<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/0JOFhyF5bT.jpeg">
  <link rel="icon" type="image/png" href="/img/0JOFhyF5bT.jpeg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="mz2sj">
  <meta name="keywords" content="">
  <title>01-爬虫入门 ~ 微风和暖</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>微风和暖</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期二, 四月 21日 2020, 6:10 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    1k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      4 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h3 id="http请求"><a class="markdownIt-Anchor" href="#http请求"></a> HTTP请求</h3>
<p>对于http请求，记录一下常用的几种：</p>
<ol>
<li>GET：向指定的资源发出“显示”请求。GET方法应该只用于读取数据 ，查询字符串（名称/值对）是在 GET 请求的 URL 中发送的 。</li>
<li>POST：向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求文本中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。  查询字符串（名称/值对）是在 POST 请求的 HTTP 消息主体中发送的</li>
<li>PUT：向指定资源位置上传输最新内容。</li>
<li>DELETE：请求服务器删除Request-URL所标识的资源。</li>
</ol>
<h3 id="requestsget"><a class="markdownIt-Anchor" href="#requestsget"></a> requests.get</h3>
<p>实现基本的requests应用，爬取python之禅</p>
<pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests
url=<span class="hljs-string">'https://www.python.org/dev/peps/pep-0020/'</span>
res=request.get(url)
text=res.text
</code></pre>
<p>此时返回的text是html原生文本，想要获取对应内容就需要进行匹配了。</p>
<pre class="highlight"><code class="python"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python.txt'</span>,<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    f.write(text[text.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:text.find(<span class="hljs-string">'&lt;/pre&gt;'</span>)<span class="hljs-number">-1</span>])
print(text[text.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:text.find(<span class="hljs-string">'&lt;/pre'</span>)<span class="hljs-number">-1</span>])

Beautiful <span class="hljs-keyword">is</span> better than ugly.
Explicit <span class="hljs-keyword">is</span> better than implicit.
Simple <span class="hljs-keyword">is</span> better than complex.
Complex <span class="hljs-keyword">is</span> better than complicated.
Flat <span class="hljs-keyword">is</span> better than nested.
Sparse <span class="hljs-keyword">is</span> better than dense.
Readability counts.
Special cases aren<span class="hljs-string">'t special enough to break the rules.
Although practicality beats purity.
Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
There should be one-- and preferably only one --obvious way to do it.
Although that way may not be obvious at first unless you'</span>re Dutch.
Now <span class="hljs-keyword">is</span> better than never.
Although never <span class="hljs-keyword">is</span> often better than *right* now.
If the implementation <span class="hljs-keyword">is</span> hard to explain, it<span class="hljs-string">'s a bad idea.
If the implementation is easy to explain, it may be a good idea.
Namespaces are one honking great idea -- let'</span>s do more of those!
</code></pre>
<p>python自带的urllib也能实现上述功能</p>
<pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> urllib
url = <span class="hljs-string">'https://www.python.org/dev/peps/pep-0020/'</span>
res=urllib.request.urlopen(url).read().decode(<span class="hljs-string">'utf-8'</span>)
print(res[res.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:res.find(<span class="hljs-string">'&lt;/pre'</span>)<span class="hljs-number">-1</span>])
</code></pre>
<p>urllib明显要繁琐些。</p>
<h3 id="requestpost"><a class="markdownIt-Anchor" href="#requestpost"></a> request.post</h3>
<p>request.get只是从网站上爬取已有数据，当我们需要和网站进行数据交互时，就要用到post方法。</p>
<pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">translate</span><span class="hljs-params">(word)</span>:</span>
    url=<span class="hljs-string">"http://fy.iciba.com/ajax.php?a=fy"</span>
    data={
        <span class="hljs-string">'f'</span>:<span class="hljs-string">'auto'</span>,
        <span class="hljs-string">'t'</span>:<span class="hljs-string">'atuo'</span>,
        <span class="hljs-string">'w'</span>:word,
    }
    
    headers={<span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36'</span>}
    
    response=requests.post(url,data=data,headers=headers)
    json_data=response.json()
    <span class="hljs-keyword">return</span> json_data

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(word)</span>:</span>
    result=tranlate(word)[<span class="hljs-string">'content'</span>][<span class="hljs-string">'out'</span>]
    print(result)
    <span class="hljs-keyword">return</span> result

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python.txt'</span>) <span class="hljs-keyword">as</span> f:
        zh=[run(word) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> f]
        
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python_zh-CN.txt'</span>,<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> g:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> zh:
            g.write(i+<span class="hljs-string">'\n'</span>)

<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<p>data内容和格式的确定需要从chrome的检查工具network中的Headers获取。</p>
<h3 id="爬取豆瓣电影top250"><a class="markdownIt-Anchor" href="#爬取豆瓣电影top250"></a> 爬取豆瓣电影top250</h3>
<ol>
<li>首先要找到我们要爬取的东西在网页的位置，借助检查工具，可以找到对用位置的代码：</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/04/21/JGGbKs.png" srcset="/img/loading.gif" alt="JGGbKs.png" /></p>
<p>借助匹配规则就可以拿到想要的东西（ps：还不会匹配呀，应该是要根据html元素的层级关系来匹配）。借助检查工具中的<strong>Copy Xpath</strong>功能，可以找到电影名和图片超链接的位置。</p>
<p><img src="https://s1.ax1x.com/2020/04/21/JGt7xe.png" srcset="/img/loading.gif" alt="JGt7xe.png" /></p>
<p>获取电影名和图片超链接的Xpath公式为</p>
<pre class="highlight"><code class="python">//*[@id=<span class="hljs-string">"content"</span>]/div/div[<span class="hljs-number">1</span>]/ol/li[<span class="hljs-number">23</span>]/div/div[<span class="hljs-number">1</span>]/a/img/@alt
//*[@id=<span class="hljs-string">"content"</span>]/div/div[<span class="hljs-number">1</span>]/ol/li[<span class="hljs-number">23</span>]/div/div[<span class="hljs-number">1</span>]/a/img/@src
</code></pre>
<p>其中23是电影对应的当前页次序，范围是1-25，刚开始以为是电影的排名还出错了。</p>
<ol start="2">
<li>电影分布在好几个页面，所以还要找出翻页的规律，借助检查工具点击页码，找到对应位置的代码：</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/04/21/JGJtJS.png" srcset="/img/loading.gif" alt="JGJtJS.png" /></p>
<p>可以发现其中url对应的数字规律，0 25 50…</p>
<pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree
<span class="hljs-keyword">import</span> time


dic={}
headers={
      <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36'</span>
    }


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_name_imgpath</span><span class="hljs-params">(text)</span>:</span>
    html = etree.HTML(text)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">26</span>):
        name = html.xpath(<span class="hljs-string">'//*[@id="content"]/div/div[1]/ol/li[{}]/div/div[1]/a/img/@alt'</span>.format(i))
        img_path=html.xpath(<span class="hljs-string">'//*[@id="content"]/div/div[1]/ol/li[{}]/div/div[1]/a/img/@src'</span>.format(i))
        print(name[<span class="hljs-number">0</span>],img_path[<span class="hljs-number">0</span>])
        dic.update({name[<span class="hljs-number">0</span>]:img_path[<span class="hljs-number">0</span>]})

print(<span class="hljs-string">'crawl start'</span>)

<span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">226</span>,<span class="hljs-number">25</span>):
    text=requests.get(<span class="hljs-string">'https://movie.douban.com/top250?start={}&amp;filter='</span>.format(page),headers=headers).text
    get_name_imgpath(text)
    time.sleep(<span class="hljs-number">1</span>)
    
print(<span class="hljs-string">'crawl finish'</span>)
print(dic)
</code></pre>
<p>程序运行成功</p>
<p><img src="https://s1.ax1x.com/2020/04/21/JGfZ24.png" srcset="/img/loading.gif" alt="JGfZ24.png" /></p>
<p>收工！！！</p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/%E7%88%AC%E8%99%AB">爬虫</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/%E7%88%AC%E8%99%AB">爬虫</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <script defer src="https://utteranc.es/client.js"
          repo="mz2sj/utterances"
          issue-term="pathname"
  
          label="utterances"
    
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "01-爬虫入门&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>



  

  
    <!-- KaTeX -->
    <link rel="stylesheet" href="/lib/katex/katex.min.css"  >
  









</body>
</html>
