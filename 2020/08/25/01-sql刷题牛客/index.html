<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/0JOFhyF5bT.jpeg">
  <link rel="icon" type="image/png" href="/img/0JOFhyF5bT.jpeg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="mz2sj">
  <meta name="keywords" content="">
  <title>01-sql刷题牛客 ~ 微风和暖</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>微风和暖</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期二, 八月 25日 2020, 11:22 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    21.8k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      102 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <p>今天是刷题记录的第一天，加油啦，小孟冲冲冲！！！</p>
<ol>
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找最晚入职员工的所有信息，为了减轻入门难度，目前所有的数据里员工入职的日期都不是同一天(sqlite里面的注释为<span class="hljs-comment">--,mysql为comment)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees (

<span class="hljs-string">`emp_no int(11) NOT NULL, -- '员工编号'`</span>

<span class="hljs-string">`birth_date date NOT NULL,`</span>

<span class="hljs-string">`first_name varchar(14) NOT NULL,`</span>

<span class="hljs-string">`last_name varchar(16) NOT NULL,`</span>

<span class="hljs-string">`gender char(1) NOT NULL,`</span>

<span class="hljs-string">`hire_date date NOT NULLPRIMARY KEY (emp_no));
</span></code></pre>
<p>自己的写法，考虑的不是那么全面，只能查出一条数据</p>
<pre class="highlight"><code class="mysql">SELECT * FROM employees
ORDER BY hire_date DESC
LIMIt 1;
</code></pre>
<p>但是假如最后一天有多人入职，这种写法就hold不住了。</p>
<pre class="highlight"><code class="mysql">SELECT * FROM employees
WHERE hire_date=(SELECT MAX(hire_date) FROM employees);
</code></pre>
<ol start="2">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找入职员工时间排名倒数第三的员工所有信息，为了减轻入门难度，目前所有的数据里员工入职的日期都不是同一天
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>这题主要的考点是查找倒数第三，这种关于顺序的问题可以用 LIMIT(A,B)来处理，表示从第A行取第B个数据，LIMIT(2,1)意思就是从第2个数据取第1个数据，也就是第三名。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees
<span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">2</span>,<span class="hljs-number">1</span>);
</code></pre>
<ol start="3">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找各个部门当前(dept_manager.to_date='9999-01-01')领导当前(salaries.to_date='9999-01-01')薪水详情以及其对应部门编号dept_no(注:请以salaries表为主表进行查询，输出结果以salaries.emp_no升序排序，并且请注意输出结果里面dept_no列是最后一列)

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '员工编号',</span>
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span>
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '员工编号'</span>
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
</code></pre>
<p>常规的连接查询，注意输出就可以了</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,s.from_date,s.to_date,dm.dept_no
<span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm
<span class="hljs-keyword">ON</span> s.emp_no=dm.emp_no
<span class="hljs-keyword">WHERE</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s.emp_no <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="4">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找所有已经分配部门的员工的last_name和first_name以及dept_no(请注意输出描述里各个列的前后顺序)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>两个表只有一个共同列，直接使用内连接。此外，因为dept_no 已经指定ＮＯＴ　ＮＵＬＬ了所以题目所有的员工必然都分配了部门。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,de.dept_no
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de
<span class="hljs-keyword">ON</span> e.emp_no=de.emp_no
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> (de.dept_no <span class="hljs-keyword">ISNULL</span>);
</code></pre>
<p>５.</p>
<pre class="highlight"><code class="sql">查找所有员工的last_name和first_name以及对应部门编号dept_no，也包括暂时没有分配具体部门的员工(请注意输出描述里各个列的前后顺序)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>这题说了包括暂时没有分配具体部门的员工,所有只要是员工就得查出来,所以对employees使用左连接啦,使用内连接的话,有的员工可能没有分配部门,那么部门表就不会有他,那再内连接就找不到他的数据了.</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,de.dept_no
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de
<span class="hljs-keyword">ON</span> e.emp_no=de.emp_no;
</code></pre>
<ol start="6">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找所有员工入职时候的薪水情况，给出emp_no以及salary， 并按照emp_no进行逆序(请注意，一个员工可能有多次涨薪的情况)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>几天不写手感又生疏了呢！重点在于刚入职，入职时间就是hire_date呀</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,s.salary <span class="hljs-keyword">FROM</span>
employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s
<span class="hljs-keyword">ON</span> e.emp_no=s.emp_no
<span class="hljs-keyword">AND</span> s.from_date=e.hire_date
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.emp_no <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>也可以用聚合函数，HAVING用来进行过滤</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary <span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no 
<span class="hljs-keyword">HAVING</span> from_date=<span class="hljs-keyword">MIN</span>(from_date)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="7">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找薪水变动超过15次的员工号emp_no以及其对应的变动次数t
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>这题考察的还是聚合函数，注意题目要求变动次数t</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no
<span class="hljs-keyword">HAVING</span> t&gt;<span class="hljs-number">15</span>;
</code></pre>
<ol start="8">
<li></li>
</ol>
<pre class="highlight"><code class="sql">找出所有员工当前(to_date='9999-01-01')具体的薪水salary情况，对于相同的薪水只显示一次,并按照逆序显示
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>单纯的查salary表里有多少个salary，相同薪水只显示一次，用DISTINCT可以解决</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(salary)
<span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>看讨论区说DISTINCT消耗资源较大，用GROUP BY 解决数据重复问题,注意GROUP BY 要放在WHERE 子句后面</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> salary
<span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> salary
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="9">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有部门当前(dept_manager.to_date='9999-01-01')manager的当前(salaries.to_date='9999-01-01')薪水情况，给出dept_no, emp_no以及salary(请注意，同一个人可能有多条薪水情况记录)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>注意时间，其他没什么</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dm.dept_no,s.emp_no,s.salary
<span class="hljs-keyword">FROM</span> dept_manager dm <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s 
<span class="hljs-keyword">ON</span> dm.emp_no=s.emp_no
<span class="hljs-keyword">WHERE</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<ol start="10">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有非manager的员工emp_no
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>这个题的特点是解法多，先来简单的</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no <span class="hljs-keyword">FROM</span> employees e
<span class="hljs-keyword">WHERE</span> e.emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
(<span class="hljs-keyword">SELECT</span> dm.emp_no <span class="hljs-keyword">FROM</span> dept_manager dm);
</code></pre>
<p>也可以利用连接查询获取dept_no为空的员工</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_manager dm
<span class="hljs-keyword">ON</span> e.emp_no=dm.emp_no
<span class="hljs-keyword">WHERE</span> dm.dept_no  <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;
</code></pre>
<p>还有集合运算的解法</p>
<p>EXCEPT 集合差运算|UNION 集合并运算|INTERSECT 集合交运算</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> employees
<span class="hljs-keyword">EXCEPT</span>
<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager;
</code></pre>
<ol start="11">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有员工当前的(dept_manager.to_date='9999-01-01')manager，如果员工是manager的话不显示(也就是如果当前的manager是自己的话结果不显示)。输出结果第一列给出当前员工的emp_no,第二列给出其manager对应的emp_no。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '所有的员工编号'</span>
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span>
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span>
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '经理编号'</span>
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
</code></pre>
<p>关于时间限制的坑，还有一点就是该关联的键是dept_no,是根据dept_no来找相同部门的,再有一点就是学到了<code>&lt;&gt;</code>不等于。<code>NOT IN</code>的写法也是可以的，但是要是查询的结果，比较两个单独变量相等用不等于呀。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.emp_no <span class="hljs-keyword">AS</span> emp_no,dm.emp_no <span class="hljs-keyword">AS</span> manager_no
<span class="hljs-keyword">FROM</span> dept_emp de <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm 
<span class="hljs-keyword">ON</span> de.dept_no=dm.dept_no
<span class="hljs-keyword">WHERE</span> de.emp_no &lt;&gt; dm.emp_no <span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span>
</code></pre>
<ol start="12">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有部门中当前(dept_emp.to_date = '9999-01-01')员工当前(salaries.to_date='9999-01-01')薪水最高的相关信息，给出dept_no, emp_no以及其对应的salary，按照部门升序排列。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>用group_by反而错了，看下别人的解释</p>
<p><code>使用group by子句时，select子句中只能有聚合键、聚合函数、常数，就是除了常数和聚合其他键的函数外，不能有其他键，有其他键一定要使用聚合。emp_no并不符合这个要求。</code></p>
<ol start="13">
<li></li>
</ol>
<pre class="highlight"><code class="sql">从titles表获取按照title进行分组，每组个数大于等于2，给出title以及对应的数目t。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"titles"</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);
</code></pre>
<p>简单的GROUP BY~</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> t
<span class="hljs-keyword">FROM</span> titles
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> title;
</code></pre>
<ol start="14">
<li></li>
</ol>
<pre class="highlight"><code class="从titles表获取按照title进行分组，每组个数大于等于2，给出title以及对应的数目t。">注意对于重复的emp_no进行忽略(即emp_no重复的title不计算，title对应的数目t不增加)。
CREATE TABLE IF NOT EXISTS `titles` (
`emp_no` int(11) NOT NULL,
`title` varchar(50) NOT NULL,
`from_date` date NOT NULL,
`to_date` date DEFAULT NULL);
</code></pre>
<p>重复的emp_no可以用DISTINCT区分，记住一个点，去重用DISTINCT</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> emp_no) <span class="hljs-keyword">AS</span> t
<span class="hljs-keyword">FROM</span> titles
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> title
<span class="hljs-keyword">HAVING</span> t&gt;=<span class="hljs-number">2</span>;
</code></pre>
<ol start="15">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找employees表所有emp_no为奇数，且last_name不为Mary(注意大小写)的员工信息，并按照hire_date逆序排列(题目不能使用mod函数)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>被这个不能使用mod函数给唬住了，咱还可以使用<code>%</code>嘛</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees
<span class="hljs-keyword">WHERE</span> last_name!=<span class="hljs-string">'Mary'</span> <span class="hljs-keyword">AND</span> emp_no%<span class="hljs-number">2</span>==<span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="16">
<li></li>
</ol>
<pre class="highlight"><code class="sql">统计出当前(titles.to_date='9999-01-01')各个title类型对应的员工当前(salaries.to_date='9999-01-01')薪水对应的平均工资。结果给出title以及平均工资avg。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"titles"</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);
</code></pre>
<p>GROUPY BY 要放在WHERE之后，WHERE子句中不能使用GROUPY BY</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t.title,<span class="hljs-keyword">AVG</span>(s.salary) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">avg</span>
<span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> titles t
<span class="hljs-keyword">ON</span> s.emp_no=t.emp_no
<span class="hljs-keyword">WHERE</span> t.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t.title;
</code></pre>
<ol start="17">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取当前（to_date='9999-01-01'）薪水第二多的员工的emp_no以及其对应的薪水salary
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>先上一个错误做法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary
<span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
</code></pre>
<p>假如最大工资又两个是相同的，那么这样拿到的数据就不是第二大的了。以后碰到这种牵扯导顺序的题，要考虑能否把数据查全查准，用GROUP BY 查到值排名顺序的数据</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary
<span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> salary =(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
<span class="hljs-keyword">AND</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<ol start="18">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找当前薪水(to_date='9999-01-01')排名第二多的员工编号emp_no、薪水salary、last_name以及first_name，你可以不使用order by完成吗
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>排序题不让用ORDER BY,求第二大salary,小于最大值中的最大值就是第二大啦.</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,<span class="hljs-keyword">MAX</span>(s.salary),e.last_name,e.first_name
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no
<span class="hljs-keyword">WHERE</span> s.salary&lt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries)
<span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<p>当然这种只能求解第二高，下面这个有点难，表内条件自连接</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> e.emp_no,s.salary,e.last_name,e.first_name
<span class="hljs-keyword">from</span>
employees e
<span class="hljs-keyword">join</span> 
salaries s <span class="hljs-keyword">on</span> e.emp_no=s.emp_no 
<span class="hljs-keyword">and</span>  s.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">and</span> s.salary = 
(
     <span class="hljs-keyword">select</span> s1.salary
     <span class="hljs-keyword">from</span> 
     salaries s1
     <span class="hljs-keyword">join</span>
     salaries s2 <span class="hljs-keyword">on</span> s1.salary&lt;=s2.salary 
     <span class="hljs-keyword">and</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">and</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span>
     <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> s1.salary
     <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> s2.salary)=<span class="hljs-number">2</span>
 )
</code></pre>
<ol start="19">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找所有员工的last_name和first_name以及对应的dept_name，也包括暂时没有分配部门的员工
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>考察外联结</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,d.dept_name
<span class="hljs-keyword">FROM</span> (employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no)
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> d.dept_no=de.dept_no;
</code></pre>
<p>也可以这样写</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,d.dept_name
<span class="hljs-keyword">FROM</span> (employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no) <span class="hljs-keyword">AS</span> t
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> d.dept_no=t.dept_no;
</code></pre>
<ol start="20">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找员工编号emp_no为10001其自入职以来的薪水salary涨幅(总共涨了多少)growth(可能有多次涨薪，没有降薪)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>是计算涨幅呀，最简单的</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary)-<span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">AS</span> growth <span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span>;
</code></pre>
<p>保险起见还是按照日期来选初始工资和近期工资</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> from_date <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
-
(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> from_date <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
<span class="hljs-keyword">AS</span> growth;
</code></pre>
<ol start="21">
<li></li>
</ol>
<pre class="highlight"><code class="sql">查找所有员工自入职以来的薪水涨幅情况，给出员工编号emp_no以及其对应的薪水涨幅growth，并按照growth进行升序
（注:可能有employees表和salaries表里存在记录的员工，有对应的员工编号和涨薪记录，但是已经离职了，离职的员工salaries表的最新的to_date!='9999-01-01'，这样的数据不显示在查找结果里面）
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '入职时间'</span>
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '一条薪水记录开始时间'</span>
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '一条薪水记录结束时间'</span>
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>这题的重点是找到现在的工资对应的时间和初到公司对应的时间，然后迎刃而解。注意hire_date是员工被雇佣的时间。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,a.salary-b.salary <span class="hljs-keyword">AS</span> growth
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries a
<span class="hljs-keyword">ON</span> e.emp_no=a.emp_no 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries b
<span class="hljs-keyword">ON</span> e.hire_date=b.from_date
<span class="hljs-keyword">WHERE</span> a.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> growth <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="22">
<li></li>
</ol>
<pre class="highlight"><code class="sql">统计各个部门的工资记录数，给出部门编码dept_no、部门名称dept_name以及部门在salaries表里面有多少条记录sum
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>统计各个部门，统计各个部门，明显是按某类计算肯定要GROUP BY 啊，你这脑子</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> d.dept_no,d.dept_name,<span class="hljs-keyword">COUNT</span>(t.salary) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">sum</span>
<span class="hljs-keyword">FROM</span> (salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de
<span class="hljs-keyword">ON</span> s.emp_no=de.emp_no) <span class="hljs-keyword">AS</span> t
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d
<span class="hljs-keyword">ON</span> t.dept_no=d.dept_no
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.dept_no;
</code></pre>
<p>23.❌</p>
<pre class="highlight"><code class="sql">对所有员工的当前(to_date='9999-01-01')薪水按照salary进行按照1-N的排名，相同salary并列且按照emp_no升序排列
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>这题的难点是如何在不同rank()函数的情况下进行排名，排序其实可以转化为当前值小于其他值的个数，又因为salary有并列行为，所以进行计数时要使用distinct，至于有的人提到使用groupby这点还没太看懂。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s1.emp_no,s1.salary ,
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> s2.salary) <span class="hljs-keyword">FROM</span> salaries s2 <span class="hljs-keyword">WHERE</span> s2.salary&gt;=s1.salary
<span class="hljs-keyword">AND</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">rank</span>
<span class="hljs-keyword">FROM</span> salaries s1
<span class="hljs-keyword">WHERE</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">rank</span>,s1.emp_no <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>起始sql中有关排序的函数也可以解决上面的问题</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> emp_no,salary, <span class="hljs-keyword">dense_rank</span>() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">desc</span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">rank</span>
<span class="hljs-keyword">from</span> salaries
<span class="hljs-keyword">where</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rank</span> <span class="hljs-keyword">asc</span>,emp_no <span class="hljs-keyword">asc</span>;
</code></pre>
<p>下面介绍几个函数的区别:</p>
<p>比如对分数进行排名：90、85、85、70</p>
<p><code>ROW_NUMBER:1,2,3,4</code></p>
<p><code>RANK:1,2,2,4</code></p>
<p><code>DENSE_RANK:1、2、2、3</code></p>
<p><code>NTILE</code>函数是将有序分区中的行分发到指定数目的组中，各个组有编号，编号从1开始，就像我们说的’分区’一样 ，分为几个区，一个区会有多少个。</p>
<ol start="24">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有非manager员工当前的薪水情况，给出dept_no、emp_no以及salary ，当前表示to_date='9999-01-01'
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>这个没有很难，但是前面salary少写了一个字母就耽误了很长时间。这里不能<code>INNNER JOIN dept_manager</code>，否则就只生下来manager，写代码还是要有逻辑，不能瞎写。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.dept_no,s.emp_no,s.salary
<span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> s.emp_no=de.emp_no  <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">WHERE</span> de.emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager) <span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<p>25.❌</p>
<pre class="highlight"><code class="sql">获取员工其当前的薪水比其manager当前薪水还高的相关信息，当前表示to_date='9999-01-01',
结果第一列给出员工的emp_no，
第二列给出其manager的manager_no，
第三列给出该员工当前的薪水emp_salary,
第四列给该员工对应的manager当前的薪水manager_salary
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>看到这种题目要学会分解，dept_emp和salaries能组成员工薪水表，dept_manager和salaies能组成经理薪水表，两者都共有一个dept_no，那么只要两者dept_no相同，再比较两表的薪水大小就ok了。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,t2.emp_no <span class="hljs-keyword">AS</span> manager_no,t1.salary <span class="hljs-keyword">AS</span> emp_salary,t2.salary <span class="hljs-keyword">AS</span> manager_salary <span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,de.dept_no <span class="hljs-keyword">FROM</span> salaries s 
 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> s.emp_no=de.emp_no <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span>)
 t1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 
 (<span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,dm.dept_no <span class="hljs-keyword">FROM</span> salaries s
 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm <span class="hljs-keyword">ON</span> s.emp_no=dm.emp_no <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span>)
 t2 <span class="hljs-keyword">ON</span> t1.dept_no=t2.dept_no
<span class="hljs-keyword">WHERE</span> t1.salary&gt;t2.salary;
</code></pre>
<p>这里还有一个点就是JOIN后的ON的表达式不仅局限于等于还可以使用大于等于，和where语句起到的作用相似。或者用下面这种写法，将复杂查询分为两个简单查询，再组合。salary表可以出现两次，用where字句起到类似join的作用。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s1.emp_no,s2.emp_no <span class="hljs-keyword">AS</span> manager_no,s1.salary <span class="hljs-keyword">AS</span> emp_salary,s2.salary <span class="hljs-keyword">AS</span> manager_salary
<span class="hljs-keyword">FROM</span> dept_emp de,dept_manager dm,salaries s1,salaries s2
<span class="hljs-keyword">WHERE</span> de.emp_no=s1.emp_no
<span class="hljs-keyword">AND</span> dm.emp_no=s2.emp_no
<span class="hljs-keyword">AND</span> de.dept_no=dm.dept_no
<span class="hljs-keyword">AND</span> s1.salary&gt;s2.salary
<span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">AND</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">AND</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span>
</code></pre>
<ol start="26">
<li></li>
</ol>
<pre class="highlight"><code class="sql">汇总各个部门当前员工的title类型的分配数目，即结果给出部门编号dept_no、dept_name、其部门下所有的当前(dept_emp.to_date = '9999-01-01')员工的当前(titles.to_date = '9999-01-01')title以及该类型title对应的数目count，结果按照dept_no升序排序
(注：因为员工可能有离职，所有dept_emp里面to_date不为'9999-01-01'就已经离职了，不计入统计，而且员工可能有晋升，所以如果titles.to_date 不为 '9999-01-01'，那么这个可能是员工之前的职位信息，也不计入统计)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`titles`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);
输入描述:
</code></pre>
<p>自己竟然写出来了</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.dept_no,d.dept_name,t.title,<span class="hljs-keyword">COUNT</span>(de.emp_no) <span class="hljs-keyword">as</span> <span class="hljs-keyword">count</span>
<span class="hljs-keyword">FROM</span> dept_emp de <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> titles t <span class="hljs-keyword">ON</span> de.emp_no=t.emp_no <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> de.dept_no=d.dept_no
<span class="hljs-keyword">WHERE</span> de.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> t.to_date=<span class="hljs-string">'9999-01-01'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> de.dept_no,t.title;
</code></pre>
<p>这道题也不难，无脑连接后加上条件再groupby就ok了，倒是groupby的用法自己又快忘光了呢！</p>
<ol start="27">
<li>❌</li>
</ol>
<pre class="highlight"><code class="sql">给出每个员工每年薪水涨幅超过5000的员工编号emp_no、薪水变更开始日期from_date以及薪水涨幅值salary_growth，并按照salary_growth逆序排列。
提示：在sqlite中获取datetime时间对应的年份函数为strftime('%Y', to_date)
(数据保证每个员工的每条薪水记录to_date-from_date=1年，而且同一员工的下一条薪水记录from_data=上一条薪水记录的to_data)

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
如：插入
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">52117</span>,<span class="hljs-string">'1986-06-26'</span>,<span class="hljs-string">'1987-06-26'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">62102</span>,<span class="hljs-string">'1987-06-26'</span>,<span class="hljs-string">'1988-06-25'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1996-08-03'</span>,<span class="hljs-string">'1997-08-03'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1997-08-03'</span>,<span class="hljs-string">'1998-08-03'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1998-08-03'</span>,<span class="hljs-string">'1999-08-03'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10003</span>,<span class="hljs-number">43616</span>,<span class="hljs-string">'1996-12-02'</span>,<span class="hljs-string">'1997-12-02'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10003</span>,<span class="hljs-number">43466</span>,<span class="hljs-string">'1997-12-02'</span>,<span class="hljs-string">'1998-12-02'</span>);
</code></pre>
<p>先放上自己的写法，对于同一个人相邻两条记录的比较我们可以直接让同样的表按某种条件内连接就ok</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> 
s1.emp_no,s2.from_date,(s2.salary-s1.salary) <span class="hljs-keyword">AS</span> salary_growth
<span class="hljs-keyword">FROM</span> salaries s1  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s2
<span class="hljs-keyword">ON</span> s1.emp_no=s2.emp_no <span class="hljs-keyword">AND</span> s1.to_date=s2.from_date
<span class="hljs-keyword">WHERE</span> salary_growth&gt;<span class="hljs-number">5000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary_growth <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>这道题评论也给我看晕了，主要是存在多次涨薪的问题，比如说在一年内多次涨薪的问题。给我整晕了。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s2.emp_no, s2.from_date, (s2.salary - s1.salary) <span class="hljs-keyword">AS</span> salary_growth
<span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">AS</span> s1, salaries <span class="hljs-keyword">AS</span> s2
<span class="hljs-keyword">WHERE</span> s1.emp_no = s2.emp_no 
<span class="hljs-keyword">AND</span> salary_growth &gt; <span class="hljs-number">5000</span>
<span class="hljs-keyword">AND</span> (strftime(<span class="hljs-string">"%Y"</span>,s2.to_date) - strftime(<span class="hljs-string">"%Y"</span>,s1.to_date) = <span class="hljs-number">1</span> 
     <span class="hljs-keyword">OR</span> strftime(<span class="hljs-string">"%Y"</span>,s2.from_date) - strftime(<span class="hljs-string">"%Y"</span>,s1.from_date) = <span class="hljs-number">1</span> )
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary_growth <span class="hljs-keyword">DESC</span>
</code></pre>
<p>写上去就算看一看strftime的用法吧。<br />
28.❌</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (
film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
description <span class="hljs-built_in">text</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (film_id));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,
<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,
PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (
film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);
查找描述信息(film.description)中包含robot的电影对应的分类名称(category.name)以及电影数目(count(film.film_id))，而且还需要该分类包含电影总数量(count(film_category.category_id))&gt;=5部
</code></pre>
<p>第二个条件有点无语，不是太理解,正确答案的理解是这两个条件是并列关系。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span>,<span class="hljs-keyword">count</span>(<span class="hljs-keyword">name</span>)
<span class="hljs-keyword">from</span> film,film_category,<span class="hljs-keyword">category</span>
<span class="hljs-keyword">where</span> film.description <span class="hljs-keyword">like</span> <span class="hljs-string">'%robot%'</span> <span class="hljs-keyword">and</span> film.film_id= film_category.film_id <span class="hljs-keyword">and</span> film_category.category_id= category.category_id
<span class="hljs-keyword">and</span> category.category_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> category_id <span class="hljs-keyword">from</span> film_category <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> category_id <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(film_id)&gt;=<span class="hljs-number">5</span>)
</code></pre>
<p>自己的想法是先满足第一个条件后，再分组，不过通不过测试</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> c.name,<span class="hljs-keyword">COUNT</span>(f.film_id) <span class="hljs-keyword">AS</span> film_num
<span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> c <span class="hljs-keyword">ON</span> c.category_id=fc.category_id
<span class="hljs-keyword">WHERE</span> f.description <span class="hljs-keyword">like</span> <span class="hljs-string">'%robot%'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c.category_id
<span class="hljs-keyword">HAVING</span> film_num&gt;=<span class="hljs-number">5</span>;
</code></pre>
<ol start="29">
<li></li>
</ol>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (
film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
description <span class="hljs-built_in">text</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (film_id));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,
<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,
PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (
film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);
使用join查询方式找出没有分类的电影id以及名称
</code></pre>
<p>看清题目，判断是否为NULL，用IS</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> f.film_id,f.title
<span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id 
<span class="hljs-keyword">WHERE</span> fc.category_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;
</code></pre>
<ol start="30">
<li></li>
</ol>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (
film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
description <span class="hljs-built_in">text</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (film_id));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,
<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,
PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (
film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);
你能使用子查询的方式找出属于Action分类的所有电影对应的title,description吗
</code></pre>
<p>注意action的条件</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> f.title,f.description 
<span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> c <span class="hljs-keyword">ON</span> fc.category_id=c.category_id
<span class="hljs-keyword">WHERE</span> c.name=<span class="hljs-string">'Action'</span>;
</code></pre>
<p>题目还提到要用子查询的方式</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,description <span class="hljs-keyword">FROM</span> film <span class="hljs-keyword">where</span> film_id <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> film_id <span class="hljs-keyword">from</span> film_category <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> category_id <span class="hljs-keyword">from</span> <span class="hljs-keyword">category</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">name</span>=<span class="hljs-string">'Action'</span>))
</code></pre>
<ol start="31">
<li></li>
</ol>
<pre class="highlight"><code class="sql">将employees表的所有员工的last_name和first_name拼接起来作为Name，中间以一个空格区分
(注：sqllite,字符串拼接为 || 符号，不支持concat函数，mysql支持concat函数)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> last_name || <span class="hljs-string">' '</span> || first_name
<span class="hljs-keyword">FROM</span> employees;
</code></pre>
<p>再看看CONCAT用法</p>
<pre class="highlight"><code class="sql">CONCAT方法：
<span class="hljs-keyword">select</span> <span class="hljs-keyword">CONCAT</span>(<span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">" "</span>),first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span>  <span class="hljs-keyword">from</span> employees
或者
<span class="hljs-keyword">select</span> <span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">" "</span>，first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span>  <span class="hljs-keyword">from</span> employees
</code></pre>
<ol start="32">
<li></li>
</ol>
<p>创建一个actor表，包含如下列信息</p>
<table>
<thead>
<tr>
<th style="text-align:left">列表</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">是否为NULL</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">actor_id</td>
<td style="text-align:left">smallint(5)</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">主键id</td>
</tr>
<tr>
<td style="text-align:left">first_name</td>
<td style="text-align:left">varchar(45)</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">名字</td>
</tr>
<tr>
<td style="text-align:left">last_name</td>
<td style="text-align:left">varchar(45)</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">姓氏</td>
</tr>
<tr>
<td style="text-align:left">last_update</td>
<td style="text-align:left">date</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">日期</td>
</tr>
</tbody>
</table>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> actor(
    actor_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> ,
    first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
    last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
    last_update <span class="hljs-built_in">timestamp</span>  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">default</span> (datetime(<span class="hljs-string">'now'</span>,<span class="hljs-string">'localtime'</span>)),
    primary <span class="hljs-keyword">key</span>(actor_id)
)
</code></pre>
<ol start="33">
<li></li>
</ol>
<p>题目已经先执行了如下语句:</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> actor;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor (
   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_update  DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>)
</code></pre>
<p>请你对于表actor批量插入如下数据(不能有2条insert语句哦!)</p>
<table>
<thead>
<tr>
<th style="text-align:left">actor_id</th>
<th style="text-align:left">first_name</th>
<th style="text-align:left">last_name</th>
<th style="text-align:left">last_update</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">PENELOPE</td>
<td style="text-align:left">GUINESS</td>
<td style="text-align:left">2006-02-15 12:34:33</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">NICK</td>
<td style="text-align:left">WAHLBERG</td>
<td style="text-align:left">2006-02-15 12:34:33</td>
</tr>
</tbody>
</table>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor <span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">1</span>,<span class="hljs-string">'PENELOPE'</span>,<span class="hljs-string">'GUINESS'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>),
(<span class="hljs-number">2</span>,<span class="hljs-string">'NICK'</span>,<span class="hljs-string">'WAHLBERG'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>)
</code></pre>
<ol start="34">
<li></li>
</ol>
<p>题目已经先执行了如下语句:</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> actor;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor (
   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_update  DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> actor <span class="hljs-keyword">values</span> (<span class="hljs-string">'3'</span>, <span class="hljs-string">'WD'</span>, <span class="hljs-string">'GUINESS'</span>, <span class="hljs-string">'2006-02-15 12:34:33'</span>);
</code></pre>
<p>对于表actor插入如下数据,如果数据已经存在，请忽略(不支持使用replace操作)</p>
<table>
<thead>
<tr>
<th style="text-align:left">actor_id</th>
<th style="text-align:left">first_name</th>
<th style="text-align:left">last_name</th>
<th style="text-align:left">last_update</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">‘3’</td>
<td style="text-align:left">‘ED’</td>
<td style="text-align:left">‘CHASE’</td>
<td style="text-align:left">‘2006-02-15 12:34:33’</td>
</tr>
</tbody>
</table>
<ol start="35">
<li></li>
</ol>
<p>题目已经先执行了如下语句:</p>
<pre class="highlight"><code class="sq">drop table if exists actor;
CREATE TABLE actor (
   actor_id  smallint(5)  NOT NULL PRIMARY KEY,
   first_name  varchar(45) NOT NULL,
   last_name  varchar(45) NOT NULL,
   last_update  DATETIME NOT NULL);
insert into actor values ('3', 'WD', 'GUINESS', '2006-02-15 12:34:33');
</code></pre>
<p>对于表actor插入如下数据,如果数据已经存在，请忽略(不支持使用replace操作)</p>
<table>
<thead>
<tr>
<th style="text-align:left">actor_id</th>
<th style="text-align:left">first_name</th>
<th style="text-align:left">last_name</th>
<th style="text-align:left">last_update</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">‘3’</td>
<td style="text-align:left">‘ED’</td>
<td style="text-align:left">‘CHASE’</td>
<td style="text-align:left">‘2006-02-15 12:34:33’</td>
</tr>
</tbody>
</table>
<p>sqlite</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">ignore</span> <span class="hljs-keyword">into</span> actor 
<span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>);
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">IGNORE</span> <span class="hljs-keyword">into</span> actor 
<span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>);
</code></pre>
<ol start="36">
<li></li>
</ol>
<p>对于如下表actor，其对应的数据为:</p>
<table>
<thead>
<tr>
<th style="text-align:left">actor_id</th>
<th style="text-align:left">first_name</th>
<th style="text-align:left">last_name</th>
<th style="text-align:left">last_update</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">PENELOPE</td>
<td style="text-align:left">GUINESS</td>
<td style="text-align:left">2006-02-15 12:34:33</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">NICK</td>
<td style="text-align:left">WAHLBERG</td>
<td style="text-align:left">2006-02-15 12:34:33</td>
</tr>
</tbody>
</table>
<p>请你创建一个actor_name表，并且将actor表中的所有first_name以及last_name导入该表.</p>
<p>actor_name表结构如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">列表</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">是否为NULL</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">first_name</td>
<td style="text-align:left">varchar(45)</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">名字</td>
</tr>
<tr>
<td style="text-align:left">last_name</td>
<td style="text-align:left">varchar(45)</td>
<td style="text-align:left">not null</td>
<td style="text-align:left">姓氏</td>
</tr>
</tbody>
</table>
<p>一种写法是先建表，然后插入</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name(
first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor_name <span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor;
</code></pre>
<p>另一种是用查询到的数据建表</p>
<p>sqlite</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name
<span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor;
</code></pre>
<ol start="37">
<li></li>
</ol>
<p>针对如下表actor结构创建索引：</p>
<p>(注:在 SQLite 中,除了重命名表和在已有的表中添加列,ALTER TABLE 命令不支持其他操作，</p>
<p>mysql支持ALTER TABLE创建索引)</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor  (
   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_update  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);
</code></pre>
<p>对first_name创建唯一索引uniq_idx_firstname，对last_name创建普通索引idx_lastname</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">INDEX</span> uniq_idx_firstname <span class="hljs-keyword">ON</span> actor(first_name);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_lastname <span class="hljs-keyword">ON</span> actor(last_name);
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">INDEX</span>  uniq_idx_firstname(first_name);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> idx_lastname(last_name);
</code></pre>
<ol start="38">
<li></li>
</ol>
<p>针对actor表创建视图actor_name_view，只包含first_name以及last_name两列，并对这两列重新命名，first_name为first_name_v，last_name修改为last_name_v：</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  actor  (
   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_update datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> actor_name_view <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> first_name first_name_v,last_name last_name_v
<span class="hljs-keyword">FROM</span> actor;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> actor_name_view (fist_name_v, last_name_v) <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> first_name, last_name <span class="hljs-keyword">FROM</span> actor 
</code></pre>
<ol start="39">
<li></li>
</ol>
<pre class="highlight"><code class="sql">针对salaries表emp_no字段创建索引idx_emp_no，查询emp_no为10005, 使用强制索引。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
<span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> idx_emp_no <span class="hljs-keyword">on</span> salaries(emp_no);
</code></pre>
<p>sqlite</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries INDEXED <span class="hljs-keyword">BY</span> idx_emp_no <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10005</span>;
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries FROCE <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">BY</span> idx_emp_no <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10005</span>;
</code></pre>
<ol start="40">
<li></li>
</ol>
<p>存在actor表，包含如下列信息：</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  actor  (
   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   last_update  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);
</code></pre>
<p>现在在last_update后面新增加一列名字为create_date, 类型为datetime, NOT NULL，默认值为’2020-10-01 00:00:00’</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> create_date datetime <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">default</span>  <span class="hljs-string">'2020-10-01 00:00:00'</span> <span class="hljs-keyword">AFTER</span> last_update; 
</code></pre>
<ol start="41">
<li></li>
</ol>
<pre class="highlight"><code class="sql">构造一个触发器audit_log，在向employees_test表中插入一条数据的时候，触发插入相关的数据到audit中。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees_test(
<span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
AGE <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
ADDRESS <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">50</span>),
SALARY <span class="hljs-built_in">REAL</span>
)

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(
EMP_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);
</code></pre>
<p>begin和end之间的语句要用分号结束</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> audit_log <span class="hljs-keyword">AFTER</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> employees_test
<span class="hljs-keyword">begin</span> 
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">audit</span>(EMP_no,<span class="hljs-keyword">NAME</span>) <span class="hljs-keyword">VALUES</span>
(new.ID,new.NAME);
<span class="hljs-keyword">end</span>;
</code></pre>
<ol start="42">
<li></li>
</ol>
<pre class="highlight"><code class="sql">删除emp_no重复的记录，只保留最小的id对应的记录。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,
emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);
</code></pre>
<p>对groupby又产生了大大的疑惑，不是说select后面只能接groupby的相关字段吗</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> titles_test
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>  (
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">FROM</span> titles_test <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no)
</code></pre>
<p>两两比较找出最大值或者最小值</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> titles_test <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">in</span>(
    <span class="hljs-keyword">select</span> a.id <span class="hljs-keyword">from</span> titles_test a,titles_test b <span class="hljs-keyword">where</span> a.emp_no=b.emp_no <span class="hljs-keyword">and</span> a.id&gt;b.id)
</code></pre>
<ol start="43">
<li></li>
</ol>
<pre class="highlight"><code class="sql">将所有to_date为9999-01-01的全部更新为NULL,且 from_date更新为2001-01-01。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,
emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);

更新后的值:
titles_test 表的值：
</code></pre>
<table>
<thead>
<tr>
<th>id</th>
<th>emp_no</th>
<th>title</th>
<th>from_date</th>
<th>to_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10001</td>
<td>Senior Engineer</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>2</td>
<td>10002</td>
<td>Staff</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>3</td>
<td>10003</td>
<td>Senior Engineer</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>4</td>
<td>10004</td>
<td>Senior Engineer</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>5</td>
<td>10001</td>
<td>Senior Engineer</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>6</td>
<td>10002</td>
<td>Staff</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
<tr>
<td>7</td>
<td>10003</td>
<td>Senior Engineer</td>
<td>2001-01-01</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<p>UPDATE语句更新多列用逗号隔开哦~不是用AND</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> titles_test
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-literal">NULL</span>,from_date=<span class="hljs-string">'2001-01-01'</span> 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<ol start="44">
<li></li>
</ol>
<p>将id=5以及emp_no=10001的行数据替换成id=5以及emp_no=10005,其他数据保持不变，<strong>使用replace实现，直接使用update会报错了</strong>。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> titles_test (
   <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,
   emp_no  <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   title  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   from_date  <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
   <span class="hljs-keyword">to_date</span>  <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span>
(<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);
</code></pre>
<p>mark一下replace的用法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> titles_test <span class="hljs-keyword">SET</span> emp_no=<span class="hljs-keyword">replace</span>(emp_no,<span class="hljs-number">10001</span>,<span class="hljs-number">10005</span>) 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">5</span>;
</code></pre>
<p>全字段更新替换,会插入一条新记录。并且要将所有字段的值写出，否则将置为空。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">REPLACE</span> <span class="hljs-keyword">INTO</span> titles_test <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-number">10005</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>)
</code></pre>
<ol start="45">
<li></li>
</ol>
<p>将titles_test表名修改为titles_2017。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,
emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),
(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);
</code></pre>
<p>sqlite</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> titles_test <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> titles_2017;
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> titles_test <span class="hljs-keyword">rename</span> titles_2017
</code></pre>
<ol start="46">
<li></li>
</ol>
<p>在audit表上创建外键约束，其emp_no对应employees_test表的主键id。</p>
<p>(以下2个表已经创建了)</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees_test(
<span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
AGE <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
ADDRESS <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">50</span>),
SALARY <span class="hljs-built_in">REAL</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(
EMP_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
create_date datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);
</code></pre>
<p>先看mysql的用法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (emp_no)
<span class="hljs-keyword">REFERENCES</span> employees_test (<span class="hljs-keyword">id</span>);
</code></pre>
<p>再看sqlite,注意外键格式</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(
emp_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
create_date datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span>(emp_no) <span class="hljs-keyword">REFERENCES</span> employees_test(<span class="hljs-keyword">id</span>))
</code></pre>
<ol start="47">
<li></li>
</ol>
<pre class="highlight"><code class="sql">请你写出更新语句，将所有获取奖金的员工当前的(salaries.to_date='9999-01-01')薪水增加10%。(emp_bonus里面的emp_no都是当前获奖的所有员工)
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_bonus(
emp_no <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
btype <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
如：
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp_bonus <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10001</span>,<span class="hljs-number">1</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">85097</span>,<span class="hljs-string">'2001-06-22'</span>,<span class="hljs-string">'2002-06-22'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">88958</span>,<span class="hljs-string">'2002-06-22'</span>,<span class="hljs-string">'9999-01-01'</span>);
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salaries
<span class="hljs-keyword">SET</span> salary=salary*<span class="hljs-number">1.1</span>
<span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> emp_bonus) <span class="hljs-keyword">AND</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<ol start="48">
<li></li>
</ol>
<pre class="highlight"><code class="sql">将employees表中的所有员工的last_name和first_name通过(')连接起来。(sqlite不支持concat，请用||实现，mysql支持concat)
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
输出格式:
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> last_name || <span class="hljs-string">"'"</span> || first_name <span class="hljs-keyword">FROM</span> employees;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CONCAT</span>(last_name, <span class="hljs-string">''''</span>, first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> employees;
</code></pre>
<ol start="49">
<li></li>
</ol>
<p>查找字符串’10,A,B’ 中逗号’,'出现的次数cnt。</p>
<p>技巧题哈，学习了LENGTH 和REPLACE的用法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LENGTH</span>(<span class="hljs-string">'10,A,B'</span> )-<span class="hljs-keyword">LENGTH</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">'10,A,B'</span>,<span class="hljs-string">','</span>,<span class="hljs-string">''</span>)) <span class="hljs-keyword">AS</span> cnt
</code></pre>
<ol start="50">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取Employees中的first_name，查询按照first_name最后两个字母，按照升序进行排列
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> 
(<span class="hljs-keyword">SELECT</span> first_name,<span class="hljs-keyword">SUBSTR</span>(first_name,<span class="hljs-number">-2</span>) <span class="hljs-keyword">AS</span> first_name_2 <span class="hljs-keyword">FROM</span> employees)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name_2 <span class="hljs-keyword">ASC</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">substr</span>(first_name,<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">asc</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">from</span> employees 
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">right</span>(first_name, <span class="hljs-number">2</span>);
</code></pre>
<ol start="51">
<li></li>
</ol>
<pre class="highlight"><code class="sql">按照dept_no进行汇总，属于同一个部门的emp_no按照逗号进行连接，结果给出dept_no以及连接出的结果employees
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
输出格式:
</code></pre>
<p>记录一下GROUP_CONCAT的用法</p>
<p>sqlite</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dept_no,<span class="hljs-keyword">GROUP_CONCAT</span>(emp_no) <span class="hljs-keyword">AS</span> employees
<span class="hljs-keyword">FROM</span> dept_emp
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no;
</code></pre>
<p>mysql</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dept_no, <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">DISTINCT</span> emp_no <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no <span class="hljs-keyword">ASC</span> SEPARATOR <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> employees <span class="hljs-keyword">FROM</span> dept_emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no;
</code></pre>
<ol start="52">
<li></li>
</ol>
<pre class="highlight"><code class="SQL">查找排除最大、最小salary之后的当前(to_date = '9999-01-01' )员工的平均工资avg_salary。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
</code></pre>
<p>关于时间的限制</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(salary) <span class="hljs-keyword">AS</span> avg_salary <span class="hljs-keyword">FROM</span> salaries 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span> 
<span class="hljs-keyword">AND</span> salary <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span>)
<span class="hljs-keyword">AND</span> salary <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span>)
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">AVG</span>(salary)
<span class="hljs-keyword">FROM</span>
    salaries
<span class="hljs-keyword">WHERE</span>
    salary&lt;&gt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>) 
<span class="hljs-keyword">AND</span>
    salary&lt;&gt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>) 
<span class="hljs-keyword">AND</span>
    <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>
</code></pre>
<ol start="53">
<li></li>
</ol>
<pre class="highlight"><code class="sql">分页查询employees表，每5行一页，返回第2页的数据
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>LIMIT 后的数字代表返回几条记录，OFFSET 后的数字代表从第几条记录开始返回</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">5</span>;
</code></pre>
<p>在 LIMIT X,Y 中，Y代表返回几条记录，X代表从第几条记录开始返回（第一条记录序号为0），切勿记反。</p>
<ol start="54">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取所有员工的emp_no、部门编号dept_no以及对应的bonus类型btype和received，没有分配奖金的员工不显示对应的bonus类型btype和received
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`emp_bonus`</span>(
emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
received datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
btype <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,de.dept_no,eb.btype,eb.received
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no
</code></pre>
<ol start="55">
<li></li>
</ol>
<pre class="highlight"><code class="sql">使用含有关键字exists查找未分配具体部门的员工的所有信息。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
</code></pre>
<p>这个EXISTS当作条件判断得理解理解</p>
<p>IN是先执行子查询，得到一个结果集，将结果集代入外层谓词条件执行主查询，子查询只需要执行一次<br />
EXISTS是先从主查询中取得一条数据，再代入到子查询中，执行一次子查询，判断子查询是否能返回结果，主查询有多少条数据，子查询就要执行多少次,EXISTS中要添加判断条件？？？</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees
<span class="hljs-keyword">WHERE</span>  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> 
(<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_emp <span class="hljs-keyword">WHERE</span> employees.emp_no=dept_emp.emp_no)
</code></pre>
<ol start="56">
<li></li>
</ol>
<pre class="highlight"><code class="sql">获取有奖金的员工相关信息。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_bonus(
emp_no <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
received datetime <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,
btype <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
给出emp_no、first_name、last_name、奖金类型btype、对应的当前薪水情况salary以及奖金金额bonus。 bonus类型btype为1其奖金为薪水salary的10%，btype为2其奖金为薪水的20%，其他类型均为薪水的30%。 当前薪水表示to_date='9999-01-01'
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,e.first_name,e.last_name,eb.btype,s.salary,s.salary*eb.btype*<span class="hljs-number">0.1</span> <span class="hljs-keyword">as</span> bonus
<span class="hljs-keyword">FROM</span> employees e 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no 
<span class="hljs-keyword">WHERE</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>
</code></pre>
<p>看看CASE WHEN THEN END的用法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,e.first_name,e.last_name,eb.btype,s.salary,
(<span class="hljs-keyword">CASE</span> eb.btype
<span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.1</span>
<span class="hljs-keyword">WHEN</span> <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.2</span>
<span class="hljs-keyword">WHEN</span> <span class="hljs-number">3</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.3</span>
<span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> bonus
<span class="hljs-keyword">FROM</span> employees e 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no 
<span class="hljs-keyword">WHERE</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>
</code></pre>
<ol start="57">
<li></li>
</ol>
<pre class="highlight"><code class="sql">按照salary的累计和running_total，其中running_total为前N个当前( to_date = '9999-01-01')员工的salary累计和，其他以此类推。 具体结果如下Demo展示。。
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));
输出格式:
</code></pre>
<p>让我们来学习一种新的求和方法，两表相同按某列拍好序后，比较大小即可求和。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary,
(<span class="hljs-keyword">select</span> <span class="hljs-keyword">sum</span>(s1.salary) <span class="hljs-keyword">FROM</span> salaries s1 <span class="hljs-keyword">WHERE</span> s1.emp_no&lt;=s2.emp_no <span class="hljs-keyword">AND</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AS</span> running_total
<span class="hljs-keyword">FROM</span> salaries s2 <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s2.emp_no
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary,
<span class="hljs-keyword">SUM</span>(salary) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no) <span class="hljs-keyword">AS</span> running_total
<span class="hljs-keyword">FROM</span> salaries
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>= <span class="hljs-string">'9999-01-01'</span>;
</code></pre>
<p>58.❌</p>
<pre class="highlight"><code class="sql">对于employees表中，输出first_name排名(按first_name升序排序)为奇数的first_name
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (
<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));
</code></pre>
<p>对于这个COUNT的用法还是存疑(聚合或是满足某种条件之后？？？)，可以用于计数，两两比较之间的计数，用于排序</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees e1
<span class="hljs-keyword">WHERE</span> 
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> employees e2 <span class="hljs-keyword">WHERE</span> e1.first_name&gt;=e2.first_name)%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>;
</code></pre>
<p>用row_number() over 进行排序</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> tt.first_name
<span class="hljs-keyword">from</span>
(<span class="hljs-keyword">select</span> first_name,
row_number() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> first_name) <span class="hljs-keyword">as</span> row_idx
<span class="hljs-keyword">from</span> employees) <span class="hljs-keyword">as</span> tt
<span class="hljs-keyword">where</span> tt.row_idx%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
    e.first_name
<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">JOIN</span>
(
    <span class="hljs-keyword">SELECT</span> 
        first_name
        , ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">AS</span>  r_num
    <span class="hljs-keyword">FROM</span> employees
) <span class="hljs-keyword">AS</span> t 
<span class="hljs-keyword">ON</span> e.first_name = t.first_name
<span class="hljs-keyword">WHERE</span> t.r_num % <span class="hljs-number">2</span> = <span class="hljs-number">1</span>;
</code></pre>
<ol start="59">
<li></li>
</ol>
<p>在牛客刷题的小伙伴们都有着牛客积分，积分(grade)表简化可以如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308877503_0244CF2104BC29F1AAC07582264ADC57" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">FROM</span> grade <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">id</span>)&gt;=<span class="hljs-number">3</span>
</code></pre>
<p>这个思路也很牛逼:要三次以上的积分，那么肯定要查找3个id不同但是积分相同的情况</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-keyword">DISTINCT</span> g1.number <span class="hljs-keyword">AS</span> times
<span class="hljs-keyword">FROM</span>
    grade g1,
    grade g2,
    grade g3
<span class="hljs-keyword">WHERE</span>
    g1.id != g2.id
    <span class="hljs-keyword">AND</span> g2.id != g3.id 
    <span class="hljs-keyword">AND</span> g1.id !=g3.id
    <span class="hljs-keyword">AND</span> g1.number = g2.number
    <span class="hljs-keyword">AND</span> g2.number = g3.number
</code></pre>
<p>60.❌</p>
<p>在牛客刷题有一个通过题目个数的(passing_number)表，id是主键，简化如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308916086_6B7E692D15E9D27D855F76C56E00D52A" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为1的用户通过了4个题目;</p>
<p>…</p>
<p>第6行表示id为6的用户通过了4个题目;</p>
<p>请你根据上表，输出通过的题目的排名，通过题目个数相同的，排名相同，此时按照id升序排列，数据如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20201105/557336_1604558013211_15EB7DEE744C7810B57ED3EF3D65D7FE" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-built_in">number</span>,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> t_rank
<span class="hljs-keyword">FROM</span> passing_number <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t_rank,<span class="hljs-keyword">id</span> <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>这种做法也得理解理解</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> a.id,a.number,
(<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> b.number) <span class="hljs-keyword">from</span> passing_number b <span class="hljs-keyword">where</span> b.number&gt;=a.number )
 <span class="hljs-keyword">from</span> passing_number a <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> a.number <span class="hljs-keyword">desc</span>, a.id <span class="hljs-keyword">asc</span>;
</code></pre>
<ol start="61">
<li></li>
</ol>
<p>有一个person表，主键是id，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308809115_59865103D43294F21EB0E6AA59EE2533" srcset="/img/loading.gif" alt="" /></p>
<p>有一个任务(task)表如下，主键也是id，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308818265_982AA463886BC0847F36791DBF155842" srcset="/img/loading.gif" alt="" /></p>
<p>请你找到每个人的任务情况，并且输出出来，没有任务的也要输出，而且输出结果按照person的id升序排序，输出情况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308835496_51484617FEE1F3A5CD46EAA4F7D900CA" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> person.id,person.name,task.content
<span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task <span class="hljs-keyword">ON</span> person.id=task.person_id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> person.id <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="62">
<li></li>
</ol>
<p>现在有一个需求，让你统计正常用户发送给正常用户邮件失败的概率:<br />
有一个邮件(email)表，id为主键， type是枚举类型，枚举成员为(completed，no_completed)，completed代表邮件发送是成功的，no_completed代表邮件是发送失败的。简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652115615_43081841018939871F6352EF230E6D8E" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示为id为2的用户在2020-01-11成功发送了一封邮件给了id为3的用户;<br />
…<br />
第3行表示为id为1的用户在2020-01-11<strong>没有成功</strong>发送一封邮件给了id为4的用户;<br />
…<br />
第6行表示为id为4的用户在2020-01-12成功发送了一封邮件给了id为1的用户;</p>
<p>下面是一个用户(user)表，id为主键，is_blacklist为0代表为正常用户，is_blacklist为1代表为黑名单用户，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652932880_7440E658C1F32DF28A6F4360EAB2D9BB" srcset="/img/loading.gif" alt="" /></p>
<p>结果表示:</p>
<p>2020-01-11失败的概率为0.500，因为email的第1条数据，发送的用户id为2是黑名单用户，所以不计入统计，正常用户发正常用户总共2次，但是失败了1次，所以概率是0.500;</p>
<p>2020-01-12没有失败的情况，所以概率为0.000.<br />
(注意: sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5，sqlite四舍五入的函数为round)</p>
<p>注意先乘1.0，不然会得到0</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.date,<span class="hljs-keyword">ROUND</span>(
    <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> e.type <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'completed'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'no_completed'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">END</span>)*<span class="hljs-number">1.0</span>/<span class="hljs-keyword">COUNT</span>(e.type),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> p
<span class="hljs-keyword">FROM</span> email e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u1 <span class="hljs-keyword">ON</span> e.send_id=u1.id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u2 <span class="hljs-keyword">ON</span> e.receive_id=u2.id 
<span class="hljs-keyword">WHERE</span> u1.is_blacklist=<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> u2.is_blacklist=<span class="hljs-number">0</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> e.date <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.date;
</code></pre>
<ol start="63">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个用户最近登录是哪一天。</p>
<p>有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652540640_64D4B3DE58C69D6263B209D2B1AB6393" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />
。。。<br />
第4行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网</p>
<p>请你写出一个sql语句查询每个用户最近一天登录的日子，并且按照user_id升序排序，上面的例子查询结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20201026/557336_1603700593855_F4BBCB1D5E81A508C2A06167DCF2F5ED" srcset="/img/loading.gif" alt="" /></p>
<p>老师说过select 的字段要包含在group或者要用聚合函数</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) d
<span class="hljs-keyword">FROM</span> login
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="64">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个用户最近登录是哪一天，用的是什么设备.</p>
<p>有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200901/557336_1598928123396_B0B18451FDC78934AF1D2CF7E366835C" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />
。。。<br />
第4行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网</p>
<p>还有一个用户(user)表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652611050_C098FF7CF52D3DC2ECE5019F4E7A5E88" srcset="/img/loading.gif" alt="" /></p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652618264_F2C14AA3F53E74C2FE5A266283E56241" srcset="/img/loading.gif" alt="" /></p>
<p>请你写出一个sql语句查询每个用户最近一天登录的日子，用户的名字，以及用户用的设备的名字，并且查询结果按照user的name升序排序，上面的例子查询结果如下</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652643237_528AC16903A00B04890D9E308B2B5FDE" srcset="/img/loading.gif" alt="" /></p>
<p>老生常谈，group by后select后只能跟聚合和group by的字段</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> u.name,c.name,l.date
<span class="hljs-keyword">FROM</span> login l <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u <span class="hljs-keyword">ON</span> l.user_id=u.id 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">client</span> c <span class="hljs-keyword">ON</span> l.client_id=c.id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) max_date <span class="hljs-keyword">FROM</span> login <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id) <span class="hljs-keyword">AS</span> T <span class="hljs-keyword">ON</span> u.id=T.user_id
<span class="hljs-keyword">WHERE</span> l.date=T.max_date
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> u.name <span class="hljs-keyword">ASC</span>
</code></pre>
<p>这个答案更简明</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> u.name,c.name,l1.date
<span class="hljs-keyword">from</span> login l1,<span class="hljs-keyword">user</span> u,<span class="hljs-keyword">client</span> c
<span class="hljs-keyword">where</span> l1.date=(<span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(l2.date) <span class="hljs-keyword">from</span> login l2 <span class="hljs-keyword">where</span> l1.user_id=l2.user_id)
<span class="hljs-keyword">and</span> l1.user_id=u.id
<span class="hljs-keyword">and</span> l1.client_id=c.id
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> u.name
</code></pre>
<p>总结一下，遇到取最大最小值的问题或者是计数，可以对主键进行连接，然后增加判断条件，排序就用大于小于等于，最大最小就用max min</p>
<ol start="65">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客新登录用户的次日成功的留存率，<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20201026/557336_1603701796116_54BBC7EED94F0CAAFEC8DB042BBBCD01" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备第一次新登录了牛客网<br />
。。。</p>
<p>第4行表示id为3的用户在2020-10-12使用了客户端id为2的设备登录了牛客网</p>
<p>。。。</p>
<p>最后1行表示id为1的用户在2020-10-14使用了客户端id为2的设备登录了牛客网</p>
<p>请你写出一个sql语句查询新登录用户次日成功的留存率，即第1天登陆之后，第2天再次登陆的概率,保存小数点后面3位(3位之后的四舍五入)，上面的例子查询结果如下:</p>
<p>(sqlite里查找某一天的后一天的用法是:date(yyyy-mm-dd, ‘+1 day’)，四舍五入的函数为round，sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5</p>
<p>mysql里查找某一天的后一天的用法是:DATE_ADD(yyyy-mm-dd,INTERVAL 1 DAY)，四舍五入的函数为round)</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="66">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个日期登录新用户个数，<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903671918_2C3C4BF94A59FB9AEEA6FEA89DEE17C9" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网，因为是第1次登录，所以是新用户<br />
。。。<br />
第4行表示id为2的用户在2020-10-13使用了客户端id为2的设备登录了牛客网，因为是第2次登录，所以是老用户<br />
。。<br />
最后1行表示id为4的用户在2020-10-15使用了客户端id为1的设备登录了牛客网，因为是第2次登录，所以是老用户请你写出一个sql语句查询每个日期登录新用户个数，并且查询结果按照日期升序排序，上面的例子查询结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903683115_47DE8F52D6F847E788BB9EF6279481C4" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="67">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个日期新用户的次日留存率。<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903752757_A02F3DF1419BC2D3D4EE9B2B4557053B" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网，因为是第1次登录，所以是新用户<br />
。。。<br />
第4行表示id为2的用户在2020-10-13使用了客户端id为2的设备登录了牛客网，因为是第2次登录，所以是老用户<br />
。。<br />
最后1行表示id为4的用户在2020-10-15使用了客户端id为1的设备登录了牛客网，因为是第2次登录，所以是老用户</p>
<p>请你写出一个sql语句查询每个日期新用户的次日留存率，结果保留小数点后面3位数(3位之后的四舍五入)，并且查询结果按照日期升序排序，上面的例子查询结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903761838_F734DB69B9941F0DF86776922B0CF347" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sq">SELECT ROUND(COUNT(DISTINCT l2.user_id)*1.0/COUNT(DISTINCT l1.user_id),3)
FROM login l1,login l2
WHERE l1.user_id=l2.user_id AND l2.date=date(l1.date, '+1 day')；
</code></pre>
<ol start="68">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个日期登录新用户个数，<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903671918_2C3C4BF94A59FB9AEEA6FEA89DEE17C9" srcset="/img/loading.gif" alt="" /></p>
<p>慢慢想吧</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> a.date,
<span class="hljs-keyword">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-keyword">rank</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-keyword">new</span>
<span class="hljs-keyword">from</span> 
(<span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>, row_number() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> user_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">rank</span>
<span class="hljs-keyword">from</span> login) a
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">sum</span>(t) <span class="hljs-keyword">from</span>
(
    <span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>,
    <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (user_id,<span class="hljs-built_in">date</span>) <span class="hljs-keyword">in</span> 
    (<span class="hljs-keyword">select</span> user_id,<span class="hljs-keyword">min</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">from</span> login <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> user_id)
    <span class="hljs-keyword">then</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">end</span> <span class="hljs-keyword">as</span> t
    <span class="hljs-keyword">from</span> login
)
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">asc</span>
</code></pre>
<ol start="69">
<li></li>
</ol>
<p>牛客每天有很多人登录，请你统计一下牛客每个日期新用户的次日留存率。<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903752757_A02F3DF1419BC2D3D4EE9B2B4557053B" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql">
</code></pre>
<p>70.❌</p>
<p>牛客每天有很多人登录，请你统计一下牛客每个用户查询刷题信息，包括: 用户的名字，以及截止到某天，累计总共通过了多少题。 不存在没有登录却刷题的情况，但是存在登录了没刷题的情况，不会存在刷题表里面，有提交代码没有通过的情况，但是会记录在刷题表里，只不过通过数目是0。<br />
有一个登录(login)记录表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903934415_A5E822A1E15CEBC7E16183ECD9D7CC7A" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />
。。。<br />
第5行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网<br />
有一个刷题（passing_number)表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903944909_9C60ECB78BE56145269BDFA74F1074D3" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示id为2的用户在2020-10-12通过了4个题目。<br />
。。。<br />
第3行表示id为1的用户在2020-10-13提交了代码但是没有通过任何题目。<br />
第4行表示id为4的用户在2020-10-13通过了2个题目<br />
还有一个用户(user)表，简况如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903952301_4763AF7B377AF42CB5A87C53B965DC45" srcset="/img/loading.gif" alt="" /></p>
<p>请你写出一个sql语句查询刷题信息，包括: 用户的名字，以及截止到某天，累计总共通过了多少题，并且查询结果先按照日期升序排序，再按照姓名升序排序，有登录却没有刷题的哪一天的数据不需要输出，上面的例子查询结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20201015/557336_1602736313104_6BE4C7264FB9F7CED1DD6A6D44652D6C" srcset="/img/loading.gif" alt="" /></p>
<p>题目的含义是各个用户在不同时间累积答题求和，采用sum函数进行开窗处理，将user_id进行分区，再通过时间升序排序，进而实现了在每个user_id分区中以升序日期排序的通过题数的逐个递加</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,<span class="hljs-built_in">date</span>,
<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> user_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>)
<span class="hljs-keyword">FROM</span> passing_number p
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u
<span class="hljs-keyword">ON</span> p.user_id=u.id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">name</span>
</code></pre>
<p>还有一种是同一张表内连接的方法，这个得花时间理解，对于这种分组累加很有必要</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> u.name,pn1.date,<span class="hljs-keyword">SUM</span>(pn2.number)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> u <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> passing_number pn1 <span class="hljs-keyword">ON</span> u.id=pn1.user_id
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> passing_number pn2 <span class="hljs-keyword">ON</span> pn1.user_id=pn2.user_id
<span class="hljs-keyword">WHERE</span> pn1.date&gt;=pn2.date
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> pn1.id,pn1.date
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> pn1.date <span class="hljs-keyword">ASC</span>,u.name <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="71">
<li></li>
</ol>
<p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600513881865_4F8855D8505FBEAA5F2561794CD2C0B0" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p>
<p>。。。</p>
<p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p>
<p>请你写一个sql语句查询各个岗位分数的平均数，并且按照分数降序排序，结果保留小数点后面3位(3位之后四舍五入):</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600513888833_CE4B33A183934FE8410A2864D09E32E7" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(score),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">avg</span>
<span class="hljs-keyword">FROM</span> grade
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">avg</span> <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="72">
<li></li>
</ol>
<p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514055044_2CCD09B7C5B20F369E0D5D52AAE75E69" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p>
<p>。。。</p>
<p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p>
<p>请你写一个sql语句查询用户分数大于其所在工作(job)分数的平均分的所有grade的属性，并且以id的升序排序，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514070904_62340E72F33FAB48C78342F76BA93044" srcset="/img/loading.gif" alt="" /></p>
<p>感觉自己写的很烂</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> g.id,g.job,g.score 
<span class="hljs-keyword">FROM</span> grade g,(<span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">AVG</span>(score) avg_score <span class="hljs-keyword">FROM</span> grade <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job) <span class="hljs-keyword">AS</span> t
<span class="hljs-keyword">WHERE</span> g.job=t.job <span class="hljs-keyword">AND</span> g.score&gt;t.avg_score 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> g.id <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>这个开窗函数看起来就很简洁</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,job,score <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> *,<span class="hljs-keyword">AVG</span>(score) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> job) avg_score <span class="hljs-keyword">FROM</span> grade)
<span class="hljs-keyword">WHERE</span> score&gt;avg_score
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>;
</code></pre>
<ol start="73">
<li></li>
</ol>
<p>牛客每次举办企业笔试的时候，企业一般都会有不同的语言岗位，比如C++工程师，JAVA工程师，Python工程师，每个用户笔试完有不同的分数，现在有一个分数(grade)表简化如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652427039_07E19104EBD63DA9EDB41F5DD4489F99" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示用户id为1的选择了language_id为1岗位的最后考试完的分数为12000，<br />
…<br />
第7行表示用户id为7的选择了language_id为2岗位的最后考试完的分数为11000，</p>
<p>不同的语言岗位(language)表简化如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652437695_C8AFE1A16BE6BBA7929B73D79DE0E398" srcset="/img/loading.gif" alt="" /></p>
<p>请你找出每个岗位分数排名前2的用户，得到的结果先按照language的name升序排序，再按照积分降序排序，最后按照grade的id升序排序，得到结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652444918_D40D8F8B37A92E9E7A15A5231F7D3822" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span>,score <span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> g.id <span class="hljs-keyword">AS</span> <span class="hljs-keyword">id</span>,l.name <span class="hljs-keyword">AS</span> <span class="hljs-keyword">name</span>,g.score <span class="hljs-keyword">AS</span> score,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> g.language_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_score
<span class="hljs-keyword">FROM</span> grade g <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">language</span> l <span class="hljs-keyword">ON</span> g.language_id=l.id 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> l.name <span class="hljs-keyword">ASC</span>,score <span class="hljs-keyword">DESC</span>,<span class="hljs-keyword">id</span> <span class="hljs-keyword">ASC</span>)
<span class="hljs-keyword">WHERE</span> rank_score&lt;=<span class="hljs-number">2</span>
</code></pre>
<ol start="74">
<li></li>
</ol>
<p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514637504_1968643213375655C970A80233B90BFA" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p>
<p>。。。</p>
<p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p>
<p>请你写一个sql语句查询各个岗位分数升序排列之后的中位数位置的范围，并且按job升序排序，结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514646549_3FA97323294AEEA1C641FFAD64EF069B" srcset="/img/loading.gif" alt="" /></p>
<p>解释:</p>
<p>第1行表示C<ins>岗位的中位数位置范围为[2,2]，也就是2。因为C</ins>岗位总共3个人，是奇数，所以中位数位置为2是正确的(即位置为2的10000是中位数)</p>
<p>第2行表示Java岗位的中位数位置范围为[1,2]。因为Java岗位总共2个人，是偶数，所以要知道中位数，需要知道2个位置的数字，而因为只有2个人，所以中位数位置为[1,2]是正确的(即需要知道位置为1的12000与位置为2的13000才能计算出中位数为12500)</p>
<p>第3行表示前端岗位的中位数位置范围为[2,2]，也就是2。因为前端岗位总共3个人，是奇数，所以中位数位置为2是正确的(即位置为2的11000是中位数)</p>
<p>(注意: sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5，sqlite四舍五入的函数为round，sqlite不支持floor函数，支持cast(x as integer) 函数，不支持if函数，支持case when …then …else …end函数)</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="75">
<li></li>
</ol>
<p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514714857_0A390C0623561C804BC63A48121FD094" srcset="/img/loading.gif" alt="" /></p>
<p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p>
<p>。。。</p>
<p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p>
<p>请你写一个sql语句查询各个岗位分数的中位数位置上的所有grade信息，并且按id升序排序，结果如下:</p>
<p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514720752_917884B00BBAAAF5E9969D36073440C3" srcset="/img/loading.gif" alt="" /></p>
<pre class="highlight"><code class="sql">
</code></pre>
<p>====================================================================================</p>
<p>力扣刷题</p>
<p>====================================================================================</p>
<ol start="175">
<li></li>
</ol>
<p>表1: Person</p>
<p>±------------±--------+<br />
| 列名         | 类型     |<br />
±------------±--------+<br />
| PersonId    | int     |<br />
| FirstName   | varchar |<br />
| LastName    | varchar |<br />
±------------±--------+<br />
PersonId 是上表主键<br />
表2: Address</p>
<p>±------------±--------+<br />
| 列名         | 类型    |<br />
±------------±--------+<br />
| AddressId   | int     |<br />
| PersonId    | int     |<br />
| City        | varchar |<br />
| State       | varchar |<br />
±------------±--------+<br />
AddressId 是上表主键</p>
<p>编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供 person 的以下信息：</p>
<p>FirstName, LastName, City, State</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> p.FirstName,p.Lastname,a.City,a.State
<span class="hljs-keyword">FROM</span> Person p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Address a <span class="hljs-keyword">on</span> p.PersonId=a.PersonId;
</code></pre>
<ol start="176">
<li></li>
</ol>
<p>编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary） 。</p>
<p>±—±-------+<br />
| Id | Salary |<br />
±—±-------+<br />
| 1  | 100    |<br />
| 2  | 200    |<br />
| 3  | 300    |<br />
±—±-------+<br />
例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null。</p>
<p>±--------------------+<br />
| SecondHighestSalary |<br />
±--------------------+<br />
| 200                 |<br />
±--------------------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(e1.Salary) SecondHighestSalary <span class="hljs-keyword">FROM</span> Employee e1 
<span class="hljs-keyword">WHERE</span> e1.Salary&lt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(e2.Salary) <span class="hljs-keyword">FROM</span> Employee e2);  
</code></pre>
<ol start="177">
<li></li>
</ol>
<p>编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。</p>
<p>±—±-------+<br />
| Id | Salary |<br />
±—±-------+<br />
| 1  | 100    |<br />
| 2  | 200    |<br />
| 3  | 300    |<br />
±—±-------+<br />
例如上述 Employee 表，n = 2 时，应返回第二高的薪水 200。如果不存在第 n 高的薪水，那么查询应返回 null。</p>
<p>±-----------------------+<br />
| getNthHighestSalary(2) |<br />
±-----------------------+<br />
| 200                    |<br />
±-----------------------+</p>
<p>服了，rank()是mysql自带的函数，不能用于变量命名</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> getNthHighestSalary(N <span class="hljs-built_in">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-built_in">INT</span>
<span class="hljs-keyword">BEGIN</span>
  <span class="hljs-keyword">RETURN</span> (
      <span class="hljs-comment"># Write your MySQL query statement below.</span>
      <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Salary 
      <span class="hljs-keyword">FROM</span> (
          <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_s,
          Salary 
          <span class="hljs-keyword">FROM</span> Employee
          ) <span class="hljs-keyword">AS</span> t 
         <span class="hljs-keyword">WHERE</span> rank_s=N
  );
<span class="hljs-keyword">END</span>
</code></pre>
<ol start="178">
<li></li>
</ol>
<p>编写一个 SQL 查询来实现分数排名。</p>
<p>如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。</p>
<p>±—±------+<br />
| Id | Score |<br />
±—±------+<br />
| 1  | 3.50  |<br />
| 2  | 3.65  |<br />
| 3  | 4.00  |<br />
| 4  | 3.85  |<br />
| 5  | 4.00  |<br />
| 6  | 3.65  |<br />
±—±------+<br />
例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：</p>
<p>±------±-----+<br />
| Score | Rank |<br />
±------±-----+<br />
| 4.00  | 1    |<br />
| 4.00  | 1    |<br />
| 3.85  | 2    |<br />
| 3.65  | 3    |<br />
| 3.65  | 3    |<br />
| 3.50  | 4    |<br />
±------±-----+<br />
重要提示：对于 MySQL 解决方案，如果要转义用作列名的保留字，可以在关键字之前和之后使用撇号。例如 <code>Rank</code></p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> Score,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Score  <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Rank'</span>
<span class="hljs-keyword">FROM</span> Scores;
</code></pre>
<p>180.❗</p>
<p>编写一个 SQL 查询，查找所有至少连续出现三次的数字。</p>
<p>±—±----+<br />
| Id | Num |<br />
±—±----+<br />
| 1  |  1  |<br />
| 2  |  1  |<br />
| 3  |  1  |<br />
| 4  |  2  |<br />
| 5  |  1  |<br />
| 6  |  2  |<br />
| 7  |  2  |<br />
±—±----+<br />
例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。</p>
<p>±----------------+<br />
| ConsecutiveNums |<br />
±----------------+<br />
| 1               |<br />
±----------------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> l1.num ConsecutiveNums 
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">logs</span> l1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">logs</span> l2
<span class="hljs-keyword">ON</span> l1.Num=l2.Num <span class="hljs-keyword">AND</span> l1.Id-l2.Id <span class="hljs-keyword">between</span> <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-number">2</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> l1.id
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(l2.id)&gt;<span class="hljs-number">2</span>;
</code></pre>
<pre class="highlight"><code class="mssql">SELECT DISTINCT l1.num ConsecutiveNums 
FROM logs l1 INNER JOIN logs l2
ON l1.Num=l2.Num 
GROUP BY l1.id
HAVING SUM(l1.id-l2.id BETWEEN 0 AND 2)&gt;2;
</code></pre>
<ol start="181">
<li></li>
</ol>
<p>Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。</p>
<p>±—±------±-------±----------+<br />
| Id | Name  | Salary | ManagerId |<br />
±—±------±-------±----------+<br />
| 1  | Joe   | 70000  | 3         |<br />
| 2  | Henry | 80000  | 4         |<br />
| 3  | Sam   | 60000  | NULL      |<br />
| 4  | Max   | 90000  | NULL      |<br />
±—±------±-------±----------+<br />
给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。在上面的表格中，Joe 是唯一一个收入超过他的经理的员工。</p>
<p>±---------+<br />
| Employee |<br />
±---------+<br />
| Joe      |<br />
±---------+</p>
<pre class="highlight"><code class="mysql">SELECT e1.name Employee
FROM Employee e1 INNER JOIN Employee e2 
ON e1.ManagerId=e2.Id
WHERE e1.Salary&gt;e2.Salary;
</code></pre>
<ol start="182">
<li></li>
</ol>
<p>写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</p>
<p>示例：</p>
<p>±—±--------+<br />
| Id | Email   |<br />
±—±--------+<br />
| 1  | <a href="mailto:a@b.com">a@b.com</a> |<br />
| 2  | <a href="mailto:c@d.com">c@d.com</a> |<br />
| 3  | <a href="mailto:a@b.com">a@b.com</a> |<br />
±—±--------+<br />
根据以上输入，你的查询应返回以下结果：</p>
<p>±--------+<br />
| Email   |<br />
±--------+<br />
| <a href="mailto:a@b.com">a@b.com</a> |<br />
±--------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> Email
<span class="hljs-keyword">FROM</span> Person
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Email
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(Email)&gt;<span class="hljs-number">1</span>
</code></pre>
<p>下面这个倒是用来判断重复的好办法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span>(p1.Email) <span class="hljs-keyword">from</span> Person p1 <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> Person p2 <span class="hljs-keyword">on</span> p1.Email = p2.Email <span class="hljs-keyword">and</span> p1.Id != p2.Id;
</code></pre>
<ol start="183">
<li></li>
</ol>
<p>某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。</p>
<p>Customers 表：</p>
<p>±—±------+<br />
| Id | Name  |<br />
±—±------+<br />
| 1  | Joe   |<br />
| 2  | Henry |<br />
| 3  | Sam   |<br />
| 4  | Max   |<br />
±—±------+<br />
Orders 表：</p>
<p>±—±-----------+<br />
| Id | CustomerId |<br />
±—±-----------+<br />
| 1  | 3          |<br />
| 2  | 1          |<br />
±—±-----------+<br />
例如给定上述表格，你的查询应返回：</p>
<p>±----------+<br />
| Customers |<br />
±----------+<br />
| Henry     |<br />
| Max       |<br />
±----------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> Customers
<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">WHERE</span> Customers.Id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
(<span class="hljs-keyword">SELECT</span> CustomerId  <span class="hljs-keyword">FROM</span> Orders);
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> c.Name Customers
<span class="hljs-keyword">FROM</span> Customers c <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Orders O
<span class="hljs-keyword">ON</span> c.Id=o.CustomerId
<span class="hljs-keyword">WHERE</span> o.ID <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
</code></pre>
<ol start="184">
<li></li>
</ol>
<p>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。</p>
<p>±—±------±-------±-------------+<br />
| Id | Name  | Salary | DepartmentId |<br />
±—±------±-------±-------------+<br />
| 1  | Joe   | 70000  | 1            |<br />
| 2  | Jim   | 90000  | 1            |<br />
| 3  | Henry | 80000  | 2            |<br />
| 4  | Sam   | 60000  | 2            |<br />
| 5  | Max   | 90000  | 1            |<br />
±—±------±-------±-------------+<br />
Department 表包含公司所有部门的信息。</p>
<p>±—±---------+<br />
| Id | Name     |<br />
±—±---------+<br />
| 1  | IT       |<br />
| 2  | Sales    |<br />
±—±---------+<br />
编写一个 SQL 查询，找出每个部门工资最高的员工。对于上述表，您的 SQL 查询应返回以下行（行的顺序无关紧要）。</p>
<p>±-----------±---------±-------+<br />
| Department | Employee | Salary |<br />
±-----------±---------±-------+<br />
| IT         | Max      | 90000  |<br />
| IT         | Jim      | 90000  |<br />
| Sales      | Henry    | 80000  |<br />
±-----------±---------±-------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-comment">#DENSE_RANK() PARTITION BY 完美结合</span>
<span class="hljs-keyword">SELECT</span> Department,Employee,Salary <span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> e.Name Employee,e.Salary Salary,d.Name Department,
<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.DepartmentId <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> s_rank
<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Department d
<span class="hljs-keyword">ON</span> e.DepartmentId=d.Id) t
<span class="hljs-keyword">WHERE</span> t.s_rank=<span class="hljs-number">1</span>;
</code></pre>
<p>以后对于这种<strong>group by 后有字段不能取出来的，用这种方法 IN</strong>,或者是group by后需要当作条件的</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> d.Name Department,e.Name Employee,Salary
<span class="hljs-keyword">from</span>  Employee e
<span class="hljs-keyword">join</span> Department d 
<span class="hljs-keyword">on</span> e.DepartmentId=d.Id
<span class="hljs-keyword">where</span>(e.DepartmentId , Salary) <span class="hljs-keyword">IN</span>(
    <span class="hljs-keyword">select</span> DepartmentId, <span class="hljs-keyword">max</span>(salary)
    <span class="hljs-keyword">from</span> Employee
    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> DepartmentId
);
</code></pre>
<ol start="185">
<li></li>
</ol>
<p>Employee 表包含所有员工信息，每个员工有其对应的工号 Id，姓名 Name，工资 Salary 和部门编号 DepartmentId 。</p>
<p>±—±------±-------±-------------+<br />
| Id | Name  | Salary | DepartmentId |<br />
±—±------±-------±-------------+<br />
| 1  | Joe   | 85000  | 1            |<br />
| 2  | Henry | 80000  | 2            |<br />
| 3  | Sam   | 60000  | 2            |<br />
| 4  | Max   | 90000  | 1            |<br />
| 5  | Janet | 69000  | 1            |<br />
| 6  | Randy | 85000  | 1            |<br />
| 7  | Will  | 70000  | 1            |<br />
±—±------±-------±-------------+<br />
Department 表包含公司所有部门的信息。</p>
<p>±—±---------+<br />
| Id | Name     |<br />
±—±---------+<br />
| 1  | IT       |<br />
| 2  | Sales    |<br />
±—±---------+<br />
编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：</p>
<p>±-----------±---------±-------+<br />
| Department | Employee | Salary |<br />
±-----------±---------±-------+<br />
| IT         | Max      | 90000  |<br />
| IT         | Randy    | 85000  |<br />
| IT         | Joe      | 85000  |<br />
| IT         | Will     | 70000  |<br />
| Sales      | Henry    | 80000  |<br />
| Sales      | Sam      | 60000  |<br />
±-----------±---------±-------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-comment">#PARTITION BY 真好用</span>
<span class="hljs-keyword">SELECT</span> Department,Employee,Salary <span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> d.Name Department,e.Name Employee,e.Salary Salary,
<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.DepartmentId <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> s_rank
<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Department d
<span class="hljs-keyword">ON</span> e.DepartmentId=d.Id) t
<span class="hljs-keyword">WHERE</span> t.s_rank&lt;=<span class="hljs-number">3</span>;
</code></pre>
<p>自连接解法，这种通过自连接判断排名，一定要记得使用distinct</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> d.Name <span class="hljs-keyword">as</span> Department,e.Name <span class="hljs-keyword">as</span> Employee,e.Salary <span class="hljs-keyword">as</span> Salary
<span class="hljs-keyword">from</span> Employee <span class="hljs-keyword">as</span> e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Department <span class="hljs-keyword">as</span> d 
<span class="hljs-keyword">on</span> e.DepartmentId = d.Id
<span class="hljs-keyword">where</span> e.Id <span class="hljs-keyword">in</span>
(
    <span class="hljs-keyword">select</span> e1.Id
    <span class="hljs-keyword">from</span> Employee <span class="hljs-keyword">as</span> e1 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Employee <span class="hljs-keyword">as</span> e2
    <span class="hljs-keyword">on</span> e1.DepartmentId = e2.DepartmentId <span class="hljs-keyword">and</span> e1.Salary &lt; e2.Salary
    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> e1.Id
    <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> e2.Salary) &lt;= <span class="hljs-number">2</span>
)
<span class="hljs-keyword">and</span> e.DepartmentId <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">from</span> Department)
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> d.Id <span class="hljs-keyword">asc</span>,e.Salary <span class="hljs-keyword">desc</span>
</code></pre>
<ol start="196">
<li></li>
</ol>
<p>编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。</p>
<p>±—±-----------------+<br />
| Id | Email            |<br />
±—±-----------------+<br />
| 1  | <a href="mailto:john@example.com">john@example.com</a> |<br />
| 2  | <a href="mailto:bob@example.com">bob@example.com</a>  |<br />
| 3  | <a href="mailto:john@example.com">john@example.com</a> |<br />
±—±-----------------+<br />
Id 是这个表的主键。<br />
例如，在运行你的查询语句之后，上面的 Person 表应返回以下几行:</p>
<p>±—±-----------------+<br />
| Id | Email            |<br />
±—±-----------------+<br />
| 1  | <a href="mailto:john@example.com">john@example.com</a> |<br />
| 2  | <a href="mailto:bob@example.com">bob@example.com</a>  |<br />
±—±-----------------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-comment">#mysql删除时，先缓存再删除</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> Person
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">Id</span>) <span class="hljs-keyword">Id</span> <span class="hljs-keyword">FROM</span> Person <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Email) t)
</code></pre>
<p>这种理解也很好</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">delete</span> p1
<span class="hljs-keyword">from</span> person p1 <span class="hljs-keyword">join</span> person p2
<span class="hljs-keyword">on</span> p1.email=p2.email <span class="hljs-keyword">and</span> p1.id&gt;p2.id
</code></pre>
<ol start="197">
<li></li>
</ol>
<p>表 Weather</p>
<p>±--------------±--------+<br />
| Column Name   | Type    |<br />
±--------------±--------+<br />
| id            | int     |<br />
| recordDate    | date    |<br />
| temperature   | int     |<br />
±--------------±--------+<br />
id 是这个表的主键<br />
该表包含特定日期的温度信息</p>
<p>编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 id 。</p>
<p>返回结果 不要求顺序 。</p>
<p>查询结果格式如下例：</p>
<p>Weather<br />
±—±-----------±------------+<br />
| id | recordDate | Temperature |<br />
±—±-----------±------------+<br />
| 1  | 2015-01-01 | 10          |<br />
| 2  | 2015-01-02 | 25          |<br />
| 3  | 2015-01-03 | 20          |<br />
| 4  | 2015-01-04 | 30          |<br />
±—±-----------±------------+</p>
<p>Result table:<br />
±—+<br />
| id |<br />
±—+<br />
| 2  |<br />
| 4  |<br />
±—+<br />
2015-01-02 的温度比前一天高（10 -&gt; 25）<br />
2015-01-04 的温度比前一天高（20 -&gt; 30）</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>); <span class="hljs-comment">-- add 1 day</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">hour</span>); <span class="hljs-comment">-- add 1 hour</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">minute</span>); <span class="hljs-comment">-- ...</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">second</span>);
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">microsecond</span>);
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">week</span>);
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">month</span>);
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">quarter</span>);
<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">year</span>);

<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_sub</span>(<span class="hljs-string">'1998-01-01 00:00:00'</span>, <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 1:1:1'</span> day_second);

MySQL datediff(date1,date2)：两个日期相减 date1 - date2，返回天数。
<span class="hljs-keyword">select</span> <span class="hljs-keyword">datediff</span>(<span class="hljs-string">'2008-08-08'</span>, <span class="hljs-string">'2008-08-01'</span>); <span class="hljs-comment">-- 7</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">datediff</span>(<span class="hljs-string">'2008-08-01'</span>, <span class="hljs-string">'2008-08-08'</span>); <span class="hljs-comment">-- -7</span>

<span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08/09/2008'</span>, <span class="hljs-string">'%m/%d/%Y'</span>); <span class="hljs-comment">-- 2008-08-09</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08/09/08'</span> , <span class="hljs-string">'%m/%d/%y'</span>); <span class="hljs-comment">-- 2008-08-09</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08.09.2008'</span>, <span class="hljs-string">'%m.%d.%Y'</span>); <span class="hljs-comment">-- 2008-08-09</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08:09:30'</span>, <span class="hljs-string">'%h:%i:%s'</span>); <span class="hljs-comment">-- 08:09:30</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08.09.2008 08:09:30'</span>, <span class="hljs-string">'%m.%d.%Y %h:%i:%s'</span>); <span class="hljs-comment">-- 2008-08-09 08:09:30</span>
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a.id
<span class="hljs-keyword">FROM</span> Weather a <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Weather b
<span class="hljs-keyword">ON</span> a.recordDate=<span class="hljs-keyword">DATE_ADD</span>(b.recordDate,<span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>)
<span class="hljs-keyword">WHERE</span> a.temperature&gt;b.temperature;
</code></pre>
<ol start="262">
<li></li>
</ol>
<p>Trips 表中存所有出租车的行程信息。每段行程有唯一键 Id，Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。Status 是枚举类型，枚举成员为 (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。</p>
<p>±—±----------±----------±--------±-------------------±---------+<br />
| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|<br />
±—±----------±----------±--------±-------------------±---------+<br />
| 1  |     1     |    10     |    1    |     completed      |2013-10-01|<br />
| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|<br />
| 3  |     3     |    12     |    6    |     completed      |2013-10-01|<br />
| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|<br />
| 5  |     1     |    10     |    1    |     completed      |2013-10-02|<br />
| 6  |     2     |    11     |    6    |     completed      |2013-10-02|<br />
| 7  |     3     |    12     |    6    |     completed      |2013-10-02|<br />
| 8  |     2     |    12     |    12   |     completed      |2013-10-03|<br />
| 9  |     3     |    10     |    12   |     completed      |2013-10-03|<br />
| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|<br />
±—±----------±----------±--------±-------------------±---------+<br />
Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。</p>
<p>±---------±-------±-------+<br />
| Users_Id | Banned |  Role  |<br />
±---------±-------±-------+<br />
|    1     |   No   | client |<br />
|    2     |   Yes  | client |<br />
|    3     |   No   | client |<br />
|    4     |   No   | client |<br />
|    10    |   No   | driver |<br />
|    11    |   No   | driver |<br />
|    12    |   No   | driver |<br />
|    13    |   No   | driver |<br />
±---------±-------±-------+<br />
写一段 SQL 语句查出 2013年10月1日 至 2013年10月3日 期间非禁止用户的取消率。基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。</p>
<p>取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)</p>
<p>±-----------±------------------+<br />
|     Day    | Cancellation Rate |<br />
±-----------±------------------+<br />
| 2013-10-01 |       0.33        |<br />
| 2013-10-02 |       0.00        |<br />
| 2013-10-03 |       0.50        |<br />
±-----------±------------------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> 
t.Request_at <span class="hljs-string">'Day'</span>,
<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">IF</span>(t.Status=<span class="hljs-string">'completed'</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))/<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-number">2</span>) <span class="hljs-string">'Cancellation Rate'</span> 
<span class="hljs-keyword">FROM</span> Trips t <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Users</span> u 
<span class="hljs-keyword">ON</span> t.Client_id=u.Users_Id <span class="hljs-keyword">AND</span> u.Banned=<span class="hljs-string">'No'</span>
<span class="hljs-keyword">WHERE</span> t.Request_at <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2013-10-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2013-10-03'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t.Request_at
</code></pre>
<ol start="511">
<li></li>
</ol>
<p>活动表 Activity：</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| player_id    | int     |<br />
| device_id    | int     |<br />
| event_date   | date    |<br />
| games_played | int     |<br />
±-------------±--------+<br />
表的主键是 (player_id, event_date)。<br />
这张表展示了一些游戏玩家在游戏平台上的行为活动。<br />
每行数据记录了一名玩家在退出平台之前，当天使用同一台设备登录平台后打开的游戏的数目（可能是 0 个）。</p>
<p>写一条 SQL 查询语句获取每位玩家 第一次登陆平台的日期。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date) first_login
<span class="hljs-keyword">FROM</span> Activity
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> player_id,<span class="hljs-keyword">min</span>(event_date) <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> player_id) <span class="hljs-keyword">as</span> first_login
<span class="hljs-keyword">from</span> Activity
</code></pre>
<ol start="512">
<li></li>
</ol>
<p>Table: Activity</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| player_id    | int     |<br />
| device_id    | int     |<br />
| event_date   | date    |<br />
| games_played | int     |<br />
±-------------±--------+<br />
(player_id, event_date) 是这个表的两个主键<br />
这个表显示的是某些游戏玩家的游戏活动情况<br />
每一行是在某天使用某个设备登出之前登录并玩多个游戏（可能为0）的玩家的记录<br />
请编写一个 SQL 查询，描述每一个玩家首次登陆的设备名称</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a.player_id,a.device_id
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date) min_date
<span class="hljs-keyword">FROM</span> Activity <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id) t <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity a
<span class="hljs-keyword">ON</span> t.player_id=a.player_id <span class="hljs-keyword">AND</span> t.min_date=a.event_date
</code></pre>
<p>这种联合查询的写法注意点</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,device_id
<span class="hljs-keyword">FROM</span> activity
<span class="hljs-keyword">WHERE</span> (player_id,event_date) <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date)
<span class="hljs-keyword">FROM</span> activity
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id)
</code></pre>
<ol start="534">
<li></li>
</ol>
<p>Table: Activity</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| player_id    | int     |<br />
| device_id    | int     |<br />
| event_date   | date    |<br />
| games_played | int     |<br />
±-------------±--------+<br />
（player_id，event_date）是此表的主键。<br />
这张表显示了某些游戏的玩家的活动情况。<br />
每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0 ）。</p>
<p>编写一个 SQL 查询，同时报告每组玩家和日期，以及玩家到目前为止玩了多少游戏。也就是说，在此日期之前玩家所玩的游戏总数。详细情况请查看示例。</p>
<p>棒棒棒，自己写出来了</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a1.player_id,a1.event_date,<span class="hljs-keyword">SUM</span>(a2.games_played) games_played_so_far
<span class="hljs-keyword">FROM</span> Activity a1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity a2
<span class="hljs-keyword">ON</span> a1.player_id=a2.player_id <span class="hljs-keyword">AND</span> a1.event_date&gt;=a2.event_date
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> a1.player_id,a1.event_date
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,event_date,<span class="hljs-keyword">SUM</span>(games_played) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> player_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> event_date <span class="hljs-keyword">ASC</span>) games_played_so_far 
<span class="hljs-keyword">FROM</span> Activity；
</code></pre>
<ol start="550">
<li></li>
</ol>
<p>Table: Activity</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| player_id    | int     |<br />
| device_id    | int     |<br />
| event_date   | date    |<br />
| games_played | int     |<br />
±-------------±--------+<br />
（player_id，event_date）是此表的主键。<br />
这张表显示了某些游戏的玩家的活动情况。<br />
每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0）。</p>
<p>编写一个 SQL 查询，报告在首次登录的第二天再次登录的玩家的比率，四舍五入到小数点后两位。换句话说，您需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p>
<p>自己写的说实话有点烂</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> t1.player_id)/(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> t3.player_id) <span class="hljs-keyword">FROM</span> Activity t3),<span class="hljs-number">2</span>) fraction
<span class="hljs-keyword">FROM</span>
Activity t1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity t2
<span class="hljs-keyword">ON</span> t1.player_id=t2.player_id <span class="hljs-keyword">AND</span> <span class="hljs-keyword">DATE_ADD</span>(t1.event_date,<span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>)=t2.event_date
<span class="hljs-keyword">WHERE</span> (t1.player_id,t1.event_date) <span class="hljs-keyword">IN</span>(
    <span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date)
    <span class="hljs-keyword">FROM</span> Activity
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id
)
</code></pre>
<p>这个就很强，用最下日期+1，省去判断连续日期，首次登录连续日期，可以用MIN求出首次日期，再+1就是次日日期，判断palyer_id，加过后的日期在不在即可计数。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
	<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> player_id)/(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">distinct</span> player_id) <span class="hljs-keyword">FROM</span> Activity), 
	<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> fraction
<span class="hljs-keyword">FROM</span>
    Activity
<span class="hljs-keyword">WHERE</span>
	(player_id,event_date)
	<span class="hljs-keyword">IN</span>
	(<span class="hljs-keyword">SELECT</span> 
        player_id,
        <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">min</span>(event_date)+<span class="hljs-number">1</span>)
	<span class="hljs-keyword">FROM</span> Activity
	<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id);
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">round</span>(<span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span>(b.player_id))/(<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span>(player_id)) <span class="hljs-keyword">from</span> activity),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> fraction
<span class="hljs-keyword">from</span> activity b
<span class="hljs-keyword">join</span>
(<span class="hljs-keyword">select</span> player_id,<span class="hljs-keyword">min</span>(event_date), <span class="hljs-keyword">min</span>(event_date)+<span class="hljs-number">1</span> <span class="hljs-keyword">as</span> date_2nd
<span class="hljs-keyword">from</span> activity
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> ) a
<span class="hljs-keyword">on</span> b.event_date = a.date_2nd <span class="hljs-keyword">and</span> b.player_id = a.player_id
</code></pre>
<ol start="569">
<li></li>
</ol>
<p>Employee 表包含所有员工。Employee 表有三列：员工Id，公司名和薪水。</p>
<p>±----±-----------±-------+<br />
|Id   | Company    | Salary |<br />
±----±-----------±-------+<br />
|1    | A          | 2341   |<br />
|2    | A          | 341    |<br />
|3    | A          | 15     |<br />
|4    | A          | 15314  |<br />
|5    | A          | 451    |<br />
|6    | A          | 513    |<br />
|7    | B          | 15     |<br />
|8    | B          | 13     |<br />
|9    | B          | 1154   |<br />
|10   | B          | 1345   |<br />
|11   | B          | 1221   |<br />
|12   | B          | 234    |<br />
|13   | C          | 2345   |<br />
|14   | C          | 2645   |<br />
|15   | C          | 2645   |<br />
|16   | C          | 2652   |<br />
|17   | C          | 65     |<br />
±----±-----------±-------+<br />
请编写SQL查询来查找每个公司的薪水中位数。挑战点：你是否可以在不使用任何内置的SQL函数的情况下解决此问题。</p>
<p>求中位数的思路，先对各组数据进行排序，同时求出各组数据总数，然后再判断排名在总数/2与总数/2+1之间。</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="570">
<li></li>
</ol>
<p>Employee 表包含所有员工和他们的经理。每个员工都有一个 Id，并且还有一列是经理的 Id。</p>
<p>±-----±---------±----------±---------+<br />
|Id    |Name 	  |Department |ManagerId |<br />
±-----±---------±----------±---------+<br />
|101   |John 	  |A 	      |null      |<br />
|102   |Dan 	  |A 	      |101       |<br />
|103   |James 	  |A 	      |101       |<br />
|104   |Amy 	  |A 	      |101       |<br />
|105   |Anne 	  |A 	      |101       |<br />
|106   |Ron 	  |B 	      |101       |<br />
±-----±---------±----------±---------+<br />
给定 Employee 表，请编写一个SQL查询来查找至少有5名直接下属的经理。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> 
<span class="hljs-keyword">FROM</span> Employee
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> ManagerId
<span class="hljs-keyword">FROM</span> Employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> ManagerId
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*)&gt;=<span class="hljs-number">5</span>)
</code></pre>
<ol start="571">
<li></li>
</ol>
<p>Numbers 表保存数字的值及其频率。</p>
<p>±---------±------------+<br />
|  Number  |  Frequency  |<br />
±---------±------------|<br />
|  0       |  7          |<br />
|  1       |  1          |<br />
|  2       |  3          |<br />
|  3       |  1          |<br />
±---------±------------+<br />
在此表中，数字为 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3，所以中位数是 (0 + 0) / 2 = 0。</p>
<p>±-------+<br />
| median |<br />
±-------|<br />
| 0.0000 |<br />
±-------+<br />
请编写一个查询来查找所有数字的中位数并将结果命名为 median 。</p>
<p>新增两列，将从后往前和从前往后的频数相加，两个数都需要大于等于总数一半，再取平均</p>
<h3 id="错误答案"><a class="markdownIt-Anchor" href="#错误答案"></a> <strong>错误答案</strong></h3>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(T.num) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">median</span>
<span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span>  n1.Number <span class="hljs-keyword">num</span>,<span class="hljs-keyword">Sum</span>(n2.Frequency) <span class="hljs-keyword">as</span> f_sum
<span class="hljs-keyword">FROM</span> Numbers n1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Numbers n2
<span class="hljs-keyword">on</span> n1.Number&gt;=n2.Number
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> n1.Number
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> n1.Number <span class="hljs-keyword">ASC</span>) T
<span class="hljs-keyword">WHERE</span> T.f_sum <span class="hljs-keyword">BETWEEN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(Frequency)/<span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> Numbers) <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(Frequency)/<span class="hljs-number">2</span>+<span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> Numbers)
</code></pre>
<ol start="574">
<li></li>
</ol>
<p>表: Candidate</p>
<p>±----±--------+<br />
| id  | Name    |<br />
±----±--------+<br />
| 1   | A       |<br />
| 2   | B       |<br />
| 3   | C       |<br />
| 4   | D       |<br />
| 5   | E       |<br />
±----±--------+<br />
表: Vote</p>
<p>±----±-------------+<br />
| id  | CandidateId  |<br />
±----±-------------+<br />
| 1   |     2        |<br />
| 2   |     4        |<br />
| 3   |     3        |<br />
| 4   |     2        |<br />
| 5   |     5        |<br />
±----±-------------+<br />
id 是自动递增的主键，<br />
CandidateId 是 Candidate 表中的 id.<br />
请编写 sql 语句来找到当选者的名字，上面的例子将返回当选者 B.</p>
<pre class="highlight"><code class="sql"><span class="hljs-comment">#group by key order by count(key)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> <span class="hljs-keyword">FROM</span> Candidate <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=(
<span class="hljs-keyword">SELECT</span> CandidateId <span class="hljs-keyword">FROM</span> Vote
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> CandidateId
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(CandidateId) <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>);
</code></pre>
<ol start="577">
<li></li>
</ol>
<p>选出所有 bonus &lt; 1000 的员工的 name 及其 bonus。</p>
<p>Employee 表单</p>
<p>±------±-------±----------±-------+<br />
| empId |  name  | supervisor| salary |<br />
±------±-------±----------±-------+<br />
|   1   | John   |  3        | 1000   |<br />
|   2   | Dan    |  3        | 2000   |<br />
|   3   | Brad   |  null     | 4000   |<br />
|   4   | Thomas |  3        | 4000   |<br />
±------±-------±----------±-------+<br />
empId 是这张表单的主关键字<br />
Bonus 表单</p>
<p>±------±------+<br />
| empId | bonus |<br />
±------±------+<br />
| 2     | 500   |<br />
| 4     | 2000  |<br />
±------±------+<br />
empId 是这张表单的主关键字</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.name <span class="hljs-keyword">name</span>,b.bonus bonus
<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> Bonus b 
<span class="hljs-keyword">ON</span> e.empId=b.empId
<span class="hljs-keyword">WHERE</span> b.bonus&lt;<span class="hljs-number">1000</span> <span class="hljs-keyword">or</span> b.bonus <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;
</code></pre>
<ol start="578">
<li></li>
</ol>
<p>从 survey_log 表中获得回答率最高的问题，survey_log 表包含这些列：id, action, question_id, answer_id, q_num, timestamp。</p>
<p>id 表示用户 id；action 有以下几种值：“show”，“answer”，“skip”；当 action 值为 “answer” 时 answer_id 非空，而 action 值为 “show” 或者 “skip” 时 answer_id 为空；q_num 表示当前会话中问题的编号。</p>
<p>请编写 SQL 查询来找到具有最高回答率的问题。</p>
<p>这种group by 后又要取最值的问题，记得 order by 然后 limit 1</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t.question_id survey_log
<span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> question_id,<span class="hljs-keyword">COUNT</span>(answer_id) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">FROM</span> survey_log
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> question_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> t 
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre>
<p>这中group by后order by count的写法</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> question_id survey_log <span class="hljs-keyword">FROM</span> survey_log 
<span class="hljs-keyword">WHERE</span> answer_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> question_id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(answer_id) <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre>
<ol start="579">
<li></li>
</ol>
<p>请你编写 SQL 语句，对于每个员工，查询他除最近一个月（即最大月）之外，剩下每个月的近三个月的累计薪水（不足三个月也要计算）。</p>
<p>结果请按 Id 升序，然后按 Month 降序显示。</p>
<p>示例：<br />
输入：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>30</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>30</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>40</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>40</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>60</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>70</td>
</tr>
</tbody>
</table>
<p>rows 2 preceding:将当前行和它前面的两行划为一个窗口，因此sum函数就作 用在这三行上面</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">Month</span> <span class="hljs-keyword">month</span>,<span class="hljs-keyword">SUM</span>(Salary) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Month</span> <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-number">2</span> <span class="hljs-keyword">PRECEDING</span>) Salary
<span class="hljs-keyword">FROM</span> Employee
<span class="hljs-keyword">WHERE</span> (<span class="hljs-keyword">Id</span>,<span class="hljs-keyword">Month</span>)
<span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>,<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">Month</span>)
<span class="hljs-keyword">FROM</span> Employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">ASC</span>,<span class="hljs-keyword">Month</span> <span class="hljs-keyword">DESC</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
  a.Id <span class="hljs-keyword">AS</span> <span class="hljs-keyword">id</span>, a.Month <span class="hljs-keyword">AS</span> <span class="hljs-keyword">month</span>,<span class="hljs-keyword">SUM</span>(b.Salary) <span class="hljs-keyword">AS</span> Salary
<span class="hljs-keyword">FROM</span>
  Employee a, Employee b
<span class="hljs-keyword">WHERE</span> a.Id = b.Id 
<span class="hljs-keyword">AND</span> a.Month &gt;= b.Month
<span class="hljs-keyword">AND</span> a.Month &lt; b.Month+<span class="hljs-number">3</span> <span class="hljs-comment">#这个限制在3个月内</span>
<span class="hljs-keyword">AND</span> (a.Id, a.Month) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, <span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">Month</span>) <span class="hljs-keyword">FROM</span> Employee <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> a.Id, a.Month
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.Id, a.Month <span class="hljs-keyword">DESC</span>
</code></pre>
<ol start="580">
<li></li>
</ol>
<p>一所大学有 2 个数据表，分别是 student 和 department ，这两个表保存着每个专业的学生数据和院系数据。</p>
<p>写一个查询语句，查询 department 表中每个专业的学生人数 （即使没有学生的专业也需列出）。</p>
<p>将你的查询结果按照学生人数降序排列。 如果有两个或两个以上专业有相同的学生数目，将这些部门按照部门名字的字典序从小到大排列。</p>
<p>student 表格如下：</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>student_id</td>
<td>Integer</td>
</tr>
<tr>
<td>student_name</td>
<td>String</td>
</tr>
<tr>
<td>gender</td>
<td>Character</td>
</tr>
<tr>
<td>dept_id</td>
<td>Integer</td>
</tr>
</tbody>
</table>
<p>其中， student_id 是学生的学号， student_name 是学生的姓名， gender 是学生的性别， dept_id 是学生所属专业的专业编号。</p>
<p>department 表格如下：</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>dept_id</td>
<td>Integer</td>
</tr>
<tr>
<td>dept_name</td>
<td>String</td>
</tr>
</tbody>
</table>
<p>dept_id 是专业编号， dept_name 是专业名字。</p>
<p>区分count(*）和count(s.student_id)区别 前一个是有多少条不考虑值 后一个只算s.student_id这一列的值不会计算null</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> d.dept_name,<span class="hljs-keyword">COUNT</span>(s.student_id) student_number
<span class="hljs-keyword">FROM</span> department d <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> student s
<span class="hljs-keyword">ON</span> d.dept_id=s.dept_id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.dept_name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> student_number <span class="hljs-keyword">DESC</span>,d.dept_name <span class="hljs-keyword">ASC</span>;
</code></pre>
<ol start="584">
<li></li>
</ol>
<p>给定表 customer ，里面保存了所有客户信息和他们的推荐人。</p>
<p>±-----±-----±----------+<br />
| id   | name | referee_id|<br />
±-----±-----±----------+<br />
|    1 | Will |      NULL |<br />
|    2 | Jane |      NULL |<br />
|    3 | Alex |         2 |<br />
|    4 | Bill |      NULL |<br />
|    5 | Zack |         1 |<br />
|    6 | Mark |         2 |<br />
±-----±-----±----------+<br />
写一个查询语句，返回一个编号列表，列表中编号的推荐人的编号都 不是 2。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> customer 
<span class="hljs-keyword">where</span>
<span class="hljs-keyword">ifnull</span>(referee_id,<span class="hljs-number">0</span>)!=<span class="hljs-number">2</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> 
<span class="hljs-keyword">FROM</span> customer
<span class="hljs-keyword">WHERE</span> referee_id!=<span class="hljs-number">2</span> <span class="hljs-keyword">OR</span> referee_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
</code></pre>
<ol start="585">
<li></li>
</ol>
<p>写一个查询语句，将 2016 年 (TIV_2016) 所有成功投资的金额加起来，保留 2 位小数。</p>
<p>对于一个投保人，他在 2016 年成功投资的条件是：</p>
<p>他在 2015 年的投保额 (TIV_2015) 至少跟一个其他投保人在 2015 年的投保额相同。<br />
他所在的城市必须与其他投保人都不同（也就是说维度和经度不能跟其他任何一个投保人完全相同）。<br />
输入格式:<br />
表 insurance 格式如下：</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>PID</td>
<td>INTEGER(11)</td>
</tr>
<tr>
<td>TIV_2015</td>
<td>NUMERIC(15,2)</td>
</tr>
<tr>
<td>TIV_2016</td>
<td>NUMERIC(15,2)</td>
</tr>
<tr>
<td>LAT</td>
<td>NUMERIC(5,2)</td>
</tr>
<tr>
<td>LON</td>
<td>NUMERIC(5,2)</td>
</tr>
</tbody>
</table>
<p>PID 字段是投保人的投保编号， TIV_2015 是该投保人在2015年的总投保金额， TIV_2016 是该投保人在2016年的投保金额， LAT 是投保人所在城市的维度， LON 是投保人所在城市的经度。</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="586">
<li></li>
</ol>
<p>在表 orders 中找到订单数最多客户对应的 customer_number 。</p>
<p>数据保证订单数最多的顾客恰好只有一位。</p>
<p>表 orders 定义如下：</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>order_number (PK)</td>
<td>int</td>
</tr>
<tr>
<td>customer_number</td>
<td>int</td>
</tr>
<tr>
<td>order_date</td>
<td>date</td>
</tr>
<tr>
<td>required_date</td>
<td>date</td>
</tr>
<tr>
<td>shipped_date</td>
<td>date</td>
</tr>
<tr>
<td>status</td>
<td>char(15)</td>
</tr>
<tr>
<td>comment</td>
<td>char(200)</td>
</tr>
</tbody>
</table>
<p>题目没看懂</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> customer_number
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_number
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(order_number) <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> customer_number
<span class="hljs-keyword">from</span> orders
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_number
<span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(order_number)&gt;=<span class="hljs-keyword">all</span>(
    <span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(order_number)
    <span class="hljs-keyword">from</span> orders
    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_number
)
</code></pre>
<ol start="595">
<li></li>
</ol>
<p>这里有张 World 表</p>
<p>±----------------±-----------±-----------±-------------±--------------+<br />
| name            | continent  | area       | population   | gdp           |<br />
±----------------±-----------±-----------±-------------±--------------+<br />
| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |<br />
| Albania         | Europe     | 28748      | 2831741      | 12960000      |<br />
| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |<br />
| Andorra         | Europe     | 468        | 78115        | 3712000       |<br />
| Angola          | Africa     | 1246700    | 20609294     | 100990000     |<br />
±----------------±-----------±-----------±-------------±--------------+<br />
如果一个国家的面积超过 300 万平方公里，或者人口超过 2500 万，那么这个国家就是大国家。</p>
<p>编写一个 SQL 查询，输出表中所有大国家的名称、人口和面积。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> w.name,w.population,w.area
<span class="hljs-keyword">FROM</span> World w
<span class="hljs-keyword">WHERE</span> w.area&gt;<span class="hljs-number">3000000</span> <span class="hljs-keyword">OR</span> population&gt;<span class="hljs-number">25000000</span>
</code></pre>
<ol start="596">
<li></li>
</ol>
<p>有一个courses 表 ，有: student (学生) 和 class (课程)。</p>
<p>请列出所有超过或等于5名学生的课。</p>
<p>例如，表：</p>
<p>±--------±-----------+<br />
| student | class      |<br />
±--------±-----------+<br />
| A       | Math       |<br />
| B       | English    |<br />
| C       | Math       |<br />
| D       | Biology    |<br />
| E       | Math       |<br />
| F       | Computer   |<br />
| G       | Math       |<br />
| H       | Math       |<br />
| I       | Math       |<br />
±--------±-----------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">class</span>
<span class="hljs-keyword">FROM</span> courses
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">class</span> 
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> student)&gt;=<span class="hljs-number">5</span>
</code></pre>
<ol start="597">
<li></li>
</ol>
<p>在 Facebook 或者 Twitter 这样的社交应用中，人们经常会发好友申请也会收到其他人的好友申请。</p>
<p>表：FriendRequest</p>
<p>±---------------±--------+<br />
| Column Name    | Type    |<br />
±---------------±--------+<br />
| sender_id      | int     |<br />
| send_to_id     | int     |<br />
| request_date   | date    |<br />
±---------------±--------+<br />
此表没有主键，它可能包含重复项。<br />
该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求的日期。<br />
表：RequestAccepted</p>
<p>±---------------±--------+<br />
| Column Name    | Type    |<br />
±---------------±--------+<br />
| requester_id   | int     |<br />
| accepter_id    | int     |<br />
| accept_date    | date    |<br />
±---------------±--------+<br />
此表没有主键，它可能包含重复项。<br />
该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求通过的日期。</p>
<p>写一个查询语句，求出好友申请的通过率，用 2 位小数表示。通过率由接受好友申请的数目除以申请总数。</p>
<p>提示：</p>
<p>通过的好友申请不一定都在表 friend_request 中。你只需要统计总的被通过的申请数（不管它们在不在表 FriendRequest 中），并将它除以申请总数，得到通过率<br />
一个好友申请发送者有可能会给接受者发几条好友申请，也有可能一个好友申请会被通过好几次。这种情况下，重复的好友申请只统计一次。<br />
如果一个好友申请都没有，通过率为 0.00 。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">IFNULL</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> requester_id,accepter_id)
<span class="hljs-keyword">FROM</span> RequestAccepted)/
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> sender_id ,send_to_id )
<span class="hljs-keyword">FROM</span> FriendRequest ),<span class="hljs-number">0</span>),<span class="hljs-number">2</span>) accept_rate
</code></pre>
<ol start="601">
<li></li>
</ol>
<p>表：Stadium<br />
±--------------±--------+<br />
| Column Name   | Type    |<br />
±--------------±--------+<br />
| id            | int     |<br />
| visit_date    | date    |<br />
| people        | int     |<br />
±--------------±--------+<br />
visit_date 是表的主键<br />
每日人流量信息被记录在这三列信息中：序号 (id)、日期 (visit_date)、 人流量 (people)<br />
每天只有一行记录，日期随着 id 的增加而增加</p>
<p>编写一个 SQL 查询以找出每行的人数大于或等于 100 且 id 连续的三行或更多行记录。</p>
<p>返回按 visit_date 升序排列的结果表。</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="602">
<li></li>
</ol>
<p>在 Facebook 或者 Twitter 这样的社交应用中，人们经常会发好友申请也会收到其他人的好友申请。</p>
<p>表 request_accepted 存储了所有好友申请通过的数据记录，其中， requester_id 和 accepter_id 都是用户的编号。</p>
<table>
<thead>
<tr>
<th>requester_id</th>
<th>accepter_id</th>
<th>accept_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2</td>
<td>2016_06-03</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2016-06-09</td>
</tr>
</tbody>
</table>
<p>写一个查询语句，求出谁拥有最多的好友和他拥有的好友数目。对于上面的样例数据，结果为：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>num</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<p>保证拥有最多好友数目的只有 1 个人。<br />
好友申请只会被接受一次，所以不会有 requester_id 和 accepter_id 值都相同的重复记录。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> 
((<span class="hljs-keyword">SELECT</span> requester_id <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> request_accepted)
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
(<span class="hljs-keyword">SELECT</span> accepter_id <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> request_accepted)) sub
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>, <span class="hljs-keyword">sum</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">from</span> 
((<span class="hljs-keyword">select</span> requester_id <span class="hljs-keyword">id</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">from</span> request_accepted
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> requester_id)
<span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
(<span class="hljs-keyword">select</span> accepter_id <span class="hljs-keyword">id</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">from</span> request_accepted
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> accepter_id)) t3
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">id</span>
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">desc</span>
<span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>
</code></pre>
<ol start="603">
<li></li>
</ol>
<p>几个朋友来到电影院的售票处，准备预约连续空余座位。</p>
<p>你能利用表 cinema ，帮他们写一个查询语句，获取所有空余座位，并将它们按照 seat_id 排序后返回吗？</p>
<table>
<thead>
<tr>
<th>seat_id</th>
<th>free</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>**连续值问题怎么处理?**首先是两张表自联结，然后两张表的顺序作差值等于1，取绝对值的话就不论前后了</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> a.seat_id 
<span class="hljs-keyword">FROM</span> cinema a <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> cinema b
<span class="hljs-keyword">ON</span> <span class="hljs-keyword">abs</span>(b.seat_id-a.seat_id)=<span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> b.free=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> a.free=<span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.seat_id <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>还有这种lag函数的用法,lag是提取之前的内容，lead是提取之后的内容</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> seat_id
<span class="hljs-keyword">from</span> (
    <span class="hljs-keyword">select</span>
        seat_id ,
        free ,
        lag(free,<span class="hljs-number">1</span>,<span class="hljs-number">999</span>) <span class="hljs-keyword">over</span>() pre_free,
        <span class="hljs-keyword">lead</span>(free,<span class="hljs-number">1</span>,<span class="hljs-number">999</span>) <span class="hljs-keyword">over</span>() next_free
    <span class="hljs-keyword">from</span>  cinema
)tmp
<span class="hljs-keyword">where</span>  free=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (pre_free=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> next_free=<span class="hljs-number">1</span> )
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>  seat_id
</code></pre>
<ol start="607">
<li></li>
</ol>
<p>给定 3 个表： salesperson， company， orders。<br />
输出所有表 salesperson 中，没有向公司 ‘RED’ 销售任何东西的销售员。</p>
<p>示例：<br />
输入</p>
<p>表： salesperson</p>
<p>±---------±-----±-------±----------------±----------+<br />
| sales_id | name | salary | commission_rate | hire_date |<br />
±---------±-----±-------±----------------±----------+<br />
|   1      | John | 100000 |     6           | 4/1/2006  |<br />
|   2      | Amy  | 120000 |     5           | 5/1/2010  |<br />
|   3      | Mark | 65000  |     12          | 12/25/2008|<br />
|   4      | Pam  | 25000  |     25          | 1/1/2005  |<br />
|   5      | Alex | 50000  |     10          | 2/3/2007  |<br />
±---------±-----±-------±----------------±----------+<br />
表 salesperson 存储了所有销售员的信息。每个销售员都有一个销售员编号 sales_id 和他的名字 name 。</p>
<p>表： company</p>
<p>±--------±-------±-----------+<br />
| com_id  |  name  |    city    |<br />
±--------±-------±-----------+<br />
|   1     |  RED   |   Boston   |<br />
|   2     | ORANGE |   New York |<br />
|   3     | YELLOW |   Boston   |<br />
|   4     | GREEN  |   Austin   |<br />
±--------±-------±-----------+<br />
表 company 存储了所有公司的信息。每个公司都有一个公司编号 com_id 和它的名字 name 。</p>
<p>表： orders</p>
<p>±---------±-----------±--------±---------±-------+<br />
| order_id | order_date | com_id  | sales_id | amount |<br />
±---------±-----------±--------±---------±-------+<br />
| 1        |   1/1/2014 |    3    |    4     | 100000 |<br />
| 2        |   2/1/2014 |    4    |    5     | 5000   |<br />
| 3        |   3/1/2014 |    1    |    1     | 50000  |<br />
| 4        |   4/1/2014 |    1    |    4     | 25000  |<br />
±---------±---------±--------±---------±-------+<br />
表 orders 存储了所有的销售数据，包括销售员编号 sales_id 和公司编号 com_id 。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> salesperson
<span class="hljs-keyword">WHERE</span> sales_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
(<span class="hljs-keyword">SELECT</span> sales_id 
<span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> company c
<span class="hljs-keyword">ON</span> o.com_id=c.com_id
<span class="hljs-keyword">WHERE</span> c.name=<span class="hljs-string">'RED'</span>)
</code></pre>
<ol start="608">
<li></li>
</ol>
<p>给定一个表 tree，id 是树节点的编号， p_id 是它父节点的 id 。</p>
<p>±—±-----+<br />
| id | p_id |<br />
±—±-----+<br />
| 1  | null |<br />
| 2  | 1    |<br />
| 3  | 1    |<br />
| 4  | 2    |<br />
| 5  | 2    |<br />
±—±-----+<br />
树中每个节点属于以下三种类型之一：</p>
<p>叶子：如果这个节点没有任何孩子节点。<br />
根：如果这个节点是整棵树的根，即没有父节点。<br />
内部节点：如果这个节点既不是叶子节点也不是根节点。</p>
<p>写一个查询语句，输出所有节点的编号和节点的类型，并将结果按照节点编号排序。</p>
<pre class="highlight"><code class="sql">
</code></pre>
<ol start="610">
<li></li>
</ol>
<p>一个小学生 Tim 的作业是判断三条线段是否能形成一个三角形。</p>
<p>然而，这个作业非常繁重，因为有几百组线段需要判断。</p>
<p>假设表 triangle 保存了所有三条线段的长度 x、y、z ，请你帮 Tim 写一个查询语句，来判断每组 x、y、z 是否可以组成一个三角形？</p>
<p>记一下这种 case then用法,也可以不指定变量，只在WHEN中判断。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> x,y,z,
<span class="hljs-keyword">CASE</span> 
<span class="hljs-keyword">WHEN</span> x+y&gt;z <span class="hljs-keyword">AND</span> x+z&gt;y <span class="hljs-keyword">and</span> y+z&gt;x <span class="hljs-keyword">then</span> <span class="hljs-string">'Yes'</span>
<span class="hljs-keyword">ELSE</span> <span class="hljs-string">'No'</span>
<span class="hljs-keyword">END</span> triangle
<span class="hljs-keyword">FROM</span> triangle
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> x, y, z, <span class="hljs-keyword">if</span>(x+y&gt;z <span class="hljs-keyword">and</span> x+z&gt;y <span class="hljs-keyword">and</span> y+z&gt;x, <span class="hljs-string">'Yes'</span>, <span class="hljs-string">'No'</span>) <span class="hljs-keyword">as</span> triangle <span class="hljs-keyword">from</span> triangle
</code></pre>
<ol start="612">
<li></li>
</ol>
<p>表 point_2d 保存了所有点（多于 2 个点）的坐标 (x,y) ，这些点在平面上两两不重合。</p>
<p>写一个查询语句找到两点之间的最近距离，保留 2 位小数。</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
<td>-1</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>-1</td>
<td>-2</td>
</tr>
</tbody>
</table>
<p>最近距离在点 (-1,-1) 和(-1,2) 之间，距离为 1.00 。所以输出应该为：</p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.00</td>
</tr>
</tbody>
</table>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">SQRT</span>(<span class="hljs-keyword">POWER</span>(p1.x-p2.x,<span class="hljs-number">2</span>)+<span class="hljs-keyword">POWER</span>(P1.y-p2.y,<span class="hljs-number">2</span>))),<span class="hljs-number">2</span>) shortest
<span class="hljs-keyword">FROM</span> point_2d p1,point_2d p2
<span class="hljs-keyword">WHERE</span> p1.x!=p2.x <span class="hljs-keyword">OR</span> p1.y!=p2.y
</code></pre>
<pre class="highlight"><code class="sq">select 
round(min(sqrt(pow(t1.x-t2.x,2)+pow(t1.y-t2.y,2))),2) shortest
from point_2d as t1,point_2d as t2
where (t1.x,t1.y) != (t2.x,t2.y)
</code></pre>
<ol start="613">
<li></li>
</ol>
<p>表 point 保存了一些点在 x 轴上的坐标，这些坐标都是整数。</p>
<p>写一个查询语句，找到这些点中最近两个点之间的距离。</p>
<table>
<thead>
<tr>
<th>x</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
</tr>
<tr>
<td>0</td>
</tr>
<tr>
<td>2</td>
</tr>
</tbody>
</table>
<p>最近距离显然是 ‘1’ ，是点 ‘-1’ 和 ‘0’ 之间的距离。所以输出应该如下：</p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
</table>
<p>注意：每个点都与其他点坐标不同，表 table 不会有重复坐标出现。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">ABS</span>(p1.x-p2.x)) shortest
<span class="hljs-keyword">FROM</span> point p1,point p2
<span class="hljs-keyword">WHERE</span> p1.x!=p2.x
</code></pre>
<ol start="614">
<li></li>
</ol>
<p>在 facebook 中，表 follow 会有 2 个字段： followee, follower ，分别表示被关注者和关注者。</p>
<p>请写一个 sql 查询语句，对每一个关注者，查询关注他的关注者的数目。</p>
<p>比方说：</p>
<p>±------------±-----------+<br />
| followee    | follower   |<br />
±------------±-----------+<br />
|     A       |     B      |<br />
|     B       |     C      |<br />
|     B       |     D      |<br />
|     D       |     E      |<br />
±------------±-----------+<br />
应该输出：</p>
<p>±------------±-----------+<br />
| follower    | num        |<br />
±------------±-----------+<br />
|     B       |  2         |<br />
|     D       |  1         |<br />
±------------±-----------+<br />
解释：</p>
<p>B 和 D 都在在 follower 字段中出现，作为被关注者，B 被 C 和 D 关注，D 被 E 关注。A 不在 follower 字段内，所以A不在输出列表中。</p>
<p>注意：</p>
<p>被关注者永远不会被他 / 她自己关注。<br />
将结果按照字典序返回。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> followee follower,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> follower) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">FROM</span> follow
<span class="hljs-keyword">WHERE</span> followee <span class="hljs-keyword">IN</span>
(<span class="hljs-keyword">SELECT</span> follower <span class="hljs-keyword">FROM</span> follow)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> followee
</code></pre>
<ol start="615">
<li></li>
</ol>
<p>给如下两个表，写一个查询语句，求出在每一个工资发放日，每个部门的平均工资与公司的平均工资的比较结果 （高 / 低 / 相同）。</p>
<p>表： salary</p>
<table>
<thead>
<tr>
<th>id</th>
<th>employee_id</th>
<th>amount</th>
<th>pay_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>9000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>6000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>10000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>7000</td>
<td>2017-02-28</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>6000</td>
<td>2017-02-28</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>8000</td>
<td>2017-02-28</td>
</tr>
</tbody>
</table>
<p>employee_id 字段是表 employee 中 employee_id 字段的外键。</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>department_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
</tr>
</tbody>
</table>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t1.pay_date pay_month,t2.department_id,
<span class="hljs-keyword">CASE</span>
<span class="hljs-keyword">WHEN</span> t1.avg_amount&gt;t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'lower'</span>
<span class="hljs-keyword">WHEN</span> t1.avg_amount=t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'same'</span>
<span class="hljs-keyword">WHEN</span> t1.avg_amount&lt;t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'higher'</span>
<span class="hljs-keyword">END</span> comparison
<span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DATE_FORMAT</span>(pay_date,<span class="hljs-string">'%Y-%m'</span>) pay_date,<span class="hljs-keyword">AVG</span>(amount) avg_amount
<span class="hljs-keyword">FROM</span> salary
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">DATE_FORMAT</span>(pay_date,<span class="hljs-string">'%Y-%m'</span>)
) t1
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DATE_FORMAT</span>(s.pay_date,<span class="hljs-string">'%Y-%m'</span>) pay_date,e.department_id,<span class="hljs-keyword">AVG</span>(s.amount) avg_amount
<span class="hljs-keyword">FROM</span> salary s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> employee e
<span class="hljs-keyword">ON</span> s.employee_id=e.employee_id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">DATE_FORMAT</span>(s.pay_date,<span class="hljs-string">'%Y-%m'</span>),e.department_id
) t2 
<span class="hljs-keyword">ON</span> t1.pay_date=t2.pay_date
</code></pre>
<p>下面这个写的更好,OVER(PARTITION BY department_id,LEFT(pay_date,7))</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> pay_month,department_id,<span class="hljs-keyword">CASE</span>
            <span class="hljs-keyword">WHEN</span> DEP_AVG_Salary=Mon_AVG_Salary <span class="hljs-keyword">THEN</span> <span class="hljs-string">'same'</span>
            <span class="hljs-keyword">WHEN</span> DEP_AVG_Salary&gt;Mon_AVG_Salary <span class="hljs-keyword">THEN</span> <span class="hljs-string">'higher'</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'lower'</span>
            <span class="hljs-keyword">END</span> <span class="hljs-string">'comparison'</span>
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(<span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'pay_month'</span>,
        e.department_id,
        <span class="hljs-keyword">AVG</span>(amount) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.department_id,<span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'DEP_AVG_Salary'</span>,
        <span class="hljs-keyword">AVG</span>(amount) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'Mon_AVG_Salary'</span> 
      <span class="hljs-keyword">FROM</span> salary s
      <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> employee e <span class="hljs-keyword">ON</span> s.employee_id=e.employee_id) t
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> pay_month <span class="hljs-keyword">DESC</span>;
</code></pre>
<ol start="618">
<li></li>
</ol>
<p>一所美国大学有来自亚洲、欧洲和美洲的学生，他们的地理信息存放在如下 student 表中。</p>
<table>
<thead>
<tr>
<th>name</th>
<th>continent</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jack</td>
<td>America</td>
</tr>
<tr>
<td>Pascal</td>
<td>Europe</td>
</tr>
<tr>
<td>Xi</td>
<td>Asia</td>
</tr>
<tr>
<td>Jane</td>
<td>America</td>
</tr>
</tbody>
</table>
<p>写一个查询语句实现对大洲（continent）列的 透视表 操作，使得每个学生按照姓名的字母顺序依次排列在对应的大洲下面。输出的标题应依次为美洲（America）、亚洲（Asia）和欧洲（Europe）。数据保证来自美洲的学生不少于来自亚洲或者欧洲的学生。</p>
<p>对于样例输入，它的对应输出是：</p>
<table>
<thead>
<tr>
<th>America</th>
<th>Asia</th>
<th>Europe</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jack</td>
<td>Xi</td>
<td>Pascal</td>
</tr>
<tr>
<td>Jane</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>**行列转换怎么弄呢？**先计算ROW_NUMBER() OVER(PARTITION BY continent ORDER BY name) 分组排序，</p>
<p>然后GROUP BY，MAX,再CASE操作。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'America'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> America,
<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'Asia'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> Asia,
<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'Europe'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> Europe
<span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,continent,ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> continent <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>) rk
<span class="hljs-keyword">FROM</span> student) T
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> rk;
</code></pre>
<ol start="619">
<li></li>
</ol>
<p>表 my_numbers 的 num 字段包含很多数字，其中包括很多重复的数字。</p>
<p>你能写一个 SQL 查询语句，找到只出现过一次的数字中，最大的一个数字吗？</p>
<p>±–+<br />
|num|<br />
±–+<br />
| 8 |<br />
| 8 |<br />
| 3 |<br />
| 3 |<br />
| 1 |<br />
| 4 |<br />
| 5 |<br />
| 6 |</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">num</span>
<span class="hljs-keyword">FROM</span>
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">num</span>,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">num</span>) n_num
<span class="hljs-keyword">FROM</span> my_numbers
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span>) t
<span class="hljs-keyword">WHERE</span> n_num=<span class="hljs-number">1</span>;
</code></pre>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">CASE</span> 
<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">COUNT</span>(*)=<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">num</span>
<span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">END</span> <span class="hljs-keyword">num</span>
<span class="hljs-keyword">FROM</span> my_numbers
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>
</code></pre>
<ol start="620">
<li></li>
</ol>
<p>某城市开了一家新的电影院，吸引了很多人过来看电影。该电影院特别注意用户体验，专门有个 LED显示板做电影推荐，上面公布着影评和相关电影描述。</p>
<p>作为该电影院的信息部主管，您需要编写一个 SQL查询，找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列。</p>
<p>例如，下表 cinema:</p>
<p>±--------±----------±-------------±----------+<br />
|   id    | movie     |  description |  rating   |<br />
±--------±----------±-------------±----------+<br />
|   1     | War       |   great 3D   |   8.9     |<br />
|   2     | Science   |   fiction    |   8.5     |<br />
|   3     | irish     |   boring     |   6.2     |<br />
|   4     | Ice song  |   Fantacy    |   8.6     |<br />
|   5     | House card|   Interesting|   9.1     |<br />
±--------±----------±-------------±----------+</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> cinema
<span class="hljs-keyword">WHERE</span> description!=<span class="hljs-string">'boring'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">id</span>%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rating <span class="hljs-keyword">DESC</span>
</code></pre>
<ol start="627">
<li></li>
</ol>
<p>给定一个 salary 表，如下所示，有 m = 男性 和 f = 女性 的值。交换所有的 f 和 m 值（例如，将所有 f 值更改为 m，反之亦然）。要求只使用一个更新（Update）语句，并且没有中间的临时表。</p>
<p>注意，您必只能写一个 Update 语句，请不要编写任何 Select 语句。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salary
<span class="hljs-keyword">SET</span> sex=<span class="hljs-keyword">IF</span>(sex=<span class="hljs-string">'m'</span>,<span class="hljs-string">'f'</span>,<span class="hljs-string">'m'</span>)
</code></pre>
<p>感觉case可以处理的问题更多一点</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salary
<span class="hljs-keyword">SET</span> sex=(<span class="hljs-keyword">CASE</span> sex <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'m'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'f'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'m'</span> <span class="hljs-keyword">END</span>)
</code></pre>
<ol start="1045">
<li></li>
</ol>
<p>Customer 表：</p>
<p>±------------±--------+<br />
| Column Name | Type    |<br />
±------------±--------+<br />
| customer_id | int     |<br />
| product_key | int     |<br />
±------------±--------+<br />
product_key 是 Customer 表的外键。<br />
Product 表：</p>
<p>±------------±--------+<br />
| Column Name | Type    |<br />
±------------±--------+<br />
| product_key | int     |<br />
±------------±--------+<br />
product_key 是这张表的主键。</p>
<p>写一条 SQL 查询语句，从 Customer 表中查询购买了 Product 表中所有产品的客户的 id。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> customer_id
<span class="hljs-keyword">FROM</span> Customer
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_id
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> product_key)=(
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> product_key) <span class="hljs-keyword">FROM</span> Product
)
</code></pre>
<ol start="1050">
<li></li>
</ol>
<p>ActorDirector 表：</p>
<p>±------------±--------+<br />
| Column Name | Type    |<br />
±------------±--------+<br />
| actor_id    | int     |<br />
| director_id | int     |<br />
| timestamp   | int     |<br />
±------------±--------+<br />
timestamp 是这张表的主键.</p>
<p>写一条SQL查询语句获取合作过至少三次的演员和导演的 id 对 (actor_id, director_id)</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> actor_id,director_id
<span class="hljs-keyword">FROM</span> ActorDirector
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> actor_id,director_id
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*)&gt;=<span class="hljs-number">3</span>
</code></pre>
<ol start="1068">
<li></li>
</ol>
<p>销售表 Sales：</p>
<p>±------------±------+<br />
| Column Name | Type  |<br />
±------------±------+<br />
| sale_id     | int   |<br />
| product_id  | int   |<br />
| year        | int   |<br />
| quantity    | int   |<br />
| price       | int   |<br />
±------------±------+<br />
(sale_id, year) 是销售表 Sales 的主键.<br />
product_id 是关联到产品表 Product 的外键.<br />
注意: price 表示每单位价格<br />
产品表 Product：</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| product_id   | int     |<br />
| product_name | varchar |<br />
±-------------±--------+<br />
product_id 是表的主键.</p>
<p>写一条SQL 查询语句获取 Sales 表中所有产品对应的 产品名称 product_name 以及该产品的所有 售卖年份 year 和 价格 price 。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> p.product_name,s.year,s.price
<span class="hljs-keyword">FROM</span> Sales s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Product p
<span class="hljs-keyword">ON</span> s.product_id=p.product_id
</code></pre>
<ol start="1069">
<li></li>
</ol>
<p>销售表：Sales</p>
<p>±------------±------+<br />
| Column Name | Type  |<br />
±------------±------+<br />
| sale_id     | int   |<br />
| product_id  | int   |<br />
| year        | int   |<br />
| quantity    | int   |<br />
| price       | int   |<br />
±------------±------+<br />
sale_id 是这个表的主键。<br />
product_id 是 Product 表的外键。<br />
请注意价格是每单位的。<br />
产品表：Product</p>
<p>±-------------±--------+<br />
| Column Name  | Type    |<br />
±-------------±--------+<br />
| product_id   | int     |<br />
| product_name | varchar |<br />
±-------------±--------+<br />
product_id 是这个表的主键。</p>
<p>编写一个 SQL 查询，按产品 id product_id 来统计每个产品的销售总量。</p>
<pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> product_id,<span class="hljs-keyword">SUM</span>(quantity) total_quantity
<span class="hljs-keyword">FROM</span> Sales
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> product_id
</code></pre>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90">数据分析</a>
                  &nbsp;
                
                  <a class="hover-with-bg" href="/categories/sql">sql</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90">数据分析</a>
                
                  <a class="hover-with-bg" href="/tags/sql">sql</a>
                
                  <a class="hover-with-bg" href="/tags/%E5%88%B7%E9%A2%98">刷题</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <script defer src="https://utteranc.es/client.js"
          repo="mz2sj/utterances"
          issue-term="pathname"
  
          label="utterances"
    
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "01-sql刷题牛客&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>



  

  
    <!-- KaTeX -->
    <link rel="stylesheet" href="/lib/katex/katex.min.css"  >
  









</body>
</html>
