<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/01/08/hello-world/"/>
    <url>/2023/01/08/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post"></a> Create a new post</h3><pre class="highlight"><code class="bash">$ hexo new <span class="hljs-string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server"></a> Run server</h3><pre class="highlight"><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files"></a> Generate static files</h3><pre class="highlight"><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites"></a> Deploy to remote sites</h3><pre class="highlight"><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>决策树</title>
    <link href="/2021/06/08/%E5%86%B3%E7%AD%96%E6%A0%91/"/>
    <url>/2021/06/08/%E5%86%B3%E7%AD%96%E6%A0%91/</url>
    
    <content type="html"><![CDATA[<p>决策树学习通常包括3个步骤：特征选择、决策树的生成、决策树的剪枝。</p><h2 id="id3"><a class="markdownIt-Anchor" href="#id3"></a> ID3</h2><p>ID3通过信息增益来选择特征和分裂点，信息增益由信息熵和条件熵计算得出。</p><p>熵的公式计算公式如下：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><mfrac><mrow><mo fence="true">∣</mo><msub><mi>C</mi><mi>k</mi></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mrow><mo>∣</mo><msub><mi>C</mi><mi>k</mi></msub><mo>∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}H(D)=-\sum_{k=1}^{K} \frac{\left|C_{k}\right|}{|D|} \log _{2} \frac{ \mid C_{k} \mid}{|D|} \\\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.5149999999999999em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0150000000000001em;"><span style="top:-3.015em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.07153em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.07153em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5149999999999999em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></p><p>当样本中各类别数据概率相等时，熵最大。换种方式理解，拿出一个样本，它是各个类别的概率都是一样的，此时最难分辨样本的类别。熵越大样本的不确定性越高。</p><p>条件熵计算公式如下：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>D</mi><mo>∣</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mfrac><mrow><mo>∣</mo><msub><mi>D</mi><mi>i</mi></msub><mo>∣</mo></mrow><mrow><mo>∣</mo><mi>D</mi><mo>∣</mo></mrow></mfrac><mi>H</mi><mrow><mo fence="true">(</mo><msub><mi>D</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mi>i</mi></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi><mo>∣</mo></mrow></mfrac><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mrow><mi>i</mi><mo>∣</mo></mrow></msub><mo fence="true">∣</mo></mrow><mrow><mo>∣</mo><msub><mi>D</mi><mrow><mi>i</mi><mo>∣</mo></mrow></msub></mrow></mfrac><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mrow><mo>∣</mo><msub><mi>D</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>∣</mo></mrow><mrow><mo>∣</mo><msub><mi>D</mi><mrow><mi>i</mi><mo>∣</mo></mrow></msub></mrow></mfrac><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">H(D \mid A)=\sum_{i=1}^{n} \frac{\mid D_{i} \mid}{\mid D \mid} H\left(D_{i}\right)=-\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D| \mid} \sum_{k=1}^{k} \frac{\left|D_{i \mid}\right|}{\mid D_{i \mid}} \log _{2} \frac{\mid D_{i k} \mid}{\mid D_{i \mid}} \\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mrel mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.91364em;vertical-align:-0.60364em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span><span class="mrel mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9890079999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.31em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3694857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6125em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3694857142857143em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.60364em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3694857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.60364em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>代表<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span>特征有几个类别，即A特征的基数。条件熵是在某特征各个类别值出现概率的基础上计算熵。</p><p>熵减去条件熵就是某个特征的信息增益：</p><p>$ g(D, A)=H(D)-H(D \mid A)$</p><p>ID3算法通过信息增益来选择特征：信息增益大的特征 具有更强的分类能力。如果一个特征的信息增益为0，即表示该特征没有什么分类能力。</p><p>ID3算法步骤简化理解：</p><p>1.计算各个特征的信息增益<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">A_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>,选择最大的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">A_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>值对应的特征。</p><p>2.如果<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">A_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>小于阈值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span>,则该特征分类点下面所有样本实例数最多的类别就是该节点的类标记。</p><p>3.否则，对于<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">A_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>中的各个类别值，分裂成各个子节点。</p><p>4.迭代进行上面3步，直到信息增益均小于阈值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span>或者没有特征可以选择为止。</p><p>缺点：</p><p>1.ID3没有剪枝操作，只有输的生成，所以容易过拟合。</p><p>2.信息增益准则对可取值数目较多的属性有所偏好。</p><p>3.没有考虑缺失值的处理。</p><h3 id="c45"><a class="markdownIt-Anchor" href="#c45"></a> C4.5</h3><p>C4.5为了克服ID3对高基数特征有所偏好的特点，引入了信息增益比来选择特征，信息增益比计算公式如下：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mi>R</mi></msub><mo stretchy="false">(</mo><mi>D</mi><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>D</mi><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi>H</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">g_{R}(D, A)=\frac{g(D, A)}{H_{A}(D)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.08125em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">A</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mi>i</mi></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mi>i</mi></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">H_{A}(D)=-\sum_{i=1}^{n} \frac{\left|D_{i}\right|}{|D|} \log _{2} \frac{\left|D_{i}\right|}{|D|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>信息增益比其实就是某个特征的信息增益与将某个特征类别的信息熵的比，信息增益比倾向于基数低的特征。</p><p>C4.5的决策树生成与ID3相同，引入了剪枝策略，包括预剪枝和后剪枝。</p><h4 id="预剪枝"><a class="markdownIt-Anchor" href="#预剪枝"></a> 预剪枝</h4><p>在节点划分前来确定是否继续增长，及早停止增长的主要方法有：</p><ul><li>节点内数据样本低于某一阈值；</li><li>所有节点特征都已分裂；</li><li>节点划分前准确率比划分后准确率高。</li></ul><p>预剪枝可能会带来欠拟合问题。</p><h4 id="后剪枝"><a class="markdownIt-Anchor" href="#后剪枝"></a> 后剪枝</h4><p>C4.5 采用的<strong>悲观剪枝方法</strong>，用递归的方式从低往上针对每一个非叶子节点，评估用一个最佳叶子节点去代替这课子树是否有益。如果剪枝后与剪枝前相比其错误率是保持或者下降，则这棵子树就可以被替换掉。  C4.5 通过训练数据集上的错误分类数量来估算未知样本上的错误率。</p><p>缺点：</p><ul><li>剪枝策略可以再优化；</li><li>C4.5 用的是多叉树，用二叉树效率更高；</li><li>C4.5 只能用于分类；</li><li>C4.5 使用的熵模型拥有大量耗时的对数运算，连续值还有排序运算；</li><li>C4.5 在构造树的过程中，对数值属性值需要按照其大小进行排序，从中选择一个分割点，所以只适合于能够驻留于内存的数据集，当训练集大得无法在内存容纳时，程序无法运行</li></ul><p>缺点还要再进行理解。</p><h3 id="cart"><a class="markdownIt-Anchor" href="#cart"></a> CART</h3><h4 id="cart回归树"><a class="markdownIt-Anchor" href="#cart回归树"></a> CART回归树</h4><h5 id="回归树表示"><a class="markdownIt-Anchor" href="#回归树表示"></a> 回归树表示</h5><p>一棵 CART 回归树对应着输入空间的一个划分，以及在划分单元上的输出值。<br />设输出  y  为连续变量, 训练数据集 $ \mathbb{D}=\left{\left(\overrightarrow{\mathbf{x}}<em>{1}, \tilde{y}</em>{1}\right),\left(\overrightarrow{\mathbf{x}}<em>{2}, \tilde{y}</em>{2}\right), \cdots,\left(\overrightarrow{\mathbf{x}}<em>{N}, \tilde{y}</em>{N}\right)\right} $<br />设已经将输入空间划分为  M  个单元 $ R_{1}, R_{2}, \cdots, R_{M} $, 且在每个单元  R_{m}  上有一个固定的输出值  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">c_{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  则 CART 回归树模型可以表示为:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></msubsup><msub><mi>c</mi><mi>m</mi></msub><mi>I</mi><mrow><mo fence="true">(</mo><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mo>∈</mo><msub><mi>R</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(\overrightarrow{\mathbf{x}})=\sum_{m=1}^{M} c_{m} I\left(\overrightarrow{\mathbf{x}} \in R_{m}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.21644em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.80002em;vertical-align:-0.65002em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></p><p>其中$  I(\cdot) $ 为示性函数。</p><h5 id="回归树损失函数"><a class="markdownIt-Anchor" href="#回归树损失函数"></a> 回归树损失函数</h5><p>如果已知输入空间的单元划分，基于平方误差最小的准则，则 CART 回归树在训练数据集上的损失函数为:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></msubsup><msub><mo>∑</mo><mrow><msub><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mi>i</mi></msub><mo>∈</mo><msub><mi>R</mi><mi>m</mi></msub></mrow></msub><msup><mrow><mo fence="true">(</mo><msub><mover accent="true"><mi>y</mi><mo>~</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>c</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sum_{m=1}^{M} \sum_{\overrightarrow{\mathbf{x}}_{i} \in R_{m}}\left(\tilde{y}_{i}-c_{m}\right)^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.413039em;vertical-align:-0.43180799999999986em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3682920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span><span class="svg-align" style="top:-3.1444400000000003em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail mtight" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43180799999999986em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><p>根据损失函数最小, 则可以求解出每个单元上的最优输出值$  \hat{c}<em>{m} $ 为  😒 R</em>{m}  $上所有输入样本  $\overrightarrow{\mathbf{x}}<em>{i} $ 对应的输出 $ \tilde{y}</em>{i} $ 的平均值。<br />即:  $\hat{c}<em>{m}=\frac{1}{N</em>{m}} \sum_{\overrightarrow{\mathbf{x}}<em>{i} \in R</em>{m}} \tilde{y}<em>{i} $, 其中  $N</em>{m} $ 表示单元  $R_{m} $ 中的样本数量。</p><h5 id="如何选择切分点进行划分"><a class="markdownIt-Anchor" href="#如何选择切分点进行划分"></a> 如何选择切分点进行划分</h5><p>设输入为  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>  维:$ \overrightarrow{\mathbf{x}}=\left(x_{1}, x_{2}, \cdots, x_{n}\right)^{T}$  。<br />1.选择第  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span>  维 $ x_{j} $ 和它的取值  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span>  作为切分变量和切分点。定义两个区域:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mo>∣</mo><msub><mi>x</mi><mi>j</mi></msub><mo>≤</mo><mi>s</mi><mo fence="true">}</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mo>∣</mo><msub><mi>x</mi><mi>j</mi></msub><mo>&gt;</mo><mi>s</mi><mo fence="true">}</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}R_{1}(j, s)=\left\{\overrightarrow{\mathbf{x}} \mid x_{j} \leq s\right\} \\R_{2}(j, s)=\left\{\overrightarrow{\mathbf{x}} \mid x_{j}&gt;s\right\}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-4.05002em;"><span class="pstrut" style="height:3.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">{</span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">s</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">}</span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">{</span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">x</span></span></span></span><span class="svg-align" style="top:-3.44444em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">s</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">}</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></p><p>2.然后寻求最优切分变量  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span>  和最优切分点  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span>  。即求解:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">(</mo><msup><mi>j</mi><mo>∗</mo></msup><mo separator="true">,</mo><msup><mi>s</mi><mo>∗</mo></msup><mo fence="true">)</mo></mrow><mo>=</mo><msub><mo><mi>min</mi><mo>⁡</mo></mo><mrow><mi>j</mi><mo separator="true">,</mo><mi>s</mi></mrow></msub><mrow><mo fence="true">[</mo><msub><mo><mi>min</mi><mo>⁡</mo></mo><msub><mi>c</mi><mn>1</mn></msub></msub><msub><mo>∑</mo><mrow><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mi>i</mi></msub><mo>∈</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msub><msup><mrow><mo fence="true">(</mo><msub><mover accent="true"><mi>y</mi><mo>~</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>c</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msub><mo><mi>min</mi><mo>⁡</mo></mo><msub><mi>c</mi><mn>2</mn></msub></msub><msub><mo>∑</mo><mrow><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mi>i</mi></msub><mo>∈</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msub><msup><mrow><mo fence="true">(</mo><msub><mover accent="true"><mi>y</mi><mo>~</mo></mover><mi>i</mi></msub><mo>−</mo><msub><mi>c</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\left(j^{*}, s^{*}\right)=\min _{j, s}\left[\min _{c_{1}} \sum_{\vec{x}_{i} \in R_{1}(j, s)}\left(\tilde{y}_{i}-c_{1}\right)^{2}+\min _{c_{2}} \sum_{\vec{x}_{i} \in R_{2}(j, s)}\left(\tilde{y}_{i}-c_{2}\right)^{2}\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∗</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∗</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.80002em;vertical-align:-0.65002em;"></span><span class="mop"><span class="mop">min</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">[</span></span><span class="mop"><span class="mop">min</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.20772em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop"><span class="mop">min</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.20772em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">]</span></span></span></span></span></span></p><p>其意义为：</p><ul><li>首先假设已知切分变量  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> , 则遍历最优切分点  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">s_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  则到:</li></ul><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mover accent="true"><mi>c</mi><mo>^</mo></mover><mn>1</mn></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>N</mi><mn>1</mn></msub></mfrac><msub><mo>∑</mo><mrow><msub><mover accent="true"><mi mathvariant="bold">x</mi><mo stretchy="true">→</mo></mover><mi>i</mi></msub><mo>∈</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msub><msub><mover accent="true"><mi>y</mi><mo>~</mo></mover><mi>i</mi></msub><mo separator="true">,</mo><mspace width="1em"/><msub><mover accent="true"><mi>c</mi><mo>^</mo></mover><mn>2</mn></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>N</mi><mn>2</mn></msub></mfrac><msub><mo>∑</mo><mrow><msub><mover accent="true"><mi>x</mi><mo>⃗</mo></mover><mi>i</mi></msub><mo>∈</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>j</mi><mo separator="true">,</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msub><msub><mover accent="true"><mi>y</mi><mo>~</mo></mover><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\hat{c}_{1}=\frac{1}{N_{1}} \sum_{\overrightarrow{\mathbf{x}}_{i} \in R_{1}(j, s)} \tilde{y}_{i}, \quad \hat{c}_{2}=\frac{1}{N_{2}} \sum_{\vec{x}_{i} \in R_{2}(j, s)} \tilde{y}_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.351816em;vertical-align:-0.5067079999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3682920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.96644em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span><span class="svg-align" style="top:-3.1444400000000003em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail mtight" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5067079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">^</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.319818em;vertical-align:-0.47471em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"></span><span class="accent-body" style="left:-0.20772em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg width='0.471em' height='0.714em' style='width:0.471em' viewBox='0 0 471 714' preserveAspectRatio='xMinYMin'><path d='M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z'/></svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">s</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.19444em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>其中  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">N_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  和 $ N_{2} $ 分别代表区域  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  和 $ R_{2}$  中的样本数量。</p><ul><li>然后遍历所有的特征维度, 对每个维度找到最优切分点。从这些 (切分维度,最优切分点) 中找到使但损失函数最小的那个。</li></ul><p>3.依次将输入空间划分为两个区域，然后重复对子区域划分，直到满足停止条件为止。这样的回归树称为最小二乘回归树。</p><h4 id="cart分类树生成"><a class="markdownIt-Anchor" href="#cart分类树生成"></a> CART分类树生成</h4><p>cart分类树采用基尼指数选择最优特征。</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Gini</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mi>p</mi><mi>k</mi></msub><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msubsup><mi>p</mi><mi>k</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\operatorname{Gini}(p)=\sum_{k=1}^{K} p_{k}\left(1-p_{k}\right)=1-\sum_{k=1}^{K} p_{k}^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">G</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">i</span></span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span></p><p>对于二分类问题,基尼指数为</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mi>i</mi><mi>n</mi><mi>i</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mn>2</mn><mi>p</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Gini(p)=p(1-p)+(1-p)(1-(1-p))=2p(1-p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span></p><p>如果样本集合D根据特征A的某一值a分为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">D_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>两部分，则在特征A的条件下，基尼指数定义为</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Gini</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>D</mi><mo>∣</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mn>1</mn></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mi mathvariant="normal">Gini</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>D</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mo>+</mo><mfrac><mrow><mo fence="true">∣</mo><msub><mi>D</mi><mn>2</mn></msub><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mi mathvariant="normal">Gini</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>D</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\operatorname{Gini}(D \mid A)=\frac{\left|D_{1}\right|}{|D|} \operatorname{Gini}\left(D_{1}\right)+\frac{\left|D_{2}\right|}{|D|} \operatorname{Gini}\left(D_{2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">G</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">i</span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathrm">G</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">i</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">∣</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathrm">G</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">i</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></p><p>cart分类树生成过程与回归树类似， 遍历所有可能的维度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 和该维度所有可能的取值 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span>，取使得基尼系数最小的那个维度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span>和切分点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> 。 划分区域中样本比例高的类别即是该样本区域对应的类别。</p><p>cart 分类树和cart 回归树通常的停止条件为：</p><ul><li>结点中样本个数小于预定值，这表示树已经太复杂。</li><li>样本集的损失函数或者基尼指数小于预定值，表示结点已经非常纯净。</li><li>没有更多的特征可供切分。</li></ul><h4 id="cart剪枝"><a class="markdownIt-Anchor" href="#cart剪枝"></a> CART剪枝</h4><p><code>CART</code> 树的剪枝是从完全生长的<code>CART</code> 树底端减去一些子树，使得<code>CART</code> 树变小（即模型变简单），从而使得它对未知数据有更好的预测能力。<code>CART</code>剪枝算法分为两步：首先从生成算法的决策树<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">T_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>不算剪枝，形成一个子树序列<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>T</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>T</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">{T_0,T_1,...,T_n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>,然后通过交叉验证法在独立的验证数据集上对子树序列进行预测，从中选择最优子树。</p>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
      <category>算法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
      <tag>机器学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Regression</title>
    <link href="/2021/04/06/Regression/"/>
    <url>/2021/04/06/Regression/</url>
    
    <content type="html"><![CDATA[<p>em…,我又来立flag了，之前买了《统计学习方法》这本书，本以为会发奋读书，没想到也是半途而废。现在想想还是得学点算法类的知识，</p><p>求求你了，孟镇，做个人吧，能写出来嘛？</p><p>求求你，抄别人的也抄出来吧！</p><h2 id="线性回归"><a class="markdownIt-Anchor" href="#线性回归"></a> 线性回归</h2><p>数据集：</p><p>假设数据集为:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">D</mi><mo>=</mo><mrow><mo fence="true">{</mo><mrow><mo fence="true">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mrow><mo fence="true">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>N</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{D}=\left\{\left(x_{1}, y_{1}\right),\left(x_{2}, y_{2}\right), \cdots,\left(x_{N}, y_{N}\right)\right\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">D</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span></span></p><p>后面我们记:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>x</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mi>T</mi></msup><mo separator="true">,</mo><mi>Y</mi><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>y</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X=\left(x_{1}, x_{2}, \cdots, x_{N}\right)^{T}, Y=\left(y_{1}, y_{2}, \cdots, y_{N}\right)^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.231231em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.231231em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><p>线性回归假设:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>w</mi><mi>T</mi></msup><mi>x</mi></mrow><annotation encoding="application/x-tex">f(w)=w^{T} x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">x</span></span></span></span></p><h3 id="最小二乘法"><a class="markdownIt-Anchor" href="#最小二乘法"></a> 最小二乘法</h3><p>对这个问题, 采用二范数定义的平方误差来定义损失函数:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msubsup><mrow><mo fence="true">∥</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo fence="true">∥</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">L(w)=\sum_{i=1}^{N}\left\|w^{T} x_{i}-y_{i}\right\|_{2}^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4657079999999998em;vertical-align:-0.3997099999999999em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.86199em;"><span style="top:-2.2559899999999997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∥</span></span></span><span style="top:-2.86199em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∥</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000999999999993em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.86199em;"><span style="top:-2.2559899999999997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∥</span></span></span><span style="top:-2.86199em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∥</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000999999999993em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.065998em;"><span style="top:-2.3002900000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.31489em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3997099999999999em;"><span></span></span></span></span></span></span></span></span></span></p><p>展开得到：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">(</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mi>N</mi></msub><mo>−</mo><msub><mi>y</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mo>⋅</mo><msup><mrow><mo fence="true">(</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mi>N</mi></msub><mo>−</mo><msub><mi>y</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mi>T</mi></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">(</mo><msup><mi>w</mi><mi>T</mi></msup><msup><mi>X</mi><mi>T</mi></msup><mo>−</mo><msup><mi>Y</mi><mi>T</mi></msup><mo fence="true">)</mo></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mi>X</mi><mi>w</mi><mo>−</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>w</mi><mi>T</mi></msup><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mi>w</mi><mo>−</mo><msup><mi>Y</mi><mi>T</mi></msup><mi>X</mi><mi>w</mi><mo>−</mo><msup><mi>w</mi><mi>T</mi></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi><mo>+</mo><msup><mi>Y</mi><mi>T</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mi>w</mi><mi>T</mi></msup><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mi>w</mi><mo>−</mo><mn>2</mn><msup><mi>w</mi><mi>T</mi></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi><mo>+</mo><msup><mi>Y</mi><mi>T</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}L(w) &amp;=\left(w^{T} x_{1}-y_{1}, \cdots, w^{T} x_{N}-y_{N}\right) \cdot\left(w^{T} x_{1}-y_{1}, \cdots, w^{T} x_{N}-y_{N}\right)^{T} \\&amp;=\left(w^{T} X^{T}-Y^{T}\right) \cdot(X w-Y)=w^{T} X^{T} X w-Y^{T} X w-w^{T} X^{T} Y+Y^{T} Y \\&amp;=w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.885224000000001em;vertical-align:-2.1926120000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.692612em;"><span style="top:-4.6926120000000004em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span><span style="top:-3.141281em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"></span></span><span style="top:-1.5899499999999995em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1926120000000004em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.692612em;"><span style="top:-4.6926120000000004em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1225619999999998em;"><span style="top:-3.344231em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.141281em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-1.5899499999999995em;"><span class="pstrut" style="height:3.122562em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1926120000000004em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>最小化这个值的  $\hat{w}  $,这里注意对用变量的求导情况：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><msub><mi mathvariant="normal">argmin</mi><mo>⁡</mo><mi>w</mi></msub><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mn>2</mn><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>−</mo><mn>2</mn><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi><mo>=</mo><msup><mi>X</mi><mo>+</mo></msup><mi>Y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{w}=\operatorname{argmin}_{w} L(w) &amp; \longrightarrow \frac{\partial}{\partial w} L(w)=0 \\&amp; \longrightarrow 2 X^{T} X \hat{w}-2 X^{T} Y=0 \\&amp; \longrightarrow \hat{w}=\left(X^{T} X\right)^{-1} X^{T} Y=X^{+} Y\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.664110000000001em;vertical-align:-2.5820550000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.082055em;"><span style="top:-5.0820549999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span><span style="top:-3.204724em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"></span></span><span style="top:-1.4493849999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5820550000000004em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.082055em;"><span style="top:-5.0820549999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-3.204724em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-1.4493849999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0953389999999998em;"><span style="top:-3.3442309999999997em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5820550000000004em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>这个式子中  $\left(X^{T} X\right)^{-1} X^{T} $ 又被称为伪逆。对于行满秩或者列满秩的  X , 可以直接求解, 但是对于非满秩的样本集合，需要使用奇异值分解 (SVD) 的方法, 对  X  求奇异值分解, 得到</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>=</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X=U \Sigma V^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>W</mi><mo>^</mo></mover><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mi>X</mi><mi mathvariant="normal">⊤</mi></msup><mi>x</mi><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mrow><mo fence="true">(</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mi mathvariant="normal">⊤</mi></msup><mrow><mo fence="true">(</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo fence="true">(</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><mi>V</mi><mo fence="true">)</mo></mrow><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">(</mo><mi>V</mi><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>V</mi><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>V</mi><mi mathvariant="normal">Σ</mi></msub><msup><mi>T</mi><mi mathvariant="normal">⊤</mi></msup><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mi mathvariant="normal">⊤</mi></msup><mi>V</mi><msup><mi>ε</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mi>V</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mrow><mo fence="true">(</mo><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>V</mi><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>V</mi><mover><mo>∑</mo><mrow><mo>−</mo><mn>1</mn></mrow></mover><msup><mrow><mo fence="true">(</mo><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi mathvariant="normal">Σ</mi><mi mathvariant="normal">⊤</mi></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>V</mi><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>U</mi><mi mathvariant="normal">⊤</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{W}=\left(X^{\top} x\right)^{-1} X^{\top} Y &amp;=\left(\left(U \Sigma V^{\top}\right)^{\top}\left(U \Sigma V^{\top}\right)\right)^{-1}\left(U \Sigma V\right)^{\top} Y \\&amp;=\left(V \Sigma^{\top} U^{\top} U \Sigma V^{\top}\right)^{-1} V \Sigma^{\top} U^{\top} Y \\&amp;=\left(V_{\Sigma} T^{\top} \Sigma V^{\top}\right)^{\top} V \varepsilon^{\top} U^{\top} Y \\&amp;=\left(V^{\top}\right)^{-1} \Sigma^{-1}\left(\Sigma^{\top}\right)^{-1} V^{-1} V \Sigma^{\top} U^{\top} Y \\&amp;=V \sum^{-1}\left(\Sigma^{\top}\right)^{-1} \Sigma^{\top} U^{\top} Y \\&amp;=V \Sigma^{-1} U^{\top} Y\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:11.838602em;vertical-align:-5.669301em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.169301em;"><span style="top:-8.616406em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.103116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-6.56327em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"></span></span><span style="top:-4.765154em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"></span></span><span style="top:-3.0020379999999998em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"></span></span><span style="top:-0.5409249999999994em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"></span></span><span style="top:1.2081879999999998em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.669301em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.169301em;"><span style="top:-8.616406em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.138116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.3540079999999999em;"><span style="top:-3.6029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9890079999999999em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-6.56327em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.103116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-4.765154em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Σ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord">Σ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.138116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.0020379999999998em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.103116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.103116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-0.5409249999999994em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000002em;"><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5500050000000001em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.103116em;"><span style="top:-3.352008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span><span style="top:1.2081879999999998em;"><span class="pstrut" style="height:3.801113em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.669301em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>于是:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mo>+</mo></msup><mo>=</mo><mi>V</mi><msup><mi mathvariant="normal">Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>U</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X^{+}=V \Sigma^{-1} U^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="几何想象法"><a class="markdownIt-Anchor" href="#几何想象法"></a> 几何想象法</h3><p>我们通过对样本<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>的组合，也就是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1,x_2,...,x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>获得预测值, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi><mo>=</mo><msup><mrow><mo fence="true">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>y</mi><mi>N</mi></msub><mo fence="true">)</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">Y=\left(y_{1}, y_{2}, \cdots, y_{N}\right)^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.231231em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n*1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>的向量，则我们希望存在一个向量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mo>∗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m*1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>的向量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span> ，使得<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>β</mi></mrow><annotation encoding="application/x-tex">X^{T}\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span>之间的距离越小越好，那么<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>β</mi></mrow><annotation encoding="application/x-tex">X^{T}\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span>之间的差就与<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>的基本空间垂直，即：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mo>⋅</mo><mo stretchy="false">(</mo><mi>Y</mi><mo>−</mo><mi>X</mi><mi>β</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn><mo>⟶</mo><mi>β</mi><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi></mrow><annotation encoding="application/x-tex">X^{T} \cdot(Y-X \beta)=0 \longrightarrow \beta=\left(X^{T} X\right)^{-1} X^{T} Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.65544em;vertical-align:-0.011em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.404018em;vertical-align:-0.35001em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.054008em;"><span style="top:-3.3029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span></p><h3 id="噪声先验高斯分布的mle"><a class="markdownIt-Anchor" href="#噪声先验高斯分布的mle"></a> 噪声先验高斯分布的MLE</h3><p>对于一维的情况，记  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><msup><mi>w</mi><mi>T</mi></msup><mi>x</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">y=w^{T} x+\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.924661em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϵ</mi><mo>∼</mo><mi mathvariant="script">N</mi><mrow><mo fence="true">(</mo><mn>0</mn><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon \sim \mathcal{N}\left(0, \sigma^{2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">ϵ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> , 那么 $ y \sim \mathcal{N}\left(w^{T} x, \sigma^{2}\right)$  。代入极大似然估计中：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo>∣</mo><mi>X</mi><mo separator="true">,</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>log</mi><mo>⁡</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>p</mi><mrow><mo fence="true">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>w</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>π</mi><mi>σ</mi></mrow></msqrt></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><msup><mrow><mo fence="true">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msup><mi>u</mi><mi>T</mi></msup><msub><mi>x</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msup><mi>σ</mi><mn>2</mn></msup></mrow></mfrac></mrow></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mi>w</mi></munder><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmin</mi><mo>⁡</mo></mo><mi>w</mi></munder><munder><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><msup><mn>1</mn><mi>N</mi></msup></mrow></munder><msup><mrow><mo fence="true">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msup><mi>w</mi><mi>T</mi></msup><msub><mi>x</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mn>2</mn></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}L(w)=\log p(Y \mid X, w) &amp;=\log \prod_{i=1}^{N} p\left(y_{i} \mid x_{i}, w\right) \\&amp;=\sum_{i=1}^{N} \log \left(\frac{1}{\sqrt{2 \pi \sigma}} e^{-\frac{\left(y_{i}-u^{T} x_{i}\right)^{2}}{2 \sigma^{2}}}\right) \\\underset{w}{\operatorname{argmax}} L(w) &amp;=\underset{w}{\operatorname{argmin}} \sum_{i=1^{N}}\left(y_{i}-w^{T} x_{i}\right)^{2}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.565219em;vertical-align:-4.5326095em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.0326095em;"><span style="top:-7.0326095em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span><span style="top:-3.6266045em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"></span></span><span style="top:-0.9535964999999997em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.5326095em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.0326095em;"><span style="top:-7.0326095em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.6266045em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.75509em;"><span style="top:-3.75509em;margin-right:0.05em;"><span class="pstrut" style="height:3.30167em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8595285714285716em;"><span style="top:-2.5957857142857144em;"><span class="pstrut" style="height:3.0896em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class="pstrut" style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.3151em;"><span class="pstrut" style="height:3.0896em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.8595285714285716em;"><span class="pstrut" style="height:3.0896em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="minner mtight"><span class="minner mtight"><span class="mopen sizing reset-size1 size6 mtight delimcenter" style="top:0.125em;"><span class="mtight">(</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.03588em;margin-right:0.1em;"><span class="pstrut" style="height:2.65952em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31472em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0873300000000001em;"><span style="top:-3.0873299999999997em;margin-right:0.1em;"><span class="pstrut" style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.65952em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31472em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size1 size6 mtight delimcenter" style="top:0.125em;"><span class="mtight">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.5254400000000001em;"><span style="top:-3.5254399999999997em;margin-right:0.1em;"><span class="pstrut" style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.49381428571428565em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-0.9535964999999997em;"><span class="pstrut" style="height:3.828336em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.79213em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight"><span class="mord mtight">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7740928571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.35787em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0953389999999998em;"><span style="top:-3.344231em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.5326095em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>这个表达式和最小二乘估计得到的结果一样。</p><h3 id="权重先验为高斯分布的map-最大后验估计"><a class="markdownIt-Anchor" href="#权重先验为高斯分布的map-最大后验估计"></a> 权重先验为高斯分布的MAP-最大后验估计</h3><p>取先验分布  $w \sim \mathcal{N}\left(0, \sigma_{0}^{2}\right) $, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϵ</mi><mo>∼</mo><mi mathvariant="script">N</mi><mrow><mo fence="true">(</mo><mn>0</mn><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon \sim \mathcal{N}\left(0, \sigma^{2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">ϵ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span>  ,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>∣</mo><mi>x</mi><mo separator="true">;</mo><mi>w</mi><mo>∼</mo><mrow><mo fence="true">(</mo><msup><mi>w</mi><mi mathvariant="normal">⊤</mi></msup><mi>x</mi><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">y \mid x ; w \sim\left(w^{\top} x, \sigma^{2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span>。于是：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><msub><mi mathvariant="normal">argmax</mi><mo>⁡</mo><mi>w</mi></msub><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo>∣</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mi>w</mi></munder><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo>∣</mo><mi>w</mi><mo stretchy="false">)</mo><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mi>w</mi></munder><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo>∣</mo><mi>w</mi><mo stretchy="false">)</mo><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mi>w</mi></munder><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo>∣</mo><mi>w</mi><mo stretchy="false">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmin</mi><mo>⁡</mo></mo><mi>w</mi></munder><mrow><mo fence="true">[</mo><msup><mrow><mo fence="true">(</mo><mi>y</mi><mo>−</mo><msup><mi>w</mi><mi>T</mi></msup><mi>x</mi><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mfrac><msup><mi>σ</mi><mn>2</mn></msup><msubsup><mi>σ</mi><mn>0</mn><mn>2</mn></msubsup></mfrac><msup><mi>w</mi><mi>T</mi></msup><mi>w</mi><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{w}=\operatorname{argmax}_{w} p(w \mid Y) &amp;=\underset{w}{\operatorname{argmax}} p(Y \mid w) p(w) \\&amp;=\underset{w}{\operatorname{argmax}} \log p(Y \mid w) p(w) \\&amp;=\underset{w}{\operatorname{argmax}}(\log p(Y \mid w)+\log p(w)) \\&amp;=\underset{w}{\operatorname{argmin}}\left[\left(y-w^{T} x\right)^{2}+\frac{\sigma^{2}}{\sigma_{0}^{2}} w^{T} w\right]\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:8.846736em;vertical-align:-4.173368000000001em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.673368em;"><span style="top:-7.324476000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span><span style="top:-5.290036000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"></span></span><span style="top:-3.255596em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"></span></span><span style="top:-0.5700479999999992em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.173368000000001em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.673368em;"><span style="top:-7.324476000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span><span style="top:-5.290036000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span><span style="top:-3.255596em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-0.5700479999999992em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">x</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0953389999999998em;"><span style="top:-3.344231em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9523079999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.173368000000001em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>这里省略了<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>,$ p(Y)$  和  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> 没有关系:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo>∣</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mi mathvariant="normal">∣</mi><mi>p</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p(w \mid Y)=\frac{p(w, Y)}{p(Y)}=\frac{p(Y|w| p(w)}{p(Y)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mtight">∣</span><span class="mord mathdefault mtight">p</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>$ p(Y)<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">是</mi><mi mathvariant="normal">已</mi><mi mathvariant="normal">有</mi><mi mathvariant="normal">先</mi><mi mathvariant="normal">验</mi><mi mathvariant="normal">数</mi><mi mathvariant="normal">据</mi><mi mathvariant="normal">和</mi></mrow><annotation encoding="application/x-tex">是已有先验数据和</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">是</span><span class="mord cjk_fallback">已</span><span class="mord cjk_fallback">有</span><span class="mord cjk_fallback">先</span><span class="mord cjk_fallback">验</span><span class="mord cjk_fallback">数</span><span class="mord cjk_fallback">据</span><span class="mord cjk_fallback">和</span></span></span></span>w$无关。</p><h3 id="正则化"><a class="markdownIt-Anchor" href="#正则化"></a> 正则化</h3><p>正则化的两种方式：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>L</mi><mn>1</mn><mo>:</mo><munder><mo><mi mathvariant="normal">argmin</mi><mo>⁡</mo></mo><mi>w</mi></munder><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>+</mo><mi>λ</mi><mi mathvariant="normal">∥</mi><mi>w</mi><msub><mi mathvariant="normal">∥</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>λ</mi><mo>&gt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>L</mi><mn>2</mn><mo>:</mo><msub><mi mathvariant="normal">argmin</mi><mo>⁡</mo><mi>w</mi></msub><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>+</mo><mi>λ</mi><mi mathvariant="normal">∥</mi><mi>w</mi><msubsup><mi mathvariant="normal">∥</mi><mn>2</mn><mn>2</mn></msubsup><mo separator="true">,</mo><mi>λ</mi><mo>&gt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}L 1: \underset{w}{\operatorname{argmin}} L(w)+\lambda\|w\|_{1}, \lambda&gt;0 \\L 2: \operatorname{argmin}_{w} L(w)+\lambda\|w\|_{2}^{2}, \lambda&gt;0\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.9344400000000004em;vertical-align:-1.2172200000000002em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7172200000000002em;"><span style="top:-3.87722em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-2.20556em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.89444em;"><span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">∥</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.1427799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">λ</span><span class="mord">∥</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2172200000000002em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></p><h4 id="l1正则化-lasso"><a class="markdownIt-Anchor" href="#l1正则化-lasso"></a> L1正则化 Lasso</h4><p>L1正则化可以引起稀疏解<br />从最小化损失的角度看，由于  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">L</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">\mathrm{L} 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathrm">L</span></span><span class="mord">1</span></span></span></span>  项求导在O附近的左右导数都不是0, 因此更容易取到0<br />解。</p><h4 id="l2正则化-ridge"><a class="markdownIt-Anchor" href="#l2正则化-ridge"></a> L2正则化 Ridge</h4><p><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><msub><mi mathvariant="normal">argmin</mi><mo>⁡</mo><mi>w</mi></msub><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>+</mo><mi>λ</mi><msup><mi>w</mi><mi>T</mi></msup><mi>w</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac><mi>L</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mi>λ</mi><mi>w</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mn>2</mn><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>−</mo><mn>2</mn><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi><mo>+</mo><mn>2</mn><mi>λ</mi><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>⟶</mo><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><msup><mrow><mo fence="true">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><mo>+</mo><mi>λ</mi><mi mathvariant="double-struck">I</mi><mo fence="true">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi>Y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{w}=\operatorname{argmin}_{w} L(w)+\lambda w^{T} w &amp; \longrightarrow \frac{\partial}{\partial w} L(w)+2 \lambda w=0 \\&amp; \longrightarrow 2 X^{T} X \hat{w}-2 X^{T} Y+2 \lambda \hat{w}=0 \\&amp; \longrightarrow \hat{w}=\left(X^{T} X+\lambda \mathbb{I}\right)^{-1} X^{T} Y\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.664110000000001em;vertical-align:-2.5820550000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.082055em;"><span style="top:-5.0820549999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">λ</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.204724em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"></span></span><span style="top:-1.4493849999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5820550000000004em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.082055em;"><span style="top:-5.0820549999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-3.204724em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">λ</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-1.4493849999999995em;"><span class="pstrut" style="height:3.3714399999999998em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">λ</span><span class="mord"><span class="mord mathbb">I</span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0953389999999998em;"><span style="top:-3.3442309999999997em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5820550000000004em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>可以看到，这个正则化参数和前面的 MAP 结果不谋而合。利用2范数进行正则化不仅可 以是模型选择  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>  较小的参数，同时也避免 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^{T}X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>不可逆的问题。L2正则化可以降低过拟合。</p><p>正则化的知识还需要进一步理解。</p>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
      <category>数据分析</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>numpy知识点</title>
    <link href="/2020/12/16/numpy%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <url>/2020/12/16/numpy%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<p>记录一些常用函数和知识点</p><h4 id="axis理解"><a class="markdownIt-Anchor" href="#axis理解"></a> axis理解</h4><p><a href="https://www.jianshu.com/p/9aa448ea397c" target="_blank" rel="noopener">numpy中axis的理解</a></p><p><img src="https://upload-images.jianshu.io/upload_images/2233157-b77105789e36c847.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/652/format/webp" srcset="/img/loading.gif" alt="" /></p><p>axis=0,沿着竖直方向操作，操作对象是水平的一行，</p><p>axis=1,沿着水平方向操作，操作对象是竖直的一列。</p><pre class="highlight"><code class="python">&gt;&gt;&gt;df = pd.DataFrame([[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]], \columns=[<span class="hljs-string">"col1"</span>, <span class="hljs-string">"col2"</span>, <span class="hljs-string">"col3"</span>, <span class="hljs-string">"col4"</span>])&gt;&gt;&gt;df   col1  col2  col3  col4    <span class="hljs-number">0</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>    <span class="hljs-number">1</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>    <span class="hljs-number">2</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span></code></pre><pre class="highlight"><code class="python"><span class="hljs-meta">&gt;&gt;&gt; </span>df.mean(axis=<span class="hljs-number">1</span>)<span class="hljs-number">0</span>    <span class="hljs-number">1</span><span class="hljs-number">1</span>    <span class="hljs-number">2</span><span class="hljs-number">2</span>    <span class="hljs-number">3</span></code></pre><p>如代码所示，axis=1表示沿水平方向操作相加求平均，操作对象是竖直的一列，也就是</p><pre class="highlight"><code class="python"><span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">2</span>  +  <span class="hljs-number">2</span>  +  <span class="hljs-number">2</span>  +  <span class="hljs-number">2</span>    <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     </code></pre><p>同理看一下drop</p><pre class="highlight"><code class="python"><span class="hljs-meta">&gt;&gt;&gt; </span>df.drop(<span class="hljs-string">"col4"</span>, axis=<span class="hljs-number">1</span>)   col1  col2  col3<span class="hljs-number">0</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span><span class="hljs-number">1</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span><span class="hljs-number">2</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span></code></pre><p>drop的对象是一列，也就是drop下面这些列中的某一列</p><pre class="highlight"><code class="python"><span class="hljs-number">1</span>     <span class="hljs-number">1</span>     <span class="hljs-number">1</span><span class="hljs-number">1</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>     <span class="hljs-number">2</span>     <span class="hljs-number">3</span>     <span class="hljs-number">3</span>   </code></pre><p>sum和drop不同的的操作含义和axis结合起来可以产生不同的效果。</p><h4 id="npfull"><a class="markdownIt-Anchor" href="#npfull"></a> np.full()</h4><p>创造全为某个值的数组</p><pre class="highlight"><code class="python">np.full((<span class="hljs-number">2</span>,<span class="hljs-number">5</span>),<span class="hljs-number">6</span>,dtype=np.int)array([[<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>],       [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>]], dtype=uint32)</code></pre><p>创造形状相同，值为某个值的数组</p><pre class="highlight"><code class="python">x=np.arange(<span class="hljs-number">4</span>,dtype=np.int64)np.full_like(x,<span class="hljs-number">6</span>)array([<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>], dtype=int64)</code></pre><h4 id="npasscalar"><a class="markdownIt-Anchor" href="#npasscalar"></a> np.asscalar()</h4><pre class="highlight"><code class="python">x = np.array([<span class="hljs-number">30</span>])np.asscalar(x)</code></pre><h4 id="nparange"><a class="markdownIt-Anchor" href="#nparange"></a> np.arange()</h4><pre class="highlight"><code class="python">np.arange(<span class="hljs-number">2</span>, <span class="hljs-number">101</span>, <span class="hljs-number">2</span>)array([  <span class="hljs-number">2</span>,   <span class="hljs-number">4</span>,   <span class="hljs-number">6</span>,   <span class="hljs-number">8</span>,  <span class="hljs-number">10</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">14</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">18</span>,  <span class="hljs-number">20</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">26</span>,        <span class="hljs-number">28</span>,  <span class="hljs-number">30</span>,  <span class="hljs-number">32</span>,  <span class="hljs-number">34</span>,  <span class="hljs-number">36</span>,  <span class="hljs-number">38</span>,  <span class="hljs-number">40</span>,  <span class="hljs-number">42</span>,  <span class="hljs-number">44</span>,  <span class="hljs-number">46</span>,  <span class="hljs-number">48</span>,  <span class="hljs-number">50</span>,  <span class="hljs-number">52</span>,        <span class="hljs-number">54</span>,  <span class="hljs-number">56</span>,  <span class="hljs-number">58</span>,  <span class="hljs-number">60</span>,  <span class="hljs-number">62</span>,  <span class="hljs-number">64</span>,  <span class="hljs-number">66</span>,  <span class="hljs-number">68</span>,  <span class="hljs-number">70</span>,  <span class="hljs-number">72</span>,  <span class="hljs-number">74</span>,  <span class="hljs-number">76</span>,  <span class="hljs-number">78</span>,        <span class="hljs-number">80</span>,  <span class="hljs-number">82</span>,  <span class="hljs-number">84</span>,  <span class="hljs-number">86</span>,  <span class="hljs-number">88</span>,  <span class="hljs-number">90</span>,  <span class="hljs-number">92</span>,  <span class="hljs-number">94</span>,  <span class="hljs-number">96</span>,  <span class="hljs-number">98</span>, <span class="hljs-number">100</span>])</code></pre><h4 id="nplinspace"><a class="markdownIt-Anchor" href="#nplinspace"></a> np.linspace()</h4><p>给定一段范围划分指定数目</p><pre class="highlight"><code class="python">np.linspace(<span class="hljs-number">3.</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)array([  <span class="hljs-number">3.</span>        ,   <span class="hljs-number">3.14285714</span>,   <span class="hljs-number">3.28571429</span>,   <span class="hljs-number">3.42857143</span>,         <span class="hljs-number">3.57142857</span>,   <span class="hljs-number">3.71428571</span>,   <span class="hljs-number">3.85714286</span>,   <span class="hljs-number">4.</span>        ,         <span class="hljs-number">4.14285714</span>,   <span class="hljs-number">4.28571429</span>,   <span class="hljs-number">4.42857143</span>,   <span class="hljs-number">4.57142857</span>,         <span class="hljs-number">4.71428571</span>,   <span class="hljs-number">4.85714286</span>,   <span class="hljs-number">5.</span>        ,   <span class="hljs-number">5.14285714</span>,         <span class="hljs-number">5.28571429</span>,   <span class="hljs-number">5.42857143</span>,   <span class="hljs-number">5.57142857</span>,   <span class="hljs-number">5.71428571</span>,         <span class="hljs-number">5.85714286</span>,   <span class="hljs-number">6.</span>        ,   <span class="hljs-number">6.14285714</span>,   <span class="hljs-number">6.28571429</span>,         <span class="hljs-number">6.42857143</span>,   <span class="hljs-number">6.57142857</span>,   <span class="hljs-number">6.71428571</span>,   <span class="hljs-number">6.85714286</span>,         <span class="hljs-number">7.</span>        ,   <span class="hljs-number">7.14285714</span>,   <span class="hljs-number">7.28571429</span>,   <span class="hljs-number">7.42857143</span>,         <span class="hljs-number">7.57142857</span>,   <span class="hljs-number">7.71428571</span>,   <span class="hljs-number">7.85714286</span>,   <span class="hljs-number">8.</span>        ,         <span class="hljs-number">8.14285714</span>,   <span class="hljs-number">8.28571429</span>,   <span class="hljs-number">8.42857143</span>,   <span class="hljs-number">8.57142857</span>,         <span class="hljs-number">8.71428571</span>,   <span class="hljs-number">8.85714286</span>,   <span class="hljs-number">9.</span>        ,   <span class="hljs-number">9.14285714</span>,         <span class="hljs-number">9.28571429</span>,   <span class="hljs-number">9.42857143</span>,   <span class="hljs-number">9.57142857</span>,   <span class="hljs-number">9.71428571</span>,         <span class="hljs-number">9.85714286</span>,  <span class="hljs-number">10.</span>        ])</code></pre><h4 id="nplogspace"><a class="markdownIt-Anchor" href="#nplogspace"></a> np.logspace()</h4><p>同np.linspace(),只不过取了log</p><pre class="highlight"><code class="python">np.logspace(<span class="hljs-number">3</span>,<span class="hljs-number">10</span>,<span class="hljs-number">50</span>,endpoint=<span class="hljs-literal">False</span>)array([  <span class="hljs-number">1.00000000e+03</span>,   <span class="hljs-number">1.38038426e+03</span>,   <span class="hljs-number">1.90546072e+03</span>,         <span class="hljs-number">2.63026799e+03</span>,   <span class="hljs-number">3.63078055e+03</span>,   <span class="hljs-number">5.01187234e+03</span>,         <span class="hljs-number">6.91830971e+03</span>,   <span class="hljs-number">9.54992586e+03</span>,   <span class="hljs-number">1.31825674e+04</span>,         <span class="hljs-number">1.81970086e+04</span>,   <span class="hljs-number">2.51188643e+04</span>,   <span class="hljs-number">3.46736850e+04</span>,         <span class="hljs-number">4.78630092e+04</span>,   <span class="hljs-number">6.60693448e+04</span>,   <span class="hljs-number">9.12010839e+04</span>,         <span class="hljs-number">1.25892541e+05</span>,   <span class="hljs-number">1.73780083e+05</span>,   <span class="hljs-number">2.39883292e+05</span>,         <span class="hljs-number">3.31131121e+05</span>,   <span class="hljs-number">4.57088190e+05</span>,   <span class="hljs-number">6.30957344e+05</span>,         <span class="hljs-number">8.70963590e+05</span>,   <span class="hljs-number">1.20226443e+06</span>,   <span class="hljs-number">1.65958691e+06</span>,         <span class="hljs-number">2.29086765e+06</span>,   <span class="hljs-number">3.16227766e+06</span>,   <span class="hljs-number">4.36515832e+06</span>,         <span class="hljs-number">6.02559586e+06</span>,   <span class="hljs-number">8.31763771e+06</span>,   <span class="hljs-number">1.14815362e+07</span>,         <span class="hljs-number">1.58489319e+07</span>,   <span class="hljs-number">2.18776162e+07</span>,   <span class="hljs-number">3.01995172e+07</span>,         <span class="hljs-number">4.16869383e+07</span>,   <span class="hljs-number">5.75439937e+07</span>,   <span class="hljs-number">7.94328235e+07</span>,         <span class="hljs-number">1.09647820e+08</span>,   <span class="hljs-number">1.51356125e+08</span>,   <span class="hljs-number">2.08929613e+08</span>,         <span class="hljs-number">2.88403150e+08</span>,   <span class="hljs-number">3.98107171e+08</span>,   <span class="hljs-number">5.49540874e+08</span>,         <span class="hljs-number">7.58577575e+08</span>,   <span class="hljs-number">1.04712855e+09</span>,   <span class="hljs-number">1.44543977e+09</span>,         <span class="hljs-number">1.99526231e+09</span>,   <span class="hljs-number">2.75422870e+09</span>,   <span class="hljs-number">3.80189396e+09</span>,         <span class="hljs-number">5.24807460e+09</span>,   <span class="hljs-number">7.24435960e+09</span>])</code></pre><h4 id="npdiagonal"><a class="markdownIt-Anchor" href="#npdiagonal"></a> np.diagonal()</h4><p>输出对角线，矩阵的迹</p><pre class="highlight"><code class="python">X = np.array([[ <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [ <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>], [ <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]])np.diag(X)X.diagonal()array([ <span class="hljs-number">0</span>,  <span class="hljs-number">5</span>, <span class="hljs-number">10</span>])</code></pre><p>创造对角线指定值，其余为0的矩阵</p><pre class="highlight"><code class="python">np.diagflat([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])array([[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],       [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],       [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>],       [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>]])</code></pre><h4 id="nptri"><a class="markdownIt-Anchor" href="#nptri"></a> np.tri()</h4><p>创造对角线指定方向上下为1，其余为0的矩阵</p><pre class="highlight"><code class="python">np.tri(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-number">1</span>)array([[<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>]])np.tri(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>)array([[<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>]])np.tri(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-number">-1</span>)array([[<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],       [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>]])</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#下三角 对角线以下保留，以上为0</span>np.tril(np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">13</span>).reshape(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>), <span class="hljs-number">-1</span>)array([[ <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>],       [ <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>],       [ <span class="hljs-number">7</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">0</span>],       [<span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>]])np.triu(np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">13</span>).reshape(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>), <span class="hljs-number">-1</span>)array([[ <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>],       [ <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>],       [ <span class="hljs-number">0</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>],       [ <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-number">12</span>]])</code></pre><h4 id="打平"><a class="markdownIt-Anchor" href="#打平"></a> 打平</h4><pre class="highlight"><code class="python">x = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]])out1=np.ravel(x,order=<span class="hljs-string">'F'</span>)out2=x.flatten(order=<span class="hljs-string">'F'</span>)</code></pre><h4 id="npswapaxes"><a class="markdownIt-Anchor" href="#npswapaxes"></a> np.swapaxes()</h4><pre class="highlight"><code class="python">x=np.zeros((<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))out1=np.swapaxes(x,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)out2=x.transpose([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>])</code></pre><h4 id="npexpand_dims"><a class="markdownIt-Anchor" href="#npexpand_dims"></a> np.expand_dims()</h4><pre class="highlight"><code class="python">x=np.zeros((<span class="hljs-number">3</span>,<span class="hljs-number">4</span>))np.expand_dims(x,axis=<span class="hljs-number">1</span>)np.squeeze(x)</code></pre><h4 id="npconcatenate"><a class="markdownIt-Anchor" href="#npconcatenate"></a> np.concatenate()</h4><pre class="highlight"><code class="python">x = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]])y = np.array([[<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>]])out1 = np.concatenate((x, y), <span class="hljs-number">1</span>) <span class="hljs-comment">#水平方向操作，竖直为操作对象</span>out2 = np.hstack((x, y)) <span class="hljs-comment">#水平方向堆叠</span></code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#按列来堆叠</span>x = np.array((<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))y = np.array((<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>))out1 = np.column_stack((x, y))</code></pre><pre class="highlight"><code class="python">x = np.array([[<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>]])y = np.array([[<span class="hljs-number">4</span>],[<span class="hljs-number">5</span>],[<span class="hljs-number">6</span>]])out = np.dstack((x, y))[[[<span class="hljs-number">1</span> <span class="hljs-number">4</span>]] [[<span class="hljs-number">2</span> <span class="hljs-number">5</span>]] [[<span class="hljs-number">3</span> <span class="hljs-number">6</span>]]]</code></pre><h4 id="npsplit"><a class="markdownIt-Anchor" href="#npsplit"></a> np.split()</h4><pre class="highlight"><code class="python">x = np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)np.split(x, [<span class="hljs-number">4</span>, <span class="hljs-number">6</span>])[array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]), array([<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]), array([<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>])]    </code></pre>]]></content>
    
    
    <categories>
      
      <category>numpy</category>
      
    </categories>
    
    
    <tags>
      
      <tag>numpy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第二届翼支付杯大数据建模大赛复盘</title>
    <link href="/2020/10/03/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%BF%BC%E6%94%AF%E4%BB%98%E6%9D%AF%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E5%A4%A7%E8%B5%9B%E5%A4%8D%E7%9B%98/"/>
    <url>/2020/10/03/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%BF%BC%E6%94%AF%E4%BB%98%E6%9D%AF%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E5%A4%A7%E8%B5%9B%E5%A4%8D%E7%9B%98/</url>
    
    <content type="html"><![CDATA[<p>暑假的时候参加了一个数据竞赛–第二届翼支付杯大数据建模大赛-信用风险用户识别。最后复赛A榜排在第15名，B榜12名。第一次正式参加比赛，原本只想排到六七十名就够了，没想到最后能进到前二十，感谢队友和自己的付出。虽然最后的结果还不错，但是做的还是模模糊糊的，现在对一些top方案和自己参加比赛的想法做一些总结。</p><h2 id="数据"><a class="markdownIt-Anchor" href="#数据"></a> 数据</h2><h3 id="基础信息-base_df"><a class="markdownIt-Anchor" href="#基础信息-base_df"></a> 基础信息 base_df</h3><table><thead><tr><th>字段名</th><th>字段说明（数据经过脱敏处理）</th></tr></thead><tbody><tr><td>user</td><td>样本编号，e.g., Train_00000、Train_00001…</td></tr><tr><td>sex</td><td>性别，编码后取值为：category 0、category1</td></tr><tr><td>age</td><td>年龄，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>provider</td><td>运营商类型，编码后取值为：category 0、category 1…</td></tr><tr><td>level</td><td>用户等级，编码后取值为：category 0、category 1…</td></tr><tr><td>verified</td><td>是否实名，编码后取值为：category 0、category1</td></tr><tr><td>using_time</td><td>使用时长，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>regist_type</td><td>注册类型，编码后取值为：category 0、category 1…</td></tr><tr><td>card_a_cnt</td><td>a类型卡的数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>card_b_cnt</td><td>b类型卡的数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>card_c_cnt</td><td>c类型卡的数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>card_d_cnt</td><td>d类型卡的数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>op1_cnt</td><td>某类型1操作数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>op2_cnt</td><td>某类型2操作数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>service1_cnt</td><td>某业务1产生数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>service1_amt</td><td>某业务1产生金额，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>service2_cnt</td><td>某业务2产生数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>agreement_total</td><td>开通协议数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>agreement1</td><td>是否开通协议1，编码后取值为：category 0、category1</td></tr><tr><td>agreement2</td><td>是否开通协议2，编码后取值为：category 0、category1</td></tr><tr><td>agreement3</td><td>是否开通协议3，编码后取值为：category 0、category1</td></tr><tr><td>agreement4</td><td>是否开通协议4，编码后取值为：category 0、category1</td></tr><tr><td>acc_count</td><td>账号数量，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>login_cnt_period1</td><td>某段时期1的登录次数，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>login_cnt_period2</td><td>某段时期2的登录次数，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>ip_cnt</td><td>某段时期登录ip个数，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>login_cnt_avg</td><td>某段时期登录次数均值，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>login_days_cnt</td><td>某段时期登录天数，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>province</td><td>省份，处理成类别编码</td></tr><tr><td>city</td><td>城市，处理成类别编码</td></tr><tr><td>balance</td><td>余额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>balance_avg</td><td>近某段时期余额均值等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>balance1</td><td>类型1余额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>balance1_avg</td><td>近某段时期类型1余额均值等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>balance2</td><td>类型2余额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>balance2_avg</td><td>近某段时期类型2余额均值等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>service3</td><td>是否服务3用户，编码后取值为：category 0、category1</td></tr><tr><td>service3_level</td><td>服务3等级，编码后取值为：category 0、category1…</td></tr><tr><td>product1_amount</td><td>产品1金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product2_amount</td><td>产品2金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product3_amount</td><td>产品3金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product4_amount</td><td>产品4金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product5_amount</td><td>产品5金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product6_amount</td><td>产品6金额等级，处理成保留大小关系的类别编码：level 1、level2… 例如：level 2 &gt; level 1</td></tr><tr><td>product7_cnt</td><td>产品7申请次数，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>product7_fail_cnt</td><td>产品7申请失败次数，处理后仅保留大小关系，为某一区间的整数</td></tr></tbody></table><h3 id="操作信息-op_df"><a class="markdownIt-Anchor" href="#操作信息-op_df"></a> 操作信息 op_df</h3><table><thead><tr><th>字段名</th><th>字段说明（数据经过脱敏处理）</th></tr></thead><tbody><tr><td>user</td><td>样本编号，e.g., Train_00000、Train_00001…</td></tr><tr><td>op_type</td><td>操作类型编码，处理成类别编码</td></tr><tr><td>op_mode</td><td>操作模式编码，处理成类别编码</td></tr><tr><td>op_device</td><td>操作设备编码，处理成类别编码</td></tr><tr><td>ip</td><td>设备ip编码，处理成类别编码</td></tr><tr><td>net_type</td><td>网络类型编码，处理成类别编码</td></tr><tr><td>channel</td><td>渠道类型编码，处理成类别编码</td></tr><tr><td>ip_3</td><td>设备ip前三位编码，处理成类别编码</td></tr><tr><td>tm_diff</td><td>距离某起始时间点的时间间隔，处理成如下格式。例如： 9 days 09:02:45.000000000，表示距离某起始时间点9天9小时2分钟45秒</td></tr></tbody></table><h4 id="交易信息-trans_df"><a class="markdownIt-Anchor" href="#交易信息-trans_df"></a> 交易信息 trans_df</h4><table><thead><tr><th>字段名</th><th>字段说明（数据经过脱敏处理）</th></tr></thead><tbody><tr><td>user</td><td>样本编号，e.g., Train_00000、Train_00001…</td></tr><tr><td>platform</td><td>平台类型编码，处理成类别编码</td></tr><tr><td>tunnel_in</td><td>来源类型编码，处理成类别编码</td></tr><tr><td>tunnel_out</td><td>去向类型编码，处理成类别编码</td></tr><tr><td>amount</td><td>交易金额，处理后仅保留大小关系，为某一区间的整数</td></tr><tr><td>type1</td><td>交易类型1编码，处理成类别编码</td></tr><tr><td>type2</td><td>交易类型2编码，处理成类别编码</td></tr><tr><td>ip</td><td>设备ip编码，处理成类别编码</td></tr><tr><td>ip_3</td><td>设备ip前三位编码，处理成类别编码</td></tr><tr><td>tm_diff</td><td>距离某起始时间点的时间间隔，处理成如下格式。例如： 9 days 09:02:45.000000000，表示距离某起始时间点9天9小时2分钟45秒</td></tr></tbody></table><p>评价方式采用roc_auc_score</p><h2 id="top1方案"><a class="markdownIt-Anchor" href="#top1方案"></a> top1方案</h2><p>1.第一个比较有意思的点就是作者根据<code>user</code>键将trans_df和op_df中merge进了base_df的<code>label</code>,这样就能对trans_df和op_df作target_encoding啦~</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_trans_op_label</span><span class="hljs-params">(trans, op, train_label)</span>:</span>    trans_ = trans.copy()    op_ = op.copy()    user_label_dict = dict(zip(train_label.user.values,        train_label.label.values))    trans_[<span class="hljs-string">'label'</span>] = trans_[<span class="hljs-string">'user'</span>].map(user_label_dict)    op_[<span class="hljs-string">'label'</span>] = op_[<span class="hljs-string">'user'</span>].map(user_label_dict)    <span class="hljs-keyword">return</span> trans_, op_</code></pre><p>让我们学习一下pandas中的<code>map</code>操作。</p><p>其次就是将trans_df和op_df拼接成一张表trans_op_df，这样一张表就同时包含操作和交易信息,也许会带来更多的信息哦</p><p><img src="https://s1.ax1x.com/2020/10/03/03tuDJ.png" srcset="/img/loading.gif" alt="03tuDJ.png" /></p><p>2.构建session，这个是根据操作或者交易的时间差来确定一个session，并不是很懂。当相邻两个操作或者交易时间差超过600时，赋值为1作cumsum。</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_session_fea</span><span class="hljs-params">(file)</span>:</span>    tmp = file.groupby(<span class="hljs-string">'user'</span>)[<span class="hljs-string">'timestamp'</span>].shift()    file[<span class="hljs-string">'delta_time'</span>] = file[<span class="hljs-string">'timestamp'</span>] - tmp    file[<span class="hljs-string">'session'</span>] = np.where(file[<span class="hljs-string">'delta_time'</span>] &gt; <span class="hljs-number">600</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)    file[<span class="hljs-string">'session'</span>] = file.groupby([<span class="hljs-string">'user'</span>])[<span class="hljs-string">'session'</span>].transform(<span class="hljs-string">'cumsum'</span>)    <span class="hljs-keyword">del</span> file[<span class="hljs-string">'delta_time'</span>]    <span class="hljs-keyword">return</span> file</code></pre><p>怎么解释呢？当相邻的操作或交易在一定的时间范围内完成时，就认为是一个session，当很多操作在相邻的时间内完成，是否可以看成一种行为模式，用cumsum来累积？另外一个点就是pandas中的<code>groupby</code>后作shift的操作，可以对一个组内的某个变量进行偏移操作。</p><p>3.一些针对op_df和trans_df的交叉特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_fea_op_df</span><span class="hljs-params">(op_df)</span>:</span>    op_df[<span class="hljs-string">'op_pattern'</span>] = op_df[<span class="hljs-string">'op_type'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'op_mode'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'op_device'</span>].map(str)    op_df[<span class="hljs-string">'op_type_mode'</span>] = op_df[<span class="hljs-string">'op_type'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'op_mode'</span>].map(str)    op_df[<span class="hljs-string">'op_type_device'</span>] = op_df[<span class="hljs-string">'op_type'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'op_device'</span>].map(str)    op_df[<span class="hljs-string">'op_mode_device'</span>] = op_df[<span class="hljs-string">'op_mode'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'op_device'</span>].map(str)    op_df[<span class="hljs-string">'ip_net_type'</span>] = op_df[<span class="hljs-string">'ip'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'net_type'</span>].map(str)    op_df[<span class="hljs-string">'ip3_net_type'</span>] = op_df[<span class="hljs-string">'ip_3'</span>].map(str) + <span class="hljs-string">'_'</span> + op_df[<span class="hljs-string">'net_type'</span>].map(str)    op_df[<span class="hljs-string">'net_type_channel'</span>] = op_df[<span class="hljs-string">'net_type'</span>].map(str) + <span class="hljs-string">'_'</span> +  op_df[<span class="hljs-string">'channel'</span>].map(str)   <span class="hljs-comment"># op_df['time_diff'] = op_df['timestamp'].diff(-1)</span>    op_df.rename(columns={<span class="hljs-string">'ip'</span> : <span class="hljs-string">'op_ip'</span>, <span class="hljs-string">'ip_3'</span>: <span class="hljs-string">'op_ip_3'</span>,}, inplace=<span class="hljs-literal">True</span>)    <span class="hljs-keyword">return</span> op_df</code></pre><p>可以看出来的一点是，对于交叉特诊，作者也是将相关的一些特征进行组合。自己当时只做了一列列别数量较少的特征的交叉，在这里可以看到作者对ip等很多类别的特征也进行了交叉。</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_fea_trans_df</span><span class="hljs-params">(trans_df)</span>:</span>    trans_df[<span class="hljs-string">'tunnel_io'</span>] = trans_df[<span class="hljs-string">'tunnel_in'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'tunnel_out'</span>].astype(str)    trans_df[<span class="hljs-string">'type'</span>] = trans_df[<span class="hljs-string">'type1'</span>].astype(str) + <span class="hljs-string">'_'</span> +trans_df[<span class="hljs-string">'type2'</span>].astype(str)    trans_df[<span class="hljs-string">'tunnel_io_type'</span>] = trans_df[<span class="hljs-string">'tunnel_io'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'type'</span>].astype(str)    trans_df[<span class="hljs-string">'platform_tunnel_io_type'</span>] = trans_df[<span class="hljs-string">'platform'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'tunnel_io_type'</span>]    trans_df[<span class="hljs-string">'platform_tunnel_io'</span>] = trans_df[<span class="hljs-string">'platform'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'tunnel_io'</span>]    trans_df[<span class="hljs-string">'platform_type'</span>] = trans_df[<span class="hljs-string">'platform'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'type'</span>]    trans_df[<span class="hljs-string">'platform_amount'</span>] = trans_df[<span class="hljs-string">'platform'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'type_amount'</span>] = trans_df[<span class="hljs-string">'type'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'tunnel_io_amount'</span>] = trans_df[<span class="hljs-string">'type'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'type1_amount'</span>] = trans_df[<span class="hljs-string">'type1'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'type2_amount'</span>] = trans_df[<span class="hljs-string">'type2'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'tunnel_in_amount'</span>] = trans_df[<span class="hljs-string">'tunnel_in'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'tunnel_out_amount'</span>] = trans_df[<span class="hljs-string">'tunnel_out'</span>].astype(str) + <span class="hljs-string">'_'</span> + trans_df[<span class="hljs-string">'amount'</span>].astype(str)    trans_df[<span class="hljs-string">'amount_diff'</span>] = trans_df[<span class="hljs-string">'amount'</span>].astype(int).diff(<span class="hljs-number">-1</span>)    trans_df[<span class="hljs-string">'time_diff'</span>] = trans_df[<span class="hljs-string">'timestamp'</span>].diff(<span class="hljs-number">-1</span>)    trans_df[<span class="hljs-string">'amount_per_time'</span>] = trans_df[<span class="hljs-string">'amount_diff'</span>] / np.where(trans_df[<span class="hljs-string">'time_diff'</span>] == <span class="hljs-number">0</span>, <span class="hljs-number">0.01</span>, trans_df[<span class="hljs-string">'time_diff'</span>])    trans_df = gen_session_fea(trans_df)</code></pre><p>比较有看点的是对amount做了<code>diff</code>操作，计算相邻两次交易的差额，并计算了相邻两次交易的时间，两者相除得到交易额与时间差的比值。</p><p>3.base_df交叉特征。对于base_df里的数值特征作加减乘除操作。</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">int_cols_cross</span><span class="hljs-params">(df, cols)</span>:</span>    <span class="hljs-string">"""[summary]        对base数据的int64特征进行min-max归一化后进行加减乘除交互    Parameters    ----------    df : [DataFrame]        [训练集和测试集合并的数据]    cols : [list]        [交互特征]    Returns    -------    [DataFrame, list]        [整数特征交互后的data, 及交互特征名称]    """</span>    cross_feature = []    df = df.copy()    <span class="hljs-keyword">for</span> i, col <span class="hljs-keyword">in</span> tqdm(enumerate(cols), desc=<span class="hljs-string">'extract cross feature for base'</span>):        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i + <span class="hljs-number">1</span>, len(cols)):            df[col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'div_'</span> + cols[j]] = min_max_unif(df[col]) / min_max_unif(df[cols[j]])            df[col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'sub_'</span> + cols[j]] = min_max_unif(df[col]) - min_max_unif(df[cols[j]])            df[col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'mul_'</span> + cols[j]] = min_max_unif(df[col]) * min_max_unif(df[cols[j]])            df[col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'sum_'</span> + cols[j]] = min_max_unif(df[col]) + min_max_unif(df[cols[j]])            cross_feature.append(col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'div_'</span> + cols[j])            cross_feature.append(col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'sub_'</span> + cols[j])            cross_feature.append(col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'mul_'</span> + cols[j])            cross_feature.append(col + <span class="hljs-string">'_'</span> + <span class="hljs-string">'sum_'</span> + cols[j])    <span class="hljs-keyword">return</span> df, cross_feature</code></pre><p>这个感觉很强呀，加减乘除都用到数值特征上。</p><p>3.count计数特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_cnt_feature</span><span class="hljs-params">(df, feature)</span>:</span>    cnt_features = []    <span class="hljs-keyword">for</span> fea <span class="hljs-keyword">in</span> feature:        df[fea + <span class="hljs-string">'_count'</span>] = df.groupby([fea])[<span class="hljs-string">'user'</span>].transform(<span class="hljs-string">'count'</span>)        cnt_features.append(fea + <span class="hljs-string">'_count'</span>)    <span class="hljs-keyword">return</span> df</code></pre><p>但是为什么只对<code>cnt_feature = ['city', 'province', 'balance', 'ip_cnt', 'using_time', ]</code>这些特征作计数特征就不知道是为什么了，难道也是一个个试出来的嘛？</p><p>4.trans_df的amount统计特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_amount_features</span><span class="hljs-params">(df)</span>:</span>    group_df = df.groupby([<span class="hljs-string">'user'</span>])[<span class="hljs-string">'amount'</span>].agg({        <span class="hljs-string">'user_amount_mean'</span>: <span class="hljs-string">'mean'</span>,       <span class="hljs-comment"># 'user_amount_std': 'std',</span>        <span class="hljs-string">'user_amount_max'</span>: <span class="hljs-string">'max'</span>,        <span class="hljs-string">'user_amount_min'</span>: <span class="hljs-string">'min'</span>,        <span class="hljs-string">'user_amount_sum'</span>: <span class="hljs-string">'sum'</span>,        <span class="hljs-string">'user_amount_med'</span>: <span class="hljs-string">'median'</span>,        <span class="hljs-string">'user_amount_cnt'</span>: <span class="hljs-string">'count'</span>,        <span class="hljs-comment"># 'user_amount_q1': lambda x: x.quantile(0.25),</span>        <span class="hljs-comment"># 'user_amount_q3': lambda x: x.quantile(0.75),</span>        <span class="hljs-comment">#'user_amount_qsub': lambda x: x.quantile(0.75) - x.quantile(0.25)</span>        <span class="hljs-comment">#'user_amount_skew': 'skew',</span>        }).reset_index()    <span class="hljs-keyword">return</span> group_df</code></pre><p>这个没什么好说的，肯定得做</p><p>5.nunique特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_nunique_features</span><span class="hljs-params">(df, value, prefix)</span>:</span>    group_df = df.groupby([<span class="hljs-string">'user'</span>])[value].agg({        <span class="hljs-string">'user_{}_{}_nuniq'</span>.format(prefix, value): <span class="hljs-string">'nunique'</span>    }).reset_index()    <span class="hljs-keyword">return</span> group_df</code></pre><p>计算一个用户在某个字段上有几个unique值.</p><p>trans_df:<code>['days_diff', 'platform', 'tunnel_in', 'tunnel_out', 'type1', 'type2', ]</code></p><p>6.一个值有几个用户的nunique统计结果</p><p>首先计算一个值有几个用户</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">file_cols_user_nunique</span><span class="hljs-params">(file, feature_lst, prefix)</span>:</span>    col_nuniq_fea_lst = []    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> tqdm(feature_lst):        col_nuniq = file.groupby(col)[<span class="hljs-string">'user'</span>].nunique()        col_nuniq_dic = dict(zip(col_nuniq.index, col_nuniq.values))        file[prefix + <span class="hljs-string">'_'</span> + col + <span class="hljs-string">'_user_nuniq'</span>] = file[col].map(col_nuniq_dic)        col_nuniq_fea_lst.append(prefix + <span class="hljs-string">'_'</span> + col + <span class="hljs-string">'_user_nuniq'</span>)    <span class="hljs-keyword">return</span> file, col_nuniq_fea_lst</code></pre><p>在对上面的计算值作统计计算</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_stastic_col_user_nunique</span><span class="hljs-params">(file, feat, prefix)</span>:</span>    group_df = file.groupby(<span class="hljs-string">'user'</span>)[feat].agg({        prefix + feat + <span class="hljs-string">'_mean'</span>: <span class="hljs-string">'mean'</span>,        prefix + feat + <span class="hljs-string">'_std'</span>: <span class="hljs-string">'std'</span>,        prefix + feat + <span class="hljs-string">'_max'</span>: <span class="hljs-string">'max'</span>,        prefix + feat + <span class="hljs-string">'_min'</span>: <span class="hljs-string">'min'</span>,        prefix + feat + <span class="hljs-string">'_sum'</span>: <span class="hljs-string">'sum'</span>,        prefix + feat + <span class="hljs-string">'_med'</span>: <span class="hljs-string">'median'</span>,        <span class="hljs-comment">#prefix + feat + '_q1'  : lambda x: x.quantile(0.25),</span>        <span class="hljs-comment">#prefix + feat + '_q3'  : lambda x: x.quantile(0.75),</span>        <span class="hljs-comment">#prefix + feat + 'q_sub': lambda x: x.quantile(0.75) - x.quantile(0.25),</span>        <span class="hljs-comment">#prefix + feat + '_skew': 'skew',</span>    })    <span class="hljs-keyword">return</span> group_df</code></pre><p>这个在trans_df、op_df、trans_op_df都可以做。</p><p>7.利用pivot_table计算在各个值类别上交易的聚合</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_group_amount_features</span><span class="hljs-params">(df, value)</span>:</span>    group_df = df.pivot_table(index=<span class="hljs-string">'user'</span>,                              columns=value,                              values=<span class="hljs-string">'amount'</span>,                              dropna=<span class="hljs-literal">False</span>,                              aggfunc=[<span class="hljs-string">'count'</span>, <span class="hljs-string">'sum'</span>,                                       <span class="hljs-string">'mean'</span>, <span class="hljs-string">'max'</span>, <span class="hljs-string">'min'</span>, <span class="hljs-string">'median'</span>,                                       ]).fillna(<span class="hljs-number">0</span>)    group_df.columns = [<span class="hljs-string">'user_{}_{}_amount_{}'</span>.format(value, f[<span class="hljs-number">1</span>], f[<span class="hljs-number">0</span>]) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> group_df.columns]    group_df.reset_index(inplace=<span class="hljs-literal">True</span>)    <span class="hljs-keyword">return</span> group_df</code></pre><p>这种特征构造方式在类别不是特别多的时候比较适用。</p><p>8.计算不同时间窗口下用户交易额统计信息</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_window_amount_features</span><span class="hljs-params">(df, window)</span>:</span>    group_df = df[df[<span class="hljs-string">'days_diff'</span>]&gt;window].groupby(<span class="hljs-string">'user'</span>)[<span class="hljs-string">'amount'</span>].agg({        <span class="hljs-string">'user_amount_mean_{}d'</span>.format(window): <span class="hljs-string">'mean'</span>,        <span class="hljs-string">'user_amount_std_{}d'</span>.format(window): <span class="hljs-string">'std'</span>,        <span class="hljs-string">'user_amount_max_{}d'</span>.format(window): <span class="hljs-string">'max'</span>,        <span class="hljs-string">'user_amount_min_{}d'</span>.format(window): <span class="hljs-string">'min'</span>,        <span class="hljs-string">'user_amount_sum_{}d'</span>.format(window): <span class="hljs-string">'sum'</span>,        <span class="hljs-string">'user_amount_med_{}d'</span>.format(window): <span class="hljs-string">'median'</span>,        <span class="hljs-string">'user_amount_cnt_{}d'</span>.format(window): <span class="hljs-string">'count'</span>,        <span class="hljs-comment"># 'user_amount_q1_{}d'.format(window): lambda x: x.quantile(0.25),</span>        <span class="hljs-comment"># 'user_amount_q3_{}d'.format(window): lambda x: x.quantile(0.75),</span>        <span class="hljs-comment"># 'user_amount_qsub_{}d'.format(window): lambda x: x.quantile(0.75) - x.quantile(0.25),</span>        <span class="hljs-comment"># 'user_amount_skew_{}d'.format(window): 'skew',</span>        <span class="hljs-comment"># 'user_amount_q4_{}d'.format(window): lambda x: x.quantile(0.8),</span>        <span class="hljs-comment"># 'user_amount_q5_{}d'.format(window): lambda x: x.quantile(0.3),</span>        <span class="hljs-comment"># 'user_amount_q6_{}d'.format(window): lambda x: x.quantile(0.7),</span>        }).reset_index()    <span class="hljs-keyword">return</span> group_df</code></pre><p>9.空值特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_null_features</span><span class="hljs-params">(df, value, prefix)</span>:</span>    df[<span class="hljs-string">'is_null'</span>] = <span class="hljs-number">0</span>    df.loc[df[value].isnull(), <span class="hljs-string">'is_null'</span>] = <span class="hljs-number">1</span>    group_df = df.groupby([<span class="hljs-string">'user'</span>])[<span class="hljs-string">'is_null'</span>].agg({<span class="hljs-string">'user_{}_{}_null_cnt'</span>.format(prefix, value): <span class="hljs-string">'sum'</span>,                                                    <span class="hljs-string">'user_{}_{}_null_ratio'</span>.format(prefix, value): <span class="hljs-string">'mean'</span>}).reset_index()    <span class="hljs-keyword">return</span> group_df</code></pre><p>10.统计一些特殊值上时间的聚合特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_file_type_days_diff</span><span class="hljs-params">(df, file, type, time_feat)</span>:</span>    plot_feats = []    <span class="hljs-comment">#file_type_unique = file[type].value_counts().index.tolist()</span>    file_type_unique = []    <span class="hljs-keyword">if</span> type == <span class="hljs-string">'type1'</span>:        file_type_unique = [<span class="hljs-string">'45a1168437c708ff'</span>,                             <span class="hljs-string">'f67d4b5a05a1352a'</span>,                              ]    <span class="hljs-keyword">elif</span> type == <span class="hljs-string">'type2'</span>:        file_type_unique = [<span class="hljs-string">'11a213398ee0c623'</span>,]    <span class="hljs-keyword">elif</span> type == <span class="hljs-string">'channel'</span>:        file_type_unique = [<span class="hljs-string">'b2e7fa260df4998d'</span>,                            <span class="hljs-string">'116a2503b987ea81'</span>,                            <span class="hljs-string">'8adb3dcfea9dcf5e'</span>]    <span class="hljs-keyword">elif</span> type == <span class="hljs-string">'tunnel_io'</span>:        file_type_unique = [<span class="hljs-string">'b2e7fa260df4998d_6ee790756007e69a'</span>,]    <span class="hljs-keyword">elif</span> type == <span class="hljs-string">'type'</span>:        file_type_unique = [<span class="hljs-string">'f67d4b5a05a1352a_nan'</span>,                            <span class="hljs-string">'19d44f1a51919482_11a213398ee0c623'</span>,                            <span class="hljs-string">'45a1168437c708ff_11a213398ee0c623'</span>,                            <span class="hljs-string">'674e8d5860bc033d_11a213398ee0c623'</span>,                            <span class="hljs-string">'0a3cf8dac7dca9d1_b5a8be737a50b171'</span>]    <span class="hljs-keyword">for</span> tp <span class="hljs-keyword">in</span> file_type_unique:        <span class="hljs-keyword">assert</span> file_type_unique != []        group_df = file[file[type] == tp].groupby([<span class="hljs-string">'user'</span>])[time_feat].agg(            {<span class="hljs-string">'user_{}_{}_min_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'min'</span>,             <span class="hljs-string">'user_{}_{}_mean_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'mean'</span>,             <span class="hljs-string">'user_{}_{}_max_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'max'</span>,             <span class="hljs-string">'user_{}_{}_std_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'std'</span>,             <span class="hljs-string">'user_{}_{}_median_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'median'</span>,             <span class="hljs-string">'user_{}_{}_sum_{}'</span>.format(type, tp, time_feat): <span class="hljs-string">'sum'</span>,             <span class="hljs-comment"># 'user_{}_{}_q1_{}'.format(type, tp, time_feat): lambda x: x.quantile(0.25),</span>             <span class="hljs-comment"># 'user_{}_{}_q3_{}'.format(type, tp, time_feat): lambda x: x.quantile(0.75),</span>             <span class="hljs-comment"># 'user_{}_{}_q_sub_{}'.format(type, tp, time_feat): lambda x: x.quantile(0.75) - x.quantile(0.25),</span>             <span class="hljs-comment"># 'user_{}_{}_skew_{}'.format(type, tp, time_feat): 'skew',</span>             }).reset_index()        df = df.merge(group_df, on=[<span class="hljs-string">'user'</span>], how=<span class="hljs-string">'left'</span>)        stastic = [<span class="hljs-string">'min'</span>, <span class="hljs-string">'max'</span>, <span class="hljs-string">'max'</span>, <span class="hljs-string">'std'</span>, <span class="hljs-string">'median'</span>, <span class="hljs-string">'sum'</span>,]        <span class="hljs-keyword">for</span> stast <span class="hljs-keyword">in</span> stastic:            plot_feats.append(<span class="hljs-string">'user_{}_{}_{}_{}'</span>.format(type, tp, stast, time_feat))    <span class="hljs-keyword">return</span> df, plot_feats</code></pre><p>这个特殊值的选择作者也没有提到，应该是要根据一些画图分析得到。</p><p>11.doc2vec特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">d2v_feat</span><span class="hljs-params">(df, feat, length, num)</span>:</span>    print(<span class="hljs-string">'Start training Doc2Vec models.......'</span>)    df[feat] = df[feat].astype(str)    group_df = df.groupby([<span class="hljs-string">'user'</span>])[feat].agg(list).reset_index()    documents = [TaggedDocument(doc, [i]) <span class="hljs-keyword">for</span> i, doc <span class="hljs-keyword">in</span> zip(group_df[<span class="hljs-string">'user'</span>].values, group_df[feat])]    model = Doc2Vec(documents, vector_size=length, window=<span class="hljs-number">10</span>, min_count=<span class="hljs-number">1</span>, workers=<span class="hljs-number">1</span>, seed=<span class="hljs-number">2020</span>,                    epochs=<span class="hljs-number">20</span>,  hs=<span class="hljs-number">1</span>, )    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">'./d2v_models/'</span>):        os.makedirs(<span class="hljs-string">'./d2v_models/'</span>)    model.save(<span class="hljs-string">'../d2v_models/d2v_testb_{}.model'</span>.format(num))    <span class="hljs-comment"># model = Doc2Vec.load('./d2v_models/d2v_testb_{}.model'.format(num))</span>    doc_df = group_df[<span class="hljs-string">'user'</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-string">','</span>.join([str(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> model[x]])).str.split(<span class="hljs-string">','</span>, expand=<span class="hljs-literal">True</span>).apply(pd.to_numeric)    doc_df.columns = [<span class="hljs-string">'{}_d2v_{}'</span>.format(feat, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(length)]    <span class="hljs-keyword">return</span> pd.concat([group_df[[<span class="hljs-string">'user'</span>]], doc_df], axis=<span class="hljs-number">1</span>)</code></pre><p>em…,看懂代码就行啦。用在trans_df的amount上。自己也做了这个特征，还用在了其他的字段序列上，感觉也不能无脑对所有字段都用，还是要根据实验结果有选择的用。</p><p>12.word2vec特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">w2v_feat</span><span class="hljs-params">(df, feat, length, num)</span>:</span>    <span class="hljs-string">"""    :param df:         进行word2vec编码的数据    :param feat:       进行编码的特征    :param length:     embedding向量长度    :return:    """</span>    <span class="hljs-keyword">global</span> w2v_fea_lst    w2v_fea_lst = []    print(<span class="hljs-string">'Start training Word2Vec models.....'</span>)    df[feat] = df[feat].astype(str)    group_df = df.groupby([<span class="hljs-string">'user'</span>])[feat].agg(list).reset_index()    model = Word2Vec(group_df[feat].values, size=length, window=<span class="hljs-number">10</span>, min_count=<span class="hljs-number">1</span>, sg=<span class="hljs-number">1</span>, hs=<span class="hljs-number">1</span>, workers=<span class="hljs-number">1</span>,                     iter=<span class="hljs-number">20</span>, seed=<span class="hljs-number">2020</span>,)    <span class="hljs-comment"># if feat == 'amount':</span>    <span class="hljs-comment">#     model = Word2Vec.load('../w2v_models/w2v_testb_{}_{}.model'.format(feat, num))</span>    <span class="hljs-comment"># elif feat == 'channel':</span>    <span class="hljs-comment">#     model = Word2Vec.load('../w2v_models/w2v_channel_16.model')</span>    <span class="hljs-comment"># elif feat == 'trans_op_ip' or feat == 'trans_op_ip_3':</span>    <span class="hljs-comment">#     model = Word2Vec.load('../w2v_models/w2v_trans_op_2.model')</span>    <span class="hljs-comment"># else:</span>    <span class="hljs-comment">#     if not os.path.exists('../w2v_models/'):</span>    <span class="hljs-comment">#         os.makedirs('../w2v_models/')</span>    <span class="hljs-comment"># model = Word2Vec.load('./w2v_models/w2v_testb_{}_{}.model'.format(feat, num))</span>    model.save(<span class="hljs-string">'../w2v_models/w2v_testb_{}_{}.model'</span>.format(feat, num))    group_df[feat] = group_df[feat].apply(<span class="hljs-keyword">lambda</span> x: pd.DataFrame([model[c] <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> x]))    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> tqdm(range(length), desc=<span class="hljs-string">'extract w2v {} statistic feature'</span>.format(feat)):        group_df[<span class="hljs-string">'{}_w2v_{}_mean'</span>.format(feat,m)] = group_df[feat].apply(<span class="hljs-keyword">lambda</span> x: x[m].mean())        <span class="hljs-comment"># group_df['{}_w2v_{}_median'.format(feat, m)] = group_df[feat].apply(lambda x: x[m].median())</span>        <span class="hljs-comment"># group_df['{}_w2v_{}_max'.format(feat, m)] = group_df[feat].apply(lambda x: x[m].max())</span>        <span class="hljs-comment"># group_df['{}_w2v_{}_min'.format(feat, m)] = group_df[feat].apply(lambda x: x[m].min())</span>        <span class="hljs-comment"># group_df['{}_w2v_{}_sum'.format(feat, m)] = group_df[feat].apply(lambda x: x[m].sum())</span>        <span class="hljs-comment"># group_df['{}_w2v_{}_std'.format(feat, m)] = group_df[feat].apply(lambda x: x[m].std())</span>        w2v_fea_lst.append(<span class="hljs-string">'{}_w2v_{}_mean'</span>.format(feat,m))    <span class="hljs-keyword">del</span> group_df[feat]    <span class="hljs-keyword">return</span> group_df</code></pre><p>用在trans_df的amount上</p><p>13.tf_idf特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_tfidf_features</span><span class="hljs-params">(df, value,)</span>:</span>    print(<span class="hljs-string">'Start tfdif encoding for {}........'</span>.format(value))    df[value] = df[value].astype(str)    df[value].fillna(<span class="hljs-string">'-1'</span>, inplace=<span class="hljs-literal">True</span>)    group_df = df.groupby([<span class="hljs-string">'user'</span>]).apply(<span class="hljs-keyword">lambda</span> x: x[value].tolist()).reset_index()    group_df.columns = [<span class="hljs-string">'user'</span>, <span class="hljs-string">'list'</span>]    group_df[<span class="hljs-string">'list'</span>] = group_df[<span class="hljs-string">'list'</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-string">','</span>.join(x))    enc_vec = TfidfVectorizer()    tfidf_vec = enc_vec.fit_transform(group_df[<span class="hljs-string">'list'</span>])    svd_enc = TruncatedSVD(n_components=<span class="hljs-number">10</span>, n_iter=<span class="hljs-number">20</span>, random_state=<span class="hljs-number">2020</span>)    vec_svd = svd_enc.fit_transform(tfidf_vec)    vec_svd = pd.DataFrame(vec_svd)    vec_svd.columns = [<span class="hljs-string">'svd_tfidf_{}_{}'</span>.format(value, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>)]    group_df = pd.concat([group_df, vec_svd], axis=<span class="hljs-number">1</span>)    <span class="hljs-keyword">del</span> group_df[<span class="hljs-string">'list'</span>]    <span class="hljs-keyword">return</span> group_df</code></pre><p>14.countvec特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_countvec_features</span><span class="hljs-params">(df, value,)</span>:</span>    print(<span class="hljs-string">'Start countvec encoding for {}........'</span>.format(value))    df[value] = df[value].astype(str)    df[value].fillna(<span class="hljs-string">'-1'</span>, inplace=<span class="hljs-literal">True</span>)    group_df = df.groupby([<span class="hljs-string">'user'</span>]).apply(<span class="hljs-keyword">lambda</span> x: x[value].tolist()).reset_index()    group_df.columns = [<span class="hljs-string">'user'</span>, <span class="hljs-string">'list'</span>]    group_df[<span class="hljs-string">'list'</span>] = group_df[<span class="hljs-string">'list'</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-string">','</span>.join(x))    enc_vec = CountVectorizer()    tfidf_vec = enc_vec.fit_transform(group_df[<span class="hljs-string">'list'</span>])    svd_enc = TruncatedSVD(n_components=<span class="hljs-number">10</span>, n_iter=<span class="hljs-number">20</span>, random_state=<span class="hljs-number">2020</span>)    vec_svd = svd_enc.fit_transform(tfidf_vec)    vec_svd = pd.DataFrame(vec_svd)    vec_svd.columns = [<span class="hljs-string">'svd_countvec_{}_{}'</span>.format(value, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>)]    group_df = pd.concat([group_df, vec_svd], axis=<span class="hljs-number">1</span>)    <span class="hljs-keyword">del</span> group_df[<span class="hljs-string">'list'</span>]    <span class="hljs-keyword">return</span> group_df</code></pre><p>15.计算各个用户在op_df和trans_df上在一些字段上的统计特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gen_user_group_trans_op_features</span><span class="hljs-params">(df, columns, value)</span>:</span>    group_df = df.pivot_table(index=<span class="hljs-string">'user'</span>,                              columns=columns,                              values=value,                              dropna=<span class="hljs-literal">False</span>,                              aggfunc=[<span class="hljs-string">'count'</span>, <span class="hljs-string">'sum'</span>,                                       <span class="hljs-string">'mean'</span>, <span class="hljs-string">'max'</span>, <span class="hljs-string">'min'</span>, <span class="hljs-string">'median'</span>,                                       ]).fillna(<span class="hljs-number">0</span>)    group_df.columns = [<span class="hljs-string">'user_{}_{}_{}_{}'</span>.format(columns, f[<span class="hljs-number">1</span>], value, f[<span class="hljs-number">0</span>]) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> group_df.columns]    group_df[<span class="hljs-string">'op_trans_ratio'</span>] = group_df[<span class="hljs-string">'user_property_trans_{}_count'</span>.format(value)] / group_df[        <span class="hljs-string">'user_property_op_{}_count'</span>.format(value)]    group_df.reset_index(inplace=<span class="hljs-literal">True</span>)    <span class="hljs-keyword">return</span> group_df</code></pre><p>16.获取各个用户在第一次和最后一次操作或交易时的特征</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">user_trans_behavior_feature</span><span class="hljs-params">(df, trans_op)</span>:</span>    print(<span class="hljs-string">"Starting extract user's trans behavior......"</span>)    <span class="hljs-comment"># 获取第一次和最后一次行为</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'property'</span>].values[<span class="hljs-number">-1</span>]).to_dict()    df[<span class="hljs-string">'last_beahvior'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'property'</span>].values[<span class="hljs-number">0</span>]).to_dict()    df[<span class="hljs-string">'first_beahvior'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 是否有过交易行为</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: judge_has_trans(x)).to_dict()    df[<span class="hljs-string">'has_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 最后一次交易days_diff</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: last_trans_time(x)).to_dict()    df[<span class="hljs-string">'last_days_diff_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 第一次交易days_diff</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: first_trans_time(x)).to_dict()    df[<span class="hljs-string">'first_days_diff_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 最后一次交易hour</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: last_trans_hour(x)).to_dict()    df[<span class="hljs-string">'last_hour_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 第一次交易hour</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: first_trans_hour(x)).to_dict()    df[<span class="hljs-string">'first_hour_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 最后一次交易week</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: last_trans_week(x)).to_dict()    df[<span class="hljs-string">'last_week_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 第一次交易week</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: first_trans_week(x)).to_dict()    df[<span class="hljs-string">'first_week_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 最后一次交易timestamp</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: last_trans_timestamp(x)).to_dict()    df[<span class="hljs-string">'last_time_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 第一次交易timestamp</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: first_trans_timestamp(x)).to_dict()    df[<span class="hljs-string">'first_time_trans'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 平均交易次数</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: gen_trans_count(x)).to_dict()    df[<span class="hljs-string">'trans_count'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-comment"># 操作次数</span>    group_dic = trans_op.groupby(<span class="hljs-string">'user'</span>).apply(<span class="hljs-keyword">lambda</span> x: gen_op_count(x)).to_dict()    df[<span class="hljs-string">'op_count'</span>] = df[<span class="hljs-string">'user'</span>].map(group_dic)    <span class="hljs-keyword">return</span> df</code></pre><p>17.判断用户是否有交易</p><pre class="highlight"><code class="python">data[<span class="hljs-string">'has_trans'</span>] = pd.factorize(data[<span class="hljs-string">'has_trans'</span>])[<span class="hljs-number">0</span>]</code></pre><p>二值特征用一列01就可以了</p><p>18.类别编码</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kfold_stats_feature</span><span class="hljs-params">(train, test, feats, k, seed)</span>:</span>    folds = StratifiedKFold(n_splits=k, shuffle=<span class="hljs-literal">True</span>, random_state=seed)  <span class="hljs-comment"># 这里最好和后面模型的K折交叉验证保持一致</span>    train[<span class="hljs-string">'fold'</span>] = <span class="hljs-literal">None</span>    <span class="hljs-keyword">for</span> fold_, (trn_idx, val_idx) <span class="hljs-keyword">in</span> enumerate(folds.split(train, train[<span class="hljs-string">'label'</span>])):        train.loc[val_idx, <span class="hljs-string">'fold'</span>] = fold_    kfold_features = []    <span class="hljs-keyword">for</span> feat <span class="hljs-keyword">in</span> tqdm(feats, desc=<span class="hljs-string">'Target encoding for base feature'</span>):        nums_columns = [<span class="hljs-string">'label'</span>]        <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> nums_columns:            colname = feat + <span class="hljs-string">'_'</span> + f + <span class="hljs-string">'_kfold_mean'</span>            kfold_features.append(colname)            train[colname] = <span class="hljs-literal">None</span>            <span class="hljs-keyword">for</span> fold_, (trn_idx, val_idx) <span class="hljs-keyword">in</span> enumerate(folds.split(train, train[<span class="hljs-string">'label'</span>])):                tmp_trn = train.iloc[trn_idx]                order_label = tmp_trn.groupby([feat])[f].mean()                tmp = train.loc[train.fold == fold_, [feat]]                train.loc[train.fold == fold_, colname] = tmp[feat].map(order_label)                <span class="hljs-comment"># fillna</span>                global_mean = tmp_trn[f].mean()                train.loc[train.fold == fold_, colname] = train.loc[train.fold == fold_, colname].fillna(global_mean)            train[colname] = train[colname].astype(float)        <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> nums_columns:            colname = feat + <span class="hljs-string">'_'</span> + f + <span class="hljs-string">'_kfold_mean'</span>            test[colname] = <span class="hljs-literal">None</span>            order_label = train.groupby([feat])[f].mean()            test[colname] = test[feat].map(order_label)            <span class="hljs-comment"># fillna</span>            global_mean = train[f].mean()            test[colname] = test[colname].fillna(global_mean)            test[colname] = test[colname].astype(float)    <span class="hljs-keyword">del</span> train[<span class="hljs-string">'fold'</span>]    <span class="hljs-keyword">return</span> train, test</code></pre><p>对一些值类别比较多的变量作target encoding</p><p>19.对序列变量作target_encoding</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">target_encoding</span><span class="hljs-params">(file, train, test, feats, k, prefix, not_adp=True, agg_lst=[<span class="hljs-string">'mean'</span>], seed=<span class="hljs-number">2020</span>)</span>:</span>    folds = StratifiedKFold(n_splits=k, shuffle=<span class="hljs-literal">True</span>, random_state=seed)  <span class="hljs-comment"># 这里最好和后面模型的K折交叉验证保持一致</span>    train[<span class="hljs-string">'fold'</span>] = <span class="hljs-literal">None</span>    <span class="hljs-keyword">for</span> fold_, (trn_idx, val_idx) <span class="hljs-keyword">in</span> enumerate(folds.split(train, train[<span class="hljs-string">'label'</span>])):        train.loc[val_idx, <span class="hljs-string">'fold'</span>] = fold_    tt_file = train[[<span class="hljs-string">'user'</span>, <span class="hljs-string">'label'</span>]].merge(file, on=<span class="hljs-string">'user'</span>, how=<span class="hljs-string">'left'</span>)    te_features = []    <span class="hljs-keyword">for</span> feat <span class="hljs-keyword">in</span> tqdm(feats, desc=<span class="hljs-string">'Target encoding for {} feature '</span>.format(prefix)):        col_name = feat + <span class="hljs-string">'_te'</span>        <span class="hljs-comment"># te_features.append(col_name)</span>        <span class="hljs-keyword">for</span> fold_, (trn_idx, val_idx) <span class="hljs-keyword">in</span> enumerate(folds.split(train, train[<span class="hljs-string">'label'</span>])):            tmp_users = train.iloc[trn_idx][<span class="hljs-string">'user'</span>].values            tmp_file = file[file.user.isin(tmp_users)]            tmp_file = tmp_file.merge(train[[<span class="hljs-string">'user'</span>, <span class="hljs-string">'label'</span>]], on=<span class="hljs-string">'user'</span>, how=<span class="hljs-string">'left'</span>)            <span class="hljs-keyword">if</span> not_adp:                match = tmp_file.groupby(feat)[<span class="hljs-string">'label'</span>].mean()            <span class="hljs-keyword">else</span>:                match = tmp_file.groupby([feat, <span class="hljs-string">'user'</span>])[<span class="hljs-string">'label'</span>].agg(eu_sum=<span class="hljs-string">'sum'</span>, eu_count=<span class="hljs-string">'count'</span>).reset_index()                match[<span class="hljs-string">'eu_mean'</span>] = match[<span class="hljs-string">'eu_sum'</span>] / match[<span class="hljs-string">'eu_count'</span>]                match = match[<span class="hljs-string">'eu_mean'</span>].groupby(match[feat]).mean()            tmp_users = train.iloc[val_idx][<span class="hljs-string">'user'</span>].values            tmp_file = file[file.user.isin(tmp_users)]            tmp_file[col_name] = tmp_file[feat].map(match)            <span class="hljs-keyword">for</span> agg_ <span class="hljs-keyword">in</span> agg_lst:                tmp = tmp_file.groupby(<span class="hljs-string">'user'</span>)[col_name].agg(agg_)                train.loc[train.fold == fold_, col_name + <span class="hljs-string">'_'</span> + agg_] = train.loc[train.fold == fold_, <span class="hljs-string">'user'</span>].map(tmp)        <span class="hljs-keyword">if</span> not_adp:            match = tt_file.groupby(feat)[<span class="hljs-string">'label'</span>].mean()        <span class="hljs-keyword">else</span>:            match = tt_file.groupby([feat, <span class="hljs-string">'user'</span>])[<span class="hljs-string">'label'</span>].agg(eu_sum=<span class="hljs-string">'sum'</span>, eu_count=<span class="hljs-string">'count'</span>).reset_index()            match[<span class="hljs-string">'eu_mean'</span>] = match[<span class="hljs-string">'eu_sum'</span>] / match[<span class="hljs-string">'eu_count'</span>]            match = match[<span class="hljs-string">'eu_mean'</span>].groupby(match[feat]).mean()        tmp_file = file[file.user.isin(test[<span class="hljs-string">'user'</span>].values)]        tmp_file[col_name] = tmp_file[feat].map(match)        <span class="hljs-keyword">for</span> agg_ <span class="hljs-keyword">in</span> agg_lst:            tmp = tmp_file.groupby(<span class="hljs-string">'user'</span>)[col_name].agg(agg_)            test[col_name + <span class="hljs-string">'_'</span> + agg_] = test[<span class="hljs-string">'user'</span>].map(tmp)    <span class="hljs-keyword">del</span> train[<span class="hljs-string">'fold'</span>]    gc.collect()    <span class="hljs-comment"># print(train[te_features])</span>    <span class="hljs-keyword">return</span> train, test</code></pre><p>首先要把序列merge上label再进行编码聚合后输出单行的编码结果</p><p>20.有序变量编码</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">order_encode</span><span class="hljs-params">(df, col)</span>:</span>    <span class="hljs-string">"""    :param df:      Dataframe    :param col:     feature    :description:   对有序类别变量顺序编码    :return:    """</span>    df.loc[df[col].notnull(), col] = df.loc[df[col].notnull(), col].apply(<span class="hljs-keyword">lambda</span> x: str(x).split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>]).astype(int)    df[col] = df[col].fillna(<span class="hljs-number">-1</span>).astype(int)    <span class="hljs-keyword">return</span> df</code></pre><p>对于一些有序的变量要还原为对应数值以捕获对应的大小关系。</p><p>21.无序变量编码</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">label_encode</span><span class="hljs-params">(df, order_cols)</span>:</span>    <span class="hljs-comment"># LabelEncoder</span>    cat_cols = [f <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> df.select_dtypes(<span class="hljs-string">'object'</span>).columns <span class="hljs-keyword">if</span> f <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'user'</span>] + order_cols]    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> cat_cols:        le = LabelEncoder()        df[col].fillna(<span class="hljs-string">'-1'</span>, inplace=<span class="hljs-literal">True</span>)        df[col] = le.fit_transform(df[col])        <span class="hljs-comment">#cat_cols.append(col)</span>    <span class="hljs-keyword">return</span>  df</code></pre><p>22.风险值较高的省份二值化编码</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">province_binary</span><span class="hljs-params">(df, )</span>:</span>    <span class="hljs-string">"""[summary]        对风险率排名最高的五个省份进行二值化及组合编码    Parameters    ----------    df : [data数据]        [train or test]    Returns    -------    [DataFrame]        [经过省份二值化编码的训练集/测试集]    """</span>    <span class="hljs-comment">#省份二值化编码</span>    df[<span class="hljs-string">'is_21_province'</span>] = df.apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.province == <span class="hljs-number">21</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, axis=<span class="hljs-number">1</span>)    df[<span class="hljs-string">'is_26_province'</span>] = df.apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.province == <span class="hljs-number">26</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, axis=<span class="hljs-number">1</span>)    df[<span class="hljs-string">'is_30_province'</span>] = df.apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.province == <span class="hljs-number">30</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, axis=<span class="hljs-number">1</span>)    df[<span class="hljs-string">'is_20_province'</span>] = df.apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.province == <span class="hljs-number">20</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, axis=<span class="hljs-number">1</span>)    df[<span class="hljs-string">'is_16_province'</span>] = df.apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x.province == <span class="hljs-number">16</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, axis=<span class="hljs-number">1</span>)    df[<span class="hljs-string">'binary_province'</span>] = df[<span class="hljs-string">'is_21_province'</span>].map(str) + df[<span class="hljs-string">'is_26_province'</span>].map(str) + \                               df[<span class="hljs-string">'is_30_province'</span>].map(str) + df[<span class="hljs-string">'is_20_province'</span>].map(str) + df[<span class="hljs-string">'is_16_province'</span>].map(str)    le = LabelEncoder()    df[<span class="hljs-string">'binary_province'</span>].fillna(<span class="hljs-string">'-1'</span>, inplace=<span class="hljs-literal">True</span>)    df[<span class="hljs-string">'binary_province'</span>] = le.fit_transform(df[<span class="hljs-string">'binary_province'</span>])    <span class="hljs-keyword">return</span> df</code></pre><p>23.交易操作比例</p><pre class="highlight"><code class="python">train_data[<span class="hljs-string">'trans_ratio'</span>] = train_data[<span class="hljs-string">'trans_count'</span>] / train_data[<span class="hljs-string">'op_count'</span>]test_data[<span class="hljs-string">'trans_ratio'</span>] = test_data[<span class="hljs-string">'trans_count'</span>] / test_data[<span class="hljs-string">'op_count'</span>]</code></pre><p>到这里，作者用到的各种编码方式就介绍结束了。其实，自己已经用到了大多数编码方式，不多自己用的比较无脑，对可以用的变量自己都用了。虽热也有一些特征选择的方法，但好像并不是那么实用，问了一些大佬，推荐的做法是做一组或一个特征就实验一下，结果提升了就保留。对于一些类别变量，lgb不用onehot变量。</p><h3 id="top2"><a class="markdownIt-Anchor" href="#top2"></a> top2</h3><p>top2的很多特征编码方式和top1相近，这里主要介绍其特殊的特征处理方式。</p>]]></content>
    
    
    <categories>
      
      <category>数据竞赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据竞赛</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-业务知识-如何梳理业务逻辑</title>
    <link href="/2020/09/08/01-%E4%B8%9A%E5%8A%A1%E7%9F%A5%E8%AF%86-%E5%A6%82%E4%BD%95%E6%A2%B3%E7%90%86%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/"/>
    <url>/2020/09/08/01-%E4%B8%9A%E5%8A%A1%E7%9F%A5%E8%AF%86-%E5%A6%82%E4%BD%95%E6%A2%B3%E7%90%86%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/</url>
    
    <content type="html"><![CDATA[<p>因为不懂业务，所以找了门课来看看，记录一下自己的历程吧！</p><p>所谓七步成诗法，一一道来~</p><h3 id="我们挣什么钱经营模式老板决定"><a class="markdownIt-Anchor" href="#我们挣什么钱经营模式老板决定"></a> 我们挣什么钱（经营模式）老板决定</h3><p>这个好理解一点，企业可能同样是做一件事，但是他的目标可能是不一样的。</p><p><img src="https://s1.ax1x.com/2020/09/08/wKHIHg.png" srcset="/img/loading.gif" alt="wKHIHg.png" /></p><p>比较经典的是上面这个例子，比如视频网站，真正的使用者使用户，用户只需要看广告，而广告主却是真正付钱的人，视频网站营收的大头也是广告费用。用户是🐏，广告主是🐕。</p><p>再比如信用卡业务的例子，信用卡中乱收费的收入占比只有2%，真正占收入的大头是信贷。</p><p>如何弄清企业的经营模式呢？</p><p>1.与业内人士多交流。</p><p>2.多看新闻、财报、行业文章</p><p>3.站在企业经营者的角度思考问题</p><p>4.关注公司内部销售渠道考核指标，年报</p><h3 id="我们挣谁的钱目标客户市场部产品"><a class="markdownIt-Anchor" href="#我们挣谁的钱目标客户市场部产品"></a> 我们挣谁的钱（目标客户）市场部/产品</h3><p>这个部分是找🐏和🐕的问题，以信用卡问题为例，如何找到那些信贷需求旺盛的群体呢？</p><p>目标用户群依次是：企业经营者、小老板商户、高级白领、小白领、屌丝。</p><p>锁定核心用户的原则：</p><p>对用户而言：这个业务是我的刚性需求，非用不可</p><p>对企业而言：这个客户有强大的付钱能力。企业是有钱就要上。</p><h3 id="为什么客户要用我们的产品产品属性市场部产品"><a class="markdownIt-Anchor" href="#为什么客户要用我们的产品产品属性市场部产品"></a> 为什么客户要用我们的产品（产品属性）市场部/产品</h3><p>大部分产品并非生活必需品，要培养用户的使用习惯。比如信用卡会给你一定额度，让你先免费用爽几天、做一些优惠活动，让你感觉很方便。</p><p>第一时间捕获用户的需求，然后推销自己的产品。</p><p>如何了解产品呢？</p><p>1.亲身体验</p><p>2.站在客户角度，我这个产品满足了客户哪些需求</p><p>3.结合产品使用场景，分析产品功能设置原因</p><p>4.了解配套的运营推广活动，全面认识产品</p><h3 id="如何找到客户-销售渠道渠道推广"><a class="markdownIt-Anchor" href="#如何找到客户-销售渠道渠道推广"></a> 如何找到客户 （销售渠道）渠道/推广</h3><p>常规渠道有：销售队伍业务员、电话销售（这个最烦了）、分行网点、网站。</p><p>特殊渠道：vip呗</p><p>传统行业，门店、卖场很重要。</p><p>如何弄清销售渠道呢？</p><p>1.收集产品销售场所，了解可能的销售渠道。</p><p>2.分清消费模式是B2C还是B2B2C</p><p>3.了解各渠道消费量，销售额占比</p><p>4.了解配合销售做的推广、广告</p><h3 id="为什么客户不用别人的产品市场策略市场部运营"><a class="markdownIt-Anchor" href="#为什么客户不用别人的产品市场策略市场部运营"></a> 为什么客户不用别人的产品（市场策略）市场部/运营</h3><p>这是个竞争策略的问题，是和同行竞争的问题。别人用我的不用你的，肯定是因为我的好，哪里好呢：</p><p>1.产品核心功能强</p><p>2.产品附加值高</p><p>3.搞促销、搞宣传、粉丝经营</p><p>主要竞争方式有：</p><p>1.爆款产品</p><p>2.产品组合</p><p>3.促销活动</p><p>4.品牌宣传</p><p>5.会员策略</p><p>弄清竞争策略的方式：</p><p>1.收集别人的营销活动信息、品牌广告。</p><p>2.整理信息，归类，广告属于哪些类别，促销活动对象规则是什么。</p><h3 id="谁来干部门分工"><a class="markdownIt-Anchor" href="#谁来干部门分工"></a> 谁来干（部门分工）</h3><p>看一眼传统企业的架构</p><p><img src="https://s1.ax1x.com/2020/09/08/wKX0TU.png" srcset="/img/loading.gif" alt="wKX0TU.png" /></p><p>再看一眼互联网企业</p><p><img src="https://s1.ax1x.com/2020/09/08/wKXDkF.png" srcset="/img/loading.gif" alt="wKXDkF.png" /></p><h3 id="干了挣了多少营收情况"><a class="markdownIt-Anchor" href="#干了挣了多少营收情况"></a> 干了挣了多少（营收情况）</h3><p>销售收入是大部分公司唯一利润来源，所以传统企业渠道十分重要。</p><p>成本来源：</p><p>1.推广成本</p><p>2.产品陈本</p><p>3.运作成本：公司部门运作</p><p>4.渠道成本：单位产品在渠道销售的成本，推广或销售</p><p>5.新客户获取成本</p><p>了解营收就要多看财报，找到公司各部门的日月季报，从中发现用户数、付费情况、活动投入等信息。</p>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
      <tag>业务</tag>
      
      <tag>课程</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-sql刷题牛客</title>
    <link href="/2020/08/25/01-sql%E5%88%B7%E9%A2%98%E7%89%9B%E5%AE%A2/"/>
    <url>/2020/08/25/01-sql%E5%88%B7%E9%A2%98%E7%89%9B%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>今天是刷题记录的第一天，加油啦，小孟冲冲冲！！！</p><ol><li></li></ol><pre class="highlight"><code class="sql">查找最晚入职员工的所有信息，为了减轻入门难度，目前所有的数据里员工入职的日期都不是同一天(sqlite里面的注释为<span class="hljs-comment">--,mysql为comment)</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees (<span class="hljs-string">`emp_no int(11) NOT NULL, -- '员工编号'`</span><span class="hljs-string">`birth_date date NOT NULL,`</span><span class="hljs-string">`first_name varchar(14) NOT NULL,`</span><span class="hljs-string">`last_name varchar(16) NOT NULL,`</span><span class="hljs-string">`gender char(1) NOT NULL,`</span><span class="hljs-string">`hire_date date NOT NULLPRIMARY KEY (emp_no));</span></code></pre><p>自己的写法，考虑的不是那么全面，只能查出一条数据</p><pre class="highlight"><code class="mysql">SELECT * FROM employeesORDER BY hire_date DESCLIMIt 1;</code></pre><p>但是假如最后一天有多人入职，这种写法就hold不住了。</p><pre class="highlight"><code class="mysql">SELECT * FROM employeesWHERE hire_date=(SELECT MAX(hire_date) FROM employees);</code></pre><ol start="2"><li></li></ol><pre class="highlight"><code class="sql">查找入职员工时间排名倒数第三的员工所有信息，为了减轻入门难度，目前所有的数据里员工入职的日期都不是同一天<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>这题主要的考点是查找倒数第三，这种关于顺序的问题可以用 LIMIT(A,B)来处理，表示从第A行取第B个数据，LIMIT(2,1)意思就是从第2个数据取第1个数据，也就是第三名。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">2</span>,<span class="hljs-number">1</span>);</code></pre><ol start="3"><li></li></ol><pre class="highlight"><code class="sql">查找各个部门当前(dept_manager.to_date='9999-01-01')领导当前(salaries.to_date='9999-01-01')薪水详情以及其对应部门编号dept_no(注:请以salaries表为主表进行查询，输出结果以salaries.emp_no升序排序，并且请注意输出结果里面dept_no列是最后一列)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '员工编号',</span><span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span><span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '员工编号'</span><span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));</code></pre><p>常规的连接查询，注意输出就可以了</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,s.from_date,s.to_date,dm.dept_no<span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm<span class="hljs-keyword">ON</span> s.emp_no=dm.emp_no<span class="hljs-keyword">WHERE</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s.emp_no <span class="hljs-keyword">ASC</span>;</code></pre><ol start="4"><li></li></ol><pre class="highlight"><code class="sql">查找所有已经分配部门的员工的last_name和first_name以及dept_no(请注意输出描述里各个列的前后顺序)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>两个表只有一个共同列，直接使用内连接。此外，因为dept_no 已经指定ＮＯＴ　ＮＵＬＬ了所以题目所有的员工必然都分配了部门。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,de.dept_no<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de<span class="hljs-keyword">ON</span> e.emp_no=de.emp_no<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> (de.dept_no <span class="hljs-keyword">ISNULL</span>);</code></pre><p>５.</p><pre class="highlight"><code class="sql">查找所有员工的last_name和first_name以及对应部门编号dept_no，也包括暂时没有分配具体部门的员工(请注意输出描述里各个列的前后顺序)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>这题说了包括暂时没有分配具体部门的员工,所有只要是员工就得查出来,所以对employees使用左连接啦,使用内连接的话,有的员工可能没有分配部门,那么部门表就不会有他,那再内连接就找不到他的数据了.</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,de.dept_no<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de<span class="hljs-keyword">ON</span> e.emp_no=de.emp_no;</code></pre><ol start="6"><li></li></ol><pre class="highlight"><code class="sql">查找所有员工入职时候的薪水情况，给出emp_no以及salary， 并按照emp_no进行逆序(请注意，一个员工可能有多次涨薪的情况)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>几天不写手感又生疏了呢！重点在于刚入职，入职时间就是hire_date呀</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,s.salary <span class="hljs-keyword">FROM</span>employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s<span class="hljs-keyword">ON</span> e.emp_no=s.emp_no<span class="hljs-keyword">AND</span> s.from_date=e.hire_date<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.emp_no <span class="hljs-keyword">DESC</span>;</code></pre><p>也可以用聚合函数，HAVING用来进行过滤</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary <span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no <span class="hljs-keyword">HAVING</span> from_date=<span class="hljs-keyword">MIN</span>(from_date)<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no <span class="hljs-keyword">DESC</span>;</code></pre><ol start="7"><li></li></ol><pre class="highlight"><code class="sql">查找薪水变动超过15次的员工号emp_no以及其对应的变动次数t<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>这题考察的还是聚合函数，注意题目要求变动次数t</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no<span class="hljs-keyword">HAVING</span> t&gt;<span class="hljs-number">15</span>;</code></pre><ol start="8"><li></li></ol><pre class="highlight"><code class="sql">找出所有员工当前(to_date='9999-01-01')具体的薪水salary情况，对于相同的薪水只显示一次,并按照逆序显示<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>单纯的查salary表里有多少个salary，相同薪水只显示一次，用DISTINCT可以解决</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(salary)<span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;</code></pre><p>看讨论区说DISTINCT消耗资源较大，用GROUP BY 解决数据重复问题,注意GROUP BY 要放在WHERE 子句后面</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> salary<span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> salary<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;</code></pre><ol start="9"><li></li></ol><pre class="highlight"><code class="sql">获取所有部门当前(dept_manager.to_date='9999-01-01')manager的当前(salaries.to_date='9999-01-01')薪水情况，给出dept_no, emp_no以及salary(请注意，同一个人可能有多条薪水情况记录)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>注意时间，其他没什么</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dm.dept_no,s.emp_no,s.salary<span class="hljs-keyword">FROM</span> dept_manager dm <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> dm.emp_no=s.emp_no<span class="hljs-keyword">WHERE</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>;</code></pre><ol start="10"><li></li></ol><pre class="highlight"><code class="sql">获取所有非manager的员工emp_no<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>这个题的特点是解法多，先来简单的</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no <span class="hljs-keyword">FROM</span> employees e<span class="hljs-keyword">WHERE</span> e.emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> dm.emp_no <span class="hljs-keyword">FROM</span> dept_manager dm);</code></pre><p>也可以利用连接查询获取dept_no为空的员工</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_manager dm<span class="hljs-keyword">ON</span> e.emp_no=dm.emp_no<span class="hljs-keyword">WHERE</span> dm.dept_no  <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;</code></pre><p>还有集合运算的解法</p><p>EXCEPT 集合差运算|UNION 集合并运算|INTERSECT 集合交运算</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">EXCEPT</span><span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager;</code></pre><ol start="11"><li></li></ol><pre class="highlight"><code class="sql">获取所有员工当前的(dept_manager.to_date='9999-01-01')manager，如果员工是manager的话不显示(也就是如果当前的manager是自己的话结果不显示)。输出结果第一列给出当前员工的emp_no,第二列给出其manager对应的emp_no。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '所有的员工编号'</span><span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span><span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '部门编号'</span><span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">-- '经理编号'</span><span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));</code></pre><p>关于时间限制的坑，还有一点就是该关联的键是dept_no,是根据dept_no来找相同部门的,再有一点就是学到了<code>&lt;&gt;</code>不等于。<code>NOT IN</code>的写法也是可以的，但是要是查询的结果，比较两个单独变量相等用不等于呀。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.emp_no <span class="hljs-keyword">AS</span> emp_no,dm.emp_no <span class="hljs-keyword">AS</span> manager_no<span class="hljs-keyword">FROM</span> dept_emp de <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm <span class="hljs-keyword">ON</span> de.dept_no=dm.dept_no<span class="hljs-keyword">WHERE</span> de.emp_no &lt;&gt; dm.emp_no <span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span></code></pre><ol start="12"><li></li></ol><pre class="highlight"><code class="sql">获取所有部门中当前(dept_emp.to_date = '9999-01-01')员工当前(salaries.to_date='9999-01-01')薪水最高的相关信息，给出dept_no, emp_no以及其对应的salary，按照部门升序排列。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>用group_by反而错了，看下别人的解释</p><p><code>使用group by子句时，select子句中只能有聚合键、聚合函数、常数，就是除了常数和聚合其他键的函数外，不能有其他键，有其他键一定要使用聚合。emp_no并不符合这个要求。</code></p><ol start="13"><li></li></ol><pre class="highlight"><code class="sql">从titles表获取按照title进行分组，每组个数大于等于2，给出title以及对应的数目t。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"titles"</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>简单的GROUP BY~</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> t<span class="hljs-keyword">FROM</span> titles<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> title;</code></pre><ol start="14"><li></li></ol><pre class="highlight"><code class="从titles表获取按照title进行分组，每组个数大于等于2，给出title以及对应的数目t。">注意对于重复的emp_no进行忽略(即emp_no重复的title不计算，title对应的数目t不增加)。CREATE TABLE IF NOT EXISTS `titles` (`emp_no` int(11) NOT NULL,`title` varchar(50) NOT NULL,`from_date` date NOT NULL,`to_date` date DEFAULT NULL);</code></pre><p>重复的emp_no可以用DISTINCT区分，记住一个点，去重用DISTINCT</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> emp_no) <span class="hljs-keyword">AS</span> t<span class="hljs-keyword">FROM</span> titles<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> title<span class="hljs-keyword">HAVING</span> t&gt;=<span class="hljs-number">2</span>;</code></pre><ol start="15"><li></li></ol><pre class="highlight"><code class="sql">查找employees表所有emp_no为奇数，且last_name不为Mary(注意大小写)的员工信息，并按照hire_date逆序排列(题目不能使用mod函数)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>被这个不能使用mod函数给唬住了，咱还可以使用<code>%</code>嘛</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span> last_name!=<span class="hljs-string">'Mary'</span> <span class="hljs-keyword">AND</span> emp_no%<span class="hljs-number">2</span>==<span class="hljs-number">1</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span>;</code></pre><ol start="16"><li></li></ol><pre class="highlight"><code class="sql">统计出当前(titles.to_date='9999-01-01')各个title类型对应的员工当前(salaries.to_date='9999-01-01')薪水对应的平均工资。结果给出title以及平均工资avg。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"titles"</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>GROUPY BY 要放在WHERE之后，WHERE子句中不能使用GROUPY BY</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t.title,<span class="hljs-keyword">AVG</span>(s.salary) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">avg</span><span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> titles t<span class="hljs-keyword">ON</span> s.emp_no=t.emp_no<span class="hljs-keyword">WHERE</span> t.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t.title;</code></pre><ol start="17"><li></li></ol><pre class="highlight"><code class="sql">获取当前（to_date='9999-01-01'）薪水第二多的员工的emp_no以及其对应的薪水salary<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>先上一个错误做法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary<span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">DESC</span><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span></code></pre><p>假如最大工资又两个是相同的，那么这样拿到的数据就不是第二大的了。以后碰到这种牵扯导顺序的题，要考虑能否把数据查全查准，用GROUP BY 查到值排名顺序的数据</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary<span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> salary =(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-keyword">AND</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;</code></pre><ol start="18"><li></li></ol><pre class="highlight"><code class="sql">查找当前薪水(to_date='9999-01-01')排名第二多的员工编号emp_no、薪水salary、last_name以及first_name，你可以不使用order by完成吗<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>排序题不让用ORDER BY,求第二大salary,小于最大值中的最大值就是第二大啦.</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,<span class="hljs-keyword">MAX</span>(s.salary),e.last_name,e.first_name<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no<span class="hljs-keyword">WHERE</span> s.salary&lt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries)<span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span>;</code></pre><p>当然这种只能求解第二高，下面这个有点难，表内条件自连接</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> e.emp_no,s.salary,e.last_name,e.first_name<span class="hljs-keyword">from</span>employees e<span class="hljs-keyword">join</span> salaries s <span class="hljs-keyword">on</span> e.emp_no=s.emp_no <span class="hljs-keyword">and</span>  s.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">and</span> s.salary = (     <span class="hljs-keyword">select</span> s1.salary     <span class="hljs-keyword">from</span>      salaries s1     <span class="hljs-keyword">join</span>     salaries s2 <span class="hljs-keyword">on</span> s1.salary&lt;=s2.salary      <span class="hljs-keyword">and</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">and</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span>     <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> s1.salary     <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> s2.salary)=<span class="hljs-number">2</span> )</code></pre><ol start="19"><li></li></ol><pre class="highlight"><code class="sql">查找所有员工的last_name和first_name以及对应的dept_name，也包括暂时没有分配部门的员工<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>考察外联结</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,d.dept_name<span class="hljs-keyword">FROM</span> (employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no)<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> d.dept_no=de.dept_no;</code></pre><p>也可以这样写</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.last_name,e.first_name,d.dept_name<span class="hljs-keyword">FROM</span> (employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no) <span class="hljs-keyword">AS</span> t<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> d.dept_no=t.dept_no;</code></pre><ol start="20"><li></li></ol><pre class="highlight"><code class="sql">查找员工编号emp_no为10001其自入职以来的薪水salary涨幅(总共涨了多少)growth(可能有多次涨薪，没有降薪)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>是计算涨幅呀，最简单的</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary)-<span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">AS</span> growth <span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span>;</code></pre><p>保险起见还是按照日期来选初始工资和近期工资</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> from_date <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)-(<span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10001</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> from_date <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<span class="hljs-keyword">AS</span> growth;</code></pre><ol start="21"><li></li></ol><pre class="highlight"><code class="sql">查找所有员工自入职以来的薪水涨幅情况，给出员工编号emp_no以及其对应的薪水涨幅growth，并按照growth进行升序（注:可能有employees表和salaries表里存在记录的员工，有对应的员工编号和涨薪记录，但是已经离职了，离职的员工salaries表的最新的to_date!='9999-01-01'，这样的数据不显示在查找结果里面）<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '入职时间'</span>PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '一条薪水记录开始时间'</span><span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-comment">--  '一条薪水记录结束时间'</span>PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>这题的重点是找到现在的工资对应的时间和初到公司对应的时间，然后迎刃而解。注意hire_date是员工被雇佣的时间。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,a.salary-b.salary <span class="hljs-keyword">AS</span> growth<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries a<span class="hljs-keyword">ON</span> e.emp_no=a.emp_no <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries b<span class="hljs-keyword">ON</span> e.hire_date=b.from_date<span class="hljs-keyword">WHERE</span> a.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> growth <span class="hljs-keyword">ASC</span>;</code></pre><ol start="22"><li></li></ol><pre class="highlight"><code class="sql">统计各个部门的工资记录数，给出部门编码dept_no、部门名称dept_name以及部门在salaries表里面有多少条记录sum<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>统计各个部门，统计各个部门，明显是按某类计算肯定要GROUP BY 啊，你这脑子</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> d.dept_no,d.dept_name,<span class="hljs-keyword">COUNT</span>(t.salary) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">sum</span><span class="hljs-keyword">FROM</span> (salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de<span class="hljs-keyword">ON</span> s.emp_no=de.emp_no) <span class="hljs-keyword">AS</span> t<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d<span class="hljs-keyword">ON</span> t.dept_no=d.dept_no<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.dept_no;</code></pre><p>23.❌</p><pre class="highlight"><code class="sql">对所有员工的当前(to_date='9999-01-01')薪水按照salary进行按照1-N的排名，相同salary并列且按照emp_no升序排列<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>这题的难点是如何在不同rank()函数的情况下进行排名，排序其实可以转化为当前值小于其他值的个数，又因为salary有并列行为，所以进行计数时要使用distinct，至于有的人提到使用groupby这点还没太看懂。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s1.emp_no,s1.salary ,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> s2.salary) <span class="hljs-keyword">FROM</span> salaries s2 <span class="hljs-keyword">WHERE</span> s2.salary&gt;=s1.salary<span class="hljs-keyword">AND</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">rank</span><span class="hljs-keyword">FROM</span> salaries s1<span class="hljs-keyword">WHERE</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">rank</span>,s1.emp_no <span class="hljs-keyword">ASC</span>;</code></pre><p>起始sql中有关排序的函数也可以解决上面的问题</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> emp_no,salary, <span class="hljs-keyword">dense_rank</span>() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">desc</span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">rank</span><span class="hljs-keyword">from</span> salaries<span class="hljs-keyword">where</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rank</span> <span class="hljs-keyword">asc</span>,emp_no <span class="hljs-keyword">asc</span>;</code></pre><p>下面介绍几个函数的区别:</p><p>比如对分数进行排名：90、85、85、70</p><p><code>ROW_NUMBER:1,2,3,4</code></p><p><code>RANK:1,2,2,4</code></p><p><code>DENSE_RANK:1、2、2、3</code></p><p><code>NTILE</code>函数是将有序分区中的行分发到指定数目的组中，各个组有编号，编号从1开始，就像我们说的’分区’一样 ，分为几个区，一个区会有多少个。</p><ol start="24"><li></li></ol><pre class="highlight"><code class="sql">获取所有非manager员工当前的薪水情况，给出dept_no、emp_no以及salary ，当前表示to_date='9999-01-01'<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>这个没有很难，但是前面salary少写了一个字母就耽误了很长时间。这里不能<code>INNNER JOIN dept_manager</code>，否则就只生下来manager，写代码还是要有逻辑，不能瞎写。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.dept_no,s.emp_no,s.salary<span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> s.emp_no=de.emp_no  <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">WHERE</span> de.emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager) <span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span>;</code></pre><p>25.❌</p><pre class="highlight"><code class="sql">获取员工其当前的薪水比其manager当前薪水还高的相关信息，当前表示to_date='9999-01-01',结果第一列给出员工的emp_no，第二列给出其manager的manager_no，第三列给出该员工当前的薪水emp_salary,第四列给该员工对应的manager当前的薪水manager_salary<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_manager`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>看到这种题目要学会分解，dept_emp和salaries能组成员工薪水表，dept_manager和salaies能组成经理薪水表，两者都共有一个dept_no，那么只要两者dept_no相同，再比较两表的薪水大小就ok了。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,t2.emp_no <span class="hljs-keyword">AS</span> manager_no,t1.salary <span class="hljs-keyword">AS</span> emp_salary,t2.salary <span class="hljs-keyword">AS</span> manager_salary <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,de.dept_no <span class="hljs-keyword">FROM</span> salaries s  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> s.emp_no=de.emp_no <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span>) t1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>  (<span class="hljs-keyword">SELECT</span> s.emp_no,s.salary,dm.dept_no <span class="hljs-keyword">FROM</span> salaries s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_manager dm <span class="hljs-keyword">ON</span> s.emp_no=dm.emp_no <span class="hljs-keyword">AND</span> s.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span>) t2 <span class="hljs-keyword">ON</span> t1.dept_no=t2.dept_no<span class="hljs-keyword">WHERE</span> t1.salary&gt;t2.salary;</code></pre><p>这里还有一个点就是JOIN后的ON的表达式不仅局限于等于还可以使用大于等于，和where语句起到的作用相似。或者用下面这种写法，将复杂查询分为两个简单查询，再组合。salary表可以出现两次，用where字句起到类似join的作用。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s1.emp_no,s2.emp_no <span class="hljs-keyword">AS</span> manager_no,s1.salary <span class="hljs-keyword">AS</span> emp_salary,s2.salary <span class="hljs-keyword">AS</span> manager_salary<span class="hljs-keyword">FROM</span> dept_emp de,dept_manager dm,salaries s1,salaries s2<span class="hljs-keyword">WHERE</span> de.emp_no=s1.emp_no<span class="hljs-keyword">AND</span> dm.emp_no=s2.emp_no<span class="hljs-keyword">AND</span> de.dept_no=dm.dept_no<span class="hljs-keyword">AND</span> s1.salary&gt;s2.salary<span class="hljs-keyword">AND</span> de.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">AND</span> dm.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">AND</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">AND</span> s2.to_date=<span class="hljs-string">'9999-01-01'</span></code></pre><ol start="26"><li></li></ol><pre class="highlight"><code class="sql">汇总各个部门当前员工的title类型的分配数目，即结果给出部门编号dept_no、dept_name、其部门下所有的当前(dept_emp.to_date = '9999-01-01')员工的当前(titles.to_date = '9999-01-01')title以及该类型title对应的数目count，结果按照dept_no升序排序(注：因为员工可能有离职，所有dept_emp里面to_date不为'9999-01-01'就已经离职了，不计入统计，而且员工可能有晋升，所以如果titles.to_date 不为 '9999-01-01'，那么这个可能是员工之前的职位信息，也不计入统计)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`departments`</span> (<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`titles`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);输入描述:</code></pre><p>自己竟然写出来了</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> de.dept_no,d.dept_name,t.title,<span class="hljs-keyword">COUNT</span>(de.emp_no) <span class="hljs-keyword">as</span> <span class="hljs-keyword">count</span><span class="hljs-keyword">FROM</span> dept_emp de <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> titles t <span class="hljs-keyword">ON</span> de.emp_no=t.emp_no <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> departments d <span class="hljs-keyword">ON</span> de.dept_no=d.dept_no<span class="hljs-keyword">WHERE</span> de.to_date=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> t.to_date=<span class="hljs-string">'9999-01-01'</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> de.dept_no,t.title;</code></pre><p>这道题也不难，无脑连接后加上条件再groupby就ok了，倒是groupby的用法自己又快忘光了呢！</p><ol start="27"><li>❌</li></ol><pre class="highlight"><code class="sql">给出每个员工每年薪水涨幅超过5000的员工编号emp_no、薪水变更开始日期from_date以及薪水涨幅值salary_growth，并按照salary_growth逆序排列。提示：在sqlite中获取datetime时间对应的年份函数为strftime('%Y', to_date)(数据保证每个员工的每条薪水记录to_date-from_date=1年，而且同一员工的下一条薪水记录from_data=上一条薪水记录的to_data)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));如：插入<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">52117</span>,<span class="hljs-string">'1986-06-26'</span>,<span class="hljs-string">'1987-06-26'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">62102</span>,<span class="hljs-string">'1987-06-26'</span>,<span class="hljs-string">'1988-06-25'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1996-08-03'</span>,<span class="hljs-string">'1997-08-03'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1997-08-03'</span>,<span class="hljs-string">'1998-08-03'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10002</span>,<span class="hljs-number">72527</span>,<span class="hljs-string">'1998-08-03'</span>,<span class="hljs-string">'1999-08-03'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10003</span>,<span class="hljs-number">43616</span>,<span class="hljs-string">'1996-12-02'</span>,<span class="hljs-string">'1997-12-02'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10003</span>,<span class="hljs-number">43466</span>,<span class="hljs-string">'1997-12-02'</span>,<span class="hljs-string">'1998-12-02'</span>);</code></pre><p>先放上自己的写法，对于同一个人相邻两条记录的比较我们可以直接让同样的表按某种条件内连接就ok</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s1.emp_no,s2.from_date,(s2.salary-s1.salary) <span class="hljs-keyword">AS</span> salary_growth<span class="hljs-keyword">FROM</span> salaries s1  <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s2<span class="hljs-keyword">ON</span> s1.emp_no=s2.emp_no <span class="hljs-keyword">AND</span> s1.to_date=s2.from_date<span class="hljs-keyword">WHERE</span> salary_growth&gt;<span class="hljs-number">5000</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary_growth <span class="hljs-keyword">DESC</span>;</code></pre><p>这道题评论也给我看晕了，主要是存在多次涨薪的问题，比如说在一年内多次涨薪的问题。给我整晕了。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> s2.emp_no, s2.from_date, (s2.salary - s1.salary) <span class="hljs-keyword">AS</span> salary_growth<span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">AS</span> s1, salaries <span class="hljs-keyword">AS</span> s2<span class="hljs-keyword">WHERE</span> s1.emp_no = s2.emp_no <span class="hljs-keyword">AND</span> salary_growth &gt; <span class="hljs-number">5000</span><span class="hljs-keyword">AND</span> (strftime(<span class="hljs-string">"%Y"</span>,s2.to_date) - strftime(<span class="hljs-string">"%Y"</span>,s1.to_date) = <span class="hljs-number">1</span>      <span class="hljs-keyword">OR</span> strftime(<span class="hljs-string">"%Y"</span>,s2.from_date) - strftime(<span class="hljs-string">"%Y"</span>,s1.from_date) = <span class="hljs-number">1</span> )<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary_growth <span class="hljs-keyword">DESC</span></code></pre><p>写上去就算看一看strftime的用法吧。<br />28.❌</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,description <span class="hljs-built_in">text</span>,PRIMARY <span class="hljs-keyword">KEY</span> (film_id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);查找描述信息(film.description)中包含robot的电影对应的分类名称(category.name)以及电影数目(count(film.film_id))，而且还需要该分类包含电影总数量(count(film_category.category_id))&gt;=5部</code></pre><p>第二个条件有点无语，不是太理解,正确答案的理解是这两个条件是并列关系。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span>,<span class="hljs-keyword">count</span>(<span class="hljs-keyword">name</span>)<span class="hljs-keyword">from</span> film,film_category,<span class="hljs-keyword">category</span><span class="hljs-keyword">where</span> film.description <span class="hljs-keyword">like</span> <span class="hljs-string">'%robot%'</span> <span class="hljs-keyword">and</span> film.film_id= film_category.film_id <span class="hljs-keyword">and</span> film_category.category_id= category.category_id<span class="hljs-keyword">and</span> category.category_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> category_id <span class="hljs-keyword">from</span> film_category <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> category_id <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(film_id)&gt;=<span class="hljs-number">5</span>)</code></pre><p>自己的想法是先满足第一个条件后，再分组，不过通不过测试</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> c.name,<span class="hljs-keyword">COUNT</span>(f.film_id) <span class="hljs-keyword">AS</span> film_num<span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> c <span class="hljs-keyword">ON</span> c.category_id=fc.category_id<span class="hljs-keyword">WHERE</span> f.description <span class="hljs-keyword">like</span> <span class="hljs-string">'%robot%'</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c.category_id<span class="hljs-keyword">HAVING</span> film_num&gt;=<span class="hljs-number">5</span>;</code></pre><ol start="29"><li></li></ol><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,description <span class="hljs-built_in">text</span>,PRIMARY <span class="hljs-keyword">KEY</span> (film_id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);使用join查询方式找出没有分类的电影id以及名称</code></pre><p>看清题目，判断是否为NULL，用IS</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> f.film_id,f.title<span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id <span class="hljs-keyword">WHERE</span> fc.category_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;</code></pre><ol start="30"><li></li></ol><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> film (film_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,description <span class="hljs-built_in">text</span>,PRIMARY <span class="hljs-keyword">KEY</span> (film_id));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">category</span>  (category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> ,<span class="hljs-keyword">name</span>  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>,PRIMARY <span class="hljs-keyword">KEY</span> ( category_id ));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> film_category  (film_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,category_id  <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">3</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">`last_update`</span> <span class="hljs-built_in">timestamp</span>);你能使用子查询的方式找出属于Action分类的所有电影对应的title,description吗</code></pre><p>注意action的条件</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> f.title,f.description <span class="hljs-keyword">FROM</span> film f <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> film_category fc <span class="hljs-keyword">ON</span> f.film_id=fc.film_id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> c <span class="hljs-keyword">ON</span> fc.category_id=c.category_id<span class="hljs-keyword">WHERE</span> c.name=<span class="hljs-string">'Action'</span>;</code></pre><p>题目还提到要用子查询的方式</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> title,description <span class="hljs-keyword">FROM</span> film <span class="hljs-keyword">where</span> film_id <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> film_id <span class="hljs-keyword">from</span> film_category <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> category_id <span class="hljs-keyword">from</span> <span class="hljs-keyword">category</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">name</span>=<span class="hljs-string">'Action'</span>))</code></pre><ol start="31"><li></li></ol><pre class="highlight"><code class="sql">将employees表的所有员工的last_name和first_name拼接起来作为Name，中间以一个空格区分(注：sqllite,字符串拼接为 || 符号，不支持concat函数，mysql支持concat函数)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> last_name || <span class="hljs-string">' '</span> || first_name<span class="hljs-keyword">FROM</span> employees;</code></pre><p>再看看CONCAT用法</p><pre class="highlight"><code class="sql">CONCAT方法：<span class="hljs-keyword">select</span> <span class="hljs-keyword">CONCAT</span>(<span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">" "</span>),first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span>  <span class="hljs-keyword">from</span> employees或者<span class="hljs-keyword">select</span> <span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">" "</span>，first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span>  <span class="hljs-keyword">from</span> employees</code></pre><ol start="32"><li></li></ol><p>创建一个actor表，包含如下列信息</p><table><thead><tr><th style="text-align:left">列表</th><th style="text-align:left">类型</th><th style="text-align:left">是否为NULL</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">actor_id</td><td style="text-align:left">smallint(5)</td><td style="text-align:left">not null</td><td style="text-align:left">主键id</td></tr><tr><td style="text-align:left">first_name</td><td style="text-align:left">varchar(45)</td><td style="text-align:left">not null</td><td style="text-align:left">名字</td></tr><tr><td style="text-align:left">last_name</td><td style="text-align:left">varchar(45)</td><td style="text-align:left">not null</td><td style="text-align:left">姓氏</td></tr><tr><td style="text-align:left">last_update</td><td style="text-align:left">date</td><td style="text-align:left">not null</td><td style="text-align:left">日期</td></tr></tbody></table><pre class="highlight"><code class="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> actor(    actor_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> ,    first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,    last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>)  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,    last_update <span class="hljs-built_in">timestamp</span>  <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">default</span> (datetime(<span class="hljs-string">'now'</span>,<span class="hljs-string">'localtime'</span>)),    primary <span class="hljs-keyword">key</span>(actor_id))</code></pre><ol start="33"><li></li></ol><p>题目已经先执行了如下语句:</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> actor;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor (   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_update  DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>)</code></pre><p>请你对于表actor批量插入如下数据(不能有2条insert语句哦!)</p><table><thead><tr><th style="text-align:left">actor_id</th><th style="text-align:left">first_name</th><th style="text-align:left">last_name</th><th style="text-align:left">last_update</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">PENELOPE</td><td style="text-align:left">GUINESS</td><td style="text-align:left">2006-02-15 12:34:33</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">NICK</td><td style="text-align:left">WAHLBERG</td><td style="text-align:left">2006-02-15 12:34:33</td></tr></tbody></table><pre class="highlight"><code class="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>,<span class="hljs-string">'PENELOPE'</span>,<span class="hljs-string">'GUINESS'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">'NICK'</span>,<span class="hljs-string">'WAHLBERG'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>)</code></pre><ol start="34"><li></li></ol><p>题目已经先执行了如下语句:</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> actor;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor (   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_update  DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> actor <span class="hljs-keyword">values</span> (<span class="hljs-string">'3'</span>, <span class="hljs-string">'WD'</span>, <span class="hljs-string">'GUINESS'</span>, <span class="hljs-string">'2006-02-15 12:34:33'</span>);</code></pre><p>对于表actor插入如下数据,如果数据已经存在，请忽略(不支持使用replace操作)</p><table><thead><tr><th style="text-align:left">actor_id</th><th style="text-align:left">first_name</th><th style="text-align:left">last_name</th><th style="text-align:left">last_update</th></tr></thead><tbody><tr><td style="text-align:left">‘3’</td><td style="text-align:left">‘ED’</td><td style="text-align:left">‘CHASE’</td><td style="text-align:left">‘2006-02-15 12:34:33’</td></tr></tbody></table><ol start="35"><li></li></ol><p>题目已经先执行了如下语句:</p><pre class="highlight"><code class="sq">drop table if exists actor;CREATE TABLE actor (   actor_id  smallint(5)  NOT NULL PRIMARY KEY,   first_name  varchar(45) NOT NULL,   last_name  varchar(45) NOT NULL,   last_update  DATETIME NOT NULL);insert into actor values ('3', 'WD', 'GUINESS', '2006-02-15 12:34:33');</code></pre><p>对于表actor插入如下数据,如果数据已经存在，请忽略(不支持使用replace操作)</p><table><thead><tr><th style="text-align:left">actor_id</th><th style="text-align:left">first_name</th><th style="text-align:left">last_name</th><th style="text-align:left">last_update</th></tr></thead><tbody><tr><td style="text-align:left">‘3’</td><td style="text-align:left">‘ED’</td><td style="text-align:left">‘CHASE’</td><td style="text-align:left">‘2006-02-15 12:34:33’</td></tr></tbody></table><p>sqlite</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">ignore</span> <span class="hljs-keyword">into</span> actor <span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>);</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">IGNORE</span> <span class="hljs-keyword">into</span> actor <span class="hljs-keyword">values</span>(<span class="hljs-number">3</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>);</code></pre><ol start="36"><li></li></ol><p>对于如下表actor，其对应的数据为:</p><table><thead><tr><th style="text-align:left">actor_id</th><th style="text-align:left">first_name</th><th style="text-align:left">last_name</th><th style="text-align:left">last_update</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">PENELOPE</td><td style="text-align:left">GUINESS</td><td style="text-align:left">2006-02-15 12:34:33</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">NICK</td><td style="text-align:left">WAHLBERG</td><td style="text-align:left">2006-02-15 12:34:33</td></tr></tbody></table><p>请你创建一个actor_name表，并且将actor表中的所有first_name以及last_name导入该表.</p><p>actor_name表结构如下：</p><table><thead><tr><th style="text-align:left">列表</th><th style="text-align:left">类型</th><th style="text-align:left">是否为NULL</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">first_name</td><td style="text-align:left">varchar(45)</td><td style="text-align:left">not null</td><td style="text-align:left">名字</td></tr><tr><td style="text-align:left">last_name</td><td style="text-align:left">varchar(45)</td><td style="text-align:left">not null</td><td style="text-align:left">姓氏</td></tr></tbody></table><p>一种写法是先建表，然后插入</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name(first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor_name <span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor;</code></pre><p>另一种是用查询到的数据建表</p><p>sqlite</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name <span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name<span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor;</code></pre><ol start="37"><li></li></ol><p>针对如下表actor结构创建索引：</p><p>(注:在 SQLite 中,除了重命名表和在已有的表中添加列,ALTER TABLE 命令不支持其他操作，</p><p>mysql支持ALTER TABLE创建索引)</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor  (   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_update  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>对first_name创建唯一索引uniq_idx_firstname，对last_name创建普通索引idx_lastname</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">INDEX</span> uniq_idx_firstname <span class="hljs-keyword">ON</span> actor(first_name);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_lastname <span class="hljs-keyword">ON</span> actor(last_name);</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">INDEX</span>  uniq_idx_firstname(first_name);<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> idx_lastname(last_name);</code></pre><ol start="38"><li></li></ol><p>针对actor表创建视图actor_name_view，只包含first_name以及last_name两列，并对这两列重新命名，first_name为first_name_v，last_name修改为last_name_v：</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  actor  (   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_update datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> actor_name_view <span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> first_name first_name_v,last_name last_name_v<span class="hljs-keyword">FROM</span> actor;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> actor_name_view (fist_name_v, last_name_v) <span class="hljs-keyword">AS</span><span class="hljs-keyword">SELECT</span> first_name, last_name <span class="hljs-keyword">FROM</span> actor </code></pre><ol start="39"><li></li></ol><pre class="highlight"><code class="sql">针对salaries表emp_no字段创建索引idx_emp_no，查询emp_no为10005, 使用强制索引。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));<span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> idx_emp_no <span class="hljs-keyword">on</span> salaries(emp_no);</code></pre><p>sqlite</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries INDEXED <span class="hljs-keyword">BY</span> idx_emp_no <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10005</span>;</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries FROCE <span class="hljs-keyword">INDEX</span> <span class="hljs-keyword">BY</span> idx_emp_no <span class="hljs-keyword">WHERE</span> emp_no=<span class="hljs-number">10005</span>;</code></pre><ol start="40"><li></li></ol><p>存在actor表，包含如下列信息：</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  actor  (   actor_id  <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>)  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,   first_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_name  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   last_update  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>现在在last_update后面新增加一列名字为create_date, 类型为datetime, NOT NULL，默认值为’2020-10-01 00:00:00’</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> create_date datetime <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">default</span>  <span class="hljs-string">'2020-10-01 00:00:00'</span> <span class="hljs-keyword">AFTER</span> last_update; </code></pre><ol start="41"><li></li></ol><pre class="highlight"><code class="sql">构造一个触发器audit_log，在向employees_test表中插入一条数据的时候，触发插入相关的数据到audit中。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees_test(<span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,AGE <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,ADDRESS <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">50</span>),SALARY <span class="hljs-built_in">REAL</span>)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(EMP_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>begin和end之间的语句要用分号结束</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> audit_log <span class="hljs-keyword">AFTER</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> employees_test<span class="hljs-keyword">begin</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">audit</span>(EMP_no,<span class="hljs-keyword">NAME</span>) <span class="hljs-keyword">VALUES</span>(new.ID,new.NAME);<span class="hljs-keyword">end</span>;</code></pre><ol start="42"><li></li></ol><pre class="highlight"><code class="sql">删除emp_no重复的记录，只保留最小的id对应的记录。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);</code></pre><p>对groupby又产生了大大的疑惑，不是说select后面只能接groupby的相关字段吗</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> titles_test<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>  (        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">FROM</span> titles_test <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no)</code></pre><p>两两比较找出最大值或者最小值</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> titles_test <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">in</span>(    <span class="hljs-keyword">select</span> a.id <span class="hljs-keyword">from</span> titles_test a,titles_test b <span class="hljs-keyword">where</span> a.emp_no=b.emp_no <span class="hljs-keyword">and</span> a.id&gt;b.id)</code></pre><ol start="43"><li></li></ol><pre class="highlight"><code class="sql">将所有to_date为9999-01-01的全部更新为NULL,且 from_date更新为2001-01-01。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);更新后的值:titles_test 表的值：</code></pre><table><thead><tr><th>id</th><th>emp_no</th><th>title</th><th>from_date</th><th>to_date</th></tr></thead><tbody><tr><td>1</td><td>10001</td><td>Senior Engineer</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>2</td><td>10002</td><td>Staff</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>3</td><td>10003</td><td>Senior Engineer</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>4</td><td>10004</td><td>Senior Engineer</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>5</td><td>10001</td><td>Senior Engineer</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>6</td><td>10002</td><td>Staff</td><td>2001-01-01</td><td>NULL</td></tr><tr><td>7</td><td>10003</td><td>Senior Engineer</td><td>2001-01-01</td><td>NULL</td></tr></tbody></table><p>UPDATE语句更新多列用逗号隔开哦~不是用AND</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> titles_test<span class="hljs-keyword">SET</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-literal">NULL</span>,from_date=<span class="hljs-string">'2001-01-01'</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;</code></pre><ol start="44"><li></li></ol><p>将id=5以及emp_no=10001的行数据替换成id=5以及emp_no=10005,其他数据保持不变，<strong>使用replace实现，直接使用update会报错了</strong>。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> titles_test (   <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,   emp_no  <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   title  <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   from_date  <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   <span class="hljs-keyword">to_date</span>  <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span>(<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);</code></pre><p>mark一下replace的用法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> titles_test <span class="hljs-keyword">SET</span> emp_no=<span class="hljs-keyword">replace</span>(emp_no,<span class="hljs-number">10001</span>,<span class="hljs-number">10005</span>) <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">5</span>;</code></pre><p>全字段更新替换,会插入一条新记录。并且要将所有字段的值写出，否则将置为空。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">REPLACE</span> <span class="hljs-keyword">INTO</span> titles_test <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-number">10005</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>)</code></pre><ol start="45"><li></li></ol><p>将titles_test表名修改为titles_2017。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> titles_test (<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span> primary <span class="hljs-keyword">key</span>,emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,from_date <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">to_date</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> titles_test <span class="hljs-keyword">values</span> (<span class="hljs-string">'1'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'2'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'3'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'4'</span>, <span class="hljs-string">'10004'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'5'</span>, <span class="hljs-string">'10001'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1986-06-26'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'6'</span>, <span class="hljs-string">'10002'</span>, <span class="hljs-string">'Staff'</span>, <span class="hljs-string">'1996-08-03'</span>, <span class="hljs-string">'9999-01-01'</span>),(<span class="hljs-string">'7'</span>, <span class="hljs-string">'10003'</span>, <span class="hljs-string">'Senior Engineer'</span>, <span class="hljs-string">'1995-12-03'</span>, <span class="hljs-string">'9999-01-01'</span>);</code></pre><p>sqlite</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> titles_test <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> titles_2017;</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> titles_test <span class="hljs-keyword">rename</span> titles_2017</code></pre><ol start="46"><li></li></ol><p>在audit表上创建外键约束，其emp_no对应employees_test表的主键id。</p><p>(以下2个表已经创建了)</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees_test(<span class="hljs-keyword">ID</span> <span class="hljs-built_in">INT</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">NAME</span> <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,AGE <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,ADDRESS <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">50</span>),SALARY <span class="hljs-built_in">REAL</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(EMP_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,create_date datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);</code></pre><p>先看mysql的用法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span><span class="hljs-keyword">ADD</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (emp_no)<span class="hljs-keyword">REFERENCES</span> employees_test (<span class="hljs-keyword">id</span>);</code></pre><p>再看sqlite,注意外键格式</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span>(emp_no <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,create_date datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span>(emp_no) <span class="hljs-keyword">REFERENCES</span> employees_test(<span class="hljs-keyword">id</span>))</code></pre><ol start="47"><li></li></ol><pre class="highlight"><code class="sql">请你写出更新语句，将所有获取奖金的员工当前的(salaries.to_date='9999-01-01')薪水增加10%。(emp_bonus里面的emp_no都是当前获奖的所有员工)<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_bonus(emp_no <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,btype <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));如：<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp_bonus <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10001</span>,<span class="hljs-number">1</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">85097</span>,<span class="hljs-string">'2001-06-22'</span>,<span class="hljs-string">'2002-06-22'</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> salaries <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">10001</span>,<span class="hljs-number">88958</span>,<span class="hljs-string">'2002-06-22'</span>,<span class="hljs-string">'9999-01-01'</span>);</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salaries<span class="hljs-keyword">SET</span> salary=salary*<span class="hljs-number">1.1</span><span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> emp_bonus) <span class="hljs-keyword">AND</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>;</code></pre><ol start="48"><li></li></ol><pre class="highlight"><code class="sql">将employees表中的所有员工的last_name和first_name通过(')连接起来。(sqlite不支持concat，请用||实现，mysql支持concat)<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));输出格式:</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> last_name || <span class="hljs-string">"'"</span> || first_name <span class="hljs-keyword">FROM</span> employees;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CONCAT</span>(last_name, <span class="hljs-string">''''</span>, first_name) <span class="hljs-keyword">as</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> employees;</code></pre><ol start="49"><li></li></ol><p>查找字符串’10,A,B’ 中逗号’,'出现的次数cnt。</p><p>技巧题哈，学习了LENGTH 和REPLACE的用法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LENGTH</span>(<span class="hljs-string">'10,A,B'</span> )-<span class="hljs-keyword">LENGTH</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">'10,A,B'</span>,<span class="hljs-string">','</span>,<span class="hljs-string">''</span>)) <span class="hljs-keyword">AS</span> cnt</code></pre><ol start="50"><li></li></ol><pre class="highlight"><code class="sql">获取Employees中的first_name，查询按照first_name最后两个字母，按照升序进行排列<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> first_name,<span class="hljs-keyword">SUBSTR</span>(first_name,<span class="hljs-number">-2</span>) <span class="hljs-keyword">AS</span> first_name_2 <span class="hljs-keyword">FROM</span> employees)<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name_2 <span class="hljs-keyword">ASC</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">substr</span>(first_name,<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">asc</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">right</span>(first_name, <span class="hljs-number">2</span>);</code></pre><ol start="51"><li></li></ol><pre class="highlight"><code class="sql">按照dept_no进行汇总，属于同一个部门的emp_no按照逗号进行连接，结果给出dept_no以及连接出的结果employees<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));输出格式:</code></pre><p>记录一下GROUP_CONCAT的用法</p><p>sqlite</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dept_no,<span class="hljs-keyword">GROUP_CONCAT</span>(emp_no) <span class="hljs-keyword">AS</span> employees<span class="hljs-keyword">FROM</span> dept_emp<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no;</code></pre><p>mysql</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> dept_no, <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">DISTINCT</span> emp_no <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no <span class="hljs-keyword">ASC</span> SEPARATOR <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> employees <span class="hljs-keyword">FROM</span> dept_emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no;</code></pre><ol start="52"><li></li></ol><pre class="highlight"><code class="SQL">查找排除最大、最小salary之后的当前(to_date = '9999-01-01' )员工的平均工资avg_salary。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));</code></pre><p>关于时间的限制</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(salary) <span class="hljs-keyword">AS</span> avg_salary <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> salary <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span>)<span class="hljs-keyword">AND</span> salary <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span>)</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>    <span class="hljs-keyword">AVG</span>(salary)<span class="hljs-keyword">FROM</span>    salaries<span class="hljs-keyword">WHERE</span>    salary&lt;&gt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AND</span>    salary&lt;&gt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AND</span>    <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span></code></pre><ol start="53"><li></li></ol><pre class="highlight"><code class="sql">分页查询employees表，每5行一页，返回第2页的数据<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>LIMIT 后的数字代表返回几条记录，OFFSET 后的数字代表从第几条记录开始返回</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">5</span>;</code></pre><p>在 LIMIT X,Y 中，Y代表返回几条记录，X代表从第几条记录开始返回（第一条记录序号为0），切勿记反。</p><ol start="54"><li></li></ol><pre class="highlight"><code class="sql">获取所有员工的emp_no、部门编号dept_no以及对应的bonus类型btype和received，没有分配奖金的员工不显示对应的bonus类型btype和received<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`emp_bonus`</span>(emp_no <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,received datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,btype <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,de.dept_no,eb.btype,eb.received<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept_emp de <span class="hljs-keyword">ON</span> e.emp_no=de.emp_no <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no</code></pre><ol start="55"><li></li></ol><pre class="highlight"><code class="sql">使用含有关键字exists查找未分配具体部门的员工的所有信息。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));</code></pre><p>这个EXISTS当作条件判断得理解理解</p><p>IN是先执行子查询，得到一个结果集，将结果集代入外层谓词条件执行主查询，子查询只需要执行一次<br />EXISTS是先从主查询中取得一条数据，再代入到子查询中，执行一次子查询，判断子查询是否能返回结果，主查询有多少条数据，子查询就要执行多少次,EXISTS中要添加判断条件？？？</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<span class="hljs-keyword">WHERE</span>  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_emp <span class="hljs-keyword">WHERE</span> employees.emp_no=dept_emp.emp_no)</code></pre><ol start="56"><li></li></ol><pre class="highlight"><code class="sql">获取有奖金的员工相关信息。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`dept_emp`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`dept_no`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`dept_no`</span>));<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_bonus(emp_no <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,received datetime <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,btype <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>);<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));给出emp_no、first_name、last_name、奖金类型btype、对应的当前薪水情况salary以及奖金金额bonus。 bonus类型btype为1其奖金为薪水salary的10%，btype为2其奖金为薪水的20%，其他类型均为薪水的30%。 当前薪水表示to_date='9999-01-01'</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,e.first_name,e.last_name,eb.btype,s.salary,s.salary*eb.btype*<span class="hljs-number">0.1</span> <span class="hljs-keyword">as</span> bonus<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no <span class="hljs-keyword">WHERE</span> s.to_date=<span class="hljs-string">'9999-01-01'</span></code></pre><p>看看CASE WHEN THEN END的用法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.emp_no,e.first_name,e.last_name,eb.btype,s.salary,(<span class="hljs-keyword">CASE</span> eb.btype<span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.1</span><span class="hljs-keyword">WHEN</span> <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.2</span><span class="hljs-keyword">WHEN</span> <span class="hljs-number">3</span> <span class="hljs-keyword">THEN</span> s.salary*<span class="hljs-number">0.3</span><span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> bonus<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> emp_bonus eb <span class="hljs-keyword">ON</span> e.emp_no=eb.emp_no <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> salaries s <span class="hljs-keyword">ON</span> e.emp_no=s.emp_no <span class="hljs-keyword">WHERE</span> s.to_date=<span class="hljs-string">'9999-01-01'</span></code></pre><ol start="57"><li></li></ol><pre class="highlight"><code class="sql">按照salary的累计和running_total，其中running_total为前N个当前( to_date = '9999-01-01')员工的salary累计和，其他以此类推。 具体结果如下Demo展示。。<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`salaries`</span> ( <span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`salary`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`from_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`to_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>,<span class="hljs-string">`from_date`</span>));输出格式:</code></pre><p>让我们来学习一种新的求和方法，两表相同按某列拍好序后，比较大小即可求和。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">sum</span>(s1.salary) <span class="hljs-keyword">FROM</span> salaries s1 <span class="hljs-keyword">WHERE</span> s1.emp_no&lt;=s2.emp_no <span class="hljs-keyword">AND</span> s1.to_date=<span class="hljs-string">'9999-01-01'</span>) <span class="hljs-keyword">AS</span> running_total<span class="hljs-keyword">FROM</span> salaries s2 <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s2.emp_no</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> emp_no,salary,<span class="hljs-keyword">SUM</span>(salary) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no) <span class="hljs-keyword">AS</span> running_total<span class="hljs-keyword">FROM</span> salaries<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>= <span class="hljs-string">'9999-01-01'</span>;</code></pre><p>58.❌</p><pre class="highlight"><code class="sql">对于employees表中，输出first_name排名(按first_name升序排序)为奇数的first_name<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`employees`</span> (<span class="hljs-string">`emp_no`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`birth_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`first_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`last_name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`gender`</span> <span class="hljs-built_in">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">`hire_date`</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`emp_no`</span>));</code></pre><p>对于这个COUNT的用法还是存疑(聚合或是满足某种条件之后？？？)，可以用于计数，两两比较之间的计数，用于排序</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees e1<span class="hljs-keyword">WHERE</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> employees e2 <span class="hljs-keyword">WHERE</span> e1.first_name&gt;=e2.first_name)%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>;</code></pre><p>用row_number() over 进行排序</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> tt.first_name<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> first_name,row_number() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> first_name) <span class="hljs-keyword">as</span> row_idx<span class="hljs-keyword">from</span> employees) <span class="hljs-keyword">as</span> tt<span class="hljs-keyword">where</span> tt.row_idx%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>    e.first_name<span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">JOIN</span>(    <span class="hljs-keyword">SELECT</span>         first_name        , ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">AS</span>  r_num    <span class="hljs-keyword">FROM</span> employees) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">ON</span> e.first_name = t.first_name<span class="hljs-keyword">WHERE</span> t.r_num % <span class="hljs-number">2</span> = <span class="hljs-number">1</span>;</code></pre><ol start="59"><li></li></ol><p>在牛客刷题的小伙伴们都有着牛客积分，积分(grade)表简化可以如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308877503_0244CF2104BC29F1AAC07582264ADC57" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">FROM</span> grade <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">id</span>)&gt;=<span class="hljs-number">3</span></code></pre><p>这个思路也很牛逼:要三次以上的积分，那么肯定要查找3个id不同但是积分相同的情况</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-keyword">DISTINCT</span> g1.number <span class="hljs-keyword">AS</span> times<span class="hljs-keyword">FROM</span>    grade g1,    grade g2,    grade g3<span class="hljs-keyword">WHERE</span>    g1.id != g2.id    <span class="hljs-keyword">AND</span> g2.id != g3.id     <span class="hljs-keyword">AND</span> g1.id !=g3.id    <span class="hljs-keyword">AND</span> g1.number = g2.number    <span class="hljs-keyword">AND</span> g2.number = g3.number</code></pre><p>60.❌</p><p>在牛客刷题有一个通过题目个数的(passing_number)表，id是主键，简化如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308916086_6B7E692D15E9D27D855F76C56E00D52A" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为1的用户通过了4个题目;</p><p>…</p><p>第6行表示id为6的用户通过了4个题目;</p><p>请你根据上表，输出通过的题目的排名，通过题目个数相同的，排名相同，此时按照id升序排列，数据如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20201105/557336_1604558013211_15EB7DEE744C7810B57ED3EF3D65D7FE" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-built_in">number</span>,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> t_rank<span class="hljs-keyword">FROM</span> passing_number <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t_rank,<span class="hljs-keyword">id</span> <span class="hljs-keyword">ASC</span>;</code></pre><p>这种做法也得理解理解</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> a.id,a.number,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> b.number) <span class="hljs-keyword">from</span> passing_number b <span class="hljs-keyword">where</span> b.number&gt;=a.number ) <span class="hljs-keyword">from</span> passing_number a <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> a.number <span class="hljs-keyword">desc</span>, a.id <span class="hljs-keyword">asc</span>;</code></pre><ol start="61"><li></li></ol><p>有一个person表，主键是id，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308809115_59865103D43294F21EB0E6AA59EE2533" srcset="/img/loading.gif" alt="" /></p><p>有一个任务(task)表如下，主键也是id，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308818265_982AA463886BC0847F36791DBF155842" srcset="/img/loading.gif" alt="" /></p><p>请你找到每个人的任务情况，并且输出出来，没有任务的也要输出，而且输出结果按照person的id升序排序，输出情况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200813/557336_1597308835496_51484617FEE1F3A5CD46EAA4F7D900CA" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> person.id,person.name,task.content<span class="hljs-keyword">FROM</span> person <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task <span class="hljs-keyword">ON</span> person.id=task.person_id<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> person.id <span class="hljs-keyword">ASC</span>;</code></pre><ol start="62"><li></li></ol><p>现在有一个需求，让你统计正常用户发送给正常用户邮件失败的概率:<br />有一个邮件(email)表，id为主键， type是枚举类型，枚举成员为(completed，no_completed)，completed代表邮件发送是成功的，no_completed代表邮件是发送失败的。简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652115615_43081841018939871F6352EF230E6D8E" srcset="/img/loading.gif" alt="" /></p><p>第1行表示为id为2的用户在2020-01-11成功发送了一封邮件给了id为3的用户;<br />…<br />第3行表示为id为1的用户在2020-01-11<strong>没有成功</strong>发送一封邮件给了id为4的用户;<br />…<br />第6行表示为id为4的用户在2020-01-12成功发送了一封邮件给了id为1的用户;</p><p>下面是一个用户(user)表，id为主键，is_blacklist为0代表为正常用户，is_blacklist为1代表为黑名单用户，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652932880_7440E658C1F32DF28A6F4360EAB2D9BB" srcset="/img/loading.gif" alt="" /></p><p>结果表示:</p><p>2020-01-11失败的概率为0.500，因为email的第1条数据，发送的用户id为2是黑名单用户，所以不计入统计，正常用户发正常用户总共2次，但是失败了1次，所以概率是0.500;</p><p>2020-01-12没有失败的情况，所以概率为0.000.<br />(注意: sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5，sqlite四舍五入的函数为round)</p><p>注意先乘1.0，不然会得到0</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.date,<span class="hljs-keyword">ROUND</span>(    <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> e.type <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'completed'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'no_completed'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">END</span>)*<span class="hljs-number">1.0</span>/<span class="hljs-keyword">COUNT</span>(e.type),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> p<span class="hljs-keyword">FROM</span> email e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u1 <span class="hljs-keyword">ON</span> e.send_id=u1.id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u2 <span class="hljs-keyword">ON</span> e.receive_id=u2.id <span class="hljs-keyword">WHERE</span> u1.is_blacklist=<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> u2.is_blacklist=<span class="hljs-number">0</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> e.date <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.date;</code></pre><ol start="63"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个用户最近登录是哪一天。</p><p>有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652540640_64D4B3DE58C69D6263B209D2B1AB6393" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />。。。<br />第4行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网</p><p>请你写出一个sql语句查询每个用户最近一天登录的日子，并且按照user_id升序排序，上面的例子查询结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20201026/557336_1603700593855_F4BBCB1D5E81A508C2A06167DCF2F5ED" srcset="/img/loading.gif" alt="" /></p><p>老师说过select 的字段要包含在group或者要用聚合函数</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) d<span class="hljs-keyword">FROM</span> login<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ASC</span>;</code></pre><ol start="64"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个用户最近登录是哪一天，用的是什么设备.</p><p>有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200901/557336_1598928123396_B0B18451FDC78934AF1D2CF7E366835C" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />。。。<br />第4行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网</p><p>还有一个用户(user)表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652611050_C098FF7CF52D3DC2ECE5019F4E7A5E88" srcset="/img/loading.gif" alt="" /></p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652618264_F2C14AA3F53E74C2FE5A266283E56241" srcset="/img/loading.gif" alt="" /></p><p>请你写出一个sql语句查询每个用户最近一天登录的日子，用户的名字，以及用户用的设备的名字，并且查询结果按照user的name升序排序，上面的例子查询结果如下</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652643237_528AC16903A00B04890D9E308B2B5FDE" srcset="/img/loading.gif" alt="" /></p><p>老生常谈，group by后select后只能跟聚合和group by的字段</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> u.name,c.name,l.date<span class="hljs-keyword">FROM</span> login l <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u <span class="hljs-keyword">ON</span> l.user_id=u.id <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">client</span> c <span class="hljs-keyword">ON</span> l.client_id=c.id<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) max_date <span class="hljs-keyword">FROM</span> login <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id) <span class="hljs-keyword">AS</span> T <span class="hljs-keyword">ON</span> u.id=T.user_id<span class="hljs-keyword">WHERE</span> l.date=T.max_date<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> u.name <span class="hljs-keyword">ASC</span></code></pre><p>这个答案更简明</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> u.name,c.name,l1.date<span class="hljs-keyword">from</span> login l1,<span class="hljs-keyword">user</span> u,<span class="hljs-keyword">client</span> c<span class="hljs-keyword">where</span> l1.date=(<span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(l2.date) <span class="hljs-keyword">from</span> login l2 <span class="hljs-keyword">where</span> l1.user_id=l2.user_id)<span class="hljs-keyword">and</span> l1.user_id=u.id<span class="hljs-keyword">and</span> l1.client_id=c.id<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> u.name</code></pre><p>总结一下，遇到取最大最小值的问题或者是计数，可以对主键进行连接，然后增加判断条件，排序就用大于小于等于，最大最小就用max min</p><ol start="65"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客新登录用户的次日成功的留存率，<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20201026/557336_1603701796116_54BBC7EED94F0CAAFEC8DB042BBBCD01" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备第一次新登录了牛客网<br />。。。</p><p>第4行表示id为3的用户在2020-10-12使用了客户端id为2的设备登录了牛客网</p><p>。。。</p><p>最后1行表示id为1的用户在2020-10-14使用了客户端id为2的设备登录了牛客网</p><p>请你写出一个sql语句查询新登录用户次日成功的留存率，即第1天登陆之后，第2天再次登陆的概率,保存小数点后面3位(3位之后的四舍五入)，上面的例子查询结果如下:</p><p>(sqlite里查找某一天的后一天的用法是:date(yyyy-mm-dd, ‘+1 day’)，四舍五入的函数为round，sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5</p><p>mysql里查找某一天的后一天的用法是:DATE_ADD(yyyy-mm-dd,INTERVAL 1 DAY)，四舍五入的函数为round)</p><pre class="highlight"><code class="sql"></code></pre><ol start="66"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个日期登录新用户个数，<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903671918_2C3C4BF94A59FB9AEEA6FEA89DEE17C9" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网，因为是第1次登录，所以是新用户<br />。。。<br />第4行表示id为2的用户在2020-10-13使用了客户端id为2的设备登录了牛客网，因为是第2次登录，所以是老用户<br />。。<br />最后1行表示id为4的用户在2020-10-15使用了客户端id为1的设备登录了牛客网，因为是第2次登录，所以是老用户请你写出一个sql语句查询每个日期登录新用户个数，并且查询结果按照日期升序排序，上面的例子查询结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903683115_47DE8F52D6F847E788BB9EF6279481C4" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"></code></pre><ol start="67"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个日期新用户的次日留存率。<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903752757_A02F3DF1419BC2D3D4EE9B2B4557053B" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网，因为是第1次登录，所以是新用户<br />。。。<br />第4行表示id为2的用户在2020-10-13使用了客户端id为2的设备登录了牛客网，因为是第2次登录，所以是老用户<br />。。<br />最后1行表示id为4的用户在2020-10-15使用了客户端id为1的设备登录了牛客网，因为是第2次登录，所以是老用户</p><p>请你写出一个sql语句查询每个日期新用户的次日留存率，结果保留小数点后面3位数(3位之后的四舍五入)，并且查询结果按照日期升序排序，上面的例子查询结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903761838_F734DB69B9941F0DF86776922B0CF347" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sq">SELECT ROUND(COUNT(DISTINCT l2.user_id)*1.0/COUNT(DISTINCT l1.user_id),3)FROM login l1,login l2WHERE l1.user_id=l2.user_id AND l2.date=date(l1.date, '+1 day')；</code></pre><ol start="68"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个日期登录新用户个数，<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903671918_2C3C4BF94A59FB9AEEA6FEA89DEE17C9" srcset="/img/loading.gif" alt="" /></p><p>慢慢想吧</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> a.date,<span class="hljs-keyword">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-keyword">rank</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-keyword">new</span><span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>, row_number() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> user_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">rank</span><span class="hljs-keyword">from</span> login) a<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">sum</span>(t) <span class="hljs-keyword">from</span>(    <span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span>,    <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> (user_id,<span class="hljs-built_in">date</span>) <span class="hljs-keyword">in</span>     (<span class="hljs-keyword">select</span> user_id,<span class="hljs-keyword">min</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">from</span> login <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> user_id)    <span class="hljs-keyword">then</span> <span class="hljs-number">1</span>    <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">as</span> t    <span class="hljs-keyword">from</span> login)<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">asc</span></code></pre><ol start="69"><li></li></ol><p>牛客每天有很多人登录，请你统计一下牛客每个日期新用户的次日留存率。<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903752757_A02F3DF1419BC2D3D4EE9B2B4557053B" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"></code></pre><p>70.❌</p><p>牛客每天有很多人登录，请你统计一下牛客每个用户查询刷题信息，包括: 用户的名字，以及截止到某天，累计总共通过了多少题。 不存在没有登录却刷题的情况，但是存在登录了没刷题的情况，不会存在刷题表里面，有提交代码没有通过的情况，但是会记录在刷题表里，只不过通过数目是0。<br />有一个登录(login)记录表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903934415_A5E822A1E15CEBC7E16183ECD9D7CC7A" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12使用了客户端id为1的设备登录了牛客网<br />。。。<br />第5行表示id为3的用户在2020-10-13使用了客户端id为2的设备登录了牛客网<br />有一个刷题（passing_number)表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903944909_9C60ECB78BE56145269BDFA74F1074D3" srcset="/img/loading.gif" alt="" /></p><p>第1行表示id为2的用户在2020-10-12通过了4个题目。<br />。。。<br />第3行表示id为1的用户在2020-10-13提交了代码但是没有通过任何题目。<br />第4行表示id为4的用户在2020-10-13通过了2个题目<br />还有一个用户(user)表，简况如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200820/557336_1597903952301_4763AF7B377AF42CB5A87C53B965DC45" srcset="/img/loading.gif" alt="" /></p><p>请你写出一个sql语句查询刷题信息，包括: 用户的名字，以及截止到某天，累计总共通过了多少题，并且查询结果先按照日期升序排序，再按照姓名升序排序，有登录却没有刷题的哪一天的数据不需要输出，上面的例子查询结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20201015/557336_1602736313104_6BE4C7264FB9F7CED1DD6A6D44652D6C" srcset="/img/loading.gif" alt="" /></p><p>题目的含义是各个用户在不同时间累积答题求和，采用sum函数进行开窗处理，将user_id进行分区，再通过时间升序排序，进而实现了在每个user_id分区中以升序日期排序的通过题数的逐个递加</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,<span class="hljs-built_in">date</span>,<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> user_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>)<span class="hljs-keyword">FROM</span> passing_number p<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u<span class="hljs-keyword">ON</span> p.user_id=u.id<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">name</span></code></pre><p>还有一种是同一张表内连接的方法，这个得花时间理解，对于这种分组累加很有必要</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> u.name,pn1.date,<span class="hljs-keyword">SUM</span>(pn2.number)<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> u <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> passing_number pn1 <span class="hljs-keyword">ON</span> u.id=pn1.user_id<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> passing_number pn2 <span class="hljs-keyword">ON</span> pn1.user_id=pn2.user_id<span class="hljs-keyword">WHERE</span> pn1.date&gt;=pn2.date<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> pn1.id,pn1.date<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> pn1.date <span class="hljs-keyword">ASC</span>,u.name <span class="hljs-keyword">ASC</span>;</code></pre><ol start="71"><li></li></ol><p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600513881865_4F8855D8505FBEAA5F2561794CD2C0B0" srcset="/img/loading.gif" alt="" /></p><p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p><p>。。。</p><p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p><p>请你写一个sql语句查询各个岗位分数的平均数，并且按照分数降序排序，结果保留小数点后面3位(3位之后四舍五入):</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600513888833_CE4B33A183934FE8410A2864D09E32E7" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(score),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">avg</span><span class="hljs-keyword">FROM</span> grade<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">avg</span> <span class="hljs-keyword">DESC</span>;</code></pre><ol start="72"><li></li></ol><p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514055044_2CCD09B7C5B20F369E0D5D52AAE75E69" srcset="/img/loading.gif" alt="" /></p><p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p><p>。。。</p><p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p><p>请你写一个sql语句查询用户分数大于其所在工作(job)分数的平均分的所有grade的属性，并且以id的升序排序，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514070904_62340E72F33FAB48C78342F76BA93044" srcset="/img/loading.gif" alt="" /></p><p>感觉自己写的很烂</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> g.id,g.job,g.score <span class="hljs-keyword">FROM</span> grade g,(<span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">AVG</span>(score) avg_score <span class="hljs-keyword">FROM</span> grade <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job) <span class="hljs-keyword">AS</span> t<span class="hljs-keyword">WHERE</span> g.job=t.job <span class="hljs-keyword">AND</span> g.score&gt;t.avg_score <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> g.id <span class="hljs-keyword">ASC</span>;</code></pre><p>这个开窗函数看起来就很简洁</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,job,score <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> *,<span class="hljs-keyword">AVG</span>(score) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> job) avg_score <span class="hljs-keyword">FROM</span> grade)<span class="hljs-keyword">WHERE</span> score&gt;avg_score<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>;</code></pre><ol start="73"><li></li></ol><p>牛客每次举办企业笔试的时候，企业一般都会有不同的语言岗位，比如C++工程师，JAVA工程师，Python工程师，每个用户笔试完有不同的分数，现在有一个分数(grade)表简化如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652427039_07E19104EBD63DA9EDB41F5DD4489F99" srcset="/img/loading.gif" alt="" /></p><p>第1行表示用户id为1的选择了language_id为1岗位的最后考试完的分数为12000，<br />…<br />第7行表示用户id为7的选择了language_id为2岗位的最后考试完的分数为11000，</p><p>不同的语言岗位(language)表简化如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652437695_C8AFE1A16BE6BBA7929B73D79DE0E398" srcset="/img/loading.gif" alt="" /></p><p>请你找出每个岗位分数排名前2的用户，得到的结果先按照language的name升序排序，再按照积分降序排序，最后按照grade的id升序排序，得到结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200817/557336_1597652444918_D40D8F8B37A92E9E7A15A5231F7D3822" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span>,score <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> g.id <span class="hljs-keyword">AS</span> <span class="hljs-keyword">id</span>,l.name <span class="hljs-keyword">AS</span> <span class="hljs-keyword">name</span>,g.score <span class="hljs-keyword">AS</span> score,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> g.language_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_score<span class="hljs-keyword">FROM</span> grade g <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">language</span> l <span class="hljs-keyword">ON</span> g.language_id=l.id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> l.name <span class="hljs-keyword">ASC</span>,score <span class="hljs-keyword">DESC</span>,<span class="hljs-keyword">id</span> <span class="hljs-keyword">ASC</span>)<span class="hljs-keyword">WHERE</span> rank_score&lt;=<span class="hljs-number">2</span></code></pre><ol start="74"><li></li></ol><p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514637504_1968643213375655C970A80233B90BFA" srcset="/img/loading.gif" alt="" /></p><p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p><p>。。。</p><p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p><p>请你写一个sql语句查询各个岗位分数升序排列之后的中位数位置的范围，并且按job升序排序，结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514646549_3FA97323294AEEA1C641FFAD64EF069B" srcset="/img/loading.gif" alt="" /></p><p>解释:</p><p>第1行表示C<ins>岗位的中位数位置范围为[2,2]，也就是2。因为C</ins>岗位总共3个人，是奇数，所以中位数位置为2是正确的(即位置为2的10000是中位数)</p><p>第2行表示Java岗位的中位数位置范围为[1,2]。因为Java岗位总共2个人，是偶数，所以要知道中位数，需要知道2个位置的数字，而因为只有2个人，所以中位数位置为[1,2]是正确的(即需要知道位置为1的12000与位置为2的13000才能计算出中位数为12500)</p><p>第3行表示前端岗位的中位数位置范围为[2,2]，也就是2。因为前端岗位总共3个人，是奇数，所以中位数位置为2是正确的(即位置为2的11000是中位数)</p><p>(注意: sqlite 1/2得到的不是0.5，得到的是0，只有1*1.0/2才会得到0.5，sqlite四舍五入的函数为round，sqlite不支持floor函数，支持cast(x as integer) 函数，不支持if函数，支持case when …then …else …end函数)</p><pre class="highlight"><code class="sql"></code></pre><ol start="75"><li></li></ol><p>牛客每次考试完，都会有一个成绩表(grade)，如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514714857_0A390C0623561C804BC63A48121FD094" srcset="/img/loading.gif" alt="" /></p><p>第1行表示用户id为1的用户选择了C++岗位并且考了11001分</p><p>。。。</p><p>第8行表示用户id为8的用户选择了前端岗位并且考了9999分</p><p>请你写一个sql语句查询各个岗位分数的中位数位置上的所有grade信息，并且按id升序排序，结果如下:</p><p><img src="https://uploadfiles.nowcoder.com/images/20200919/557336_1600514720752_917884B00BBAAAF5E9969D36073440C3" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="sql"></code></pre><p>====================================================================================</p><p>力扣刷题</p><p>====================================================================================</p><ol start="175"><li></li></ol><p>表1: Person</p><p>±------------±--------+<br />| 列名         | 类型     |<br />±------------±--------+<br />| PersonId    | int     |<br />| FirstName   | varchar |<br />| LastName    | varchar |<br />±------------±--------+<br />PersonId 是上表主键<br />表2: Address</p><p>±------------±--------+<br />| 列名         | 类型    |<br />±------------±--------+<br />| AddressId   | int     |<br />| PersonId    | int     |<br />| City        | varchar |<br />| State       | varchar |<br />±------------±--------+<br />AddressId 是上表主键</p><p>编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供 person 的以下信息：</p><p>FirstName, LastName, City, State</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> p.FirstName,p.Lastname,a.City,a.State<span class="hljs-keyword">FROM</span> Person p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Address a <span class="hljs-keyword">on</span> p.PersonId=a.PersonId;</code></pre><ol start="176"><li></li></ol><p>编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary） 。</p><p>±—±-------+<br />| Id | Salary |<br />±—±-------+<br />| 1  | 100    |<br />| 2  | 200    |<br />| 3  | 300    |<br />±—±-------+<br />例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null。</p><p>±--------------------+<br />| SecondHighestSalary |<br />±--------------------+<br />| 200                 |<br />±--------------------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(e1.Salary) SecondHighestSalary <span class="hljs-keyword">FROM</span> Employee e1 <span class="hljs-keyword">WHERE</span> e1.Salary&lt;(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(e2.Salary) <span class="hljs-keyword">FROM</span> Employee e2);  </code></pre><ol start="177"><li></li></ol><p>编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。</p><p>±—±-------+<br />| Id | Salary |<br />±—±-------+<br />| 1  | 100    |<br />| 2  | 200    |<br />| 3  | 300    |<br />±—±-------+<br />例如上述 Employee 表，n = 2 时，应返回第二高的薪水 200。如果不存在第 n 高的薪水，那么查询应返回 null。</p><p>±-----------------------+<br />| getNthHighestSalary(2) |<br />±-----------------------+<br />| 200                    |<br />±-----------------------+</p><p>服了，rank()是mysql自带的函数，不能用于变量命名</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> getNthHighestSalary(N <span class="hljs-built_in">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-built_in">INT</span><span class="hljs-keyword">BEGIN</span>  <span class="hljs-keyword">RETURN</span> (      <span class="hljs-comment"># Write your MySQL query statement below.</span>      <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Salary       <span class="hljs-keyword">FROM</span> (          <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_s,          Salary           <span class="hljs-keyword">FROM</span> Employee          ) <span class="hljs-keyword">AS</span> t          <span class="hljs-keyword">WHERE</span> rank_s=N  );<span class="hljs-keyword">END</span></code></pre><ol start="178"><li></li></ol><p>编写一个 SQL 查询来实现分数排名。</p><p>如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。</p><p>±—±------+<br />| Id | Score |<br />±—±------+<br />| 1  | 3.50  |<br />| 2  | 3.65  |<br />| 3  | 4.00  |<br />| 4  | 3.85  |<br />| 5  | 4.00  |<br />| 6  | 3.65  |<br />±—±------+<br />例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：</p><p>±------±-----+<br />| Score | Rank |<br />±------±-----+<br />| 4.00  | 1    |<br />| 4.00  | 1    |<br />| 3.85  | 2    |<br />| 3.65  | 3    |<br />| 3.65  | 3    |<br />| 3.50  | 4    |<br />±------±-----+<br />重要提示：对于 MySQL 解决方案，如果要转义用作列名的保留字，可以在关键字之前和之后使用撇号。例如 <code>Rank</code></p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> Score,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Score  <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Rank'</span><span class="hljs-keyword">FROM</span> Scores;</code></pre><p>180.❗</p><p>编写一个 SQL 查询，查找所有至少连续出现三次的数字。</p><p>±—±----+<br />| Id | Num |<br />±—±----+<br />| 1  |  1  |<br />| 2  |  1  |<br />| 3  |  1  |<br />| 4  |  2  |<br />| 5  |  1  |<br />| 6  |  2  |<br />| 7  |  2  |<br />±—±----+<br />例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。</p><p>±----------------+<br />| ConsecutiveNums |<br />±----------------+<br />| 1               |<br />±----------------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> l1.num ConsecutiveNums <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">logs</span> l1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">logs</span> l2<span class="hljs-keyword">ON</span> l1.Num=l2.Num <span class="hljs-keyword">AND</span> l1.Id-l2.Id <span class="hljs-keyword">between</span> <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-number">2</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> l1.id<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(l2.id)&gt;<span class="hljs-number">2</span>;</code></pre><pre class="highlight"><code class="mssql">SELECT DISTINCT l1.num ConsecutiveNums FROM logs l1 INNER JOIN logs l2ON l1.Num=l2.Num GROUP BY l1.idHAVING SUM(l1.id-l2.id BETWEEN 0 AND 2)&gt;2;</code></pre><ol start="181"><li></li></ol><p>Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。</p><p>±—±------±-------±----------+<br />| Id | Name  | Salary | ManagerId |<br />±—±------±-------±----------+<br />| 1  | Joe   | 70000  | 3         |<br />| 2  | Henry | 80000  | 4         |<br />| 3  | Sam   | 60000  | NULL      |<br />| 4  | Max   | 90000  | NULL      |<br />±—±------±-------±----------+<br />给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。在上面的表格中，Joe 是唯一一个收入超过他的经理的员工。</p><p>±---------+<br />| Employee |<br />±---------+<br />| Joe      |<br />±---------+</p><pre class="highlight"><code class="mysql">SELECT e1.name EmployeeFROM Employee e1 INNER JOIN Employee e2 ON e1.ManagerId=e2.IdWHERE e1.Salary&gt;e2.Salary;</code></pre><ol start="182"><li></li></ol><p>写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</p><p>示例：</p><p>±—±--------+<br />| Id | Email   |<br />±—±--------+<br />| 1  | <a href="mailto:a@b.com">a@b.com</a> |<br />| 2  | <a href="mailto:c@d.com">c@d.com</a> |<br />| 3  | <a href="mailto:a@b.com">a@b.com</a> |<br />±—±--------+<br />根据以上输入，你的查询应返回以下结果：</p><p>±--------+<br />| Email   |<br />±--------+<br />| <a href="mailto:a@b.com">a@b.com</a> |<br />±--------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> Email<span class="hljs-keyword">FROM</span> Person<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Email<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(Email)&gt;<span class="hljs-number">1</span></code></pre><p>下面这个倒是用来判断重复的好办法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span>(p1.Email) <span class="hljs-keyword">from</span> Person p1 <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> Person p2 <span class="hljs-keyword">on</span> p1.Email = p2.Email <span class="hljs-keyword">and</span> p1.Id != p2.Id;</code></pre><ol start="183"><li></li></ol><p>某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。</p><p>Customers 表：</p><p>±—±------+<br />| Id | Name  |<br />±—±------+<br />| 1  | Joe   |<br />| 2  | Henry |<br />| 3  | Sam   |<br />| 4  | Max   |<br />±—±------+<br />Orders 表：</p><p>±—±-----------+<br />| Id | CustomerId |<br />±—±-----------+<br />| 1  | 3          |<br />| 2  | 1          |<br />±—±-----------+<br />例如给定上述表格，你的查询应返回：</p><p>±----------+<br />| Customers |<br />±----------+<br />| Henry     |<br />| Max       |<br />±----------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> Customers<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">WHERE</span> Customers.Id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> CustomerId  <span class="hljs-keyword">FROM</span> Orders);</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> c.Name Customers<span class="hljs-keyword">FROM</span> Customers c <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Orders O<span class="hljs-keyword">ON</span> c.Id=o.CustomerId<span class="hljs-keyword">WHERE</span> o.ID <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span></code></pre><ol start="184"><li></li></ol><p>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。</p><p>±—±------±-------±-------------+<br />| Id | Name  | Salary | DepartmentId |<br />±—±------±-------±-------------+<br />| 1  | Joe   | 70000  | 1            |<br />| 2  | Jim   | 90000  | 1            |<br />| 3  | Henry | 80000  | 2            |<br />| 4  | Sam   | 60000  | 2            |<br />| 5  | Max   | 90000  | 1            |<br />±—±------±-------±-------------+<br />Department 表包含公司所有部门的信息。</p><p>±—±---------+<br />| Id | Name     |<br />±—±---------+<br />| 1  | IT       |<br />| 2  | Sales    |<br />±—±---------+<br />编写一个 SQL 查询，找出每个部门工资最高的员工。对于上述表，您的 SQL 查询应返回以下行（行的顺序无关紧要）。</p><p>±-----------±---------±-------+<br />| Department | Employee | Salary |<br />±-----------±---------±-------+<br />| IT         | Max      | 90000  |<br />| IT         | Jim      | 90000  |<br />| Sales      | Henry    | 80000  |<br />±-----------±---------±-------+</p><pre class="highlight"><code class="sql"><span class="hljs-comment">#DENSE_RANK() PARTITION BY 完美结合</span><span class="hljs-keyword">SELECT</span> Department,Employee,Salary <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> e.Name Employee,e.Salary Salary,d.Name Department,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.DepartmentId <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> s_rank<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Department d<span class="hljs-keyword">ON</span> e.DepartmentId=d.Id) t<span class="hljs-keyword">WHERE</span> t.s_rank=<span class="hljs-number">1</span>;</code></pre><p>以后对于这种<strong>group by 后有字段不能取出来的，用这种方法 IN</strong>,或者是group by后需要当作条件的</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> d.Name Department,e.Name Employee,Salary<span class="hljs-keyword">from</span>  Employee e<span class="hljs-keyword">join</span> Department d <span class="hljs-keyword">on</span> e.DepartmentId=d.Id<span class="hljs-keyword">where</span>(e.DepartmentId , Salary) <span class="hljs-keyword">IN</span>(    <span class="hljs-keyword">select</span> DepartmentId, <span class="hljs-keyword">max</span>(salary)    <span class="hljs-keyword">from</span> Employee    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> DepartmentId);</code></pre><ol start="185"><li></li></ol><p>Employee 表包含所有员工信息，每个员工有其对应的工号 Id，姓名 Name，工资 Salary 和部门编号 DepartmentId 。</p><p>±—±------±-------±-------------+<br />| Id | Name  | Salary | DepartmentId |<br />±—±------±-------±-------------+<br />| 1  | Joe   | 85000  | 1            |<br />| 2  | Henry | 80000  | 2            |<br />| 3  | Sam   | 60000  | 2            |<br />| 4  | Max   | 90000  | 1            |<br />| 5  | Janet | 69000  | 1            |<br />| 6  | Randy | 85000  | 1            |<br />| 7  | Will  | 70000  | 1            |<br />±—±------±-------±-------------+<br />Department 表包含公司所有部门的信息。</p><p>±—±---------+<br />| Id | Name     |<br />±—±---------+<br />| 1  | IT       |<br />| 2  | Sales    |<br />±—±---------+<br />编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：</p><p>±-----------±---------±-------+<br />| Department | Employee | Salary |<br />±-----------±---------±-------+<br />| IT         | Max      | 90000  |<br />| IT         | Randy    | 85000  |<br />| IT         | Joe      | 85000  |<br />| IT         | Will     | 70000  |<br />| Sales      | Henry    | 80000  |<br />| Sales      | Sam      | 60000  |<br />±-----------±---------±-------+</p><pre class="highlight"><code class="sql"><span class="hljs-comment">#PARTITION BY 真好用</span><span class="hljs-keyword">SELECT</span> Department,Employee,Salary <span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> d.Name Department,e.Name Employee,e.Salary Salary,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.DepartmentId <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> e.Salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> s_rank<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Department d<span class="hljs-keyword">ON</span> e.DepartmentId=d.Id) t<span class="hljs-keyword">WHERE</span> t.s_rank&lt;=<span class="hljs-number">3</span>;</code></pre><p>自连接解法，这种通过自连接判断排名，一定要记得使用distinct</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> d.Name <span class="hljs-keyword">as</span> Department,e.Name <span class="hljs-keyword">as</span> Employee,e.Salary <span class="hljs-keyword">as</span> Salary<span class="hljs-keyword">from</span> Employee <span class="hljs-keyword">as</span> e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Department <span class="hljs-keyword">as</span> d <span class="hljs-keyword">on</span> e.DepartmentId = d.Id<span class="hljs-keyword">where</span> e.Id <span class="hljs-keyword">in</span>(    <span class="hljs-keyword">select</span> e1.Id    <span class="hljs-keyword">from</span> Employee <span class="hljs-keyword">as</span> e1 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Employee <span class="hljs-keyword">as</span> e2    <span class="hljs-keyword">on</span> e1.DepartmentId = e2.DepartmentId <span class="hljs-keyword">and</span> e1.Salary &lt; e2.Salary    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> e1.Id    <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span> e2.Salary) &lt;= <span class="hljs-number">2</span>)<span class="hljs-keyword">and</span> e.DepartmentId <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">from</span> Department)<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> d.Id <span class="hljs-keyword">asc</span>,e.Salary <span class="hljs-keyword">desc</span></code></pre><ol start="196"><li></li></ol><p>编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。</p><p>±—±-----------------+<br />| Id | Email            |<br />±—±-----------------+<br />| 1  | <a href="mailto:john@example.com">john@example.com</a> |<br />| 2  | <a href="mailto:bob@example.com">bob@example.com</a>  |<br />| 3  | <a href="mailto:john@example.com">john@example.com</a> |<br />±—±-----------------+<br />Id 是这个表的主键。<br />例如，在运行你的查询语句之后，上面的 Person 表应返回以下几行:</p><p>±—±-----------------+<br />| Id | Email            |<br />±—±-----------------+<br />| 1  | <a href="mailto:john@example.com">john@example.com</a> |<br />| 2  | <a href="mailto:bob@example.com">bob@example.com</a>  |<br />±—±-----------------+</p><pre class="highlight"><code class="sql"><span class="hljs-comment">#mysql删除时，先缓存再删除</span><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> Person<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">Id</span>) <span class="hljs-keyword">Id</span> <span class="hljs-keyword">FROM</span> Person <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Email) t)</code></pre><p>这种理解也很好</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">delete</span> p1<span class="hljs-keyword">from</span> person p1 <span class="hljs-keyword">join</span> person p2<span class="hljs-keyword">on</span> p1.email=p2.email <span class="hljs-keyword">and</span> p1.id&gt;p2.id</code></pre><ol start="197"><li></li></ol><p>表 Weather</p><p>±--------------±--------+<br />| Column Name   | Type    |<br />±--------------±--------+<br />| id            | int     |<br />| recordDate    | date    |<br />| temperature   | int     |<br />±--------------±--------+<br />id 是这个表的主键<br />该表包含特定日期的温度信息</p><p>编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 id 。</p><p>返回结果 不要求顺序 。</p><p>查询结果格式如下例：</p><p>Weather<br />±—±-----------±------------+<br />| id | recordDate | Temperature |<br />±—±-----------±------------+<br />| 1  | 2015-01-01 | 10          |<br />| 2  | 2015-01-02 | 25          |<br />| 3  | 2015-01-03 | 20          |<br />| 4  | 2015-01-04 | 30          |<br />±—±-----------±------------+</p><p>Result table:<br />±—+<br />| id |<br />±—+<br />| 2  |<br />| 4  |<br />±—+<br />2015-01-02 的温度比前一天高（10 -&gt; 25）<br />2015-01-04 的温度比前一天高（20 -&gt; 30）</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>); <span class="hljs-comment">-- add 1 day</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">hour</span>); <span class="hljs-comment">-- add 1 hour</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">minute</span>); <span class="hljs-comment">-- ...</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">second</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">microsecond</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">week</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">month</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">quarter</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_add</span>(@dt, <span class="hljs-built_in">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">year</span>);<span class="hljs-keyword">select</span> <span class="hljs-keyword">date_sub</span>(<span class="hljs-string">'1998-01-01 00:00:00'</span>, <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 1:1:1'</span> day_second);MySQL datediff(date1,date2)：两个日期相减 date1 - date2，返回天数。<span class="hljs-keyword">select</span> <span class="hljs-keyword">datediff</span>(<span class="hljs-string">'2008-08-08'</span>, <span class="hljs-string">'2008-08-01'</span>); <span class="hljs-comment">-- 7</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">datediff</span>(<span class="hljs-string">'2008-08-01'</span>, <span class="hljs-string">'2008-08-08'</span>); <span class="hljs-comment">-- -7</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08/09/2008'</span>, <span class="hljs-string">'%m/%d/%Y'</span>); <span class="hljs-comment">-- 2008-08-09</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08/09/08'</span> , <span class="hljs-string">'%m/%d/%y'</span>); <span class="hljs-comment">-- 2008-08-09</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08.09.2008'</span>, <span class="hljs-string">'%m.%d.%Y'</span>); <span class="hljs-comment">-- 2008-08-09</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08:09:30'</span>, <span class="hljs-string">'%h:%i:%s'</span>); <span class="hljs-comment">-- 08:09:30</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">str_to_date</span>(<span class="hljs-string">'08.09.2008 08:09:30'</span>, <span class="hljs-string">'%m.%d.%Y %h:%i:%s'</span>); <span class="hljs-comment">-- 2008-08-09 08:09:30</span></code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a.id<span class="hljs-keyword">FROM</span> Weather a <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Weather b<span class="hljs-keyword">ON</span> a.recordDate=<span class="hljs-keyword">DATE_ADD</span>(b.recordDate,<span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>)<span class="hljs-keyword">WHERE</span> a.temperature&gt;b.temperature;</code></pre><ol start="262"><li></li></ol><p>Trips 表中存所有出租车的行程信息。每段行程有唯一键 Id，Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。Status 是枚举类型，枚举成员为 (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。</p><p>±—±----------±----------±--------±-------------------±---------+<br />| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|<br />±—±----------±----------±--------±-------------------±---------+<br />| 1  |     1     |    10     |    1    |     completed      |2013-10-01|<br />| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|<br />| 3  |     3     |    12     |    6    |     completed      |2013-10-01|<br />| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|<br />| 5  |     1     |    10     |    1    |     completed      |2013-10-02|<br />| 6  |     2     |    11     |    6    |     completed      |2013-10-02|<br />| 7  |     3     |    12     |    6    |     completed      |2013-10-02|<br />| 8  |     2     |    12     |    12   |     completed      |2013-10-03|<br />| 9  |     3     |    10     |    12   |     completed      |2013-10-03|<br />| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|<br />±—±----------±----------±--------±-------------------±---------+<br />Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。</p><p>±---------±-------±-------+<br />| Users_Id | Banned |  Role  |<br />±---------±-------±-------+<br />|    1     |   No   | client |<br />|    2     |   Yes  | client |<br />|    3     |   No   | client |<br />|    4     |   No   | client |<br />|    10    |   No   | driver |<br />|    11    |   No   | driver |<br />|    12    |   No   | driver |<br />|    13    |   No   | driver |<br />±---------±-------±-------+<br />写一段 SQL 语句查出 2013年10月1日 至 2013年10月3日 期间非禁止用户的取消率。基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。</p><p>取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)</p><p>±-----------±------------------+<br />|     Day    | Cancellation Rate |<br />±-----------±------------------+<br />| 2013-10-01 |       0.33        |<br />| 2013-10-02 |       0.00        |<br />| 2013-10-03 |       0.50        |<br />±-----------±------------------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t.Request_at <span class="hljs-string">'Day'</span>,<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">IF</span>(t.Status=<span class="hljs-string">'completed'</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))/<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-number">2</span>) <span class="hljs-string">'Cancellation Rate'</span> <span class="hljs-keyword">FROM</span> Trips t <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">Users</span> u <span class="hljs-keyword">ON</span> t.Client_id=u.Users_Id <span class="hljs-keyword">AND</span> u.Banned=<span class="hljs-string">'No'</span><span class="hljs-keyword">WHERE</span> t.Request_at <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2013-10-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2013-10-03'</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t.Request_at</code></pre><ol start="511"><li></li></ol><p>活动表 Activity：</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| player_id    | int     |<br />| device_id    | int     |<br />| event_date   | date    |<br />| games_played | int     |<br />±-------------±--------+<br />表的主键是 (player_id, event_date)。<br />这张表展示了一些游戏玩家在游戏平台上的行为活动。<br />每行数据记录了一名玩家在退出平台之前，当天使用同一台设备登录平台后打开的游戏的数目（可能是 0 个）。</p><p>写一条 SQL 查询语句获取每位玩家 第一次登陆平台的日期。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date) first_login<span class="hljs-keyword">FROM</span> Activity<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> player_id,<span class="hljs-keyword">min</span>(event_date) <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> player_id) <span class="hljs-keyword">as</span> first_login<span class="hljs-keyword">from</span> Activity</code></pre><ol start="512"><li></li></ol><p>Table: Activity</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| player_id    | int     |<br />| device_id    | int     |<br />| event_date   | date    |<br />| games_played | int     |<br />±-------------±--------+<br />(player_id, event_date) 是这个表的两个主键<br />这个表显示的是某些游戏玩家的游戏活动情况<br />每一行是在某天使用某个设备登出之前登录并玩多个游戏（可能为0）的玩家的记录<br />请编写一个 SQL 查询，描述每一个玩家首次登陆的设备名称</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a.player_id,a.device_id<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date) min_date<span class="hljs-keyword">FROM</span> Activity <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id) t <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity a<span class="hljs-keyword">ON</span> t.player_id=a.player_id <span class="hljs-keyword">AND</span> t.min_date=a.event_date</code></pre><p>这种联合查询的写法注意点</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,device_id<span class="hljs-keyword">FROM</span> activity<span class="hljs-keyword">WHERE</span> (player_id,event_date) <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date)<span class="hljs-keyword">FROM</span> activity<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id)</code></pre><ol start="534"><li></li></ol><p>Table: Activity</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| player_id    | int     |<br />| device_id    | int     |<br />| event_date   | date    |<br />| games_played | int     |<br />±-------------±--------+<br />（player_id，event_date）是此表的主键。<br />这张表显示了某些游戏的玩家的活动情况。<br />每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0 ）。</p><p>编写一个 SQL 查询，同时报告每组玩家和日期，以及玩家到目前为止玩了多少游戏。也就是说，在此日期之前玩家所玩的游戏总数。详细情况请查看示例。</p><p>棒棒棒，自己写出来了</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> a1.player_id,a1.event_date,<span class="hljs-keyword">SUM</span>(a2.games_played) games_played_so_far<span class="hljs-keyword">FROM</span> Activity a1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity a2<span class="hljs-keyword">ON</span> a1.player_id=a2.player_id <span class="hljs-keyword">AND</span> a1.event_date&gt;=a2.event_date<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> a1.player_id,a1.event_date</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> player_id,event_date,<span class="hljs-keyword">SUM</span>(games_played) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> player_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> event_date <span class="hljs-keyword">ASC</span>) games_played_so_far <span class="hljs-keyword">FROM</span> Activity；</code></pre><ol start="550"><li></li></ol><p>Table: Activity</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| player_id    | int     |<br />| device_id    | int     |<br />| event_date   | date    |<br />| games_played | int     |<br />±-------------±--------+<br />（player_id，event_date）是此表的主键。<br />这张表显示了某些游戏的玩家的活动情况。<br />每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0）。</p><p>编写一个 SQL 查询，报告在首次登录的第二天再次登录的玩家的比率，四舍五入到小数点后两位。换句话说，您需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p><p>自己写的说实话有点烂</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> t1.player_id)/(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> t3.player_id) <span class="hljs-keyword">FROM</span> Activity t3),<span class="hljs-number">2</span>) fraction<span class="hljs-keyword">FROM</span>Activity t1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Activity t2<span class="hljs-keyword">ON</span> t1.player_id=t2.player_id <span class="hljs-keyword">AND</span> <span class="hljs-keyword">DATE_ADD</span>(t1.event_date,<span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>)=t2.event_date<span class="hljs-keyword">WHERE</span> (t1.player_id,t1.event_date) <span class="hljs-keyword">IN</span>(    <span class="hljs-keyword">SELECT</span> player_id,<span class="hljs-keyword">MIN</span>(event_date)    <span class="hljs-keyword">FROM</span> Activity    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id)</code></pre><p>这个就很强，用最下日期+1，省去判断连续日期，首次登录连续日期，可以用MIN求出首次日期，再+1就是次日日期，判断palyer_id，加过后的日期在不在即可计数。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span><span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> player_id)/(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">distinct</span> player_id) <span class="hljs-keyword">FROM</span> Activity), <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> fraction<span class="hljs-keyword">FROM</span>    Activity<span class="hljs-keyword">WHERE</span>(player_id,event_date)<span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span>         player_id,        <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">min</span>(event_date)+<span class="hljs-number">1</span>)<span class="hljs-keyword">FROM</span> Activity<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> player_id);</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">round</span>(<span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span>(b.player_id))/(<span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(<span class="hljs-keyword">distinct</span>(player_id)) <span class="hljs-keyword">from</span> activity),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> fraction<span class="hljs-keyword">from</span> activity b<span class="hljs-keyword">join</span>(<span class="hljs-keyword">select</span> player_id,<span class="hljs-keyword">min</span>(event_date), <span class="hljs-keyword">min</span>(event_date)+<span class="hljs-number">1</span> <span class="hljs-keyword">as</span> date_2nd<span class="hljs-keyword">from</span> activity<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> ) a<span class="hljs-keyword">on</span> b.event_date = a.date_2nd <span class="hljs-keyword">and</span> b.player_id = a.player_id</code></pre><ol start="569"><li></li></ol><p>Employee 表包含所有员工。Employee 表有三列：员工Id，公司名和薪水。</p><p>±----±-----------±-------+<br />|Id   | Company    | Salary |<br />±----±-----------±-------+<br />|1    | A          | 2341   |<br />|2    | A          | 341    |<br />|3    | A          | 15     |<br />|4    | A          | 15314  |<br />|5    | A          | 451    |<br />|6    | A          | 513    |<br />|7    | B          | 15     |<br />|8    | B          | 13     |<br />|9    | B          | 1154   |<br />|10   | B          | 1345   |<br />|11   | B          | 1221   |<br />|12   | B          | 234    |<br />|13   | C          | 2345   |<br />|14   | C          | 2645   |<br />|15   | C          | 2645   |<br />|16   | C          | 2652   |<br />|17   | C          | 65     |<br />±----±-----------±-------+<br />请编写SQL查询来查找每个公司的薪水中位数。挑战点：你是否可以在不使用任何内置的SQL函数的情况下解决此问题。</p><p>求中位数的思路，先对各组数据进行排序，同时求出各组数据总数，然后再判断排名在总数/2与总数/2+1之间。</p><pre class="highlight"><code class="sql"></code></pre><ol start="570"><li></li></ol><p>Employee 表包含所有员工和他们的经理。每个员工都有一个 Id，并且还有一列是经理的 Id。</p><p>±-----±---------±----------±---------+<br />|Id    |Name   |Department |ManagerId |<br />±-----±---------±----------±---------+<br />|101   |John   |A       |null      |<br />|102   |Dan   |A       |101       |<br />|103   |James   |A       |101       |<br />|104   |Amy   |A       |101       |<br />|105   |Anne   |A       |101       |<br />|106   |Ron   |B       |101       |<br />±-----±---------±----------±---------+<br />给定 Employee 表，请编写一个SQL查询来查找至少有5名直接下属的经理。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> <span class="hljs-keyword">FROM</span> Employee<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> ManagerId<span class="hljs-keyword">FROM</span> Employee<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> ManagerId<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*)&gt;=<span class="hljs-number">5</span>)</code></pre><ol start="571"><li></li></ol><p>Numbers 表保存数字的值及其频率。</p><p>±---------±------------+<br />|  Number  |  Frequency  |<br />±---------±------------|<br />|  0       |  7          |<br />|  1       |  1          |<br />|  2       |  3          |<br />|  3       |  1          |<br />±---------±------------+<br />在此表中，数字为 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3，所以中位数是 (0 + 0) / 2 = 0。</p><p>±-------+<br />| median |<br />±-------|<br />| 0.0000 |<br />±-------+<br />请编写一个查询来查找所有数字的中位数并将结果命名为 median 。</p><p>新增两列，将从后往前和从前往后的频数相加，两个数都需要大于等于总数一半，再取平均</p><h3 id="错误答案"><a class="markdownIt-Anchor" href="#错误答案"></a> <strong>错误答案</strong></h3><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(T.num) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">median</span><span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span>  n1.Number <span class="hljs-keyword">num</span>,<span class="hljs-keyword">Sum</span>(n2.Frequency) <span class="hljs-keyword">as</span> f_sum<span class="hljs-keyword">FROM</span> Numbers n1 <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Numbers n2<span class="hljs-keyword">on</span> n1.Number&gt;=n2.Number<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> n1.Number<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> n1.Number <span class="hljs-keyword">ASC</span>) T<span class="hljs-keyword">WHERE</span> T.f_sum <span class="hljs-keyword">BETWEEN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(Frequency)/<span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> Numbers) <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(Frequency)/<span class="hljs-number">2</span>+<span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> Numbers)</code></pre><ol start="574"><li></li></ol><p>表: Candidate</p><p>±----±--------+<br />| id  | Name    |<br />±----±--------+<br />| 1   | A       |<br />| 2   | B       |<br />| 3   | C       |<br />| 4   | D       |<br />| 5   | E       |<br />±----±--------+<br />表: Vote</p><p>±----±-------------+<br />| id  | CandidateId  |<br />±----±-------------+<br />| 1   |     2        |<br />| 2   |     4        |<br />| 3   |     3        |<br />| 4   |     2        |<br />| 5   |     5        |<br />±----±-------------+<br />id 是自动递增的主键，<br />CandidateId 是 Candidate 表中的 id.<br />请编写 sql 语句来找到当选者的名字，上面的例子将返回当选者 B.</p><pre class="highlight"><code class="sql"><span class="hljs-comment">#group by key order by count(key)</span><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Name</span> <span class="hljs-keyword">FROM</span> Candidate <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=(<span class="hljs-keyword">SELECT</span> CandidateId <span class="hljs-keyword">FROM</span> Vote<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> CandidateId<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(CandidateId) <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>);</code></pre><ol start="577"><li></li></ol><p>选出所有 bonus &lt; 1000 的员工的 name 及其 bonus。</p><p>Employee 表单</p><p>±------±-------±----------±-------+<br />| empId |  name  | supervisor| salary |<br />±------±-------±----------±-------+<br />|   1   | John   |  3        | 1000   |<br />|   2   | Dan    |  3        | 2000   |<br />|   3   | Brad   |  null     | 4000   |<br />|   4   | Thomas |  3        | 4000   |<br />±------±-------±----------±-------+<br />empId 是这张表单的主关键字<br />Bonus 表单</p><p>±------±------+<br />| empId | bonus |<br />±------±------+<br />| 2     | 500   |<br />| 4     | 2000  |<br />±------±------+<br />empId 是这张表单的主关键字</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> e.name <span class="hljs-keyword">name</span>,b.bonus bonus<span class="hljs-keyword">FROM</span> Employee e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> Bonus b <span class="hljs-keyword">ON</span> e.empId=b.empId<span class="hljs-keyword">WHERE</span> b.bonus&lt;<span class="hljs-number">1000</span> <span class="hljs-keyword">or</span> b.bonus <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;</code></pre><ol start="578"><li></li></ol><p>从 survey_log 表中获得回答率最高的问题，survey_log 表包含这些列：id, action, question_id, answer_id, q_num, timestamp。</p><p>id 表示用户 id；action 有以下几种值：“show”，“answer”，“skip”；当 action 值为 “answer” 时 answer_id 非空，而 action 值为 “show” 或者 “skip” 时 answer_id 为空；q_num 表示当前会话中问题的编号。</p><p>请编写 SQL 查询来找到具有最高回答率的问题。</p><p>这种group by 后又要取最值的问题，记得 order by 然后 limit 1</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t.question_id survey_log<span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> question_id,<span class="hljs-keyword">COUNT</span>(answer_id) <span class="hljs-keyword">num</span><span class="hljs-keyword">FROM</span> survey_log<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> question_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;</code></pre><p>这中group by后order by count的写法</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> question_id survey_log <span class="hljs-keyword">FROM</span> survey_log <span class="hljs-keyword">WHERE</span> answer_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> question_id<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(answer_id) <span class="hljs-keyword">DESC</span><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;</code></pre><ol start="579"><li></li></ol><p>请你编写 SQL 语句，对于每个员工，查询他除最近一个月（即最大月）之外，剩下每个月的近三个月的累计薪水（不足三个月也要计算）。</p><p>结果请按 Id 升序，然后按 Month 降序显示。</p><p>示例：<br />输入：</p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>20</td></tr><tr><td>2</td><td>1</td><td>20</td></tr><tr><td>1</td><td>2</td><td>30</td></tr><tr><td>2</td><td>2</td><td>30</td></tr><tr><td>3</td><td>2</td><td>40</td></tr><tr><td>1</td><td>3</td><td>40</td></tr><tr><td>3</td><td>3</td><td>60</td></tr><tr><td>1</td><td>4</td><td>60</td></tr><tr><td>3</td><td>4</td><td>70</td></tr></tbody></table><p>rows 2 preceding:将当前行和它前面的两行划为一个窗口，因此sum函数就作 用在这三行上面</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">Month</span> <span class="hljs-keyword">month</span>,<span class="hljs-keyword">SUM</span>(Salary) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Month</span> <span class="hljs-keyword">ASC</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-number">2</span> <span class="hljs-keyword">PRECEDING</span>) Salary<span class="hljs-keyword">FROM</span> Employee<span class="hljs-keyword">WHERE</span> (<span class="hljs-keyword">Id</span>,<span class="hljs-keyword">Month</span>)<span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>,<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">Month</span>)<span class="hljs-keyword">FROM</span> Employee<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span>)<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span> <span class="hljs-keyword">ASC</span>,<span class="hljs-keyword">Month</span> <span class="hljs-keyword">DESC</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>  a.Id <span class="hljs-keyword">AS</span> <span class="hljs-keyword">id</span>, a.Month <span class="hljs-keyword">AS</span> <span class="hljs-keyword">month</span>,<span class="hljs-keyword">SUM</span>(b.Salary) <span class="hljs-keyword">AS</span> Salary<span class="hljs-keyword">FROM</span>  Employee a, Employee b<span class="hljs-keyword">WHERE</span> a.Id = b.Id <span class="hljs-keyword">AND</span> a.Month &gt;= b.Month<span class="hljs-keyword">AND</span> a.Month &lt; b.Month+<span class="hljs-number">3</span> <span class="hljs-comment">#这个限制在3个月内</span><span class="hljs-keyword">AND</span> (a.Id, a.Month) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">Id</span>, <span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">Month</span>) <span class="hljs-keyword">FROM</span> Employee <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">Id</span>)<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> a.Id, a.Month<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.Id, a.Month <span class="hljs-keyword">DESC</span></code></pre><ol start="580"><li></li></ol><p>一所大学有 2 个数据表，分别是 student 和 department ，这两个表保存着每个专业的学生数据和院系数据。</p><p>写一个查询语句，查询 department 表中每个专业的学生人数 （即使没有学生的专业也需列出）。</p><p>将你的查询结果按照学生人数降序排列。 如果有两个或两个以上专业有相同的学生数目，将这些部门按照部门名字的字典序从小到大排列。</p><p>student 表格如下：</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>student_id</td><td>Integer</td></tr><tr><td>student_name</td><td>String</td></tr><tr><td>gender</td><td>Character</td></tr><tr><td>dept_id</td><td>Integer</td></tr></tbody></table><p>其中， student_id 是学生的学号， student_name 是学生的姓名， gender 是学生的性别， dept_id 是学生所属专业的专业编号。</p><p>department 表格如下：</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>dept_id</td><td>Integer</td></tr><tr><td>dept_name</td><td>String</td></tr></tbody></table><p>dept_id 是专业编号， dept_name 是专业名字。</p><p>区分count(*）和count(s.student_id)区别 前一个是有多少条不考虑值 后一个只算s.student_id这一列的值不会计算null</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> d.dept_name,<span class="hljs-keyword">COUNT</span>(s.student_id) student_number<span class="hljs-keyword">FROM</span> department d <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> student s<span class="hljs-keyword">ON</span> d.dept_id=s.dept_id<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.dept_name<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> student_number <span class="hljs-keyword">DESC</span>,d.dept_name <span class="hljs-keyword">ASC</span>;</code></pre><ol start="584"><li></li></ol><p>给定表 customer ，里面保存了所有客户信息和他们的推荐人。</p><p>±-----±-----±----------+<br />| id   | name | referee_id|<br />±-----±-----±----------+<br />|    1 | Will |      NULL |<br />|    2 | Jane |      NULL |<br />|    3 | Alex |         2 |<br />|    4 | Bill |      NULL |<br />|    5 | Zack |         1 |<br />|    6 | Mark |         2 |<br />±-----±-----±----------+<br />写一个查询语句，返回一个编号列表，列表中编号的推荐人的编号都 不是 2。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> customer <span class="hljs-keyword">where</span><span class="hljs-keyword">ifnull</span>(referee_id,<span class="hljs-number">0</span>)!=<span class="hljs-number">2</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> customer<span class="hljs-keyword">WHERE</span> referee_id!=<span class="hljs-number">2</span> <span class="hljs-keyword">OR</span> referee_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span></code></pre><ol start="585"><li></li></ol><p>写一个查询语句，将 2016 年 (TIV_2016) 所有成功投资的金额加起来，保留 2 位小数。</p><p>对于一个投保人，他在 2016 年成功投资的条件是：</p><p>他在 2015 年的投保额 (TIV_2015) 至少跟一个其他投保人在 2015 年的投保额相同。<br />他所在的城市必须与其他投保人都不同（也就是说维度和经度不能跟其他任何一个投保人完全相同）。<br />输入格式:<br />表 insurance 格式如下：</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>PID</td><td>INTEGER(11)</td></tr><tr><td>TIV_2015</td><td>NUMERIC(15,2)</td></tr><tr><td>TIV_2016</td><td>NUMERIC(15,2)</td></tr><tr><td>LAT</td><td>NUMERIC(5,2)</td></tr><tr><td>LON</td><td>NUMERIC(5,2)</td></tr></tbody></table><p>PID 字段是投保人的投保编号， TIV_2015 是该投保人在2015年的总投保金额， TIV_2016 是该投保人在2016年的投保金额， LAT 是投保人所在城市的维度， LON 是投保人所在城市的经度。</p><pre class="highlight"><code class="sql"></code></pre><ol start="586"><li></li></ol><p>在表 orders 中找到订单数最多客户对应的 customer_number 。</p><p>数据保证订单数最多的顾客恰好只有一位。</p><p>表 orders 定义如下：</p><table><thead><tr><th>Column</th><th>Type</th></tr></thead><tbody><tr><td>order_number (PK)</td><td>int</td></tr><tr><td>customer_number</td><td>int</td></tr><tr><td>order_date</td><td>date</td></tr><tr><td>required_date</td><td>date</td></tr><tr><td>shipped_date</td><td>date</td></tr><tr><td>status</td><td>char(15)</td></tr><tr><td>comment</td><td>char(200)</td></tr></tbody></table><p>题目没看懂</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> customer_number<span class="hljs-keyword">FROM</span> orders<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_number<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">COUNT</span>(order_number) <span class="hljs-keyword">DESC</span><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> customer_number<span class="hljs-keyword">from</span> orders<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_number<span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(order_number)&gt;=<span class="hljs-keyword">all</span>(    <span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(order_number)    <span class="hljs-keyword">from</span> orders    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_number)</code></pre><ol start="595"><li></li></ol><p>这里有张 World 表</p><p>±----------------±-----------±-----------±-------------±--------------+<br />| name            | continent  | area       | population   | gdp           |<br />±----------------±-----------±-----------±-------------±--------------+<br />| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |<br />| Albania         | Europe     | 28748      | 2831741      | 12960000      |<br />| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |<br />| Andorra         | Europe     | 468        | 78115        | 3712000       |<br />| Angola          | Africa     | 1246700    | 20609294     | 100990000     |<br />±----------------±-----------±-----------±-------------±--------------+<br />如果一个国家的面积超过 300 万平方公里，或者人口超过 2500 万，那么这个国家就是大国家。</p><p>编写一个 SQL 查询，输出表中所有大国家的名称、人口和面积。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> w.name,w.population,w.area<span class="hljs-keyword">FROM</span> World w<span class="hljs-keyword">WHERE</span> w.area&gt;<span class="hljs-number">3000000</span> <span class="hljs-keyword">OR</span> population&gt;<span class="hljs-number">25000000</span></code></pre><ol start="596"><li></li></ol><p>有一个courses 表 ，有: student (学生) 和 class (课程)。</p><p>请列出所有超过或等于5名学生的课。</p><p>例如，表：</p><p>±--------±-----------+<br />| student | class      |<br />±--------±-----------+<br />| A       | Math       |<br />| B       | English    |<br />| C       | Math       |<br />| D       | Biology    |<br />| E       | Math       |<br />| F       | Computer   |<br />| G       | Math       |<br />| H       | Math       |<br />| I       | Math       |<br />±--------±-----------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">class</span><span class="hljs-keyword">FROM</span> courses<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">class</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> student)&gt;=<span class="hljs-number">5</span></code></pre><ol start="597"><li></li></ol><p>在 Facebook 或者 Twitter 这样的社交应用中，人们经常会发好友申请也会收到其他人的好友申请。</p><p>表：FriendRequest</p><p>±---------------±--------+<br />| Column Name    | Type    |<br />±---------------±--------+<br />| sender_id      | int     |<br />| send_to_id     | int     |<br />| request_date   | date    |<br />±---------------±--------+<br />此表没有主键，它可能包含重复项。<br />该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求的日期。<br />表：RequestAccepted</p><p>±---------------±--------+<br />| Column Name    | Type    |<br />±---------------±--------+<br />| requester_id   | int     |<br />| accepter_id    | int     |<br />| accept_date    | date    |<br />±---------------±--------+<br />此表没有主键，它可能包含重复项。<br />该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求通过的日期。</p><p>写一个查询语句，求出好友申请的通过率，用 2 位小数表示。通过率由接受好友申请的数目除以申请总数。</p><p>提示：</p><p>通过的好友申请不一定都在表 friend_request 中。你只需要统计总的被通过的申请数（不管它们在不在表 FriendRequest 中），并将它除以申请总数，得到通过率<br />一个好友申请发送者有可能会给接受者发几条好友申请，也有可能一个好友申请会被通过好几次。这种情况下，重复的好友申请只统计一次。<br />如果一个好友申请都没有，通过率为 0.00 。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">IFNULL</span>((<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> requester_id,accepter_id)<span class="hljs-keyword">FROM</span> RequestAccepted)/(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> sender_id ,send_to_id )<span class="hljs-keyword">FROM</span> FriendRequest ),<span class="hljs-number">0</span>),<span class="hljs-number">2</span>) accept_rate</code></pre><ol start="601"><li></li></ol><p>表：Stadium<br />±--------------±--------+<br />| Column Name   | Type    |<br />±--------------±--------+<br />| id            | int     |<br />| visit_date    | date    |<br />| people        | int     |<br />±--------------±--------+<br />visit_date 是表的主键<br />每日人流量信息被记录在这三列信息中：序号 (id)、日期 (visit_date)、 人流量 (people)<br />每天只有一行记录，日期随着 id 的增加而增加</p><p>编写一个 SQL 查询以找出每行的人数大于或等于 100 且 id 连续的三行或更多行记录。</p><p>返回按 visit_date 升序排列的结果表。</p><pre class="highlight"><code class="sql"></code></pre><ol start="602"><li></li></ol><p>在 Facebook 或者 Twitter 这样的社交应用中，人们经常会发好友申请也会收到其他人的好友申请。</p><p>表 request_accepted 存储了所有好友申请通过的数据记录，其中， requester_id 和 accepter_id 都是用户的编号。</p><table><thead><tr><th>requester_id</th><th>accepter_id</th><th>accept_date</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>2016_06-03</td></tr><tr><td>1</td><td>3</td><td>2016-06-08</td></tr><tr><td>2</td><td>3</td><td>2016-06-08</td></tr><tr><td>3</td><td>4</td><td>2016-06-09</td></tr></tbody></table><p>写一个查询语句，求出谁拥有最多的好友和他拥有的好友数目。对于上面的样例数据，结果为：</p><table><thead><tr><th>id</th><th>num</th></tr></thead><tbody><tr><td>3</td><td>3</td></tr></tbody></table><p>注意：</p><p>保证拥有最多好友数目的只有 1 个人。<br />好友申请只会被接受一次，所以不会有 requester_id 和 accepter_id 值都相同的重复记录。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> ((<span class="hljs-keyword">SELECT</span> requester_id <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> request_accepted)<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>(<span class="hljs-keyword">SELECT</span> accepter_id <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> request_accepted)) sub<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>, <span class="hljs-keyword">sum</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">num</span><span class="hljs-keyword">from</span> ((<span class="hljs-keyword">select</span> requester_id <span class="hljs-keyword">id</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">num</span><span class="hljs-keyword">from</span> request_accepted<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> requester_id)<span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>(<span class="hljs-keyword">select</span> accepter_id <span class="hljs-keyword">id</span>, <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">num</span><span class="hljs-keyword">from</span> request_accepted<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> accepter_id)) t3<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">id</span><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">desc</span><span class="hljs-keyword">limit</span> <span class="hljs-number">1</span></code></pre><ol start="603"><li></li></ol><p>几个朋友来到电影院的售票处，准备预约连续空余座位。</p><p>你能利用表 cinema ，帮他们写一个查询语句，获取所有空余座位，并将它们按照 seat_id 排序后返回吗？</p><table><thead><tr><th>seat_id</th><th>free</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>0</td></tr><tr><td>3</td><td>1</td></tr><tr><td>4</td><td>1</td></tr><tr><td>5</td><td>1</td></tr></tbody></table><p>**连续值问题怎么处理?**首先是两张表自联结，然后两张表的顺序作差值等于1，取绝对值的话就不论前后了</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> a.seat_id <span class="hljs-keyword">FROM</span> cinema a <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> cinema b<span class="hljs-keyword">ON</span> <span class="hljs-keyword">abs</span>(b.seat_id-a.seat_id)=<span class="hljs-number">1</span><span class="hljs-keyword">WHERE</span> b.free=<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> a.free=<span class="hljs-number">1</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.seat_id <span class="hljs-keyword">ASC</span>;</code></pre><p>还有这种lag函数的用法,lag是提取之前的内容，lead是提取之后的内容</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> seat_id<span class="hljs-keyword">from</span> (    <span class="hljs-keyword">select</span>        seat_id ,        free ,        lag(free,<span class="hljs-number">1</span>,<span class="hljs-number">999</span>) <span class="hljs-keyword">over</span>() pre_free,        <span class="hljs-keyword">lead</span>(free,<span class="hljs-number">1</span>,<span class="hljs-number">999</span>) <span class="hljs-keyword">over</span>() next_free    <span class="hljs-keyword">from</span>  cinema)tmp<span class="hljs-keyword">where</span>  free=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (pre_free=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> next_free=<span class="hljs-number">1</span> )<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>  seat_id</code></pre><ol start="607"><li></li></ol><p>给定 3 个表： salesperson， company， orders。<br />输出所有表 salesperson 中，没有向公司 ‘RED’ 销售任何东西的销售员。</p><p>示例：<br />输入</p><p>表： salesperson</p><p>±---------±-----±-------±----------------±----------+<br />| sales_id | name | salary | commission_rate | hire_date |<br />±---------±-----±-------±----------------±----------+<br />|   1      | John | 100000 |     6           | 4/1/2006  |<br />|   2      | Amy  | 120000 |     5           | 5/1/2010  |<br />|   3      | Mark | 65000  |     12          | 12/25/2008|<br />|   4      | Pam  | 25000  |     25          | 1/1/2005  |<br />|   5      | Alex | 50000  |     10          | 2/3/2007  |<br />±---------±-----±-------±----------------±----------+<br />表 salesperson 存储了所有销售员的信息。每个销售员都有一个销售员编号 sales_id 和他的名字 name 。</p><p>表： company</p><p>±--------±-------±-----------+<br />| com_id  |  name  |    city    |<br />±--------±-------±-----------+<br />|   1     |  RED   |   Boston   |<br />|   2     | ORANGE |   New York |<br />|   3     | YELLOW |   Boston   |<br />|   4     | GREEN  |   Austin   |<br />±--------±-------±-----------+<br />表 company 存储了所有公司的信息。每个公司都有一个公司编号 com_id 和它的名字 name 。</p><p>表： orders</p><p>±---------±-----------±--------±---------±-------+<br />| order_id | order_date | com_id  | sales_id | amount |<br />±---------±-----------±--------±---------±-------+<br />| 1        |   1/1/2014 |    3    |    4     | 100000 |<br />| 2        |   2/1/2014 |    4    |    5     | 5000   |<br />| 3        |   3/1/2014 |    1    |    1     | 50000  |<br />| 4        |   4/1/2014 |    1    |    4     | 25000  |<br />±---------±---------±--------±---------±-------+<br />表 orders 存储了所有的销售数据，包括销售员编号 sales_id 和公司编号 com_id 。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> salesperson<span class="hljs-keyword">WHERE</span> sales_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> sales_id <span class="hljs-keyword">FROM</span> orders o <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> company c<span class="hljs-keyword">ON</span> o.com_id=c.com_id<span class="hljs-keyword">WHERE</span> c.name=<span class="hljs-string">'RED'</span>)</code></pre><ol start="608"><li></li></ol><p>给定一个表 tree，id 是树节点的编号， p_id 是它父节点的 id 。</p><p>±—±-----+<br />| id | p_id |<br />±—±-----+<br />| 1  | null |<br />| 2  | 1    |<br />| 3  | 1    |<br />| 4  | 2    |<br />| 5  | 2    |<br />±—±-----+<br />树中每个节点属于以下三种类型之一：</p><p>叶子：如果这个节点没有任何孩子节点。<br />根：如果这个节点是整棵树的根，即没有父节点。<br />内部节点：如果这个节点既不是叶子节点也不是根节点。</p><p>写一个查询语句，输出所有节点的编号和节点的类型，并将结果按照节点编号排序。</p><pre class="highlight"><code class="sql"></code></pre><ol start="610"><li></li></ol><p>一个小学生 Tim 的作业是判断三条线段是否能形成一个三角形。</p><p>然而，这个作业非常繁重，因为有几百组线段需要判断。</p><p>假设表 triangle 保存了所有三条线段的长度 x、y、z ，请你帮 Tim 写一个查询语句，来判断每组 x、y、z 是否可以组成一个三角形？</p><p>记一下这种 case then用法,也可以不指定变量，只在WHEN中判断。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> x,y,z,<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> x+y&gt;z <span class="hljs-keyword">AND</span> x+z&gt;y <span class="hljs-keyword">and</span> y+z&gt;x <span class="hljs-keyword">then</span> <span class="hljs-string">'Yes'</span><span class="hljs-keyword">ELSE</span> <span class="hljs-string">'No'</span><span class="hljs-keyword">END</span> triangle<span class="hljs-keyword">FROM</span> triangle</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">select</span> x, y, z, <span class="hljs-keyword">if</span>(x+y&gt;z <span class="hljs-keyword">and</span> x+z&gt;y <span class="hljs-keyword">and</span> y+z&gt;x, <span class="hljs-string">'Yes'</span>, <span class="hljs-string">'No'</span>) <span class="hljs-keyword">as</span> triangle <span class="hljs-keyword">from</span> triangle</code></pre><ol start="612"><li></li></ol><p>表 point_2d 保存了所有点（多于 2 个点）的坐标 (x,y) ，这些点在平面上两两不重合。</p><p>写一个查询语句找到两点之间的最近距离，保留 2 位小数。</p><table><thead><tr><th>x</th><th>y</th></tr></thead><tbody><tr><td>-1</td><td>-1</td></tr><tr><td>0</td><td>0</td></tr><tr><td>-1</td><td>-2</td></tr></tbody></table><p>最近距离在点 (-1,-1) 和(-1,2) 之间，距离为 1.00 。所以输出应该为：</p><table><thead><tr><th>shortest</th></tr></thead><tbody><tr><td>1.00</td></tr></tbody></table><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span>  <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">SQRT</span>(<span class="hljs-keyword">POWER</span>(p1.x-p2.x,<span class="hljs-number">2</span>)+<span class="hljs-keyword">POWER</span>(P1.y-p2.y,<span class="hljs-number">2</span>))),<span class="hljs-number">2</span>) shortest<span class="hljs-keyword">FROM</span> point_2d p1,point_2d p2<span class="hljs-keyword">WHERE</span> p1.x!=p2.x <span class="hljs-keyword">OR</span> p1.y!=p2.y</code></pre><pre class="highlight"><code class="sq">select round(min(sqrt(pow(t1.x-t2.x,2)+pow(t1.y-t2.y,2))),2) shortestfrom point_2d as t1,point_2d as t2where (t1.x,t1.y) != (t2.x,t2.y)</code></pre><ol start="613"><li></li></ol><p>表 point 保存了一些点在 x 轴上的坐标，这些坐标都是整数。</p><p>写一个查询语句，找到这些点中最近两个点之间的距离。</p><table><thead><tr><th>x</th></tr></thead><tbody><tr><td>-1</td></tr><tr><td>0</td></tr><tr><td>2</td></tr></tbody></table><p>最近距离显然是 ‘1’ ，是点 ‘-1’ 和 ‘0’ 之间的距离。所以输出应该如下：</p><table><thead><tr><th>shortest</th></tr></thead><tbody><tr><td>1</td></tr></tbody></table><p>注意：每个点都与其他点坐标不同，表 table 不会有重复坐标出现。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">ABS</span>(p1.x-p2.x)) shortest<span class="hljs-keyword">FROM</span> point p1,point p2<span class="hljs-keyword">WHERE</span> p1.x!=p2.x</code></pre><ol start="614"><li></li></ol><p>在 facebook 中，表 follow 会有 2 个字段： followee, follower ，分别表示被关注者和关注者。</p><p>请写一个 sql 查询语句，对每一个关注者，查询关注他的关注者的数目。</p><p>比方说：</p><p>±------------±-----------+<br />| followee    | follower   |<br />±------------±-----------+<br />|     A       |     B      |<br />|     B       |     C      |<br />|     B       |     D      |<br />|     D       |     E      |<br />±------------±-----------+<br />应该输出：</p><p>±------------±-----------+<br />| follower    | num        |<br />±------------±-----------+<br />|     B       |  2         |<br />|     D       |  1         |<br />±------------±-----------+<br />解释：</p><p>B 和 D 都在在 follower 字段中出现，作为被关注者，B 被 C 和 D 关注，D 被 E 关注。A 不在 follower 字段内，所以A不在输出列表中。</p><p>注意：</p><p>被关注者永远不会被他 / 她自己关注。<br />将结果按照字典序返回。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> followee follower,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> follower) <span class="hljs-keyword">num</span><span class="hljs-keyword">FROM</span> follow<span class="hljs-keyword">WHERE</span> followee <span class="hljs-keyword">IN</span>(<span class="hljs-keyword">SELECT</span> follower <span class="hljs-keyword">FROM</span> follow)<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> followee</code></pre><ol start="615"><li></li></ol><p>给如下两个表，写一个查询语句，求出在每一个工资发放日，每个部门的平均工资与公司的平均工资的比较结果 （高 / 低 / 相同）。</p><p>表： salary</p><table><thead><tr><th>id</th><th>employee_id</th><th>amount</th><th>pay_date</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>9000</td><td>2017-03-31</td></tr><tr><td>2</td><td>2</td><td>6000</td><td>2017-03-31</td></tr><tr><td>3</td><td>3</td><td>10000</td><td>2017-03-31</td></tr><tr><td>4</td><td>1</td><td>7000</td><td>2017-02-28</td></tr><tr><td>5</td><td>2</td><td>6000</td><td>2017-02-28</td></tr><tr><td>6</td><td>3</td><td>8000</td><td>2017-02-28</td></tr></tbody></table><p>employee_id 字段是表 employee 中 employee_id 字段的外键。</p><table><thead><tr><th>employee_id</th><th>department_id</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>2</td></tr><tr><td>3</td><td>2</td></tr></tbody></table><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> t1.pay_date pay_month,t2.department_id,<span class="hljs-keyword">CASE</span><span class="hljs-keyword">WHEN</span> t1.avg_amount&gt;t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'lower'</span><span class="hljs-keyword">WHEN</span> t1.avg_amount=t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'same'</span><span class="hljs-keyword">WHEN</span> t1.avg_amount&lt;t2.avg_amount <span class="hljs-keyword">THEN</span> <span class="hljs-string">'higher'</span><span class="hljs-keyword">END</span> comparison<span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DATE_FORMAT</span>(pay_date,<span class="hljs-string">'%Y-%m'</span>) pay_date,<span class="hljs-keyword">AVG</span>(amount) avg_amount<span class="hljs-keyword">FROM</span> salary<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">DATE_FORMAT</span>(pay_date,<span class="hljs-string">'%Y-%m'</span>)) t1<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DATE_FORMAT</span>(s.pay_date,<span class="hljs-string">'%Y-%m'</span>) pay_date,e.department_id,<span class="hljs-keyword">AVG</span>(s.amount) avg_amount<span class="hljs-keyword">FROM</span> salary s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> employee e<span class="hljs-keyword">ON</span> s.employee_id=e.employee_id<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">DATE_FORMAT</span>(s.pay_date,<span class="hljs-string">'%Y-%m'</span>),e.department_id) t2 <span class="hljs-keyword">ON</span> t1.pay_date=t2.pay_date</code></pre><p>下面这个写的更好,OVER(PARTITION BY department_id,LEFT(pay_date,7))</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> pay_month,department_id,<span class="hljs-keyword">CASE</span>            <span class="hljs-keyword">WHEN</span> DEP_AVG_Salary=Mon_AVG_Salary <span class="hljs-keyword">THEN</span> <span class="hljs-string">'same'</span>            <span class="hljs-keyword">WHEN</span> DEP_AVG_Salary&gt;Mon_AVG_Salary <span class="hljs-keyword">THEN</span> <span class="hljs-string">'higher'</span>            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'lower'</span>            <span class="hljs-keyword">END</span> <span class="hljs-string">'comparison'</span><span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>(<span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'pay_month'</span>,        e.department_id,        <span class="hljs-keyword">AVG</span>(amount) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> e.department_id,<span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'DEP_AVG_Salary'</span>,        <span class="hljs-keyword">AVG</span>(amount) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">LEFT</span>(pay_date,<span class="hljs-number">7</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">'Mon_AVG_Salary'</span>       <span class="hljs-keyword">FROM</span> salary s      <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> employee e <span class="hljs-keyword">ON</span> s.employee_id=e.employee_id) t<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> pay_month <span class="hljs-keyword">DESC</span>;</code></pre><ol start="618"><li></li></ol><p>一所美国大学有来自亚洲、欧洲和美洲的学生，他们的地理信息存放在如下 student 表中。</p><table><thead><tr><th>name</th><th>continent</th></tr></thead><tbody><tr><td>Jack</td><td>America</td></tr><tr><td>Pascal</td><td>Europe</td></tr><tr><td>Xi</td><td>Asia</td></tr><tr><td>Jane</td><td>America</td></tr></tbody></table><p>写一个查询语句实现对大洲（continent）列的 透视表 操作，使得每个学生按照姓名的字母顺序依次排列在对应的大洲下面。输出的标题应依次为美洲（America）、亚洲（Asia）和欧洲（Europe）。数据保证来自美洲的学生不少于来自亚洲或者欧洲的学生。</p><p>对于样例输入，它的对应输出是：</p><table><thead><tr><th>America</th><th>Asia</th><th>Europe</th></tr></thead><tbody><tr><td>Jack</td><td>Xi</td><td>Pascal</td></tr><tr><td>Jane</td><td></td><td></td></tr></tbody></table><p>**行列转换怎么弄呢？**先计算ROW_NUMBER() OVER(PARTITION BY continent ORDER BY name) 分组排序，</p><p>然后GROUP BY，MAX,再CASE操作。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span><span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'America'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> America,<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'Asia'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> Asia,<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> continent=<span class="hljs-string">'Europe'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> Europe<span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,continent,ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> continent <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>) rk<span class="hljs-keyword">FROM</span> student) T<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> rk;</code></pre><ol start="619"><li></li></ol><p>表 my_numbers 的 num 字段包含很多数字，其中包括很多重复的数字。</p><p>你能写一个 SQL 查询语句，找到只出现过一次的数字中，最大的一个数字吗？</p><p>±–+<br />|num|<br />±–+<br />| 8 |<br />| 8 |<br />| 3 |<br />| 3 |<br />| 1 |<br />| 4 |<br />| 5 |<br />| 6 |</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">num</span><span class="hljs-keyword">FROM</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">num</span>,<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">num</span>) n_num<span class="hljs-keyword">FROM</span> my_numbers<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span>) t<span class="hljs-keyword">WHERE</span> n_num=<span class="hljs-number">1</span>;</code></pre><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span><span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">COUNT</span>(*)=<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">num</span><span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span><span class="hljs-keyword">END</span> <span class="hljs-keyword">num</span><span class="hljs-keyword">FROM</span> my_numbers<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">DESC</span><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span></code></pre><ol start="620"><li></li></ol><p>某城市开了一家新的电影院，吸引了很多人过来看电影。该电影院特别注意用户体验，专门有个 LED显示板做电影推荐，上面公布着影评和相关电影描述。</p><p>作为该电影院的信息部主管，您需要编写一个 SQL查询，找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列。</p><p>例如，下表 cinema:</p><p>±--------±----------±-------------±----------+<br />|   id    | movie     |  description |  rating   |<br />±--------±----------±-------------±----------+<br />|   1     | War       |   great 3D   |   8.9     |<br />|   2     | Science   |   fiction    |   8.5     |<br />|   3     | irish     |   boring     |   6.2     |<br />|   4     | Ice song  |   Fantacy    |   8.6     |<br />|   5     | House card|   Interesting|   9.1     |<br />±--------±----------±-------------±----------+</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> *<span class="hljs-keyword">FROM</span> cinema<span class="hljs-keyword">WHERE</span> description!=<span class="hljs-string">'boring'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">id</span>%<span class="hljs-number">2</span>=<span class="hljs-number">1</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rating <span class="hljs-keyword">DESC</span></code></pre><ol start="627"><li></li></ol><p>给定一个 salary 表，如下所示，有 m = 男性 和 f = 女性 的值。交换所有的 f 和 m 值（例如，将所有 f 值更改为 m，反之亦然）。要求只使用一个更新（Update）语句，并且没有中间的临时表。</p><p>注意，您必只能写一个 Update 语句，请不要编写任何 Select 语句。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salary<span class="hljs-keyword">SET</span> sex=<span class="hljs-keyword">IF</span>(sex=<span class="hljs-string">'m'</span>,<span class="hljs-string">'f'</span>,<span class="hljs-string">'m'</span>)</code></pre><p>感觉case可以处理的问题更多一点</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">UPDATE</span> salary<span class="hljs-keyword">SET</span> sex=(<span class="hljs-keyword">CASE</span> sex <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'m'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'f'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'m'</span> <span class="hljs-keyword">END</span>)</code></pre><ol start="1045"><li></li></ol><p>Customer 表：</p><p>±------------±--------+<br />| Column Name | Type    |<br />±------------±--------+<br />| customer_id | int     |<br />| product_key | int     |<br />±------------±--------+<br />product_key 是 Customer 表的外键。<br />Product 表：</p><p>±------------±--------+<br />| Column Name | Type    |<br />±------------±--------+<br />| product_key | int     |<br />±------------±--------+<br />product_key 是这张表的主键。</p><p>写一条 SQL 查询语句，从 Customer 表中查询购买了 Product 表中所有产品的客户的 id。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> customer_id<span class="hljs-keyword">FROM</span> Customer<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_id<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> product_key)=(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> product_key) <span class="hljs-keyword">FROM</span> Product)</code></pre><ol start="1050"><li></li></ol><p>ActorDirector 表：</p><p>±------------±--------+<br />| Column Name | Type    |<br />±------------±--------+<br />| actor_id    | int     |<br />| director_id | int     |<br />| timestamp   | int     |<br />±------------±--------+<br />timestamp 是这张表的主键.</p><p>写一条SQL查询语句获取合作过至少三次的演员和导演的 id 对 (actor_id, director_id)</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> actor_id,director_id<span class="hljs-keyword">FROM</span> ActorDirector<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> actor_id,director_id<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*)&gt;=<span class="hljs-number">3</span></code></pre><ol start="1068"><li></li></ol><p>销售表 Sales：</p><p>±------------±------+<br />| Column Name | Type  |<br />±------------±------+<br />| sale_id     | int   |<br />| product_id  | int   |<br />| year        | int   |<br />| quantity    | int   |<br />| price       | int   |<br />±------------±------+<br />(sale_id, year) 是销售表 Sales 的主键.<br />product_id 是关联到产品表 Product 的外键.<br />注意: price 表示每单位价格<br />产品表 Product：</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| product_id   | int     |<br />| product_name | varchar |<br />±-------------±--------+<br />product_id 是表的主键.</p><p>写一条SQL 查询语句获取 Sales 表中所有产品对应的 产品名称 product_name 以及该产品的所有 售卖年份 year 和 价格 price 。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> p.product_name,s.year,s.price<span class="hljs-keyword">FROM</span> Sales s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Product p<span class="hljs-keyword">ON</span> s.product_id=p.product_id</code></pre><ol start="1069"><li></li></ol><p>销售表：Sales</p><p>±------------±------+<br />| Column Name | Type  |<br />±------------±------+<br />| sale_id     | int   |<br />| product_id  | int   |<br />| year        | int   |<br />| quantity    | int   |<br />| price       | int   |<br />±------------±------+<br />sale_id 是这个表的主键。<br />product_id 是 Product 表的外键。<br />请注意价格是每单位的。<br />产品表：Product</p><p>±-------------±--------+<br />| Column Name  | Type    |<br />±-------------±--------+<br />| product_id   | int     |<br />| product_name | varchar |<br />±-------------±--------+<br />product_id 是这个表的主键。</p><p>编写一个 SQL 查询，按产品 id product_id 来统计每个产品的销售总量。</p><pre class="highlight"><code class="sql"><span class="hljs-keyword">SELECT</span> product_id,<span class="hljs-keyword">SUM</span>(quantity) total_quantity<span class="hljs-keyword">FROM</span> Sales<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> product_id</code></pre>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
      <category>sql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
      <tag>sql</tag>
      
      <tag>刷题</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>怨念</title>
    <link href="/2020/06/22/%E6%80%A8%E5%BF%B5/"/>
    <url>/2020/06/22/%E6%80%A8%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<p>这是远离坏心情的帖子…</p><p>啊,2020年的六月下旬.六月的雨你什么时候结束呀?明天和导师聊什么呢?说你自己什么也没干吗?呵呵.好好干吧.</p><p>我爱生活,生活爱我.</p>]]></content>
    
    
    <categories>
      
      <category>再见坏心情</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>01-java扫盲</title>
    <link href="/2020/06/17/01-java%E6%89%AB%E7%9B%B2/"/>
    <url>/2020/06/17/01-java%E6%89%AB%E7%9B%B2/</url>
    
    <content type="html"><![CDATA[<p>现在真的好迷茫呀，研究生的事让自己又烦又怕，学学java压压惊，老天保佑我吧。</p><h3 id="关键字"><a class="markdownIt-Anchor" href="#关键字"></a> 关键字</h3><p>被java语言赋予特定含义的字，组成关键字单词的字母全部小写，goto和const是保留字。</p><h3 id="标识符"><a class="markdownIt-Anchor" href="#标识符"></a> 标识符</h3><p>标识符就是给类、接口、方法、变量等起名字。不能以数字开头，不能是java中的关键字，标识符严格区分大小写。标识符的英文拼写中，常量每个字母都大写，用<code>_</code>隔开，例如<code>STUDENT_MAX_AGE</code>。</p><h3 id="main方法"><a class="markdownIt-Anchor" href="#main方法"></a> main方法</h3><p>main方法是程序的主方法，是程序的入口，被jvm调用。</p><h3 id="反码补码"><a class="markdownIt-Anchor" href="#反码补码"></a> 反码补码</h3><p>计算机在操作时，采用数据对应的二进制的补码来计算。正数的原码最高位是0，负数的原码最高位是1，其他都是数值为。</p><p>正数的反码与原码相同，负数的反码与原码符号位相同，数值位取反。</p><p>正数的补码与原码相同，负数的补码是在反码的基础上加上1.</p><h3 id="基本数据类型"><a class="markdownIt-Anchor" href="#基本数据类型"></a> 基本数据类型</h3><h4 id="整数"><a class="markdownIt-Anchor" href="#整数"></a> 整数</h4><table><thead><tr><th>关键字</th><th>占用字节数</th></tr></thead><tbody><tr><td>byte</td><td>1</td></tr><tr><td>short</td><td>2</td></tr><tr><td>int</td><td>4</td></tr><tr><td>long</td><td>8</td></tr></tbody></table><h4 id="浮点数"><a class="markdownIt-Anchor" href="#浮点数"></a> 浮点数</h4><table><thead><tr><th>关键字</th><th>占用字节数</th></tr></thead><tbody><tr><td>float</td><td>4</td></tr><tr><td>double</td><td>8</td></tr></tbody></table><h4 id="字符"><a class="markdownIt-Anchor" href="#字符"></a> 字符</h4><table><thead><tr><th>关键字</th><th>占用字节数</th></tr></thead><tbody><tr><td>char</td><td>2</td></tr></tbody></table><h4 id="布尔"><a class="markdownIt-Anchor" href="#布尔"></a> 布尔</h4><table><thead><tr><th>关键字</th><th>占用字节数</th></tr></thead><tbody><tr><td>boolean</td><td>1</td></tr></tbody></table><p>布尔类型不参与转换</p><p>整数默认是int类型，浮点数默认是double类型。长整型后缀用L或者l标记，建议使用L。</p><p>单精度浮点数用F或者f标记，建议使用F。</p><h4 id="默认转换"><a class="markdownIt-Anchor" href="#默认转换"></a> 默认转换</h4><p>byte,short,char-int-long-float-double</p><p>byte,short,char相互之间不能转换，它们参与运算首先转换成int类型。</p><h3 id="关于精度的一些问题"><a class="markdownIt-Anchor" href="#关于精度的一些问题"></a> 关于精度的一些问题</h3><p>如要声明一个常量为 float 型，则需在数字后面加 f 或 F</p><h3 id="变量-常量相加"><a class="markdownIt-Anchor" href="#变量-常量相加"></a> 变量、常量相加</h3><p>byte b1=3,b2=4,b;</p><p>b=b1+b2;错误，b1和b2是变量，变量的值会变化，不确定具体的值，所以默认使用int。byte、short、char相加会转换为int类型做运算，转为byte会降低精度。</p><p>b=3+4;     正确，常量相加，先做加法，然后看结果是否在赋值的数据类型范围内，在的话即正确</p><h3 id="强制转换"><a class="markdownIt-Anchor" href="#强制转换"></a> 强制转换</h3><p>从大的类型转换为小的类型</p><p>目标数据类型 变量=(目标数据类型)(被转换的数据)</p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>05-CV入门之模型集成</title>
    <link href="/2020/06/02/05-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/"/>
    <url>/2020/06/02/05-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/</url>
    
    <content type="html"><![CDATA[<h3 id="集成学习方法"><a class="markdownIt-Anchor" href="#集成学习方法"></a> 集成学习方法</h3><p>在机器学习中的集成学习可以在一定程度上提高预测精度，常见的集成学习方法有Stacking、Bagging和Boosting，同时这些集成学习方法与具体验证集划分联系紧密。</p><p>由于深度学习模型一般需要较长的训练周期，如果硬件设备不允许建议选取留出法，如果需要追求精度可以使用交叉验证的方法。</p><p>下面假设构建了10折交叉验证，训练得到10个CNN模型。</p><p><img src="https://s1.ax1x.com/2020/06/02/tYttJA.png" srcset="/img/loading.gif" alt="tYttJA.png" /></p><p>那么在10个CNN模型可以使用如下方式进行集成：</p><p>对预测的结果的概率值进行平均，然后解码为具体字符；<br />对预测的字符进行投票，得到最终字符。</p><p>除了上面这种方法外，我们也可以选择不同的模型，将不同模型的结果进行集成。</p><h3 id="深度学习中的集成"><a class="markdownIt-Anchor" href="#深度学习中的集成"></a> 深度学习中的集成</h3><h4 id="dropout"><a class="markdownIt-Anchor" href="#dropout"></a> Dropout</h4><p>Dropout可以作为训练深度神经网络的一种技巧。在每个训练批次中，通过随机让一部分的节点停止工作。同时在预测的过程中让所有的节点都其作用。</p><p><img src="https://s1.ax1x.com/2020/06/02/tYthLT.png" srcset="/img/loading.gif" alt="tYthLT.png" /></p><p>Dropout经常出现在在先有的CNN网络中，可以有效的缓解模型过拟合的情况，也可以在预测时增加模型的精度。</p><p>加入Dropout后的网络结构如下：</p><pre class="highlight"><code class="py"><span class="hljs-comment"># 定义模型</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHN_Model1</span><span class="hljs-params">(nn.Module)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>        super(SVHN_Model1, self).__init__()        <span class="hljs-comment"># CNN提取特征模块</span>        self.cnn = nn.Sequential(            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">16</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), stride=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),            nn.ReLU(),            nn.Dropout(<span class="hljs-number">0.25</span>),            nn.MaxPool2d(<span class="hljs-number">2</span>),            nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), stride=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),            nn.ReLU(),             nn.Dropout(<span class="hljs-number">0.25</span>),            nn.MaxPool2d(<span class="hljs-number">2</span>),        )        <span class="hljs-comment"># </span>        self.fc1 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc2 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc3 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc4 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc5 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc6 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self, img)</span>:</span>                feat = self.cnn(img)        feat = feat.view(feat.shape[<span class="hljs-number">0</span>], <span class="hljs-number">-1</span>)        c1 = self.fc1(feat)        c2 = self.fc2(feat)        c3 = self.fc3(feat)        c4 = self.fc4(feat)        c5 = self.fc5(feat)        c6 = self.fc6(feat)        <span class="hljs-keyword">return</span> c1, c2, c3, c4, c5, c6</code></pre><h4 id="tta"><a class="markdownIt-Anchor" href="#tta"></a> TTA</h4><p>测试集数据扩增（Test Time Augmentation，简称TTA）也是常用的集成学习技巧，数据扩增不仅可以在训练时候用，而且可以同样在预测时候进行数据扩增，对同一个样本预测三次，然后对三次结果进行平均。</p><pre class="highlight"><code class="">def predict(test_loader, model, tta=10):   model.eval()   test_pred_tta = None   # TTA 次数   for _ in range(tta):       test_pred = []          with torch.no_grad():           for i, (input, target) in enumerate(test_loader):               c0, c1, c2, c3, c4, c5 = model(data[0])               output = np.concatenate([c0.data.numpy(), c1.data.numpy(),                  c2.data.numpy(), c3.data.numpy(),                  c4.data.numpy(), c5.data.numpy()], axis=1)               test_pred.append(output)              test_pred = np.vstack(test_pred)       if test_pred_tta is None:           test_pred_tta = test_pred       else:           test_pred_tta += test_pred      return test_pred_tta</code></pre><h4 id="snapshot"><a class="markdownIt-Anchor" href="#snapshot"></a> Snapshot</h4><p>本章的开头已经提到，假设我们训练了10个CNN则可以将多个模型的预测结果进行平均。但是假如只训练了一个CNN模型，如何做模型集成呢？</p><p>在论文Snapshot Ensembles中，作者提出使用cyclical learning rate进行训练模型，并保存精度比较好的一些checkopint，最后将多个checkpoint进行模型集成。</p><p><img src="C:%5CUsers%5CMZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1591064391827.png" srcset="/img/loading.gif" alt="1591064391827" /></p><p>由于在cyclical learning rate中学习率的变化有周期性变大和减少的行为，因此CNN模型很有可能在跳出局部最优进入另一个局部最优。在Snapshot论文中作者通过使用表明，此种方法可以在一定程度上提高模型精度，但需要更长的训练时间。</p><h3 id="结果后处理"><a class="markdownIt-Anchor" href="#结果后处理"></a> 结果后处理</h3><p>在不同的任务中可能会有不同的解决方案，不同思路的模型不仅可以互相借鉴，同时也可以修正最终的预测结果。</p><p>在本次赛题中，可以从以下几个思路对预测结果进行后处理：</p><ul><li>统计图片中每个位置字符出现的频率，使用规则修正结果；</li><li>单独训练一个字符长度预测模型，用来预测图片中字符个数，并修正结果。</li></ul>]]></content>
    
    
    <categories>
      
      <category>CV</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CV</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-CV入门之模型训练与验证</title>
    <link href="/2020/05/30/04-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E9%AA%8C%E8%AF%81/"/>
    <url>/2020/05/30/04-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E4%B8%8E%E9%AA%8C%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h3 id="数据集划分"><a class="markdownIt-Anchor" href="#数据集划分"></a> 数据集划分</h3><p>在模型的训练过程中，模型只能利用训练数据来进行训练，模型并不能接触到测试集上的样本。因此模型如果将训练集学的过好，模型就会记住训练样本的细节，导致模型在测试集的泛化效果较差，这种现象称为过拟合（Overfitting）。与过拟合相对应的是欠拟合（Underfitting），即模型在训练集上的拟合效果较差。</p><p><img src="https://s1.ax1x.com/2020/05/30/tQdKu4.png" srcset="/img/loading.gif" alt="tQdKu4.png" /></p><p>如图所示：随着模型复杂度和模型训练轮数的增加，CNN模型在训练集上的误差会降低，但在测试集上的误差会逐渐降低，然后逐渐升高，而我们为了追求的是模型在测试集上的精度越高越好 。 解决上述问题最好的解决方法：构建一个与测试集尽可能<strong>分布一致</strong>的样本集（可称为验证集），在训练过程中不断验证模型在验证集上的精度，并以此控制模型的训练。</p><p>因为训练集和验证集是分开的，所以模型在验证集上面的精度在一定程度上可以反映模型的泛化能力。在划分验证集的时候，需要注意验证集的分布应该与测试集尽量保持一致，不然模型在验证集上的精度就失去了指导意义。</p><h4 id="留出法"><a class="markdownIt-Anchor" href="#留出法"></a> 留出法</h4><p>直接将训练集划分成两部分，新的训练集和验证集。这种划分方式的优点是最为直接简单；缺点是只得到了一份验证集，有可能导致模型在验证集上过拟合。留出法应用场景是数据量比较大的情况。</p><p><img src="https://s1.ax1x.com/2020/05/30/tQdzI1.png" srcset="/img/loading.gif" alt="tQdzI1.png" /></p><h4 id="交叉验证法"><a class="markdownIt-Anchor" href="#交叉验证法"></a> 交叉验证法</h4><p><img src="C:%5CUsers%5CMZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1590842709000.png" srcset="/img/loading.gif" alt="1590842709000" /></p><p>将训练集划分成K份，将其中的K-1份作为训练集，剩余的1份作为验证集，循环K训练。这种划分方式是所有的训练集都是验证集，最终模型验证精度是K份平均得到。这种方式的优点是验证集精度比较可靠，训练K次可以得到K个有多样性差异的模型；CV验证的缺点是需要训练K次，不适合数据量很大的情况。</p><h4 id="自助采样法"><a class="markdownIt-Anchor" href="#自助采样法"></a> 自助采样法</h4><p><img src="https://s1.ax1x.com/2020/05/30/tQwPxO.png" srcset="/img/loading.gif" alt="tQwPxO.png" /></p><p>通过有放回的采样方式得到新的训练集和验证集，每次的训练集和验证集都是有区别的。这种划分方式一般适用于数据量较小的情况。</p><h3 id="模型训练与验证"><a class="markdownIt-Anchor" href="#模型训练与验证"></a> 模型训练与验证</h3><p>放下代码，其实之前代码已经写的差不多了</p><pre class="highlight"><code class="python">train_loader = torch.utils.data.DataLoader(    train_dataset,    batch_size=<span class="hljs-number">10</span>,     shuffle=<span class="hljs-literal">True</span>,     num_workers=<span class="hljs-number">10</span>, )    val_loader = torch.utils.data.DataLoader(    val_dataset,    batch_size=<span class="hljs-number">10</span>,     shuffle=<span class="hljs-literal">False</span>,     num_workers=<span class="hljs-number">10</span>, )model = SVHN_Model1()criterion = nn.CrossEntropyLoss (size_average=<span class="hljs-literal">False</span>)optimizer = torch.optim.Adam(model.parameters(), <span class="hljs-number">0.001</span>)best_loss = <span class="hljs-number">1000.0</span><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">20</span>):    print(<span class="hljs-string">'Epoch: '</span>, epoch)    train(train_loader, model, criterion, optimizer, epoch)    val_loss = validate(val_loader, model, criterion)        <span class="hljs-comment"># 记录下验证集精度</span>    <span class="hljs-keyword">if</span> val_loss &lt; best_loss:        best_loss = val_loss        torch.save(model.state_dict(), <span class="hljs-string">'./model.pt'</span>)</code></pre><pre class="highlight"><code class="py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train</span><span class="hljs-params">(train_loader, model, criterion, optimizer, epoch)</span>:</span>    <span class="hljs-comment"># 切换模型为训练模式</span>    model.train()    <span class="hljs-keyword">for</span> i, (input, target) <span class="hljs-keyword">in</span> enumerate(train_loader):        c0, c1, c2, c3, c4, c5 = model(data[<span class="hljs-number">0</span>])        loss = criterion(c0, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">0</span>]) + \                criterion(c1, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">1</span>]) + \                criterion(c2, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">2</span>]) + \                criterion(c3, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">3</span>]) + \                criterion(c4, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">4</span>]) + \                criterion(c5, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">5</span>])        loss /= <span class="hljs-number">6</span>        optimizer.zero_grad()        loss.backward()        optimizer.step()</code></pre><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate</span><span class="hljs-params">(val_loader, model, criterion)</span>:</span>    <span class="hljs-comment"># 切换模型为预测模型</span>    model.eval()    val_loss = []    <span class="hljs-comment"># 不记录模型梯度信息</span>    <span class="hljs-keyword">with</span> torch.no_grad():        <span class="hljs-keyword">for</span> i, (input, target) <span class="hljs-keyword">in</span> enumerate(val_loader):            c0, c1, c2, c3, c4, c5 = model(data[<span class="hljs-number">0</span>])            loss = criterion(c0, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">0</span>]) + \                    criterion(c1, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">1</span>]) + \                    criterion(c2, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">2</span>]) + \                    criterion(c3, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">3</span>]) + \                    criterion(c4, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">4</span>]) + \                    criterion(c5, data[<span class="hljs-number">1</span>][:, <span class="hljs-number">5</span>])            loss /= <span class="hljs-number">6</span>            val_loss.append(loss.item())    <span class="hljs-keyword">return</span> np.mean(val_loss)</code></pre><pre class="highlight"><code class="python">torch.save(model_object.state_dict(), <span class="hljs-string">'model.pt'</span>)model.load_state_dict(torch.load(<span class="hljs-string">' model.pt'</span>))</code></pre><h3 id="模型调参"><a class="markdownIt-Anchor" href="#模型调参"></a> 模型调参</h3><p>在参加本次比赛的过程中，我建议大家以如下逻辑完成：</p><ul><li>1.初步构建简单的CNN模型，不用特别复杂，跑通训练、验证和预测的流程；</li><li>2.简单CNN模型的损失会比较大，尝试增加模型复杂度，并观察验证集精度；</li><li>3.在增加模型复杂度的同时增加数据扩增方法，直至验证集精度不变。</li></ul><p><img src="C:%5CUsers%5CMZ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1590843146998.png" srcset="/img/loading.gif" alt="1590843146998" /></p><p>ok，有时间再修改。</p>]]></content>
    
    
    <categories>
      
      <category>CV</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CV</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-CV入门之模型构建</title>
    <link href="/2020/05/26/03-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA/"/>
    <url>/2020/05/26/03-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h3 id="cnn介绍"><a class="markdownIt-Anchor" href="#cnn介绍"></a> CNN介绍</h3><p>​卷积神经网络（简称CNN）是一类特殊的人工神经网络，是深度学习中重要的一个分支。CNN在很多领域都表现优异，精度和速度比传统计算学习算法高很多。特别是在计算机视觉领域，CNN是解决图像分类、图像检索、物体检测和语义分割的主流模型。</p><p>​CNN是一种层次模型，输入的是原始的像素数据。CNN通过卷积（convolution）、池化（pooling）、非线性激活函数（non-linear activation function）和全连接层（fully connected layer）构成。 利用pytorch我们可以很方便实现。</p><pre class="highlight"><code class="python"><span class="hljs-comment">#顺序依次是卷积、激活函数、池化</span>cnn=nn.Sequential(        nn.Conv2d(<span class="hljs-number">3</span>,<span class="hljs-number">16</span>,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),stride=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)),        nn.ReLU(),        nn.MaxPool2d(<span class="hljs-number">2</span>),        nn.Conv2d(<span class="hljs-number">16</span>,<span class="hljs-number">32</span>,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),stride=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)),        nn.ReLU(),        nn.MaxPool2d(<span class="hljs-number">2</span>),    )</code></pre><p>​与传统机器学习模型相比，CNN具有一种端到端（End to End）的思路。在CNN训练的过程中是直接从图像像素到最终的输出，并不涉及到具体的特征提取和构建模型的过程，也不需要人工的参与。</p><h3 id="模型构建"><a class="markdownIt-Anchor" href="#模型构建"></a> 模型构建</h3><p>下面写一下代码的完整流程</p><pre class="highlight"><code class="python"><span class="hljs-comment">#数据</span><span class="hljs-keyword">import</span> os,sys,glob,shutil,json<span class="hljs-keyword">import</span> cv2<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> torch<span class="hljs-keyword">from</span> torch.utils.data.dataset <span class="hljs-keyword">import</span> Dataset<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHNDataset</span><span class="hljs-params">(Dataset)</span>:</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,img_path,img_label,transform=None)</span>:</span>    self.img_path=img_path    self.img_label=img_label    <span class="hljs-keyword">if</span> transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:      self.transform=transform    <span class="hljs-keyword">else</span>:      self.transform=<span class="hljs-literal">None</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span><span class="hljs-params">(self,index)</span>:</span>    img=Image.open(self.img_path[index]).convert(<span class="hljs-string">'RGB'</span>)    <span class="hljs-keyword">if</span> self.transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:      img=self.transform(img)        lbl=np.array(self.img_label[index],dtype=np.int)    lbl=list(lbl)+(<span class="hljs-number">5</span>-len(lbl))*[<span class="hljs-number">10</span>]    <span class="hljs-keyword">return</span> img,torch.from_numpy(np.array(lbl[:<span class="hljs-number">6</span>]))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span><span class="hljs-params">(self)</span>:</span>    <span class="hljs-keyword">return</span> len(self.img_path)train_path=glob.glob(<span class="hljs-string">'./data/mchar_train/*.png'</span>)train_path.sort()train_json=json.load(open(<span class="hljs-string">'./data/mchar_train.json'</span>))train_label=[train_json[x][<span class="hljs-string">'label'</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> train_json]data=SVHNDataset(train_path,train_label,transforms.Compose([        transforms.Resize((<span class="hljs-number">64</span>,<span class="hljs-number">128</span>)),        transforms.ColorJitter(<span class="hljs-number">0.2</span>,<span class="hljs-number">0.2</span>,<span class="hljs-number">0.2</span>),        transforms.RandomRotation(<span class="hljs-number">5</span>),]))train_loader=torch.utils.data.DataLoader(    SVHNDataset(train_path,train_label,          transforms.Compose([            transforms.Resize((<span class="hljs-number">64</span>,<span class="hljs-number">128</span>)),            transforms.ColorJitter(<span class="hljs-number">0.3</span>,<span class="hljs-number">0.3</span>,<span class="hljs-number">0.2</span>),            transforms.RandomRotation(<span class="hljs-number">5</span>),            transforms.ToTensor(),            transforms.Normalize([<span class="hljs-number">0.485</span>,<span class="hljs-number">0.456</span>,<span class="hljs-number">0.406</span>],[<span class="hljs-number">0.229</span>,<span class="hljs-number">0.224</span>,<span class="hljs-number">0.225</span>])          ])),    batch_size=<span class="hljs-number">10</span>,    shuffle=<span class="hljs-literal">False</span>,    num_workers=<span class="hljs-number">10</span>)</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#模型</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHN_Model1</span><span class="hljs-params">(nn.Module)</span>:</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>    super(SVHN_Model1,self).__init__()    self.cnn=nn.Sequential(        nn.Conv2d(<span class="hljs-number">3</span>,<span class="hljs-number">16</span>,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),stride=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)),        nn.ReLU(),        nn.MaxPool2d(<span class="hljs-number">2</span>),        nn.Conv2d(<span class="hljs-number">16</span>,<span class="hljs-number">32</span>,kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>),stride=(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)),        nn.ReLU(),        nn.MaxPool2d(<span class="hljs-number">2</span>),    )    self.fc1=nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>,<span class="hljs-number">11</span>)    self.fc2=nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>,<span class="hljs-number">11</span>)    self.fc3=nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>,<span class="hljs-number">11</span>)    self.fc4=nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>,<span class="hljs-number">11</span>)    self.fc5=nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>,<span class="hljs-number">11</span>)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self,img)</span>:</span>    feat=self.cnn(img)    feat=feat.view(feat.shape[<span class="hljs-number">0</span>],<span class="hljs-number">-1</span>)    c1=self.fc1(feat)    c2=self.fc2(feat)    c3=self.fc3(feat)    c4=self.fc4(feat)    c5=self.fc5(feat)            <span class="hljs-keyword">return</span> c1,c2,c3,c4,c5</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#使用预训练模型</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHN_Model2</span><span class="hljs-params">(nn.Module)</span>:</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>    super(SVHN_Model2,self).__init__()        model_conv=models.resnet18(pretrained=<span class="hljs-literal">True</span>)    model_conv.avgpool=nn.AdaptivedAvgPool2d(<span class="hljs-number">1</span>)    model_conv=nn.Sequential(*list(model_conv.children())[:<span class="hljs-number">-1</span>])    self.cnn=model_conv    self.fc1=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)    self.fc2=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)    self.fc3=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)    self.fc3=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)    self.fc4=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)    self.fc5=nn.Linear(<span class="hljs-number">512</span>,<span class="hljs-number">11</span>)  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self,img)</span>:</span>    feat=self.cnn(img)    feat=feat.view(feat.shape[<span class="hljs-number">0</span>],<span class="hljs-number">-1</span>)    c1=self.fc1(feat)    c2=self.fc2(feat)    c3=self.fc3(feat)    c4=self.fc4(feat)    c5=self.fc5(feat)    <span class="hljs-keyword">return</span> c1,c2,c3,c4,c5</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#pipeline</span>model=SVHN_Model1()model.cuda()%%timecriterion=nn.CrossEntropyLoss()optimizer=torch.optim.Adam(model.parameters(),<span class="hljs-number">0.005</span>)loss_plot,c0_plot=[],[]<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):  <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> train_loader:    data[<span class="hljs-number">0</span>]=data[<span class="hljs-number">0</span>].cuda()    data[<span class="hljs-number">1</span>]=data[<span class="hljs-number">1</span>].cuda()    c0,c1,c2,c3,c4=model(data[<span class="hljs-number">0</span>])    loss=criterion(c0,data[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>].long())+\        criterion(c1,data[<span class="hljs-number">1</span>][:,<span class="hljs-number">1</span>].long())+\        criterion(c2,data[<span class="hljs-number">1</span>][:,<span class="hljs-number">2</span>].long())+\        criterion(c3,data[<span class="hljs-number">1</span>][:,<span class="hljs-number">3</span>].long())+\        criterion(c4,data[<span class="hljs-number">1</span>][:,<span class="hljs-number">4</span>].long())          loss/=<span class="hljs-number">5</span>    optimizer.zero_grad()    loss.backward()    optimizer.step()    loss_plot.append(loss.item())    c0_plot.append((c0.argmax(<span class="hljs-number">1</span>)==data[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>]).sum().item()*<span class="hljs-number">1.0</span>/c0.shape[<span class="hljs-number">0</span>])  print(epoch)</code></pre><p>至此就完成了，这里的pipeline并不完整，只包含了训练的代码，还未包含模型的预测，模型的训练与验证下次再说。</p>]]></content>
    
    
    <categories>
      
      <category>CV</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CV</tag>
      
      <tag>CNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-CV入门之数据读取与扩增</title>
    <link href="/2020/05/23/02-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E4%B8%8E%E6%89%A9%E5%A2%9E/"/>
    <url>/2020/05/23/02-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E4%B8%8E%E6%89%A9%E5%A2%9E/</url>
    
    <content type="html"><![CDATA[<h3 id="pillow"><a class="markdownIt-Anchor" href="#pillow"></a> Pillow</h3><p>Pilow是python中进行图像处理的一个库，话不多说看代码。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Imageim=Image.open(<span class="hljs-string">'./data/cat.png'</span>)im</code></pre><p>自己截了colab里面的猫猫，很可爱呀</p><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image,ImageFilterim=Image.open(<span class="hljs-string">'./data/cat.png'</span>)im2=im.filter(ImageFilter.BLUR)im2.save(<span class="hljs-string">'blur.jpg'</span>,<span class="hljs-string">'jpeg'</span>)im2</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>可爱的猫猫变糊了</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Imageim=Image.open(<span class="hljs-string">'./data/cat.png'</span>)im.thumbnail((im.width//<span class="hljs-number">2</span>,im.height//<span class="hljs-number">2</span>))im</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>可爱的猫猫变小了</p><p>对图像处理并不熟悉，我们要做的是清楚需要对图像处理做哪些工作，然后再去查找相关API</p><h3 id="opencv-2"><a class="markdownIt-Anchor" href="#opencv-2"></a> Opencv 2</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> cv2<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> pltimg=cv2.imread(<span class="hljs-string">'./data/cat.png'</span>)img=cv2.cvtColor(img,cv2.COLOR_BGR2RGB)plt.imshow(img)</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>opencv读出来的是数组，需要由其他包可视化</p><pre class="highlight"><code class="python">img=cv2.imread(<span class="hljs-string">'./data/cat.png'</span>)img=cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)plt.imshow(img)</code></pre><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASEAAAD7CAYAAAAlzyLmAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+j8jraAAAgAElEQVR4nOy9WYxkWX7e9/uf5d4bS2ZEZmVWZS3d1ct0z/RwZsjxDIf7YgoybYqyDNiWN8gELJh+sAEbtmFJfvKDDdgvtvVkYQAZoAADtA0KFmGLNmEKJCWRHnJmNEPOwu5p9l5da66x3e2c44dzb2RkVlZ1dXV1V2VWfEAiMyJjOfdGnO9+/11CCCyxxBJLPC6ox72AJZZY4unGkoSWWGKJx4olCS2xxBKPFUsSWmKJJR4rliS0xBJLPFYsSWiJJZZ4rPhIJCQi/6KIvCoir4vI33xUi1piiSWeHsjD5gmJiAZeA/4i8B7wx8C/FUL43qNb3hJLLHHWYT7Cc78CvB5CeANARH4d+CvAPUko0Z3QsYOP8JZLLLHEacSs2qd0Mznpfx+FhC4D7y7cfg/4sfs9oWMH/MSz/+5HeMsllljiNOIP3/l79/zfx+6YFpFfFZGvi8jXSzf7uN9uiSWWOGX4KCR0DXhm4faV5r4jCCF8NYTw5RDClxPd+Qhvt8QSS5xFfBQS+mPgJRF5XkQS4N8EfvPRLGuJJZZ4WvDQPqEQQi0i/xHw/wAa+J9DCN99ZCtbYoklngp8FMc0IYR/CPzDR7SWJZZY4inERyKhJc4g5IQo6rLn1KPB8XO7PK/AsmxjiSU+GZxE7ksASyW0xPHNIRJ/Qji8Ui+v4B8e7TlsbzoPQFByeD7vR0xP0TleKqGnGSdtAhHQ6v4bZHlVvz9OIpkQwPtIRosE3z5O5Kk9r0sl9DSjJRylCCYST9By9CruQXzcOFJ7qN3h85+iq/UDYZFEmnMbUks4Ti7NpV/q5ry6cEhMLUkdU1JnGUsSehrRbIqQWEKq8amhHCQELQQNSDQbggLxoHOPuIA9qDAHedwctbvbbHva0aoZJaAUvmOZXu5SZwpvwBtBPIgPKAfJgUMXHp071LRCvEfy6m4z+Iyf3yUJPa0QAaPwicEnGtdslOizAK8haEF8IIhC1QFdaHxi4maBo1fupx0tAemoKoPWuMxQ9RRVR/AWghHwoOrmp4qSSHxAKgUORAmEp4N8WixJ6GlCu1GsIRhFNcwoBwZvhKqrCAq8ARQ4K/gExAtmFpAa8jUNIUWXgWTkUZUnvTVDjWdPzYY5ERKVj1vr4jJDvmGZnNf4BKqVeE5VBeIa8ikFVYMuhaAUdVchaxZdeNJtjRQOVVRQ1Y/7yD4RLEnoaYMIwWqC1dRdTbGqCRpcAkHFq7XX4FNwKeCjGaFqqDvgE9C5kG0LJlfYA4Ma81T5ME6EVtRdS7WimWxpDl7wBBMINoCAHmnMDELVqBwFdSoEiSawN2ByQc8sWgniHFI93kP6pLAkoacFjQoK1lCtZdQdTbmqcVlUPXUXUK0ZBt6CTwKESEzi40YJOhBEyM9Jc0XvkKza6C/amYB/Ssyz1l+TWHw3wWWGySVLMVAUaxBsIOhIQBBvOy94E6KZWwNB8EVzrkIke9dRIAZV1Ej+dJhlSxJ6WtD6KzLD+HJCsaoi0diobsphaDYIoAIoCCpuovaCLJUglUA/UOgAXijWFTpPWH3bMBwVSFWDc9GXpM5wyLkhdddLmF7uUvWE3VeEcrM5W+2ht0HGzOMzwEPtBZzgOoIqBF2AmUFNoFjV6Eyhc4ualuDPNgHBkoSeHjRmmE8NdRaVT2hUj0uj6gkmzIkn/iz8TXNBDkSCsh6CUHeFYKDsC26QoYoaNcrBn3F/hjUEq3E9S7GqqPpC3fFI6ggNyUS05ldozp0QJCAC3goQEC/xdAXBJfHh3sbUCfDg7nr3M4UlCZ11NFds308p1zKqVcNsUygH0V/hk0g0wRy74sqhKYE0/2vMMXRArEck4DOH88J+aiiHXZL9wMa3FXpncjbD9835LC70mW1aZpuK/U87QuqhUYf4hQiXaqWQRBKSAAhBB+q+QxoirwtBleAyQRdCMjbYPQ21IFV9ppXlkoSeEgSrqXuaqivU3YDrekISwPrmAcSN06qdYxdyhLihJCAqoE0kIUniZboEptrgEoXLDFqrsxu+F6HuavI1IV+H5MKUJKmZTjJcoY+ew1ZR+sVExuacJCE+VCuCUigD4gRvwCVCMComip5xLEnorKO5ctc9y+SCjmZDz8crd1u00xIQ3G2KnfByNFxFELTyKOWhV1InjjxJ2P10SrZp6b1fYG7ufwIH+QlBa/xKhssM+y8YDl52hK5jJakxymNsHdWhF4KLaii0ykhCTGI8zskKUIFgPV6EuhNQBsq+olpNMVOFnpXc/cSzgyUJPSWo+prpluC6Ad9zSOYITh36LtrveOOUBhAVopBpr+IS5lfx4AVUQCmP0Z5eVpKZmr1+xn4+YLqv0VXCyvXm8afclBAfCImiGqSUq4bR854vfP4tcmfYLzJqp+mkFS6pqWtNXWm8V1EZtSTUEruXo2Sv43sEBU55fCVUK4pyGLen3lU87Giu04AlCZ11NGUE3gguC7g0+nTmG+B4CbOK5tb86cihSFIB0aHJzfPRLNMerQ5/UuMYrTiCxKu572aIc6c+8S4owaeW8aWEYk3wg5LMxEjYVHmUBMBEJ7NSiAooPF7L0dqxIIfmmIrnMgjzz6Q983UGdSboVMX6vjOc+rAkoacBItSZUK07SF1DJM0VeMH0EgkoHRDlCV7hfZOA2KgYbTzGOpTyJMYhEjANCVnlMcoz7MzoXK2YVZbR7Q26N3qYaY25PUKaerNHpooetOr8YQd8NuHx0BT5lpsdbv1MzdYzO1zpTElUDQaG2YzaK2baUjmNSGh88jIn9OAFHxoT7YQYQFxmZKHgFOVQMXXxCtG5phB3doloSUJnHSqWBgQtYD3K+sO9Gw5NBFEh+p61R6mAF09ANc7q+MWXxv+jtZ+Tj1axjkwrjyKS2zCb0TEVB71AtWIQD+Y0t6lQipBZ6q6ie27CZ9duzv/lxZOoGoWmUpoQBK0CqjFlRaLj3jmFNAQUvDr08ASZ+96ExvzF421UQ85KE6o/u1iS0FmGCD5L8B1D3QGVOJK0xtoaLSFemQElAWviZglB8AG8V9T+7i+/SMAoT2Lia+jGFDHiSU00uXwQRALVlZKbOqH3bsrWLRsTGY+tb05wfi4Hjv5efOwxIgtq4X9H/nGyWhB/rFHbSe+12AuouT9/ZsDOKymz84GXzu1wpbNL5TVViD+TOqUOCiWeXNmoMhtoFaNbSiLJl06TVwbv1cLbS/MD3im8ElzXUzlF1WuiZI1JdhZD9UsSOssQIaSxmtulgjYea2t6aUmqDzPgtPKkOhLErLY4r3BBqFz0mKpmUzmvcF4wOppfLSEpAlY7jDh8UNQNO5zbGDHpJ0zdCsHqu9bW/m67Ds7ziua9jBbIQZ9AiL5xeLf9d9rXuBeO5y21txffZ7HzYUtC5ywHn3ao9YIX+nc4bw+Y+oTCW6qg0fhISF43yxacUZHctUOLJ2nOz7RO2KFLCIJrHP7OK3xDRDWAF1zqcU7waSShoNRhtsQZI6IlCZ1VtLViWuEThUuh1y3opSUdW6GlUTDtlboxEJQN1F7hgqJoyKcloboxI3SzuVryaf/vG/LJdHTYql5g2NG80e9D0zRt3sSr9Q2JELIkqrZugk803sY1ByV4G53q3sQM41jpH38HRXTmHtuPcyFy7Ldy8W/lAqqOJCYuxJ5JpUfqgKoCZlwizqNmsZK97AtmY8q5wYS+LgDQBFTz09EVJnhWbU6qapKFc7J4ftvzk2h3JODug8wJXsTgnKKynmCb9ioiMYBwmk3a+2BJQmcRC71tfKJwTZnG88M9Vm0+VyodXdHRFZXXzJzFB0FJiGaFs0x1rCFQclRdLJpxXVNixJM7w7ROMMqzagtS5VhPJgz0jDc3N/BWxUh0qz5Eoo/EGnwvxSea6VZKPlTUXaEcxLq2aiUmVYaOw3YrjHWsdnMS7bDaYdXJNQ0uRHMympfxp/YK5xWjwjKbpDGXp9BILeixwUwFO4b++xYz82R3SvQopzgn/PjVt7iQjtiw4/l7aPFo8XSlwAfFis6pgmZcp/R0F4/gguCDIneG0huM8vSTSGRGeYx46qConKb0mkkZqJ2iSg11EFyioz/vDPuFliR0xhGkaRehwIgjVTWqISEjjSmlHIXXKIkqp/1four51RtASWM2SVQ989sLUISolJQjUxVdXWCTmmo1Q5X9w3UZhTcKn2iqVY2zwnRTUw7AdUJTVuKRfo2xjqxTspoVdGzFZjYm1XVUIHIyCdUL5lFLuoUz1EGxX3TYSbvUTjErLN4pqsziphrXUahaoXPBJSl2YimGgaGd0dfF/JiVeFoDSRPQ4nBBYcVhGvPWBaH2Gi+B0uuonJoIpCJgVFRMasH3VjZmstIxBeJp6AK/JKEzDgkBCYemQaprehK//LXXND0SSRtF0aqcVNcYFX08pdcLKulwAwHUXs83uVEeo1xUWKoEoPCWC4MRN76ygsktVS8Wy9arHrVWoHVFrzMmMY6NtKBnYv7NwM6w4umZIpKZKumqEiWenipQ+OgY5+SyBrewe11zTL65L/eWqU9xCFOX4hHGdcrYpUzqlNuzfqNKEqa15jPDPbaSAzJVYcXF9xSwDQFqPA7V+IUsVhw9XcRzqeNaFIGJBBJV0zflkbXOnGVSJ9RKYbWj9oqiimaZN5xZM6zFkoSeMihCVEON4il9/ApY5ZrNGp2k7VXbS5iTTBsFU+LnpFU3BNW+djQx3NwX4oJiNc15e6tGaoFhhU1rrq7v88Pr1+jrggv2gFRVJFLPN3mmKhSeRFxDOB7d+q1OUGAfFq3CK0NUS3mwVMFEYvIpLjSkEo5ukZb02t9zUzUcXZMVNw+9OxQz5TA+nreeLuK5bcxEF4RCDErH81d7RWIcM+VjV4MzjiUJnUUsTmsIsa1oLF2K/h4r0Zei8fPN1CqHVh21vgxFmJtl8bnRod3R8Wp+SF4RWiLJaTyp1KzonJf6t5i8nOC8Yj2b0DUVF7N9nsvuYMWxqmaohmS0+COko05QOosm4keBQ9DicUGRiDv8W7s5CZVB41GUDRktKq/28e25s+JAgQ6e3NvmWCKJaOvnTu2WfNrAQKfp2NQeVx0U17U7KoDOYJJiiyUJnVU0oWdx7UgZ5uomVVFxKBUaEolffh+EAoNr1FAdNC4IqQJwcwWSqrrxjyzkw5ygTrq6oKsKPt97jx/tv4mSQ2WTiMNKPVc38R3ub3Z80P8fFpHwPBZiK9ZmTWXQVGhynzDxCR41J8XWFCzRuBAd+FYcVhx5MLig0A3hK/Gs6ByAqU+4U0XfmGmUH+rQtAOogsaqhfN5hgkIliR09tGoIUK8wtZNkl0LRYix6uaWUR4VwtxXpIhzfzwyv6q3Smp+lW+u+MeJyDbqwoqbm1eLCkfz5G+uVp0l4lgMrJ/ki7JS41BY4vHG+9wR89GKo9v4y5QsnDNpLgLexM/IK5xTWCcx5WCBiM5SjhAsSejsogmFS4jJbeIgd5aZsyjJSFVNV0dnrwsKj0SyaEyDxeS7Vhm16OqSgZ7dtbkyqY4QUes8zqQik2pBRbQm4JO5mdp1tQoJwOr6UDGiGjNM0Ch08CCKRGoUnioYuqqcn7N4/uJzu6qknx6qosqbeVZ17i17dZdxnTCaZbixJS2IyZRtPucZIyBYktDZR1sWEeKVtgpxQ1RBzzeVjqnHR57WmgkAeNAL331FOHKF901our36H1cJi36e04hIniqG4dtSdwG3oCij58g3KQ41BIOWxtcW/DytwTYmmEPNz7Gfk5vMw/quabOiHPPo5lnFkoTOOMTHLGACJKomVY7CGwp/+NFbcXR1cZd/RjXlDLZx1MZNohrfRz03tw59PE3I+hjZnORcPq1oiXtO4AvkmqmKRBy5t+QhiVE+KSMBNeoJDoMAuoka7LqM7bKPRyh9zGWqKo2eKHTeZnWfnXN4HEsSOuvwYV4cmjQZxjNncUGw3lCIQ2s/d6q2V2VFrAZ3HEbJqqChyRJuiShpFNFiKP049An+otOEqBQP84w8R1VjS7JJY5KWcqiQ2vPjg8LJoQKN0bH4Srm37JTd+Fpt6L5SmFLiBaRt4XFGFdGShM4yQkCVDpRgZvDeaMi0k9A3BUa5eQZ1q2DmBNSaZ80m8cTQfkYVf0sVEwaPhdWTe2QvnxUlFEn20BwjRBOtPQ9WYhFwIo6eiuH49n80RLaYO5RJNS8v2Ss77BcZN+4M8DOD2TXovCWhx3K4nxiWJHSWEQIyK9FlTbrX48b2gFEv5eraLqs2x4pjRefzKzWNwmlNDNu8jJNITitqRk+V6IaIFrGogk6Kej2pTugHRZsT1BKKbgL28TwdNUMVHtt0JYhmbFM315R2HM+4Lrzl9qTPndsrrH0tIdsLFAOoesQR3N6f6fljSxI66wghTr0AaMoujMTSCqP8/Ep9PAv5SNFqWMiNEY9tokBPG3RD1powT3S8l6k5J+JWAbWQo9E3gI6OnQ2U8c2M+oCZCRAw+dk1w1osSeis4li9kbew2p9xvj/m+d425+yETFWk6jAkD02URwKJ1HO102YNHyefe/l5TrvquR+sxFD9/XK2j4T2oYmkHT4jk6PP/qHuNdYuTvl9+yneO3cVVSu6t2uS3RJVOqRyZ5qIliR01tG29DDQTSpWk5w1O2VgpnPC8UGoONp0TOGPZPE6wvyqf9odzR8VD3Lsd5mkC8+Zl8o0xLSux3Szgj/vbvJ2J07E1bnH3BnzNGBJQmcVIUCacPsr64yfFYoXcn528x027JgNM5rn9Cg8XhQ2RMKxUt9VnX6Y/Vvfs55riQ+P43VrL/du8rUv7LNzpYO4hI2DLlI5ZFo83dExEXkG+HvABaJ1+9UQwt8WkXXgfwWeA94C/moIYffjW+oSHwbiA95qtr/o+ee/8l2e7ezw5d4baAKTpo3FYSHoYcX3PJrToG3a9TQrn4fBg5qkremWEXglu8a/9/If8k6xzm9d/1FW30ripJKWhM4oHqQcuQb+sxDCZ4EfB/5DEfks8DeB3wkhvAT8TnN7iccM8VEBFc+uM35+BVkrudLZZcOODmu25iFld9dPe1V+mh3QjwuJOAZ6ynk7orxQs/tyyuRKh5BZ0PrM9hX6QCUUQrgOXG/+HonI94HLwF8Bfr552K8Bvwv8jY9llUs8ENppEuVmj/d/JiPf8Pzki2/yU73XgEP5H8nlaHi5RZuI9yAO6CUeHRyClZpn7Dab5oC/9MU/4bvPb/HOdy7SvdnB7BdIUUHdfF5nSBl9KJ+QiDwHfBH4GnChISiAG0Rz7aTn/CrwqwCZWX3YdS7xIeATRbHuUZs5F7N9VlWOQ8hDzPw5zHU5wcG8OOBiST6fODJVkQTHp7o3Mcrx9vo5qr5BKo+ufRwgecbwwCQkIn3gN4D/JIRwIAvSMIQQZHHY0gJCCF8FvgowyLbODn0/SWg+iybfkGKgOf+Z2/zY+bf5oe41SvTc/9OWINzLDl8Sz+OFb6rzn0vusK7HvPbseV7/qaukO5bz3zSk113M+zpDSuiBWtSJiCUS0P8SQvj7zd03ReRi8/+LwK2PZ4lLPDCaMTp1pvix82/zl4f/jGfsdqxXWnCUtj6fJeE8eWg/p3U95sXkFv/c2rvIixMmzzvKgYlTN86Yb+gDSUii5Pm7wPdDCP/9wr9+E/iV5u9fAf7Bo1/eEg+E5qoYehnV1oBiKAzMLPb3OQWNw5a4G75pG3vBHvDK1k26F8eUfYXPDMGaM0VED2KO/RTw14A/FZFvNff9l8B/C/xvIvLXgbeBv/rxLHGJD0KcyAnleofx5YTZVuC8PWBFlYw8uGA/+EWWeKLgEFzQfDp9n6uXbvNPV1/m/974SVw/QVMi5QNMnD0leJDo2D+BeyY9/IVHu5wlHgrNVFOXKYo1oeofzXZe4vRCi2dVcjbsiGII0wspHRGSUf64l/bIsMyYPuUQH6CMGc3jS4aDL+dc2NxnVc2YenvXyJolThfaFiHP2B3O/dgNbrwwYPVrHS7eGsdw/RlQQk/BfMczjtA0vXKOuitc2Nzn6uouVhzlsXqwJU4vVvSML567xivP3KBY46nzCS3xpEKEoBVi4sdYDuBnN99ppoWW83DvEqcb7QSPV3rvs5mM+P76VephB5VXqHFx2HnxlGJJQqcdImA0QSuqlcDPrb5KTxXN+JklAZ12tA5qLZ4fSq9RJppfW/sJyoHFGkHNqkhCpxhLc+y0Q4TQSQm9DJcGeqq4q+vhEmcDbS/vrF8wumKYnk8IVp9qFQRLEjrdCAG0otrsMbvcJ6xWrOsxQzVb5gedUSjx/MjFa+z8RMmdLyhcN0Gcnw8zOI1YktBphwh1x1D1NTp1JMuq9zOPjXTMytqUeiXAGRiGuPQJnVKI8+A9vpuy/5xhtiVcWD8gD+auftFPK44MdzwDaOv/Pt29gb+s+O3803hrok9IKe6dzvdkY0lCpxnOgwjFupBv1VzojuaOzKcdiz2dzwraQMOW2ae3UvCNwRWCGsZJHKf4cJckdFoRAjhHUIpyGOidn7CZjakaJfQ0RMZOIhpPOyN+cVrI2VFDAFkzdmmQ5ow2LPZgGKNkRfm4l/ZQWJLQaUXbc9go3PmSH7v0Np/q3jqzSmiRcFpCaQkHmI/hqYKJs72azpAQRcK9lNFpJKcVlZPguNzd5+sXr6LqHp3rOeZOExU9ZdGyJQmdVog0yYqCThzryYQVlc834FlGO1CwDJoqGLR42qSEMuiFUdYN8TSisFVHZ6FlrRJPR1e4DpQ9RaZPr/JdktBphVKQWFxmODc84Ef7b8TWHWeMgBYVTKt8cp/gEKY+pWxq43yIm1A1k0Ks1CTNTHjXkNFhEqc+NNeaXw9z3o6nQXxSJrAmdsU8l4yZXfCAonPHkrzvCacwWrYkodMMpQha6CUl5/UIOLuDB9ve164pRamCoQyGwtsjx2xx+PmE04ALMn9uGfSRcdXt6yr8QynIx3muNYFUanzHU/WEYOJaYluX0/UdWJLQKUX8okVzLFGOripiB8UnoHdQqxCif0pRocl9AkSnqsXNJ37cayO3Jlf7Gh4VXyto8mApg5l3jPTN/QCVRJWTqgrnFT7IXAkBccaauLm/qF1x2/b2yHEcGVh4uFYXFDfqATuuP69yt+I4Z8ZkUqGImc3tOXjUcCjyYFjROd3NCVN61JlAVYNWoE6XT3BJQqcZTTvXRDt6UjOBeTP7x4k2T6l1kFfBMPIZ0LaWDU3Eyp1IRIsE1Dqaq6DnPqA82CPFudFEs/PXb+/Lmvq5xRHXKI6QUvsaGVVcF/f2GWnCfCT2zXrAm7NNjDg6uiJT0RTeNAeoE87Bo4QPilKgqwquDPd5D3DpClQVBIModarU0JKETiuUAq0IGswT0MCsVT9l0Nyoh+Te8uf5ed7Lh9ReM62jEuqaEqMcF7MDnk236amCLbN/TJkcqqiWgBwtMakjyufoEMdD+EaBtX9DJGjnVfSdqZas1JH1RxJrXi8cJbU91+Mbk+fYrnq8O1nj9qSPVh6tPFZ5vp1eoWtKXurf4kvdN0nuUlyPFlo8K0lOlnQJSgghIKcsMgZLEjp9aPvIGI1PLXWmMMqjHnOtmBJPguPAZ3xt9ALvzwZ84/WrZG+n0cxpl6cgqEBxpeLlqze40D3gl9b/lC2zf0QRtWpo4pOohhpiiOaYiUqoIRd/7HlHX+PQhGqJq6vKI2oIwImQKUGHOAYpmlRx3a0qezW/yK9/+0dRtxN0Abo4qjZuRguZb3z2GdY+N2FdjzlvRmRSPVKzrE3DyKTiSneP3FlumnNQ103m9OnCkoROM5pMfXXytKVPFD4onHimPuX92YDrk1XkwJLsc0hCzSYNSqhWDbfGfUQCB77DMEznTmPPoQ+oVT/xPaLqaQlokWCAI7c9coSYfXxjIBLZERON6CuqgsEvrIFmMGQeLAcu41a1AiNDciCoEnSbG3js9B+ME66XQ7xVnDPj5n3u7f96WCjxdFVJpiuCEDOnl0poiY8d7ZcsBKT2iIPaqyNq4JOGJjAJCXv1Gt+aPMs3vv88dseQjZo1NeQzR4BkRzGq1thb6/P72YQXe7d5Pr3NltmnbPw/i2qnam/PHdVyhHwqH4nloM4ovSFRNVY8SjypqlESyFSFFYcLirGLPio1d5AreqqIROHj/W3Kw9fHz/Pb1z7D3qiD3VeoEo5YwHJ4XAD2tuU3vvdF1odj/oMXpnwmff9jabOrCQzMjIHNOc35qUsSOq3wAVxAfJjnyDwOtL6U3Cfs1H2uzYak1y2dmxAMJ24OCWAnYGZCUVveGw9JVc2ambBl9vGoxiEtjQ9I5gR03P/TkpEjmlujKiN3hkzXpLrGiEdJODLuOpJWdGRbcVRE0imDmSujZOH43pmtcfvaEDXVZFNB3atdU2O+mZFQvZtxu9CMnssiyYl/5E5qLZ5UVXR0xQlusVODJQmdVoSA+EYJBU3VmCmfNKzUaAKvFxf4R7c+zXt7A1QVyee+3BiimlClcOugD8DFbB+X3liIhpm5AloMx7doCWiv6nKr6FM6w17RofIKIZqpVjtWbIFRjrVkxqqZYZQnUxWKMDfb2vfwCFo8jjCPNE7rBJlpdC60Uft7WsACqgYzFdxMM3bZxxaxtFKzrsecS3r4RJA0AXP6tvTpW/ESESFAVaPqQOk0JeoTb2wfc2RiD6M/HV3mB9+7jJ4o0hgpvi/EE6NPBUy3O7xXGm4OVnG9SAYTn95FPtUxJeFCVEk7ZZc3985R1pq8sHjXeIOCoJQn65RY7Zj2x8xSS88UnLNRIS1GvwpvYw5RiKqpDBoXFPtlBzuWSEJ1s/b7EKwuQOfguor9usMkJPPcqEeJTCq2zD5Tn+IyoJPN0zZOE5YkdFoRoikmPlB5Pc/D+TA4qfviwzpPS69RuUJV91EJJyEAQQheqMPRMLxD5gS0GPWqGnIYu5TSG8Z1Sl4ZqkpTThKoJMqwALOj+i4AACAASURBVM56RAW8VUyrBNOE5ldNftRECwrEoxbyinxQaHEPZe5K44z/uE1l3ZibQTi1EziWJHRKIc5DVaOnNbfGPX5QbLFuxpzT4w98bks+mTSO2mbjuRg/fygimtYJZgY6j47dDz6Ahd/Nhi2cYeJTcm+PKKDjBLRfdyi94Z3JGrt5h1GeMh2n+Kmh844lGTWmoEDVh9kzQpU5btSKnaTDZn/Cqs3pqLJxWrsjr++Dig7rRrkY8XgDYuCB6kQXUhJiLduHj1gtPud+n0cVDD5IQ3rhVBLRkoROK0KAukZcoKo1O3WfTFUPRELtl7pER7XQZiYvRJzgwYs6HULtFeKi+vjQGQML+6YNn59EQBBNsNIbZs4yLlNGeUqeW3ylkUqRHEC2Gws5gwBByEtF0IFKG0IQpqmlcAYj7khU0c+jbaDacyEgEgg6NE72B9jkbTbAh+SDw2ifmncFaLO3T/os2sfHiwcL4fnTRURLEjrlUJVjttPh/9t9ni8NNc/Y7XvmpOjG2XqrXmHqU/7f7Vf43s0ttPasdnIS7XhhZZuNdMwFe8AL6S2s1DFUfY/XbM2Yi90DXr1UoSaazk2Fzrk7NL+AVqn4BOygYLg6ZZjMKJvExENCOJpseFBnvD8dMKkTtiddppOU4KL6kkro3vL0rjUjkkWYXkyZXlQ4Fcml8sLeuMurcp6eLfn04CZrdorFzfOKDv1E0TS82D3gzWemlKMEPUui4/2EtANxkYCLIRTnPGqj4GKyf99kxfYzyYNlu+7zveklxi7ldt5nVGU829vlJwevs6JnrKr8yGtVaG7Xq1wvh+iC2NTMGOSU+YWWJHRaEUJM0689Zs/wxvY5Lnb20f0QOyveIxzsEG7WA26Vq3zj9asMvhmdmrfPBVwauH21z5XhHi+sZGyYA3qqxCp3Yp1X67MhKC6m+wy3Ruzvdwl3MsR/sBoICrwNDFenPLu6y4rJjyQSzq/0DQEV3jBzCXdmPaalZTpJ8RMzfw9VCd1bBclbtw8n04YtzCtdfCIEUQQvFF645YQsq7jU26evC1AxXH8kwTEILggX030+vXWL9zoDptfOwaRZ/8KxCdFhLR7qfqB/dZ+LKyMu2KYkpVGai1gsdTlwGTerAd/ceYb9Wcbebg/GlhuXVnixe3uex9Q+r1WvO3Wf22UfVQZCWcZ3sKdrW5+u1S5xCBHEGIL3JLvC5GaPm+dW57VKi10H74laYfKAuHjl9FbI3Qqvdnu81rvAP159gdVOzo9vvsXldI8Ldp8ts3fkJWI2s2fDjnlx/Q7vmDV2hylBxXyaNqdGQuMrboip7kLVD7hBzfnemPPZmExVh+bYQkKiRxi7lJ2yy0HZYVIkFJWJCqiFCngTKAcGe24VqT3Ujrpn8Ekg2MM+zMEL3mmqKnA7j+kBAztjzUxB/DzG6Jp8pb4uuNLdwwfhuxdXqXsaVcXjE3/oA/PD+B7ufMlza7tcyNqSjbtTJ/JgeaO4wE7d47uji7x65zyzWUJ9q4POhaQAVQjjtMvu1S5dXcSER4lp2ppA7i2vz87z1uhcPM/GLMs2lvgE0TQ1ExdY+4Ej29a8trlJ79m46/fuEyP3TWhbCkUyihE27sReNOludHbHS3vCdGuFv/8vrbN1eZefvvAGf3H1ADg0WaqgqdB8LnuXz118l++tX+ars59mttPB3jGkuzG3JkA0v2wM3+dXKj71wg3W0ilfGrxDX+dMfTLPZF7MhnZBcSNf5e2DNaZFwuigQ6gb+0oAFUAHfOYZXTLU6QA78ZipY7ZhqPqB0HHziBlOcLnG18Lbu2vcSvo8N9ih3y/wCLZxVLeK7ILd54X0Fgf9Ds/2drlT9Hj1znkOdrtQK6RUBBXoXZiw3pvyytoN/sLwe2RSkUl1YmrBnuvxmze+wLvbQ9S3V7j4hwU6r9GTfXABN8ioO5pbLuXtz6xjxXHJ7gKHuVl7rsvXbjzL7k6frUlArI3TeE+RKQZLEjq1CKpJnAsBM/GkRtgvH+zjtOIwyhNST9k30YxwoBxYI2iJhCS1Q5cJOKF2OmYuN03AWrRk0VMFPanYMfus9afUlabOFbqMzm/xkQN8GvAGbL/kSm+PgZ3R1zk9VcQGZSc4oqugyWvLtEgoWwXkjm40aaPyJhKdt7HRV1ACKrbwiLVVzfN8TAuoqkgQubMU3pCqeoEAA56AVp6uKlDiuZpts2Jy9osOZWVwtaIuNUoHNlfGXO7t80y2yzk9jtnY9zKLgzCrLFVp6BZgRyVSOXBRTXmrcJnGmxhhO14fqJo6vdEkg5FF1XEQ5mnEkoROMYISqB3ZjSnJvuH6fsqe79xzDLRDsDiuJne4YPfxXxK+/9JW9H009Wf7eUZRGcrKUOYWm874qSvvcrmzx4vZrbs6Ex4qIsMBihU941+58m32t7rcfjE6V+ugqL1CSSBRbt7K4/n09rwdq2vC4vZYuHzmLDOfsJN3mUwy/HECWnQQB9B5wE4CduIw4wozNNHcPClw5IUyt9SV4Vbap2tKVkzBpWyPlDr2BAqa3FumkgJwNbnDlWSHK8kuOxs9fNPLSOM5nxzQVSVDHZ1G98tgT8Sx1TugdJrbr2jeWu3jEqg3K1Tq6PVnrGQFX1jZ4+fXXmWop6yqHIegUOgQuFYMUa/2GV4PZNsF6NOngmBJQqcbIhACajRFTTVq1iEP9r4jf7T4eRj/pbUbZOtx08cOhDFfqERzox7wdrmBJrDedAzsquKeYfvF9hI/1v3zI//zITalb9+/day2XRe3635sWM9CBnOzgQsfw+l5bXCFjiZYa1YtHqIEJAiqBl14dOFQRY2qAni5q9IdgAChUjgXmJWWgzJDEaIfSmSerBg7GVoyiWO2E3FNFNLflc9zPNHyXlDiWUtmjLKMcEE46GcMezm/eOX7XEl2eCbZZksfzD+PxSZuLfaqLp2bsHLNoScVoVVCp6ySfklCpx0hmk04T7Kn+D93f4RL6R4/3H2bXuPEvKtzIXEu15HK9Gbz5MEe6VQIMVdFLZDDB+UPnaQAtPiFvJajLVtPghY/V0L7VUZVNwTUEkqQw4QkpyDX6JEiPfAkeyWq8kjt0bkn3bFUlcV1fXRQt88Tif4kH5Vg4Qy5i/VqNrgjqiyuu2mUFkAjILHZR1v0uphacC+0xAuwnkzwPWEtmzJdSVi1OetmQtZ48/Nj6Qotee+5LnuuyzuTNbJdT7pdoPLTOe4HliR0utGUblCUEAKdW4Hfeetlnl3f5VPP3GBopvdsIRGJwC40D0vnYd+qMUHgsE3pked+ABHdT4UtJuR9EDzCfpWxW3QpKhPNsLCgakIkApUrzESwB0Lndom9sU+wBozGjmu6NwzVWJhdUFQDBw2BzJepAnWtmFaWVNfUXlGJJqO66/hjhIojiZQfpias7RAA8Gy6zYYd0VUlK2qGbkzT9j0nPj3y+pqYfX2jHvKD2QXe2xly+XqJfXc7OqSXPqElHhuasGwyDuzd7PKuBPYu9TivR/c1CfJgyX3Cnuvy5/l5pj5hv+owc5a8tsxqS8dUfHb1Omt2wgWzz3kzeuRzu7QEfPOaxzd966+qK42UCqkFVTRlCg0f6UKwI7CTQBDBdzNCqvGpwaUKM4s9rV0miNPxeTqmC9SrDvTR3KC4Jj/vNaSbNmuPCi4oRq7DNw+ucjNfoWtKeqbEiKejS6w4Lqd7rJsxXVWwqvLGFxeV2bVyjT/ZvUy+m6Gqe/UVOT1YktApR1BNCwdg8PqUbDdl+7OrfOe5ywz1ZJ5lC4cKpZX123Wf69Uaf7x3lW/86QuYA026K9gxqCpgcrg5EP7ky5fZ2BjxM1t/zi8MvveRxp7PVUM4VEMx5OzJxR7pHQ1QekPhNNU4oXNTY6bQv+bRZWiIRDBTR7pbEgSqFUv5qVXKnqLqCXYa6F8rUaXHvanxVmLkKRXKFcXO5xVu3c1LrpQEjPLNRA43n6QRz9vDE9G87xLCxCe8lm/x+7/7eQY/aKJ5ieBSKNZj0mjnuRGf2bzJle4eP7nyA3qqIGkKbn/7/c+w/wcXWLsTUMWMkD7+4QYfBUsSOgNoZbjen9GZlnQ217hVrLBT90msOzFaFssFEkYu486sT3bLkOxD55Yn3feoKubZ5JsJBy9ZDjoZB3UHiOTxUTbkkXWIR4cYw4+h6JakVNPnRwghRsR0CWYayJpcpmDi3DU9rTE7E0JqKDYSyr6iXBGqlaiYVOHQkxI9BkTwmcF1DGARF8+dNGHwNlqnGtPHijucEPKI4FHMnCXbFgZvFbhE4ROhzhQ6V9RdYbLa4Xp3lUzXVH2DC9W8VcveuEvvRiDdi34vlDocC34KsSShs4C2erp2iPN0b9b88R+9zNfPX+WXPv0dfnn4LeAwMgXMI2EzZ6l946cxcPCcIliF14FgLHXfc/UzN3huZYdXetePtL/4KDic83WoqzIpY45MECpM7FWkYk6TZI5yoAkilKsao+XQL72eMNvKcKkwuqKoe+DSgLeBqid43cXkXew0oEtPnSnKnlD3BJd6RMAax1o2Y5jM6OuCri7oqqJpCVvPI3ctoZ+UK3Xk2I5h0SzOpOJyusfsR2a8s5GhythlUtVgxpAcBPxbCbd2LrDzfI+fXXsNjefV6iK7VY/i/R4X364wkxopqliecorxwCQkIhr4OnAthPDLIvI88OvAOeAbwF8LIZT3e40lPka0TuoQyO7knPt2n3y9w59sXuYXh3+KJszlfAsfVJMgGDeINzC7UmPXcvrdgq2VEcNkxk8M3+CC3aN3nxD9w0CLPxJNSsShpRni6KPz2zQkpBNH1Q+Ig6rbzJqvAqoOFAPNbENRd2B6yRN69dzp7FZi0p+qId1R2LFQd4SqH4kqpLFENrU1w2TG0M4aAirJVNW0O6nnBN7mSd0rqgf3d9xrYq/rC3afn3vxB1y/tMp7+wNG2z3UgWHwqjStbwNew07aY/rZhERqXptscW06ILulyN7eQ6rDcUKnMT+oxYdRQv8x8H1gtbn93wH/Qwjh10Xk7wB/HfifHvH6lngISFmT7TrEa965sc7/MfgSVzvbfLn75uFVncCKnrGV7nN1tcfNFwaESjHcGLPRnzBIZpzPxqyYnBU9iwTxMYwVUs3ceI2i5FBVtD6ZFVtQesN2p2TctVReM9tUlLlG1SEWjHaEcgAuCWDarOgwJyKfRv9R1Y/1cS4B141KSTo1Jq0ZZDkb6TiqIFWSSXlPAgLuS0T3I2rVOLm7quBKZ5dU1yTKcSOp2F/tsC89VC5xNJKA3ZpSeMvb9QZ/8N5zTG/3WL99ek2vk/BAJCQiV4C/BPw3wH8qIgL8AvBvNw/5NeC/YklCjxXtaGiZFvRfq+lmCfnagN/Z/TxrL+zwqZdvsq7HTZFm4JLZZV2P+VznPf7yxrdxQchURSLuyIZrTbBH3Z60fc1s3j0nbVqDxFt9nXMx3aenS0qnuQYUK4ZRNwUnsXg0QNBNcWprn3miedrUlfluM5K5v9AgWgfEeoZrE1azgpdWb/OZznUyVTHU0zlZA3dliS+uHfhQofr2eDOp+Ine67ieUA0NZZMWsfPZ/pFSj8Jb9usO3zm4hPn9Ac9/tyDZn4H3p1r9LOJBldD/CPwXwEpz+xywF0Jo9eB7wOWTnigivwr8KkBmVk96yBKPGOJiBbkC0r1AdUexd67H2+UGubVsmoP5OJueFGgCW3ofOOq7WBw4+HGi3bwqNDkyoU2o9HR1SRU0fVvQS0uUBLxX+FrF+q82cbGFP3ZbhcOcIIn+H1RAVMBYRz8t6ScFvRN8QI86FeH48Sa4IykJPqj5tJG8yeF6o9zke6OLvLc/INsNpHdmSPnxTXV9HPhAEhKRXwZuhRC+ISI//2HfIITwVeCrAINs6+xoyMcEud+Au8XWno2jevj6jN5Ny95uh79T/hz9tSn/xovf5Audd0jkMHL2JMywT5pIlAuKDNXMntf0dY6SQNeU5M6yW3SpnGZSJhS1pqoMZd58laWpZvEQgiASkEYlae3R2tNJS9a7M3qm5MX+bdbslIt2bz6ocNH5/qDq5mHQ9mJavN36yW5UA+7UK/zmu59n/AebpLuw8k4eHdHudDuij+NBlNBPAf+yiPwSkBF9Qn8bGIqIadTQFeDax7fMJe7CIhG15LPQYzioWFdmbh1gboE3GxRrCZOx5v0rQ17Orh/ZPI96OujDQDWZQ1oCrvGdrOgc6x2VHQFQeEPPlBTOsGO6TKuEsUrm1fBK+YaEJLYrAaS5L00rrHasd2c829tlxea80LnNUE9ZUbN7Fv5+nLjXeR/5jBvFgDt3Vrjy3Zp0t8LszqB+NNHJJwkfSEIhhL8F/C2ARgn95yGEf0dE/nfgXyNGyH4F+Acf4zqfCpyockQIWhHSBLTgUkOwx8wjH5AQEBe7CYoLUbI733QXDKQ7BYPXFdkdxW+ln+f3Nl7kS5fe5RfXv0smFUM9+VhGFX8YtCpINV2eEU9PFfNGbW2925qZUgXN+SxO29grO2z3etRtSUiTW1R7FRMPdVRYq0lOpiuGdsb5ZNRUvE8fedTvYTHxKW+Xm+zUPX7jzR9m/O4qvXc16e4MPaliq48z5JBu8VHyhP4G8Osi8l8D/wz4u49mSU8nxIfDfI/2izZP41X4rsUnmnItoeqpwx7HAXQZUC7EkHUVUKXH7BdI5ZCiRJzH3thn7faI0Mvo3FmhGK7yT376U3zmizdZN2NW1AyrqoeetvGocFgn5bHEnBoXFJlU9JqePscr16c+ZafuzydxxMLcWJRrxdHXBVYcG3bEqprNM6G1+I9lHtjDQBMY+Q7fGj3De5Mh7mtrPP9HBXqaY3Ym84uJ+HjsZ8UpDR+ShEIIvwv8bvP3G8BXHv2SnjJIdGKE1OA7NrZZ7Ri8UXgjBC34RCj7CmeFqi+4DkdIKLYZjZM/pQ6oCpJJgrgQCaqO+TVSe3yiqDsKryHMDH+0+xzn0gmjfsaKytk0o3k/nCcFMUTu59Xliw5jG++g1GbuQF/sUW3F0W1IqNc4nhWeRD6+iN+Hxbbrs1P3ebPY5Js3r3Bw0GGwGzCTCpXXZ5qAYJkx/dgw/0JllpAY8q0eey9a6h5MnnWwWpF2SvqdgsTUDJOCRDsyXZGo40mHgkeame1C7TWz2lIHRV4bcqeZ5AmzUUYowO7G/sXpTcOf3XqBuhf4vYufotst+OWr3+VnV169Z1j6ccFyd2uNFq2D3aMozcLcsEYxteZcm3rQ4nEcn+awNKXtpf0Ho5f4x++/wM6tVTb+qeXytiO7NUXvz5pukGeTfFosSehxQIRgFGiF7ya4zFCuavJzUK0EepdHXB7sc7F7wLOdHVKpWTfjeR3TB4WO29YcPiimPiH3lvfyNd4ar7M363AnDNFjRbKvsAdxvPG0kzCu1bw+7EnD/QhjscrdStM8bSHE/iSRaRsRcwgj34mfzXTI7k4fc9uy8k5JemMSs6Hd2XNCn4QlCX2cWIhaiQ8Eo8FoqvUu25/vUA6EfNPjhjW2O2NzbUTflry0epvNZMTATFnXY7SEeV7Pg+auDPV03p+5DJoNO+JKtsvYpfxg5Tz7Zca1O0PynYzQcaxvHjDs5Fzt3Jkrh9OE1qltm7jak0JAVlxsX9vkXO24Pm8U57lWDPnNV7+Au52R3VasXw+ko0Cym0cCOuX1YB8GSxL6JCFCsNG5vPvDjv6FMf/ClTf4+cH3jzysp4q5w/RhSyVayb9Ym+XS2LTsR/tvMPUp/6j/Gb7Tu0g/LXlpcJuhnXLJ7mHFndhO9EnHolP7SUBbr6eaTgEO4cBlvDq9wGv75+n+cZf171fYgxlmdzqPZooPZ9b0OglLEvoYcOhABLSmOr9C1Tfk65r8nCI/B8OLOzwz3ONSujfPT2mv4I+iRqv1ixxH+/oxQuTRKrav8AiFt7xfDamCPtZM68nY1E8iFn08LaqgyYNl4lPer9YYu4w/G29xfbrKnXGPgzs91MiwectjJjWqaNIpzmD4/UGwJKFHhcb0koUvk9Qen6Vsfy5jcgX41IR/9eVvMTAzNsyInipY0YdJcifVIH0UNXJ8CqtuZu9YqXEIRjm0iu81c7Ga/s/GF3lNtrja2eZznfea6aGP36x5UqHEz3t5txeP7dBlz/V4u9jg/3r/h9g+6CHfWWH4umcw8Vy4VaCqHMlrxMX+4NIkIQZ1ukY4PwosSehRoY1gGH0Ycu8mVH1LviGU52qeW9/nR3pvk0k1DxEvFkryCW70qIY8iY5EVDZzxUoJqGa659OOkxTpfA58M9Z54lP26M6DAVXQ3KwGXCuGvD8bcHN7gDuwDO9A92YVG7DdPkCcj83omokpTzOWJPRRIRLVT9Pbpb68Tr6ZcXDVsP+VnN7KjM+ce4dLnQNe6NyemziL+KR8L+37tDVaW+k+eysdpnWsxwpB6NqSRDkKb+amm28mPjwtpllrYmVSzdueQDx/kxCjjdeqNa5XQ96cbvCt25eYzFKq93vYg9hwP90N6Aq2ph5VBdKdGeYgjwmkPhwtteHsht8fBEsSelRoohl115KvaSZXAv/657/JK533GeopXSmAJ8Osacsi+jpnPZkAPa5PDLXTaBXbrPqFSvR2RE8iT47T9+OEmju4o1qcK6IQydij2HE93i+GvDE6x861IWZfs/Ya9G460u0C+/5OzPFplfFTTDIfhCUJPQjk5C+Q1A5qR+h3GH/hPMWKZu/TUF/NOb9xwLPpNt3F2qcngIBaKDybZoTuBEZJxnoyofCG7aLHtE54d7bGb/vPk6qKNTslVRWX7B5bZu9xL/2RYT77DOFGNWTH9Ri7jO2yz8xZrs9WmVYJoyJhMktxtaaeGagUeqLQM8FMhfXtgC6ge7PGjir0rIp9nyXc87uzxCGWJPRBOOlL1N7nPWE6xW8MuPllTXm55BdeeZV///zvzf0FLZ4kAmrXctnsctnsxjt7MAkJv7X7w/zgYJNr4wF/duc8VjuuDnYZJDl2xZ0pEoJ27JHlzWKT18bn2c57vLc9pCoM5r2UdDeaVhduOHTuSPZypKyRWYnkJWgVZ5zBERPrfjPAlqroKJYk9AGQpndLUDKf79VONvBrK9TPbTC5mFJeqFnfGHGls0tXVeRBzxPoniQCOg61kFtjg2Zop2x2xnRMim0q0NeSGSs2fyytLj4JHA+xx0ZpxKb7psmv6seOj3LHRwIqK6gq8Dp62ppuB0vl8+HxZJPQSR/oxxFJuN/7uGhyidGEbhYfnpdQO/7/9t4sxpIsve/7feecWO7NvFlZS1d19Vrd5IjUcBbPeGQPIZkmSNqiBNt8sEBQFmDKJjAvhkTLBiwSfqD9ZgGCZRqQaQ8ky4JBULRowqQIW5Y9pp8stDjNdWZ6pnumu6ere2rJqtzuFts5nx9OxM2bWVlbd2ZlZnX8gYvMGzduxLknIv7n2787f+5ZNv/NORfO3eWvvvB1Xs7ucMFO2PTDxWFOMwF1/eOhbeMjgS+svMNnhu9RhIRCUyxdOQ1Pbp6+PgbR+G5iF1RXMnMpSeLRYKgvNjQjQ1EJkxeFdMfx3G5GMq/QxCFt8vE+m8/H3NP1YXC6SehJoyOjvU54KCDG7F/lRMAI5TnhMy98wCsrd/nc8F0u2zGFJlTtg32aCeggOs/Zuplh2up+3e/owgnOWgT1o8BKIBBITENmG3Jb42wgJB4dxkaJIRPCwGC8JbhWGpY9ybhXrz4aTp6EHld8/ajibhdIuFxArKtGOMjwo4yQWWZXMppcKM4L9RrkG8rl1yeYWUV9dZ1mYJldVf7V8+9yNdkil73mdGeJfA5Dl7KxKOT+FJIP7PU+s6K8mGwyMgWzQcb3rd6hCTGZtwyWt3cucWPjHH7a1nEKH9/o5uPAyZPQo+CwUqaPS0bLhNP9v/y3zetqVhKqNcfuS4Z6TaleLnj5ubu8+9YVLn7dIWVNeSGlOG9pnqn57OA91s2MQpNjLwj/JPC0Es79EKU8zzNul2fcbnTLD6M3cxoyaiz/h/ssm5MhRRrbbS/X9unx0XFyJNTp0y4+uOrM3rYWamXftkXoimlLnnZ81LWaEllu6LkPwcX9Y+vgKEL7NBYNq4dtL6o8NsVrBkr1XIUbNBjg+u0LpJsWUxeotexcc0xfUC5d2QVYSEA9zha8GsaatQX13SJn7rIdx6TTVlJ6Ntvh+fM7vD1PCKlrbUD0RHREOBkSWiKgkCWxdvIgQZ2gi0LtEBITPRSJEGzHOJFAmkxQ22Y6aNwe3FLFwbbqYOflqFeEkIDPweeKzxR/vsHmnpev3OXa6iYDW7PiSka24PuzWyTi+aWv/dvo751jeEsxs4owTNn5fMlf+dy/4Goa3dVFSM68CvY047CcPItSY7heXWTscyY+YxZSLiUT8kEsJRtbP3v+dP49zl+d8k/kM0yGL/SpFkeMEyUhNQacQa2griUaI1FiMbGsqRqJ5GK77a0Uk0Gn/XT7631ISC00Q1oSUvwgoFkgXysZZBUvrW7xfcMNhrZk3c7Ipea5ZIughrq2DHfBFUoYpjQrCflqxSvZBiM7P7beVD0+Gmp19xjWu0Rcr4YCSxFSZkuvaZMxNFUMYIyiTtu2ORbEX01KxmZZOu+J6Cjw5EmolYDUGHSQUI/SSCzO7COQ4Fp1yUirPoFPhGYYReFuW7MC9aqiRmMnzmWThnSkpGiqseld7nFpQ5J41oYFmfVMm5R35pd4Id/iuSQG771VPsuOH+KvD7n49YJ61XHnsyuU54WXL95cdOmEs2+IfprQpVi8W5/nO8VlVm3Jq9ntRV95FDb8Gt8tL1Gq4261Shkcc59QBUtiPHebVSprWTMFVmoSPCMzZ+gqggOs6SWhI8TJkJAIWInF3FOz3P9tiXTaIu+WhQqmjigBGWKvbgPNitKc87HTptMlAxEgsdMmAtYqIkqa1WRJQ+o8q2mFlUATDOMmowyOVDyVWjb90oHPewAAIABJREFUCjfLcyS7hvTWmJCeY37JUV4KXMqn5KZqxfWegE4TusDDcci5Va5RJjOuJBmmLWFiiAbn2/WIKjgmTUoTLFWwVMFRekehCUloWDF7+X45NYmEVuo2CB+P0qtPAk+YhFp7T2IJuduTfpb3UI3tfVuSidKMgIJ4sAVgWjISYtvf0B67y07uWgOb1lwkoKKoCN4bGmuwrVHRmbCICD6fTDEENptz/JMPPsOt7RErGwqNp161FJ8oOX9xzCdWbh9rm+AeHx5dJcmYaCrsNgO+MXsOZwIvpFucs1M+qM7z3vQ8jVqaYAgq5G2MEMBWs0JtLSumYsVWeDXMNGPuE4wnll/tJaEjw4lIQiG1+IGLNqDDUrNCtDSrgWBlUWbHNJDMlGCjuiatYVqalnBElmxBslDZI9EZMBqTEI1i27o5TgIX0inPZ1us2xlWAneaEe9/+zKD9y2rNxrEB6pVwxc/8TY/vP42zyVbZ7IO88cFHmmjwYVpk/Pe5Dwiynwt4cV8k/fn53l/vI4PsqgseWEw43w2w4iyVQ+Z+ZRnXOz6WmOZhozCO0ytkYR6HBmeLAkJYDrjc/x7z+fdv6qIF8yS8S8sjNTx1alqi9eDYKJqZp3HOY+zbQ1mBCOx3KnXWJhqqx7idg3ZdmwmqIOMJodRUjCy856AzgCGpmI9mTMWZasc0njLdj0gkXPMfRK7shohdw2uLV8yrjNy2zCwFW5JyvVqKEJCFc5GWN1Zw4nMqhohJPtjgg6SiDSxs2jnDVMDmkAzlDapMHq7QkI0SHd2pdZdH8sodAdTrAtY51kZlKzlJUYiuQWV2FhPagpN2KxW+Nb4CqN34PybJWqF+QsjygvCM+lk4T1bLnTV4/Sgux7PJ1uMVue8U17m/ek6ReN4e+cS78rFmJSbz8ltzbP5mIGt+M7kEu+P1xllJQNbt4tSPNYsZNyqzzGpMiTE+7GPETo6nIxh+p5tLOKDZEnXXth8OxVLWiloIQ1Fr9gDeaALlDYBY5TEBjK7X5LpCKkMCXfqEbtlTjpR3LikXs9pViw+g9zUi/bBPU43cqkxNnDORRXbiuLb/vSJ9QxdxYqrWE9mDE2FM2HRPBL27gmASi2zkFJ6u3hgeiI6Ojx5ElJFmoAtA2oFnxlUomSkBmTZlrPsNeuIpktuT5WQRkmIhxFRC5HoIXMmkJqG1SSueiNbAPD1yXP88/evUdxa4aUtj5nXFN83YudVQ3G1YWiikdJjnmg96OOERZ9KaS62eoZn3Q4/cunbzEK66FE/tBWrtliUcbUof3p0k2fzXQa25moaO6BcdBMSabjTrPGH2y9wZ2vE1aCQOPAB7R0TR4InS0IKBEV8wFSekLbRhtLZeARRIlEtLTL7PGgdQTkIaeuWN/s/Owx7ifHRGJ3bhmfSCQNbk7U9zj+YnaN8b5XBhiEZl1A3lCNh9pwnvzhf7BcwT0WZ006lfBqJqOtf/4zb5YKdANHAXKtb1Mr2atj2QwpNeSXb4E/lsVHh0JRYCYxMJKrNZoXv7a7RjBPEg1rbS0FHiJORhGqPaVnBuNgSOSSCHCb5QBsnFNMyusjnaKBWVPRe8lmyBS2OF4QQDFXjmDYpjZqFyP3V4iVmdcr16xdZu25ItzWW6NQobemqZ3VQPnIb5tOOLo2hJpbrsBIWzRafZsSWR3uqeK2OG/X5mK7hJjzjdslNHb2kBJI20nqjWmXr9ohk02GrGumz6I8UT5iEYvkMKZvYdaCOyYAhUXwmLPJAlxNWJXrB1AjNQKjWlZDECOhFhPRhJHRAlArBQANF7diRPLpii0F8/+YFBjcNl28p5749xcwbzHgGxJyz9YsTnh/t7OuMelaxXFd57AcxME88F+1kkdbwtGG5M2uOxoRVLNOQ8ub0CnfLFT517ntcSbYZmTnP2wmJwDhYajW8Pb7Eylsp+abixvXHulHhceBkfI6q4ONLfIjJ77UuIqODbYMOhf25YMt4kFte2x26BNYAPli8WJraUrh0satvDIO7hvyuku147LSKNYR9aEt2QuI8qW2eChUMoqE1YNgNA+7UI0a2YGTm5E8hAS3jfp1tAxK7poaE2jgM0HVdK9QxqxOSCSRTxTQ9AR01TkQd6yB1g5nEAnW29ARn8ENHvWpj0mmbKR9sNFobD8kklt2onUbJadkVD5F0vCBBoBFMDaYR0m3BVGBLsKUiHlypmAayzTK24y1iAfOuaJXaWPbjXF4wcnvq2FlGINpBZiHjtd1XeWPzCs+t7vDvXpksIoafVnR2r65ER27qtuVR7ED7ZnGVIkv5geQuVoS7YcDN5hy3Ntd44d2aZLfBTMtFe6ceR4OTjb5SjQXDRRCviI35YjKwi5QNYE/qCWAqQIXGC0qXJ7Z/ZRIv4CMB2VIwpZBtKslMSceBdLdB6oCbVNCEGAHro/6/qLi4aEoHmY2lP886AUF8EAtNY+zLfMSd7VWsCU9FQbbHgZVAKp7MNAxsTaOWzXqFc2622GcWMrb9Cn7uSLdr7LiAukGC9iVdjxAnp44drMnSeCQIdlqTaVeuoy3zYWVR2qPZEoITsk2zqDekhphb1qpfpgHxUcoxFZgmkG97bBGwhccUdSS9qtlHOAs8pR0TYuRvynvlRW6Va1zfXifcydgwq2z7IRfshBT/sYgIj40NG0a2oAyO1zau8cHGOs9eeo5XX91gZOb89x/8KG9uPMPgnRRTlYjv1bDjwMlJQssP/qKzBRgfMLMSjJCYGEOEa/8awMSk15DamIlvTRtf1EkxYOoQbU0+euKixNXsGRQfoNPfE4Qm0a1vHuT/P0MoNOHd2UU+mJ5jcmeFwW3LPM3ZaYYUSdJ6yp5udPFBiXqGpmJoK753Z53hHw248VLK61eusWpL/uibLzF6M2H1g4CU9UIN66Wgo8XpS4ZZEFJbkF4EbYju+yB0XS1tq4mJjdKSKNGY3MYhiddFYGQ0hO8RUEcyH6ebaeEVU2FSZ8zrBBpBPAuv2HLf9Y8LEmnIpCF4ifbCqeFru8/FrhtbjnRbSabt/dTHBh0LTicJdepa09ppYJ+KtI86lhNhlztoHPy7fIrHIB8VcOJxxrc9qs5uYJ9HmIWMjfkKmzsr2JlpVVchM7Gk6VmPgXoU+C7wDBiakto61AtuqgxuC1/7k5dB4dI34dx3CuysgqruvWLHhNNHQh0OXvAD75dVpo5UHhTF+mGlHtG2Ns3BwkdnDAFDrbFgV1E7fGMwXhY5eV19pKfB+P44SCXawLo1zlaQbBkkCNmux04qTGs77A3Sx4PTS0IPwWE3w5HcIItOCm1EdwW3ZqvkrmYcBot6xZ3EcFYaA95uRrxZXOVGcY7xNCfMHWKUZkXQ3DM0JbmpFz3HnnZ0fdVGdo6RwOr6jNmzGckULnxDcUVgcKuINsXeFnSseCQSEpF14O8BnyKunf8h8C3g14FrwLvAT6vq1rGM8oQgIXrYJkXGbp7HmjLGttKCOVOqy45f4d3ZRTbmqzSlQ+rYW91nikk9uamxBML9eiY9pViRisR41gcF3zsfcIVh7TvT6I4P91fpexwdHvWO+2Xgn6rqDwKfBd4AfgH4iqp+AvhK+/6pg5spk+0BN8cjbtXn2GjW2PYr7IaccRiwHYbshpxa3SIn6zShU8F2/ICN+Sp3ZkPYTkm2DAShGQWyQayfc5qN0gtVUpMjn2crgUuDCf5iTbXWel47/ewh3tQeHx0PlYRE5BzwI8BfBVDVCqhE5KeAH213+4fA/wv8zeMY5ImgvQmzHSX9XsqWH/HOldih4ZydM2yLoAMx98pNFt0cTotdxauh0IRKLberETfGIyY7A4bfi1Ujx6+AXCy5vNaOnVgo3p9Q4OJh5NLNZazpEwvWr5niyObZxCplfGK0wc6LA94un8XnFudM6209HdfyacajqGOvABvAPxCRzwKvAz8PXFHVG+0+N4Erh31ZRL4EfAkgd2sfecDHgn0VHtuKjyGmbUgAUwpUhq1qQGYaSFlEGHs15K1nCUNbdfH03Li7vpXY6gF17dDa4ObQBQbng4rVtFw80OEEpbnDSKUjpnEYsNGMyKUmTdqAyiMk/JEtOJ/NIPOExKCJjfagvqnGseNRSMgBnwf+mqq+JiK/zAHVS1VVRA6VWVX1y8CXAc7lz55OudaY2Etqkb0vaJ6AMYhX0jGEzPL1m1f57uACFwYzRmnRVuIz5K7m+1diyP+LySbPuh3gZI3VFqXA8tXJK7y5e5mN6QrlLMFMHMNbgeHtis1PZXz68g1eHG5hCFHVQQ7tWHoc6M7TGfcTaRZqYSKBWg0bfsQ0ZPz+5GVev/sS69mcH7n4FpfcLmu2YMheW54Pg24xeSm9Q7LuefviRYoL57FVTlp7zLyMAbK9UfrY8Cgk9D7wvqq+1r7/DSIJ3RKRq6p6Q0SuArePa5DHChGwJnaDNXvbYs96g2j0kNm5MJ+keB9vxipYfIjBf8Ok5lKbCNl1aDhpD1NHJnfKVW6NR0znKVpZbCUkM4+b1CAZLw63uJLsxiJfSwT0pNCRR+wL5kkJJBJfXUxWoQkb1Sq3d1cpVyzj9ZyhKVkx1SNV1HwUrNkC2OLcoGCcCz43cXGC1ibUk9Bx4aEkpKo3ReS6iPyAqn4L+HHgG+3rZ4H/qv37W8c60uPAkvFRQiBkCX6QoM7QDCxq4+f5ZiA4w7y0NFYZzzLmVYIxsXZx7S1vm4sM3YgyOMbZgESatia1Z91On0gdoi4q+q5f5c3iWXaaATdma1SNpd7OWX3bYQuYX7CU51bghTk/MvomI1Nw0cwxKKVafFvaosIuXPb3I6fl3/Qo+3QpEyme3DQYUVbapoRJW1LKipAgTNVThJRtP6QJFmsDPhi+M7vEVjokGca5PQrkUpO4hivDMbcvC6KOdDvF7BxoyNDjyPGocUJ/DfhVEUmBt4H/gCg3/C8i8nPAd4GfPp4hHhNk6eYKsUSsJpZ6LcFnhmpkCA6y3UC+2eCzBCkNai2lFyqjGKe4pKGsHXVjMSZQBcfUZwxMxfm2iHoiDetmhldzLETUebW6SokbzYjX7l5jp8yZFBl1bUnvWi680aAWdl5xVOeEH3r+Bj8xGGMwsf4yge1QUyoUahmHFC8Brw/PJnuQBLX8u01bdnVoatZNQy7COZPhsFjZfwwT5tRq2WpWaNTgTEBV+GC6zma5wvPZFt/XCuAfVfIcmpIUz/P5Nr/3TAzBWP3A4ezp83g+bXgkElLVPwS+cMhHP360w3mC6FJDIKZ9iBAyS7lu8YlQr8agxXQiuMJjahfrCwdih1hAgxKCoCpUYjHGMG8SJk1KbSxGlMIkrLaF9IFF6+ihlB+ZkBYPfnucbT9ko1njg/I84ypjVqbMZxl+bhlOBTfzNANLcUmpLjdcW72LwWAQrMRUhlykjZ72YCo8Qq4NHtkXyOgxCyO2R/aCOJeqGHbk2BWTj1JQ/DsUT95KPAazj4Bq9cy0YtN73i4v887sEjvlgKCCD0LRxNu2DMmiPO1RITMNYRDwA0FdLwE9CZzZiOkjQQht7llMgi0upuxeM4Q0BvEB5Jvgtuak6wmmsmhqYpcFy15gn0BTWRC4a6Pa5UxgqxqQGs/cJ6y5oq1PrYxswavZLVL8h17BvRrqth5uRwbfKq7yJ7vPsVUOubOzSl06zO2UfNcwvKGkd2b451dZ/cxdfuaV1/nXhm+SSDyGJQYvZuoILXkEAl6VGk9QpUapVCkVpuoIKkw1AXXkUpNLQyKBXPxCvUpbosnE7SMaQ4pZFBnbL23shIJv1znvNRf43Y0/xfub6xgTK3D6YKi9ZWZC7JSqGQnNIsRgWSLbK+v66D3izrk5+aU5hQyoh2Z/vFCPY8HHm4RaaEtEwQk+j8XtfRo7fqgRpAmYRjGeaJh2e6VjtWtR1Gb4N8FQeofX2MeqMZ55SHEhqiGJ8SRtYKP/CLaGLhcMoFDTqi1Dtsohu0VOU1u0Mti5kExiFUlNLD43XB2N+fzgXZ5zc2B133GtGPaihCKx1uoJEii0WUrijQRatUSciCcTjxWlKxeeiyERQyKWTB69QEitynYYstmscnc6pNjNsLkny6v420M8ZxkSpiGL5zF7NrdwIJr9UcgnqKHARHtV0lCkAbXu3rpXPY4cH2sSkqCxYFpiCQMXS8hWEjt45BCM4nPBr2aodCViheo8hIE/NN68qhzbMoj9zWwgtZ7z2YyR21PJghrGYUCt7p7uHcur92Hba3VUahdxMxOf883Js2xXA+7MVtieDKgrh+6k2Lmw9g6M3iuZPZvw3p9fo7ji+elnvsEnkx1G5tEuv0EwWIZiCBKlo2EbQFNrRbSgQCKxHGbS0pgVWah7j4OxCm+Vz/LHkxcYv3GB9e8Kk5eV8GrTSkSRFN6eXKQMjpcHd/nc8F3QWC+pk1CNhrZ8SUeUzX2lo22/wrYfcrM8R+o8NvM0WYIO0tiUoYgE2Lvqjx4faxLqoIkhpDbWJ/JgfEtENrYWCoM4TW4azS/1qkB+yAqpQtNY5oAxijFKbT2lj6qLFRbF0aYhw4u0Wdx7EXG1xoeF++SnVRp7Z01Dxp16xGa9wht3LzOe5vjaEmoLlcHOYlDiyq2Gwbc3mD37HPUPzXjl8iZ/ZvA2V91+CehB6NSlTnE7bm/1LDhu1Wtcn66z8r5w/s2SepRRXxNEBGPiHG7Oh8ybBCOBzwzeIxFPaI3z7cgJuvc+N0IarVn7YhADhs1mlRvVObbrIc56rPOxxXjqYkOGxbXuSeio0ZNQh7ZemtlLmkZFaQZCeT4hWCHfCjRzobzQBtKqoE0s6yhtm6FFWWxRrAkYE7hbrFB4R2o9A1tjUJzxJBJYc3OGtsK0BmsjgVyavbiZttSqaZNLi5BQq+P96jxvjZ9hXOfMiiwS0MxhZhY3E4Y3BDtXfGooXn2G8YuGT7/wAT84usUz9l417DSgVk8gsKsZG9UqO2WOLRVbeGwF88oSrEFa+xBA1VhupWu8vXKZRDwTn1OrjTYztdRqmTYZAWFgKrI2LKAj/jI4PDGe6m65wrjOGM9z6tLFvvNWECu9WnaM6EloGRolIfGRkFSgHsHkqiUdK6PrJcEaps9nbaEhWluQQBr2LZLGKIM0GktvjEc0zTqJ8wzSmqBCUcepXx8UrGUFqWlIrcdJaLvCNjgTC7EDi1SQWUipguPdyQW+c/sSvrH40oIX3LYj2xTyTeXSH46Rsmbnk+vc+WxG+ak5v/Di/86LtuSCzfAa7jEInyS8BkqtKdSz0Vzk+vQ825Mh6xPFjUvcdECYOYJTxMaC4k1tEYH3gN9PX8KKMm1SKu+ogqX0jqJx7M5zQhDytI6qliiZawgqzOsEHwxF7agqR/AGX1l0blsSioGssezvSc/S04mehJYgHQmFjowEtVEasgVIHTBtAX28LEVYa/T409qrVQhBqH3coWks3htElLKOqlnTWFSFuUuwJjCXhMzGVbpyFieBzDakHQmJ4lWYNhmFd+yUOU0V1S+ZWqQWkrGQ7irJpK2tHaAaCcUlZW00YyQ1+SkhHq+dEVmp1VPjeb+Bm36N16fXePfuBYq7A1wRS/TaEuzEElJFB37RKFMFqsZxez7CmUDtLQGhbBx1MJS1oyzdoqVv7S3OBCof579sLCEY6jpeIw2ChuhsUAMhMRjbq2DHiY81CS1XZJRGMbViyxii76eCrwWfwfxZRYJgKo80gWQ8xO1aQq7RQA3g480bNLacbmpLMY9NFjtVTUMkH9iT7CfzjFm533OUOo+zAWviC/YIbns6oCwTfGmRmcPOhdE7hmwnkG/VZHdjLpUfJjSrCZufCXzy0+/xL59/j4AwVo/RhgQlwS5c9E8KncpVq6dQT6HKZnBshwH/3Y0f4w/efwF/fcgzr8PlXc/g/TEyLxldr1CTUp0zjF+JhdhiWyhlupPz1uwyYpQ0bbA2BjWqxgWgniexbEllERNXi067Ui+RoIwiotHbKTF4NXb8dYgqZrcNzehx5PhYkxBwIHVDF+pY5yXzAyXkis9sNFDWPpJVBbo8e23/Mw2yeK9tnpkkATEQRBYGzs7D4xvBY9qHJu7fON8atgPWtlX92s/n4zyqCj72U7OFkG8GBhs16VaBvTtGBxn1pVWagUHWK/7M+e/ycnaHQi0mKAmefCnfOAYrHr+E5DUsSGimnmlQZmq52YzY8Gt8685l/PUhq981rL+xjUyL2BNOlWRcMdywiFqmlcS24Z7Izo0hlBZEKVcE6/bMzsFbaAwEUDXsC+zuQisUcAou7GthFxLwqSG40yE9Pq3oSahtSS1eF+QCiq3iChkSQJTgoFnPMFWCqSHZjRHVfrVdOZV2RaWNH1o6RVvLWaXtGgIL9WBvGLJ4AIJ3kaS6qiKNoHOH1EK2YUl3YxdZN4vxP8ObFW5aY4omJl36gJ1U5EFZ++dDfvX6v059wbN+dZeVrOKHLtzgmXTCS9ldriUbpOIZmSImjhJIJZBIbIUc3ewRFsGIxL+HxCcEujCC9i+KV6VQmKmlUMtNv8bYD/iD2cv80dbzbBcDbt1YR+aWlfcsF28q+Waz1xPOmLhAzGvyO4K6HFtaQiZoovc4q0JlF+QPLFSrvQ3sXavufRx8dDIs7etzKEeCm1kya/oCZ8eEnoQACQHTBiTaKqpjtgACNCvRS6YJlOtJbKBYKdkO+HzpCdADf5fR2RnMHlktJCbYs4J3D0iQffe6VIb8jsWWsHo9MNxocJMad3e65MqLaSjaPixmWmCmBVe/MgFgfm2dzR+8wOYI/tmrFxisFVy7uMmn17/H0FRcTbfJpWLFVOSmYkUq1s08epKIibqWSE6GGAm9TE4epVbFE8MMaoSiJZ5xyNlo1tgNA96aX2GzWuH/u/4K/q1Vsm3h5a/XJDslblLFNtyqSNtpJarMgpkVmOmcLLPYwuFzIRhQo0vzJ1AJepAgO6mvU7VUWGhW3WUIS5JVu82nUI+EZldQa2MjhdD3oj9q9CQEixVOmmh0VlFsCahgakEaiZ6yoaDGYGswY6VcP8RgqUur78F7VeVwkuoeiiAQBCljKx5TS+wgWwrZVpR+st2AnTWYsrn3gVjOh+u2tyTlpg2DOw43F9Sm1CsJb2wO+M65SzjnGWY1znqGSU1mG4au4nw6JzGegalwJjA01aIywKotYn7YovKhowwJtVp2/IA6WHabAXOfMG4ybs9GlN6yNR5SVw65mbGyIbhZHKcmBnUGMbLoOXcYpApk2yDBUF4I+IR7pMr7Yln9Ouyze07WvXrD9HGiJyFiy2iagKk8ydRgE0FCzKL3g7a2jCjzywZbKGvfbcjuFFSrq0xgz2oMLZEsH7z7q/eoaXF/4kPkBanjK79jcDPI7yrD2zW2CrH+TxNi+5nG7x3oYPzKfVbpZGPC+e1iUS0AYxYVBNU4fDZELRRDwzQVbg+Ft1YlzkEegzZ9poRM0SR6qMRqlO4ArQ1UBqkFNzWYOtZgcnNwcyXfDLgGrs4Dpg6gNRKUkBqqNUu9YhkASROQ2qMh3NvCSQS3W3DhG45mxXLn047Z6gOMxQfr7B1UxRYb7/f9PQErdv89cG17HAl6EurQdWYNIA2Yps0Ar6V120cbkBqJeWRFjalbN/7yzb58T3fkJCwM1/fYIpbUMPGCaWInUDdT0kkg2yxj2sCshKUHU4081gotdYOUUdXpukjY7hjGoIkDZ/GjjJBY6lVHtWajLWzQkZFENchBsxrbcXceKtNEI7k0kEzA1PE3uEJJ5oHsToVpAlJ6xHs0dYTMxXy9VAhOIim2JVYO/rJFe+7Gk4wrjHfYMtrJMKD2EVSkx+wdpwtJ6LG+1uMx0ZMQ7Bmnw16LaFvH6OlkV1GJxJBtB1ypJLsVUtSkk0CyaQipwa+G+CDIkrF02U6kEreHg59FEjJzQzI22ALyO0o2DmRbNWZW7VO79uUuPYZtQo2wsOKYZYOTxGOGALVix2CsYCeWbMvGUrdtxLC6uK9PDfVqDOBbVBPpSFxjom/30xAITphfyVADTW4ISSS2aG9rv+8h3zKRcO/T56sbp5lVSO1Z+26KmxnK88L8eb9HRMs2ooMQvT8ZdQtF+3FIlSYXfPJ4hN/j8dCTUGcPaiUEaaUSUytqwBWKWnBzyLc8tuweggY3DyQTix+AHwD3C7lZSD+H2CNClLJMHVUXO4d0Ekh3Gty0PtL2w3sP9WG2rHYe5mX8dLmN9pL0hCqkCWE02CuJ20ovaiWSloulUZpBzNr3qVAPo6exPB9jr5pVpVnzSCPYicGWUSKSEMA/QOdRhbJCasPgVoabO3ZxzK8S5//wUuftzz5AUvuOK/fsqwY0iaroviJ4PY4UPQlBfMCkJaDQrYTxhrM16BySeSAZN5g6Biwigpt78juOZkXwmcH71l7i9t/sUgvSuo0X93onMQWJ55Voe1EBn0Vpw7rDHOHHi4Xac/CBs63tKYAOMoqrq4REqIdRsolqVMuztrW1JxASQS34LKpuzUoMdwhpR2qx9bItiJ5J/4jeJ9XYI16VfMuS37Y0A6VZDejSsYElyfQw8pX9+2nrJdM4Xp/GRajH8aEnIdhb7VW75PX4HChR8qmFZOpJ7k6hDZ5TI7jdkrXrhnrV4jNLvSo0KwE/XCIyBVOYNv6oPZ0hSg0mRmJ3N3y9GjCpUA8EVxh0cjJFtfarQXv/iw9AoDmXs3Mtkm9xUWlWlrPMD7HPtGqZdsQr7JGwSqx5NI1zLXVzyBgOG6RidmaYHVhV8MmAegXG1wyN88jBOKzlcy+pyV2772580nkqFdRp9DMsV1jse9IfOXoS6hD21LIYaxdvsuiBjsGMqCI+7KV7NAE79wQn2CIacaPdJKop6qJHzDQgjewLV1EXbU3QCkwmShOmibao7nynDtISa5tjpwZwuiBthDZ2hwXBAq2ppSVcaSUtifNi6qj+ygNc84cOpbNBVZ50GlcPVwhvYYFBAAAM90lEQVQhXZIfW+IRIunfc4w2kDR6vwCN1wDdu2bGx2sj3e8/xZ1qzyJ6EoI9KagJMVaITkPTdrVkoaLoUuFzKWqcV0yZsLJiqIcmSkOt/aMZtkbuebyxxUdCar8dT23jixBvdlPBcKMm3aqws3pPSjsNaEnTFA3D2556aqhXDCGTRcJvNERHEjKVLP3eiIV5zEYitjMh21aSaSzZ8TjoMtvNpGD1bY9fSQnJgOpcDK/o1EK1LFTF+AMg2Kh+d0QTEiW4OF47j8e1VfSUZjudodwgnSG/x5GhJyHYZ4SVoIscrrht6bVsnFSNLvOywhhIpqG17RhQIWStSiHRrhTd/nHFR/dspMFFm4kE2gRasPOAmTcxE/60EFAHEcR73NRHomlMfJBbyQiJuWgq0U1vy4NqUfwbkjjPtpKYglJqq+49HtQI1A2mjHFU6ThDjdmzR5nOsMye18sSawR1UmoXKKpxEXBFvF62jMGrtmzH1aeQHQt6EoI9YgnEBFVVJNurIROz7MM+slr+K00gmTaYxhJsjKMxTZQEoFMbWhWmYeGBg7bMqEQpydYxbcQWDeKXqqudEnRGa2kCyW6FrR35nShuLH6TxIccWAQqdvFVENXMhfppBVsog80mEm/R3PfcjzQ27xnerkjHjmZgaAYdCclezA9RMurGaFojdKdKSxMXAuNjrJgEMJVGAupqR/UFzo4UPQnBgoSktS+oxodFbXzoTH1I9G5HQEHRxmMnFVI5kszgM9tm5Md9gosPw6IWESxIyHht1bSYQGvqgCmbSHoHz3kK0EkedidgyoTB3RQJZhFVvAhgBNKJkswiCfkkEpWt2nkR2virQLpVYao2afWjoPEkN8ck1uDXcuq1FDUxEJKlccVt8f+uUFlHlBLiNVpWxW0Z7nXR90R0ZOhJCFjkXIWwyN8yXqFRTBXTDGKqwf1vOvEaI4LbjHxpbTzQGWplT63rvnPg/QKB02ULOgytDc1WAVfsRZMvSxym7qRAwcgeaXcPvhD/l9b1/5F/bzdnPqZ+2LmPgZatVIuVhWeu84otX4M94unGypKxPX5f+tSNI0dPQh26m7eVYKw1GGcwZRPVBNX9OVvd10xcEWMlw4CpUmxlWhKKHjA1QkBbj1J3x+89BN3NfyhOY9+r7mGvG5KdOjaFtCwkjsVD7dvfhmLqPWkzHiO+TB2iQ8D7o5H82l5yZlJiigZNLGYlRZ3Q5JaQmCh5HpjPBTEG7pF6VSCkFtNILC0ifSb9UaInoYPoDM6tkVSasEc+D7rxQgCxUeVq7QzR3BNX3Xs8uw86VheFbM2jB+89YUjQGFfjo7QYEtlvtz0YKnRPZ5I943zc4Qg9Tu01pI6NB+K1NFFCtUoXw7Vc4Gwh9Rw2/lYK0hAjwqVXxY4UPQnB/htKBILGVbT1BD2QgLqHxwcEsPOGtLVDhDRW8usMnHtiP+1DuGd3ABY1jZtRhsmTmCQ7q6KEsFw36BSgMzTbeY34EMvJuphrJl3B7ft+mYXLPDghZA5xJqrAR/07G4+ZVGAFUzlCYgiZpRnaJZ99xD4pbQnBCppbjI2SMRDvi6bTt0/HNTmr6EloGcter3qvfc9DCajbx8cscWsEyaLoD3t2kC61IbqG7z1mdOkrPovdYF1QzLxeBNGdxptdao8JIZYEkXg7LYjogV+Mf9TE7HkRMM5AdYTqZxf/VdXxWvm2YqZkMLDIQba53ylbe1cA1BrE6anzXJ5l9CR0Pzxi/tJBIpLaR7NBG/iotvXOGIkrql1y27MXSwR7K3FXpkNTQ1jJYh2hotpL7DwtZNTayUSjhJCOpc2sbw3UrbS0LHAsVLA2WVhCF5Kg0OyvEvmRfuchBd6iVGswRU0i3KsCPmSxkRC9pzQPSbLt8VjoSeggHvfGP2jgrOpF/lNXrycMU9QZQmLxWVdOI97YIYni/kJdU+LKCzQDh09MzF+rmtN543sP3mN8QIoGrBAGyYKMoohz4Dtd7JVvvYnzei97/qBq/FGJaPl/jbqvaXxUcz8MlheC07IYnHH0JHTUWL4xfVyNpV3hRYQu62OhmgVBfFvMvcudWg7s8x8ukviJQxUJAcXE32uiO3vxO/ftG43FEnSvxfKTeqgX5/qQhvCDAas9PjJ6EjpqHHJzSlkjVexUoQdVgAelAnQxNPcJDzhV6FQzCVGqeZi3ax9Zh3tJ6Dh+61HZmXocKXoSOg50N2qnTixJMocabJf3f9hnp/khOEyieVSj/pPGwXM+aO57HCt6EnoSeKin6AFSw1mp5neIIfih+3+Yz44LB50MPZ4YehI6TjzKw/SoN/5ZWJXPwhgfhLM+/jOKvjhBjx49ThS9JHTS6FffHh9z9JJQjx49ThSPREIi8jdE5Osi8jUR+TURyUXkFRF5TUS+LSK/LiLpcQ+2R48eTx8eSkIi8jzw14EvqOqniN2dfgb4W8DfUdXvB7aAnzvOgfbo0ePpxKPahBwwEJEaGAI3gB8D/r32838I/BfArzzwKD7AzuRDDbRHjx5nGA+I+n8oCanqByLyt4H3gDnwz4DXgW1V7epxvg88/9BjNQ3+zp1HGXKPHj2eImi4f+neh5KQiJwHfgp4BdgG/jHwk496chH5EvAlgJwh4pJH/WqPHj2eFtT3j4d7FHXsJ4B3VHUDQER+E/izwLqIuFYaegH44LAvq+qXgS8DnEuvqL3yzOMNvkePHmcecvP+VPMoJPQe8EURGRLVsR8Hvgr8LvCXgH8E/CzwWw89khE0751oPXp87PCAhpEP9Y6p6mvAbwC/D/xJ+50vA38T+E9E5NvAReDvH8VYe/To8fHCI3nHVPWXgF86sPlt4F858hH16NHjY4U+YrpHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaLoSahHjx4nip6EevTocaIQVX1yJxPZAKbAWW7Deol+/CeFszx2+HiP/2VVPbTp4BMlIQAR+aqqfuGJnvQI0Y//5HCWxw79+O+HXh3r0aPHiaInoR49epwoToKEvnwC5zxK9OM/OZzlsUM//kPxxG1CPXr06LGMXh3r0aPHieKJkpCI/KSIfEtEvi0iv/Akz/24EJEXReR3ReQbIvJ1Efn5dvsFEfm/ROSt9u/5kx7rgyAiVkT+QER+p33/ioi81l6DXxeR9KTHeD+IyLqI/IaIfFNE3hCRHz5L8y8if6O9d74mIr8mIvlpnn8R+R9F5LaIfG1p26HzLRH/bfs7/lhEPv9hz/vESEhELPB3gb8AfBL4yyLyySd1/g+BBvhPVfWTwBeB/6gd7y8AX1HVTwBfad+fZvw88MbS+78F/B1V/X5gC/i5ExnVo+GXgX+qqj8IfJb4O87E/IvI88BfB76gqp8CLPAznO75/5+Anzyw7X7z/ReAT7SvLwG/8qHPqqpP5AX8MPB/Lr3/ReAXn9T5j2D8vwX8G8C3gKvttqvAt056bA8Y8wvtjfNjwO8AQgw2c4ddk9P0As4B79DaLZe2n4n5B54HrgMXANfO/58/7fMPXAO+9rD5Bv4H4C8ftt/jvp6kOtZdlA7vt9tOPUTkGvA54DXgiqreaD+6CVw5oWE9Cv4b4D8DQvv+IrCtqk37/jRfg1eADeAftOrk3xORFc7I/KvqB8DfBt4DbgA7wOucnfnvcL/5PrLnuTdMPwQisgr8r8B/rKq7y59pXAJOpXtRRP4t4Laqvn7SY/mQcMDngV9R1c8R0332qV6nfP7PAz9FJNPngBXuVXXOFI5rvp8kCX0AvLj0/oV226mFiCREAvpVVf3NdvMtEbnafn4VuH1S43sI/izw74jIu8A/Iqpkvwysi4hr9znN1+B94H1Vfa19/xtEUjor8/8TwDuquqGqNfCbxGtyVua/w/3m+8ie5ydJQr8HfKL1DqREI91vP8HzPxZERIC/D7yhqv/10ke/Dfxs+//PEm1Fpw6q+ouq+oKqXiPO9f+jqn8F+F3gL7W7nebx3wSui8gPtJt+HPgGZ2T+iWrYF0Vk2N5L3fjPxPwv4X7z/dvAv996yb4I7CypbY+HJ2z0+ovAm8B3gP/8pI1wDxnrnyOKnn8M/GH7+otEu8pXgLeA/xu4cNJjfYTf8qPA77T/vwr8C+DbwD8GspMe3wPG/S8BX22vwf8GnD9L8w/8l8A3ga8B/zOQneb5B36NaL+qiZLoz91vvolOjr/bPst/QvQCfqjz9hHTPXr0OFH0hukePXqcKHoS6tGjx4miJ6EePXqcKHoS6tGjx4miJ6EePXqcKHoS6tGjx4miJ6EePXqcKHoS6tGjx4ni/wcOZ6Ky1quLKQAAAABJRU5ErkJggg==" srcset="/img/loading.gif" alt="" /></p><p>代码说的是转成灰度图像，不知道我怎么就变成了这个亚子</p><pre class="highlight"><code class="python">img=cv2.imread(<span class="hljs-string">'./data/cat.png'</span>)img=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)edges=cv2.Canny(img,<span class="hljs-number">30</span>,<span class="hljs-number">70</span>)plt.imshow(edges)</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>给猫猫描描边</p><h3 id="数据扩增"><a class="markdownIt-Anchor" href="#数据扩增"></a> 数据扩增</h3><p>图像的数据扩增方法包括各种旋转以及裁剪以及对像素的操作。</p><p>以torchvision为例，常见的数据扩增方法包括：</p><ul><li>transforms.CenterCrop 对图片中心进行裁剪</li><li>transforms.ColorJitter 对图像颜色的对比度、饱和度和零度进行变换</li><li>transforms.FiveCrop 对图像四个角和中心进行裁剪得到五分图像</li><li>transforms.Grayscale 对图像进行灰度变换</li><li>transforms.Pad 使用固定值进行像素填充</li><li>transforms.RandomAffine 随机仿射变换</li><li>transforms.RandomCrop 随机区域裁剪</li><li>transforms.RandomHorizontalFlip 随机水平翻转</li><li>transforms.RandomRotation 随机旋转</li><li>transforms.RandomVerticalFlip 随机垂直翻转</li></ul><p><img src="https://github.com/datawhalechina/team-learning/blob/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task02/%E6%95%B0%E6%8D%AE%E6%89%A9%E5%A2%9E%E7%A4%BA%E4%BE%8B.png" srcset="/img/loading.gif" alt="" /></p><p>新手用用torchvision足够啦</p><h3 id="dataset"><a class="markdownIt-Anchor" href="#dataset"></a> Dataset</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> os,sys,glob,shutil,json<span class="hljs-keyword">import</span> cv2<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> torch<span class="hljs-keyword">from</span> torch.utils.data.dataset <span class="hljs-keyword">import</span> Dataset<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHNDataset</span><span class="hljs-params">(Dataset)</span>:</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,img_path,img_label,transform=None)</span>:</span>    self.img_path=img_path    self.img_label=img_label    <span class="hljs-keyword">if</span> transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:      self.transform=transform    <span class="hljs-keyword">else</span>:      self.transform=<span class="hljs-literal">None</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span><span class="hljs-params">(self,index)</span>:</span>    img=Image.open(self.img_path[index]).convert(<span class="hljs-string">'RGB'</span>)    <span class="hljs-keyword">if</span> self.transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:      img=self.transform(img)        lbl=np.array(self.img_label[index],dtype=np.int)    lbl=list(lbl)+(<span class="hljs-number">5</span>-len(lbl))*[<span class="hljs-number">10</span>]    <span class="hljs-keyword">return</span> img,torch.from_numpy(np.array(lbl[:<span class="hljs-number">5</span>]))  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span><span class="hljs-params">(self)</span>:</span>    <span class="hljs-keyword">return</span> len(self.img_path)</code></pre><p>pytorch自定义Dataset需要继承自pytorch定义的Dataset类，我们要实现其中的__init__()、<strong>len</strong>()、<strong>getitem</strong>()方法即可，对数据的操作主要放在__getitem__()方法中,比如之前提到的数据扩增我们也是放在__getitem__()里面进行操作。</p><pre class="highlight"><code class="python">train_path=glob.glob(<span class="hljs-string">'./data/mchar_train/*.png'</span>)train_path.sort()train_json=json.load(open(<span class="hljs-string">'./data/mchar_train.json'</span>))train_label=[train_json[x][<span class="hljs-string">'label'</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> train_json]data=SVHNDataset(train_path,train_label,transforms.Compose([        transforms.Resize((<span class="hljs-number">64</span>,<span class="hljs-number">128</span>)),        transforms.ColorJitter(<span class="hljs-number">0.2</span>,<span class="hljs-number">0.2</span>,<span class="hljs-number">0.2</span>),        transforms.RandomRotation(<span class="hljs-number">5</span>),]))</code></pre><p>需要注意的是Dataset每次只能返回一条数据，想要构成batch型数据，还需要进一步构建dataloader</p><h3 id="dataloader"><a class="markdownIt-Anchor" href="#dataloader"></a> DataLoader</h3><p>dataloader的代码不需要我们重构，直接调用即可 ，但是如果我们想采用特殊的采样方法等定制化功能时，还需要我们对代码进行重构。</p><pre class="highlight"><code class="python">train_loader=torch.utils.data.DataLoader(    SVHNDataset(train_path,train_label,          transforms.Compose([            transforms.Resize((<span class="hljs-number">64</span>,<span class="hljs-number">128</span>)),            transforms.ColorJitter(<span class="hljs-number">0.3</span>,<span class="hljs-number">0.3</span>,<span class="hljs-number">0.2</span>),            transforms.RandomRotation(<span class="hljs-number">5</span>),            transforms.ToTensor(),            transforms.Normalize([<span class="hljs-number">0.485</span>,<span class="hljs-number">0.456</span>,<span class="hljs-number">0.406</span>],[<span class="hljs-number">0.229</span>,<span class="hljs-number">0.224</span>,<span class="hljs-number">0.225</span>])          ])),    batch_size=<span class="hljs-number">10</span>,    shuffle=<span class="hljs-literal">False</span>,    num_workers=<span class="hljs-number">10</span>)</code></pre><p>我们可以通过</p><pre class="highlight"><code class="python">next(iter(train_loader))</code></pre><p>来查看单个batch的数据情况</p><p>收工！！！</p>]]></content>
    
    
    <categories>
      
      <category>CV</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CV</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-CV入门之赛题理解</title>
    <link href="/2020/05/20/01-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E8%B5%9B%E9%A2%98%E7%90%86%E8%A7%A3/"/>
    <url>/2020/05/20/01-CV%E5%85%A5%E9%97%A8%E4%B9%8B%E8%B5%9B%E9%A2%98%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h2 id="目标"><a class="markdownIt-Anchor" href="#目标"></a> 目标</h2><p>识别图像中的字符串</p><p><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/%E8%B5%9B%E4%BA%8B%E7%AE%80%E4%BB%8B/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%B7%E6%9C%AC%E5%B1%95%E7%A4%BA.png" srcset="/img/loading.gif" alt="" /></p><p>为了简化难度，主办方提供了字符在图片中的字符框位置，我们只需识别字符框中的字符即可。</p><p><img src="https://github.com/datawhalechina/team-learning/blob/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E5%AD%97%E7%AC%A6%E5%9D%90%E6%A0%87.png" srcset="/img/loading.gif" alt="" /></p><p>下面看读取数据的一个例子</p><img src="https://s1.ax1x.com/2020/05/20/Y746df.png" srcset="/img/loading.gif" alt="Y746df.png" style="zoom:67%;" /><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-comment">#读取图片的起始结尾位置及标签</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_json</span><span class="hljs-params">(d)</span>:</span>  arr=np.array([    d[<span class="hljs-string">'top'</span>],d[<span class="hljs-string">'height'</span>],d[<span class="hljs-string">'left'</span>],d[<span class="hljs-string">'width'</span>],d[<span class="hljs-string">'label'</span>]  ])  arr=arr.astype(int)  <span class="hljs-keyword">return</span> arr</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> cv2img=cv2.imread(<span class="hljs-string">'./data/mchar_train/000008.png'</span>)arr=parse_json(train_json[<span class="hljs-string">'000008.png'</span>])</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<span class="hljs-comment">#显示图片</span>plt.figure(figsize=(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>))plt.subplot(<span class="hljs-number">1</span>,arr.shape[<span class="hljs-number">1</span>]+<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)plt.imshow(img)</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>可以看到128三个数字，由于已经给我们分好了每个字符的范围，我们可以单独把每个字符画出来</p><pre class="highlight"><code class="python"><span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> range(arr.shape[<span class="hljs-number">1</span>]):  plt.subplot(<span class="hljs-number">1</span>,arr.shape[<span class="hljs-number">1</span>],idx+<span class="hljs-number">1</span>)  plt.imshow(img[arr[<span class="hljs-number">0</span>,idx]:arr[<span class="hljs-number">0</span>,idx]+arr[<span class="hljs-number">1</span>,idx],arr[<span class="hljs-number">2</span>,idx]:arr[<span class="hljs-number">2</span>,idx]+arr[<span class="hljs-number">3</span>,idx]])  plt.title(arr[<span class="hljs-number">4</span>,idx])  plt.xticks([]);plt.yticks([])</code></pre><p><img src="data:image/png;base64,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" srcset="/img/loading.gif" alt="" /></p><p>糊的不行</p><h2 id="解题思路"><a class="markdownIt-Anchor" href="#解题思路"></a> 解题思路</h2><h3 id="定长字符识别"><a class="markdownIt-Anchor" href="#定长字符识别"></a> 定长字符识别</h3><p>可以将赛题抽象为一个定长字符识别问题，在赛题数据集中大部分图像中字符个数为2-4个，最多的字符 个数为6个。<br />因此可以对于所有的图像都抽象为6个字符的识别问题，字符23填充为23XXXX，字符231填充为231XXX。</p><p><img src="https://s1.ax1x.com/2020/05/20/Y7I8UK.png" srcset="/img/loading.gif" alt="Y7I8UK.png" /></p><p>经过填充之后，原始的赛题可以简化了6个字符的分类问题。在每个字符的分类中会进行11个类别的分类，假如分类为填充字符，则表明该字符为空。</p><h3 id="不定长字符识别"><a class="markdownIt-Anchor" href="#不定长字符识别"></a> 不定长字符识别</h3><p><img src="https://s1.ax1x.com/2020/05/20/Y7Is58.png" srcset="/img/loading.gif" alt="Y7Is58.png" /></p><p>在字符识别研究中，有特定的方法来解决此种不定长的字符识别问题，比较典型的有CRNN字符识别模型。<br />在本次赛题中给定的图像数据都比较规整，可以视为一个单词或者一个句子</p><h3 id="检测再识别"><a class="markdownIt-Anchor" href="#检测再识别"></a> 检测再识别</h3><p>在赛题数据中已经给出了训练集、验证集中所有图片中字符的位置，因此可以首先将字符的位置进行识别，利用物体检测的思路完成。</p><p><img src="https://s1.ax1x.com/2020/05/20/Y7Io5T.png" srcset="/img/loading.gif" alt="Y7Io5T.png" /></p><p>需要用到目标检测模型，那是后话啦，先把眼前的弄好。</p>]]></content>
    
    
    <categories>
      
      <category>CV</category>
      
      <category>比赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CV</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-爬虫</title>
    <link href="/2020/04/27/04-%E7%88%AC%E8%99%AB/"/>
    <url>/2020/04/27/04-%E7%88%AC%E8%99%AB/</url>
    
    <content type="html"><![CDATA[<h3 id="chrome监控ajax请求"><a class="markdownIt-Anchor" href="#chrome监控ajax请求"></a> chrome监控ajax请求</h3><p>浏览器中输入腾讯新闻的网址，发现不断向下拉滚动条就可以新闻会不断出现，初步判断新出现的新闻是通过ajax加载的。打开chrome的开发者工具，进入network中的js界面，将js脚本按名称排序，继续向下拉动滚动条，可以发现新出现的请求有规律。</p><p><img src="https://s1.ax1x.com/2020/04/27/JfrVbR.png" srcset="/img/loading.gif" alt="JfrVbR.png" /></p><p><code>rcd?</code>这个请求随着滚动条的拖动不断增加，我们把前几条请求单独拿出来分析。</p><p><code>https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page=0&amp;expIds=&amp;callback=__jp1</code></p><p><code>https://pacaio.match.qq.com/irs/rcd?cid=4&amp;token=9513f1a78a663e1d25b46a826f248c3c&amp;ext=&amp;page=0&amp;expIds=&amp;callback=__jp2</code></p><p><code>https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page=1&amp;expIds=20200427A0I0UN|20200427002954|20200402012032|20200427A0CB27|20200427A0H4VM|20200427A0GJP8|20200427002536|20200426005210|20200427A0CW43|20200427A0H11D&amp;callback=__jp4</code></p><p><code>https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page=2&amp;expIds=20200427A0BLNR|20200427A08JMI|20200426005565|20200427A0BBTS|20200427A088DC|20200427A05064|20200427A04L6I|20200427A066PB|20200427V05K49&amp;callback=__jp5</code></p><p><code>https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page=3&amp;expIds=20200427V01DY9|20200427000076|20200426A0O227|20200427A00E00|20200427A02TN7|20200426A0PR2B|20200426A0PLML|20200426A0HWYG|20200426A0Q1GM|20200426A0PGG8&amp;callback=__jp6</code></p><p>出去开头的请求规律不规范外，可以发现请求的一些规律，第三条之后的请求：<code>cid=137</code>,<code>page=1 2 3...</code>,<code>callback=__jp4 5 6</code>,从第二条开始看的话，<code>page=0 1 2 3</code></p><p>又综合分析一下，经过自己的尝试我们可以构造出下面的请求</p><pre class="highlight"><code class="python">url=<span class="hljs-string">'https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page={}'</span>.format(i)</code></pre><p>只需要更改<code>i</code>就可以获取不同页面的内容，并且是直接返回json，省去解析的麻烦。</p><p>不用selenium就可以爬取新闻</p><p>下面放上自己的代码</p><h3 id="requests爬取腾讯新闻"><a class="markdownIt-Anchor" href="#requests爬取腾讯新闻"></a> requests爬取腾讯新闻</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> time<span class="hljs-keyword">import</span> requestsurl_fmt=<span class="hljs-string">'https://pacaio.match.qq.com/irs/rcd?cid=137&amp;token=d0f13d594edfc180f5bf6b845456f3ea&amp;id=&amp;ext=top&amp;page={}'</span>title_list=[]tags_list=[]keywords_list=[]vurl_list=[]intro_list=[]category_list=[]source_list=[]bimg_list=[]<span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>):    url=url_fmt.format(page)    res=requests.get(url)    data=res.json()[<span class="hljs-string">'data'</span>]        <span class="hljs-keyword">for</span> new <span class="hljs-keyword">in</span> data:        <span class="hljs-keyword">try</span>:            title=new[<span class="hljs-string">'title'</span>]            tags=new[<span class="hljs-string">'tags'</span>]            keywords=new[<span class="hljs-string">'keywords'</span>]            vurl=new[<span class="hljs-string">'vurl'</span>]            intro=new[<span class="hljs-string">'intro'</span>]            category=new[<span class="hljs-string">'category'</span>]            source=new[<span class="hljs-string">'source'</span>]            bimg=new[<span class="hljs-string">'bimg'</span>]        <span class="hljs-keyword">except</span>:            <span class="hljs-keyword">continue</span>        title_list.append(title)        tags_list.append(tags)        keywords_list.append(keywords)        vurl_list.append(vurl)        intro_list.append(intro)        category_list.append(category)        source_list.append(source)        bimg_list.append(bimg)    time.sleep(<span class="hljs-number">2</span>)</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pdnews=pd.DataFrame({<span class="hljs-string">'title'</span>:title_list,                   <span class="hljs-string">'tags'</span>:tags_list,                   <span class="hljs-string">'keywords'</span>:keywords_list,                   <span class="hljs-string">'vurl'</span>:vurl_list,                   <span class="hljs-string">'intro'</span>:intro_list,                   <span class="hljs-string">'category'</span>:category_list,                   <span class="hljs-string">'source'</span>:source_list,                   <span class="hljs-string">'bimg'</span>:bimg_list})news.to_csv(<span class="hljs-string">'news.csv'</span>)</code></pre><p><img src="https://s1.ax1x.com/2020/04/27/Jfx7gf.png" srcset="/img/loading.gif" alt="Jfx7gf.png" /></p><p>大功告成！！！</p><h3 id="selenium模拟拖动滚动条"><a class="markdownIt-Anchor" href="#selenium模拟拖动滚动条"></a> selenium模拟拖动滚动条</h3><p>可以让selenium模拟拖动滚动条使新闻更新，在这里发现展示的新闻数量是有限的，拖动到一定程度将不能再拖动。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> time<span class="hljs-keyword">from</span>  selenium <span class="hljs-keyword">import</span> webdriver<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<span class="hljs-comment">#模拟打开界面</span>driver=webdriver.Chrome(<span class="hljs-string">r'C:\Users\MZ\Downloads\chromedriver_win32\chromedriver.exe'</span>)driver.get(<span class="hljs-string">'https://news.qq.com/'</span>)driver.maximize_window()time.sleep(<span class="hljs-number">3</span>)current_window_1=driver.current_window_handleprint(current_window_1)</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#无法拖动时退出拖动，使用chrome自带copy xpath 构造解析式</span>number_before=<span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">50</span>):    driver.execute_script(<span class="hljs-string">"window.scrollTo(0,document.body.scrollHeight-100)"</span>)    html=driver.page_source    tree=etree.HTML(html)    number_after=len(tree.xpath(<span class="hljs-string">'/html/body/div/div[4]/div[2]/div/div/ul[2]/li'</span>))<span class="hljs-number">-1</span>    <span class="hljs-keyword">if</span> number_before==number_after:        <span class="hljs-keyword">break</span>    time.sleep(<span class="hljs-number">1</span>)    number_before=number_afterhtml=driver.page_sourceprint(number_after)</code></pre><pre class="highlight"><code class="python">news_number=len(tree.xpath(<span class="hljs-string">'/html/body/div/div[4]/div[2]/div/div/ul[2]/li'</span>))<span class="hljs-number">-1</span>title_fmt=<span class="hljs-string">'/html/body/div/div[4]/div[2]/div/div/ul[2]/li[{}]/a/img/@alt'</span>img_fmt=<span class="hljs-string">'/html/body/div/div[4]/div[2]/div/div/ul[2]/li[{}]/a/img/@src'</span>news_src=<span class="hljs-string">'/html/body/div/div[4]/div[2]/div/div/ul[2]/li[{}]/a/@href'</span>title_list=[]img_list=[]src_list=[]<span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> range(news_number):    <span class="hljs-keyword">try</span>:        title=tree.xpath(title_fmt.format(number))[<span class="hljs-number">0</span>]        img=tree.xpath(img_fmt.format(number))[<span class="hljs-number">0</span>]        src=tree.xpath(news_src.format(number))[<span class="hljs-number">0</span>]    <span class="hljs-keyword">except</span>:        <span class="hljs-keyword">continue</span>        title_list.append(title)    img_list.append(img)    src_list.append(src) </code></pre><pre class="highlight"><code class="python">news=pd.DataFrame({<span class="hljs-string">'title'</span>:title_list,<span class="hljs-string">'url'</span>:src_list,<span class="hljs-string">'img'</span>:img_list})news.to_csv(<span class="hljs-string">'news.csv'</span>)news.head(<span class="hljs-number">10</span>)</code></pre><p><img src="https://s1.ax1x.com/2020/04/27/JhQp79.png" srcset="/img/loading.gif" alt="JhQp79.png" /></p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>腾讯新闻爬虫</tag>
      
      <tag>ajax</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-爬虫</title>
    <link href="/2020/04/25/03-%E7%88%AC%E8%99%AB/"/>
    <url>/2020/04/25/03-%E7%88%AC%E8%99%AB/</url>
    
    <content type="html"><![CDATA[<h3 id="proxy-ip-代理"><a class="markdownIt-Anchor" href="#proxy-ip-代理"></a> proxy ip 代理</h3><p>代理主要用来解决ip频繁访问被服务器封号的问题，在requests中使用代理很简单.proxies格式是一个字典：<code>{‘http’: ‘[http://IP:port‘,‘https’:'https://IP:port‘}](http://xn--ip:port%2Chttps:'https-mc9nd6a//IP:port‘})</code>,我们将它传入requests中的get方法就可以使用</p><pre class="highlight"><code class="python">requests.get(url, headers = headers, proxies = proxies, timeout = <span class="hljs-number">10</span>)</code></pre><p>我们可以从网上提供的一些代理池中获取有效的代理，具体代码如下：</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> re<span class="hljs-keyword">import</span> json<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open_proxy_url</span><span class="hljs-params">(url)</span>:</span>    user_agent = <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>    headers = {<span class="hljs-string">'User-Agent'</span>: user_agent}    <span class="hljs-keyword">try</span>:        r = requests.get(url, headers = headers, timeout = <span class="hljs-number">10</span>)        r.raise_for_status()        r.encoding = r.apparent_encoding        <span class="hljs-keyword">return</span> r.text    <span class="hljs-keyword">except</span>:        print(<span class="hljs-string">'无法访问网页'</span> + url)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_proxy_ip</span><span class="hljs-params">(response)</span>:</span>    proxy_ip_list = []    soup = BeautifulSoup(response, <span class="hljs-string">'html.parser'</span>)    proxy_ips = soup.find(id = <span class="hljs-string">'ip_list'</span>).find_all(<span class="hljs-string">'tr'</span>)    <span class="hljs-keyword">for</span> proxy_ip <span class="hljs-keyword">in</span> proxy_ips:        <span class="hljs-keyword">if</span> len(proxy_ip.select(<span class="hljs-string">'td'</span>)) &gt;=<span class="hljs-number">8</span>:            ip = proxy_ip.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>].text            port = proxy_ip.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">2</span>].text            protocol = proxy_ip.select(<span class="hljs-string">'td'</span>)[<span class="hljs-number">5</span>].text            <span class="hljs-keyword">if</span> protocol <span class="hljs-keyword">in</span> (<span class="hljs-string">'HTTP'</span>,<span class="hljs-string">'HTTPS'</span>,<span class="hljs-string">'http'</span>,<span class="hljs-string">'https'</span>):                proxy_ip_list.append(<span class="hljs-string">f'<span class="hljs-subst">{protocol}</span>://<span class="hljs-subst">{ip}</span>:<span class="hljs-subst">{port}</span>'</span>)    <span class="hljs-keyword">return</span> proxy_ip_list<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open_url_using_proxy</span><span class="hljs-params">(url, proxy)</span>:</span>    user_agent = <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>    headers = {<span class="hljs-string">'User-Agent'</span>: user_agent}    proxies = {}    <span class="hljs-keyword">if</span> proxy.startswith((<span class="hljs-string">'HTTPS'</span>,<span class="hljs-string">'https'</span>)):        proxies[<span class="hljs-string">'https'</span>] = proxy    <span class="hljs-keyword">else</span>:        proxies[<span class="hljs-string">'http'</span>] = proxy    <span class="hljs-keyword">try</span>:        r = requests.get(url, headers = headers, proxies = proxies, timeout = <span class="hljs-number">10</span>)        r.raise_for_status()        r.encoding = r.apparent_encoding        <span class="hljs-keyword">return</span> (r.text, r.status_code)    <span class="hljs-keyword">except</span>:        print(<span class="hljs-string">'无法访问网页'</span> + url)        print(<span class="hljs-string">'无效代理IP: '</span> + proxy)        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_proxy_avaliability</span><span class="hljs-params">(proxy)</span>:</span>    url = <span class="hljs-string">'http://www.baidu.com'</span>    result = open_url_using_proxy(url, proxy)    VALID_PROXY = <span class="hljs-literal">False</span>    <span class="hljs-keyword">if</span> result:        text, status_code = result        <span class="hljs-keyword">if</span> status_code == <span class="hljs-number">200</span>:            r_title = re.findall(<span class="hljs-string">'&lt;title&gt;.*&lt;/title&gt;'</span>, text)            <span class="hljs-keyword">if</span> r_title:                <span class="hljs-keyword">if</span> r_title[<span class="hljs-number">0</span>] == <span class="hljs-string">'&lt;title&gt;百度一下，你就知道&lt;/title&gt;'</span>:                    VALID_PROXY = <span class="hljs-literal">True</span>        <span class="hljs-keyword">if</span> VALID_PROXY:            check_ip_url = <span class="hljs-string">'https://jsonip.com/'</span>            <span class="hljs-keyword">try</span>:                text, status_code = open_url_using_proxy(check_ip_url, proxy)            <span class="hljs-keyword">except</span>:                <span class="hljs-keyword">return</span>            print(<span class="hljs-string">'有效代理IP: '</span> + proxy)            <span class="hljs-keyword">with</span> open(<span class="hljs-string">'valid_proxy_ip.txt'</span>,<span class="hljs-string">'a'</span>) <span class="hljs-keyword">as</span> f:                f.writelines(proxy)            <span class="hljs-keyword">try</span>:                source_ip = json.loads(text).get(<span class="hljs-string">'ip'</span>)                print(<span class="hljs-string">f'源IP地址为：<span class="hljs-subst">{source_ip}</span>'</span>)                print(<span class="hljs-string">'='</span>*<span class="hljs-number">40</span>)            <span class="hljs-keyword">except</span>:                print(<span class="hljs-string">'返回的非json,无法解析'</span>)                print(text)    <span class="hljs-keyword">else</span>:        print(<span class="hljs-string">'无效代理IP: '</span> + proxy)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:    proxy_url = <span class="hljs-string">'https://www.xicidaili.com/'</span>    proxy_ip_filename = <span class="hljs-string">'proxy_ip.txt'</span>    text = open(proxy_ip_filename, <span class="hljs-string">'r'</span>).read()    proxy_ip_list = get_proxy_ip(text)    <span class="hljs-keyword">for</span> proxy <span class="hljs-keyword">in</span> proxy_ip_list:        check_proxy_avaliability(proxy)</code></pre><h3 id="selenium"><a class="markdownIt-Anchor" href="#selenium"></a> selenium</h3><ul><li>selenium是什么：一个自动化测试工具（大家都是这么说的）</li><li>selenium应用场景：用代码的方式去模拟浏览器操作过程（如：打开浏览器、在输入框里输入文字、回车等），在爬虫方面很有必要</li></ul><p>selenium模拟浏览器进行操作，需要电脑安装相应的浏览器和浏览器驱动</p><p>1、导入模块：</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver  <span class="hljs-comment"># 启动浏览器需要用到</span><span class="hljs-keyword">from</span> selenium.webdriver.common.keys <span class="hljs-keyword">import</span> Keys  <span class="hljs-comment"># 提供键盘按键支持（最后一个K要大写）</span></code></pre><p>2、创建一个WebDriver实例：</p><pre class="highlight"><code class="python">driver = webdriver.Chrome(<span class="hljs-string">"chromedriver驱动程序路径"</span>)</code></pre><p>3、打开一个页面:</p><pre class="highlight"><code class="python">driver.get(<span class="hljs-string">"http://www.python.org"</span>)  <span class="hljs-comment"># 这个时候chromedriver会打开一个Chrome浏览器窗口，显示的是网址所对应的页面</span></code></pre><p>4、关闭页面</p><pre class="highlight"><code class="python">driver.close()  <span class="hljs-comment"># 关闭浏览器一个Tab</span><span class="hljs-comment"># or</span>driver.quit()  <span class="hljs-comment"># 关闭浏览器窗口</span></code></pre><h4 id="高级-查找元素"><a class="markdownIt-Anchor" href="#高级-查找元素"></a> 高级 查找元素</h4><p>在打开页面和关闭页面中间，就是各种操作！而查找元素这一点，和爬虫常见的HTML页面解析，定位到具体的某个元素基本一样，只不过，调用者是driver</p><pre class="highlight"><code class="python">element = driver.find_element_by_name(<span class="hljs-string">"q"</span>)</code></pre><h4 id="高级-页面交互"><a class="markdownIt-Anchor" href="#高级-页面交互"></a> 高级 页面交互</h4><p>找到元素后，就是进行“交互”，如键盘输入（需提前导入模块）</p><pre class="highlight"><code class="python">element.send_keys(“some text”）  <span class="hljs-comment"># 往一个可以输入对象中输入“some text”</span><span class="hljs-comment">#甚至</span>element.send_keys(Keys.RETURN）  <span class="hljs-comment"># 模拟键盘回车</span><span class="hljs-comment">#一般来说，这种方式输入后会一直存在，而要清空某个文本框中的文字，就需要：</span>element.clear()  <span class="hljs-comment"># 清空element对象中的文字</span></code></pre><h3 id="session和cookie"><a class="markdownIt-Anchor" href="#session和cookie"></a> session和cookie</h3><p>Session 是会话的意思，会话是产生在服务端的，用来保存当前用户的会话信息，而 Cookies 是保存在客户端（浏览器），有了 Cookie 以后，客户端（浏览器）再次访问服务端的时候，会将这个 Cookie 带上，这时，服务端可以通过 Cookie 来识别本次请求到底是谁在访问。</p><p>可以简单理解为 Cookies 中保存了登录凭证，我们只要持有这个凭证，就可以在服务端保持一个登录状态。</p><p>在爬虫中，有时候遇到需要登录才能访问的网页，只需要在登录后获取了 Cookies ，在下次访问的时候将登录后获取到的 Cookies 放在请求头中，这时，服务端就会认为我们的爬虫是一个正常登录用户。</p><h4 id="session"><a class="markdownIt-Anchor" href="#session"></a> session</h4><ul><li><p>那么，Cookies 是如何保持会话状态的呢？</p><p>在客户端（浏览器）第一次请求服务端的时候，服务端会返回一个请求头中带有 <code>Set-Cookie</code> 字段的响应给客户端（浏览器），用来标记是哪一个用户，客户端（浏览器）会把这个 Cookies 给保存起来。</p><p>我们来使用工具 PostMan 来访问下某东的登录页，看下返回的响应头：</p><p><img src="https://camo.githubusercontent.com/13e08343d36c9f3cce3d86318c6d096cb7fa55cb/68747470733a2f2f63646e2e6765656b64696767696e672e636f6d2f707974686f6e2d7370696465722f6a645f6c6f67696e2d687474702d726573706f6e73652e706e67" srcset="/img/loading.gif" alt="img" /></p></li><li><p>当我们输入好用户名和密码时，客户端会将这个 Cookies 放在请求头一起发送给服务端，这时，服务端就知道是谁在进行登录操作，并且可以判断这个人输入的用户名和密码对不对，如果输入正确，则在服务端的 Session 记录一下这个人已经登录成功了，下次再请求的时候这个人就是登录状态了。</p><p>如果客户端传给服务端的 Cookies 是无效的，或者这个 Cookies 根本不是由这个服务端下发的，或者这个 Cookies 已经过期了，那么接下里的请求将不再能访问需要登录后才能访问的页面。</p><p>所以， Session 和 Cookies 之间是需要相互配合的，一个在服务端，一个在客户端。</p></li></ul><h4 id="cookie"><a class="markdownIt-Anchor" href="#cookie"></a> cookie</h4><p>我们登陆一个网站，Chrome 中按 F12 打开开发者工具，选择 Application 标签，点开 Cookies 这一栏。</p><p><a href="https://imgchr.com/i/J6iXA1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/25/J6iXA1.png" srcset="/img/loading.gif" alt="J6iXA1.png" /></a></p><ul><li>Name：这个是 Cookie 的名字。一旦创建，该名称便不可更改。</li><li>Value：这个是 Cookie 的值。</li><li>Domain：这个是可以访问该 Cookie 的域名。例如，如果设置为 .jd.com ，则所有以 <a href="http://jd.com" target="_blank" rel="noopener">jd.com</a> ，结尾的域名都可以访问该Cookie。</li><li>Max Age：Cookie 失效的时间，单位为秒，也常和 Expires 一起使用。 Max Age 如果为正数，则在 Max Age 秒之后失效，如果为负数，则关闭浏览器时 Cookie 即失效，浏览器也不会保存该 Cookie 。</li><li>Path：Cookie 的使用路径。如果设置为 /path/ ，则只有路径为 /path/ 的页面可以访问该 Cookie 。如果设置为 / ，则本域名下的所有页面都可以访问该 Cookie 。</li><li>Size：Cookie 的大小。</li><li>HTTPOnly：如果此项打勾，那么通过 JS 脚本将无法读取到 Cookie 信息，这样能有效的防止 XSS 攻击，窃取 Cookie 内容，可以增加 Cookie 的安全性。</li><li>Secure：如果此项打勾，那么这个 Cookie 只能用 HTTPS 协议发送给服务器，用 HTTP 协议是不发送的。</li></ul><p>那么有的网站为什么这次关闭了，下次打开的时候还是登录状态呢？</p><p>这就要说到 Cookie 的持久化了，其实也不能说是持久化，就是 Cookie 失效的时间设置的长一点，比如直接设置到 2099 年失效，这样，在浏览器关闭后，这个 Cookie 是会保存在我们的硬盘中的，下次打开浏览器，会再从我们的硬盘中将这个 Cookie 读取出来，用来维持用户的会话状态。</p><p>第二个问题产生了，服务端的会话也会无限的维持下去么，当然不会，这就要在 Cookie 和 Session 上做文章了， Cookie 中可以使用加密的方式将用户名记录下来，在下次将 Cookies 读取出来由请求发送到服务端后，服务端悄悄的自己创建一个用户已经登录的会话，这样我们在客户端看起来就好像这个登录会话是一直保持的。</p><h4 id="重要概念"><a class="markdownIt-Anchor" href="#重要概念"></a> 重要概念</h4><p>当我们关闭浏览器的时候会自动销毁服务端的会话，这个是错误的，因为在关闭浏览器的时候，浏览器并不会额外的通知服务端说，我要关闭了，你把和我的会话销毁掉吧。</p><p>因为服务端的会话是保存在内存中的，虽然一个会话不会很大，但是架不住会话多啊，硬件毕竟是会有限制的，不能无限扩充下去的，所以在服务端设置会话的过期时间就非常有必要。</p><p>当然，有没有方式能让浏览器在关闭的时候同步的关闭服务端的会话，当然是可以的，我们可以通过脚本语言 JS 来监听浏览器关闭的动作，当浏览器触发关闭动作的时候，由 JS 像服务端发起一个请求来通知服务端销毁会话。</p><p>由于不同的浏览器对 JS 事件的实现机制不一致，不一定保证 JS 能监听到浏览器关闭的动作，所以现在常用的方式还是在服务端自己设置会话的过期时间</p><h4 id="模拟登陆163"><a class="markdownIt-Anchor" href="#模拟登陆163"></a> 模拟登陆163</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> time<span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By</code></pre><pre class="highlight"><code class="python"><span class="hljs-string">"""使用selenium进行模拟登陆1.初始化ChromDriver2.打开163登陆页面3.找到用户名的输入框，输入用户名4.找到密码框，输入密码5.提交用户信息"""</span>name = <span class="hljs-string">'*'</span>passwd = <span class="hljs-string">'*'</span>driver = webdriver.Chrome(<span class="hljs-string">'./chromedriver'</span>)driver.get(<span class="hljs-string">'https://mail.163.com/'</span>)<span class="hljs-comment"># 将窗口调整最大</span>driver.maximize_window()<span class="hljs-comment"># 休息5s</span>time.sleep(<span class="hljs-number">5</span>)current_window_1 = driver.current_window_handleprint(current_window_1)</code></pre><pre class="highlight"><code class="python">button = driver.find_element_by_id(<span class="hljs-string">'lbNormal'</span>)button.click()driver.switch_to.frame(driver.find_element_by_xpath(<span class="hljs-string">"//iframe[starts-with(@id, 'x-URS-iframe')]"</span>))</code></pre><pre class="highlight"><code class="python">email = driver.find_element_by_name(<span class="hljs-string">'email'</span>)<span class="hljs-comment">#email = driver.find_element_by_xpath('//input[@name="email"]')</span>email.send_keys(name)password = driver.find_element_by_name(<span class="hljs-string">'password'</span>)<span class="hljs-comment">#password = driver.find_element_by_xpath("//input[@name='password']")</span>password.send_keys(passwd)submit = driver.find_element_by_id(<span class="hljs-string">"dologin"</span>)time.sleep(<span class="hljs-number">15</span>)submit.click()time.sleep(<span class="hljs-number">10</span>)print(driver.page_source)driver.quit()</code></pre><p>这次的内容有点多，很多都是点了一下，并没有深入介绍，想要熟练掌握，还要多加练习，多啃文档。</p><h3 id="丁香园自动化登陆"><a class="markdownIt-Anchor" href="#丁香园自动化登陆"></a> 丁香园自动化登陆</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<span class="hljs-keyword">import</span> time</code></pre><pre class="highlight"><code class="python">name=<span class="hljs-string">'1876180****'</span>passwd=<span class="hljs-string">'dxy123456'</span>driver=webdriver.Chrome(<span class="hljs-string">r'C:\Users\MZ\Downloads\chromedriver_win32\chromedriver.exe'</span>)driver.get(<span class="hljs-string">'http://www.dxy.cn/bbs/thread/626626#626626'</span>)driver.maximize_window()time.sleep(<span class="hljs-number">5</span>)current_window_1=driver.current_window_handleprint(current_window_1)</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">#点击登陆按钮</span>button=driver.find_element_by_xpath(<span class="hljs-string">'//*[@id="J-eventBanner"]/div/div/a[2]'</span>)button.click()<span class="hljs-comment">#点击账号密码登陆</span>button=driver.find_element_by_xpath(<span class="hljs-string">'/html/body/div[2]/div[2]/div[1]/a[2]'</span>)button.click()</code></pre><pre class="highlight"><code class="python">email=driver.find_element_by_id(<span class="hljs-string">'username'</span>)email.send_keys(name)password=driver.find_element_by_name(<span class="hljs-string">'password'</span>)password.send_keys(passwd)submit=driver.find_element_by_xpath(<span class="hljs-string">'//*[@id="user"]/div[1]/div[3]/button'</span>)time.sleep(<span class="hljs-number">3</span>)submit.click()time.sleep(<span class="hljs-number">10</span>)print(driver.page_source)</code></pre><p>至此即可获得登陆后的界面信息，抽取评论应该和上次所用方法一样，有时间再做补充。</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>selenium</tag>
      
      <tag>cookie</tag>
      
      <tag>session</tag>
      
      <tag>代理</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-爬虫</title>
    <link href="/2020/04/23/02-%E7%88%AC%E8%99%AB/"/>
    <url>/2020/04/23/02-%E7%88%AC%E8%99%AB/</url>
    
    <content type="html"><![CDATA[<h3 id="正则表达式"><a class="markdownIt-Anchor" href="#正则表达式"></a> 正则表达式</h3><h4 id="正则表达式语法"><a class="markdownIt-Anchor" href="#正则表达式语法"></a> 正则表达式语法</h4><ul><li><code>.</code> 表示任何单个字符</li><li><code>[ ]</code> 字符集，对单个字符给出取值范围 ，如<code>[abc]</code>表示a、b、c，<code>[a‐z]</code>表示a到z单个字符</li><li><code>[^ ]</code> 非字符集，对单个字符给出排除范围 ，如<code>[^abc]</code>表示非a或b或c的单个字符</li><li><code>*</code> 前一个字符0次或无限次扩展，如abc* 表示 ab、abc、abcc、abccc等</li><li><code>+</code> 前一个字符1次或无限次扩展 ，如abc+ 表示 abc、abcc、abccc等</li><li><code>?</code> 前一个字符0次或1次扩展 ，如abc? 表示 ab、abc</li><li><code>|</code> 左右表达式任意一个 ，如abc|def 表示 abc、def</li><li><code>{m}</code> 扩展前一个字符m次 ，如ab{2}c表示abbc</li><li><code>{m,n}</code> 扩展前一个字符m至n次（含n） ，如ab{1,2}c表示abc、abbc</li><li><code>^</code> 匹配字符串开头 ，如^abc表示abc且在一个字符串的开头</li><li><code>$</code> 匹配字符串结尾 ，如abc$表示abc且在一个字符串的结尾</li><li><code>( )</code> 分组标记，内部只能使用 | 操作符 ，如(abc)表示abc，(abc|def)表示abc、def，使用分组除了整体匹配的符号外，单独的分组也会匹配出来。</li><li><code>\d</code> 数字，等价于<code>[0‐9]</code></li><li><code>\w</code> 单词字符，等价于<code>[A‐Za‐z0‐9_]</code></li></ul><h4 id="re库"><a class="markdownIt-Anchor" href="#re库"></a> re库</h4><ul><li>re.search() 在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象<ul><li>re.search(pattern, string, flags=0)</li></ul></li><li>re.match() 从一个字符串的开始位置起匹配正则表达式，返回match对象<ul><li>re.match(pattern, string, flags=0)</li></ul></li><li>re.findall() 搜索字符串，以列表类型返回全部能匹配的子串<ul><li>re.findall(pattern, string, flags=0)</li></ul></li><li>re.split() 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型<ul><li>re.split(pattern, string, maxsplit=0, flags=0)</li></ul></li><li>re.finditer() 搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象<ul><li>re.finditer(pattern, string, flags=0)</li></ul></li><li>re.sub() 在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串<ul><li>re.sub(pattern, repl, string, count=0, flags=0)</li><li>flags : 正则表达式使用时的控制标记：<ul><li>re.I --&gt; re.IGNORECASE : 忽略正则表达式的大小写，<code>[A‐Z]</code>能够匹配小写字符</li><li>re.M --&gt; re.MULTILINE : 正则表达式中的^操作符能够将给定字符串的每行当作匹配开始</li><li>re.S --&gt; re.DOTALL : 正则表达式中的.操作符能够匹配所有字符，默认匹配除换行外的所有字符</li></ul></li></ul></li></ul><h4 id="淘宝商品爬虫"><a class="markdownIt-Anchor" href="#淘宝商品爬虫"></a> 淘宝商品爬虫</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">import</span> re<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getHTMLText</span><span class="hljs-params">(url)</span>:</span>    <span class="hljs-keyword">try</span>:        kv={<span class="hljs-string">'cookie'</span>:<span class="hljs-string">'thw=cn; cna=+xjxFvvjZFUCAbegU4BJw+f0; hng=CN%7Czh-CN%7CCNY%7C156; _samesite_flag_=true; cookie2=18ea7aba395e98b25e202aca290dfc51; t=063bd64499346909d85799069ecdfb0a; _tb_token_=e7b0d70737676; sgcookie=EQbeuix2KIOgXG2FFLZOJ; unb=2657451481; uc3=vt3=F8dBxGR2VD%2BIzyEg%2Beo%3D&amp;lg2=UtASsssmOIJ0bQ%3D%3D&amp;id2=UU6kVNSBaZ7V0Q%3D%3D&amp;nk2=oHW%2BtqmuGFM%3D; csg=4349f769; lgc=%5Cu5B5F%5Cu95471023; cookie17=UU6kVNSBaZ7V0Q%3D%3D; dnk=%5Cu5B5F%5Cu95471023; skt=490ef5758fe425d4; existShop=MTU4NzU0MjE2Mg%3D%3D; uc4=nk4=0%40oicDEdY%2Fq4hj7fRzY6bY5rGJXw%3D%3D&amp;id4=0%40U2xpViK2NwPK%2B6Z6pycbkB5Z8GcI; tracknick=%5Cu5B5F%5Cu95471023; _cc_=VFC%2FuZ9ajQ%3D%3D; _l_g_=Ug%3D%3D; sg=313; _nk_=%5Cu5B5F%5Cu95471023; cookie1=WqUIbiciTOhdw8TeNfR1ltACceU5jKLQIv2L5E78Zzo%3D; enc=5kK7r49vDFT6xXh5WeuK224BSMneKyQf4H%2F7R%2FSyjHeMJIz8BwUqOX967CJBECgM1E03U6Y1ORAfflhD%2FmV1Mg%3D%3D; JSESSIONID=F55DD890B8CDAD1F8644BE9DABD3A503; tfstk=cEb1BFvrHAD1s1bZ8tNebz9sepTVa6yBtl9O1MBYuf-uj7C6psAjzL_IQiDnJ3dC.; uc1=cookie16=VT5L2FSpNgq6fDudInPRgavC%2BQ%3D%3D&amp;cookie21=Vq8l%2BKCLjhS4UhJVbhgU&amp;cookie15=V32FPkk%2Fw0dUvg%3D%3D&amp;existShop=false&amp;pas=0&amp;cookie14=UoTUPcllKBuWuA%3D%3D; mt=ci=75_1; v=0; isg=BPDwL_0CWmxemQaV6E8w83tQwb5COdSDUALMBOpBvMsepZBPkkmkE0aX-a3FLoxb; l=eBxryhwuQJlCKyvkBOfaFurza77OSIRYYuPzaNbMiT5POS5B5QzGWZX3qAT6C3GVh6ByR3JMwUXJBeYBqQAonxv92j-la_kmn'</span>,            <span class="hljs-string">'user-agent'</span>:<span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36'</span>}        r=requests.get(url,timeout=<span class="hljs-number">30</span>,headers=kv)        r.raise_for_status()        r.encoding=r.apparent_encoding        <span class="hljs-keyword">return</span> r.text    <span class="hljs-keyword">except</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">'爬取失败'</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parsePage</span><span class="hljs-params">(glist,html)</span>:</span>    <span class="hljs-keyword">try</span>:        price_list=re.findall(<span class="hljs-string">'\"view_price\":\"\d+\.\d+\"'</span>,html)        name_list=re.findall(<span class="hljs-string">r'\"raw_title\":\"[a-zA-Z0-9_\w\s\\\u3010\u3011\-*]+\"'</span>,html)        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(price_list)):            price=eval(price_list[i].split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>])            name=eval(name_list[i].split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>])<span class="hljs-comment">#             print(price,name)</span>            glist.append([price,name])    <span class="hljs-keyword">except</span>:        print(<span class="hljs-string">'解析失败'</span>)                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printGoodList</span><span class="hljs-params">(glist)</span>:</span>    tplt=<span class="hljs-string">"{0:^4}\t{1:6}\t{2:^10}"</span>    print(tplt.format(<span class="hljs-string">'序号'</span>,<span class="hljs-string">"商品价格"</span>,<span class="hljs-string">'商品名称'</span>))    count=<span class="hljs-number">0</span>    <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> glist:        count+=<span class="hljs-number">1</span>        print(tplt.format(count,g[<span class="hljs-number">0</span>],g[<span class="hljs-number">1</span>]))        goods_name=<span class="hljs-string">'书包'</span>start_url=<span class="hljs-string">'https://s.taobao.com/search?q='</span>+goods_nameinfo_list=[]page=<span class="hljs-number">3</span>count=<span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(page):    count+=<span class="hljs-number">1</span>    <span class="hljs-keyword">try</span>:        url=start_url+<span class="hljs-string">"&amp;s"</span>+str(<span class="hljs-number">44</span>*i)        html=getHTMLText(url)        parsePage(info_list,html)        print(<span class="hljs-string">"\r爬取页面当前进度:{:.2f}%"</span>.format(count*<span class="hljs-number">100</span>/page),end=<span class="hljs-string">""</span>)    <span class="hljs-keyword">except</span>:        <span class="hljs-keyword">continue</span></code></pre><p>正则表达式的问题主要出现在匹配商品名称上面，自己的表达式为<code>\&quot;raw_title\&quot;:\&quot;[a-zA-Z0-9_\w\s\\\u3010\u3011\-*]+\&quot;</code>,主要出现的问题是商品名称会出现许多特殊符号，比如【-，等等，自己想用<code>.*</code>来匹配，但是<code>.</code>会匹配所有字符，产生越界问题。参考答案给的解决方案是<code>\&quot;raw_title\&quot;\:\&quot;.*?\&quot;</code>,在<code>.*</code>后面加上问号就可以解决越界问题。</p><h3 id="beautifulsoup"><a class="markdownIt-Anchor" href="#beautifulsoup"></a> BeautifulSoup</h3><h4 id="beautifulsoup的基本元素"><a class="markdownIt-Anchor" href="#beautifulsoup的基本元素"></a> BeautifulSoup的基本元素</h4><ol><li>Beautiful Soup库的理解： Beautiful Soup库是解析、遍历、维护“标签树”的功能库，对应一个HTML/XML文档的全部内容</li><li>BeautifulSoup类的基本元素:<ul><li><code>Tag 标签，最基本的信息组织单元，分别用&lt;&gt;和标明开头和结尾；</code></li><li><code>Name 标签的名字，…的名字是'p'，格式：.name;</code></li><li><code>Attributes 标签的属性，字典形式组织，格式：.attrs;</code></li><li><code>NavigableString 标签内非属性字符串，&lt;&gt;…中字符串，格式：.string;</code></li><li><code>Comment 标签内字符串的注释部分，一种特殊的Comment类型;</code></li></ul></li></ol><pre class="highlight"><code class="python"><span class="hljs-comment"># 导入bs4库</span><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<span class="hljs-keyword">import</span> requests <span class="hljs-comment"># 抓取页面</span>r = requests.get(<span class="hljs-string">'https://python123.io/ws/demo.html'</span>) <span class="hljs-comment"># Demo网址</span>demo = r.text  <span class="hljs-comment"># 抓取的数据</span>demo<span class="hljs-comment"># 解析HTML页面</span>soup = BeautifulSoup(demo, <span class="hljs-string">'html.parser'</span>)  <span class="hljs-comment"># 抓取的页面数据；bs4的解析器</span><span class="hljs-comment"># 有层次感的输出解析后的HTML页面</span>print(soup.prettify())</code></pre><h5 id="标签"><a class="markdownIt-Anchor" href="#标签"></a> 标签</h5><p>直接使用tag名获得</p><pre class="highlight"><code class="python">soup.a soup.title</code></pre><p>返回的string对象可以继续调用BeautifulSoup的层级标签功能</p><h5 id="标签的名字"><a class="markdownIt-Anchor" href="#标签的名字"></a> 标签的名字</h5><pre class="highlight"><code class="python">soup.a.namesoup.a.parent.namesoup.p.parent.name</code></pre><p>可以用来查看层级标签的名字，当层级标签比较复杂时可以使用。</p><h5 id="标签的属性"><a class="markdownIt-Anchor" href="#标签的属性"></a> 标签的属性</h5><pre class="highlight"><code class="python">tag = soup.aprint(tag.attrs)print(tag.attrs[<span class="hljs-string">'class'</span>])print(type(tag.attrs))</code></pre><p>注意，返回的是关于标签的一个列表</p><h5 id="string"><a class="markdownIt-Anchor" href="#string"></a> string</h5><pre class="highlight"><code class="python">print(soup.a.string)print(type(soup.a.string))</code></pre><p>返回标签内的非属性字符串。</p><h5 id="prettify"><a class="markdownIt-Anchor" href="#prettify"></a> prettify()</h5><pre class="highlight"><code class="python">print(soup.prettify())</code></pre><p>返回层次化的标签结构</p><h4 id="基于bs4库的html内容遍历方法"><a class="markdownIt-Anchor" href="#基于bs4库的html内容遍历方法"></a> 基于bs4库的HTML内容遍历方法</h4><p>HTML基本格式:<code>&lt;&gt;…</code>构成了所属关系，形成了标签的树形结构</p><ul><li>标签树的下行遍历<ul><li>.contents 子节点的列表，将``所有儿子节点存入列表</li><li>.children 子节点的迭代类型，与.contents类似，用于循环遍历儿子节点</li><li>.descendants 子孙节点的迭代类型，包含所有子孙节点，用于循环遍历</li></ul></li><li>标签树的上行遍<ul><li>.parent 节点的父亲标签</li><li>.parents 节点先辈标签的迭代类型，用于循环遍历先辈节点</li></ul></li><li>标签树的平行遍历<ul><li>.next_sibling 返回按照HTML文本顺序的下一个平行节点标签</li><li>.previous_sibling 返回按照HTML文本顺序的上一个平行节点标签</li><li>.next_siblings 迭代类型，返回按照HTML文本顺序的后续所有平行节点标签</li><li>.previous_siblings 迭代类型，返回按照HTML文本顺序的前续所有平行节点标签</li></ul></li></ul><h5 id="标签树的下行遍历"><a class="markdownIt-Anchor" href="#标签树的下行遍历"></a> 标签树的下行遍历</h5><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoupr=requests.get(<span class="hljs-string">'http://python123.io/ws/demo.html'</span>)demo=r.textsoup=BeautifulSoup(demo,<span class="hljs-string">'html.parser'</span>)print(soup.contents)<span class="hljs-comment"># 获取整个标签树的儿子节点</span>print(soup.body.contents)<span class="hljs-comment">#返回标签树的body标签下的节点</span>print(soup.head)<span class="hljs-comment">#返回head标签</span><span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> soup.body.children:<span class="hljs-comment">#遍历儿子节点，不会遍历儿子节点下的节点</span>    print(child)    <span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> soup.body.descendants:<span class="hljs-comment">#遍历子孙节点，遍历父节点下面所有节点</span>    print(child)</code></pre><h5 id="标签树的上行遍历"><a class="markdownIt-Anchor" href="#标签树的上行遍历"></a> 标签树的上行遍历</h5><pre class="highlight"><code class="python">soup.title.parentsoup.title.parent<span class="hljs-keyword">for</span> parent <span class="hljs-keyword">in</span> soup.a.parents: <span class="hljs-comment"># 遍历先辈的信息</span>    <span class="hljs-keyword">if</span> parent <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:        print(parent)    <span class="hljs-keyword">else</span>:        print(parent.name)</code></pre><h5 id="标签树的平行遍历"><a class="markdownIt-Anchor" href="#标签树的平行遍历"></a> 标签树的平行遍历</h5><p>注意：</p><ul><li>标签树的平行遍历是有条件的</li><li>平行遍历发生在同一个父亲节点的各节点之间</li><li>标签中的内容也构成了节点,连续的字符串也是节点</li></ul><pre class="highlight"><code class="python">print(soup.a.next_sibling)<span class="hljs-comment">#a标签的下一个标签</span>print(soup.a.next_sibling.next_sibling)<span class="hljs-comment">#a标签的下一个标签的下一个标签</span>print(soup.a.previous_sibling)<span class="hljs-comment">#a标签的前一个标签</span>print(soup.a.previous_sibling.previous_sibling)<span class="hljs-comment">#a标签的前一个标签的前一个标签</span><span class="hljs-keyword">for</span> sibling <span class="hljs-keyword">in</span> soup.a.next_siblings:<span class="hljs-comment">#遍历后续节点</span>    print(sibling)<span class="hljs-keyword">for</span> sibling <span class="hljs-keyword">in</span> soup.a.previous_siblings:<span class="hljs-comment">#遍历之前的节点</span>    print(sibling)</code></pre><h4 id="基于bs4库的html查找方法"><a class="markdownIt-Anchor" href="#基于bs4库的html查找方法"></a> 基于bs4库的html查找方法</h4><ul><li>&lt;&gt;.find_all(name, attrs, recursive, string, **kwargs)<ul><li>参数：</li><li>∙ name : 对标签名称的检索字符串</li><li>∙ attrs: 对标签属性值的检索字符串，可标注属性检索</li><li>∙ recursive: 是否对子孙全部检索，默认True</li><li>∙ string: &lt;&gt;…&lt;/&gt;中字符串区域的检索字符串<ul><li>简写：</li><li><code>(..) 等价于</code>.find_all(…)</li><li>soup(…) 等价于 soup.find_all(…)</li></ul></li></ul></li><li>扩展方法：<ul><li>&lt;&gt;.find() 搜索且只返回一个结果，同.find_all()参数</li><li>&lt;&gt;.find_parents() 在先辈节点中搜索，返回列表类型，同.find_all()参数</li><li>&lt;&gt;.find_parent() 在先辈节点中返回一个结果，同.find()参数</li><li>&lt;&gt;.find_next_siblings() 在后续平行节点中搜索，返回列表类型，同.find_all()参数</li><li>&lt;&gt;.find_next_sibling() 在后续平行节点中返回一个结果，同.find()参数</li><li>&lt;&gt;.find_previous_siblings() 在前序平行节点中搜索，返回列表类型，同.find_all()参数</li><li>&lt;&gt;.find_previous_sibling() 在前序平行节点中返回一个结果，同.find()参数</li></ul></li></ul><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoupr = requests.get(<span class="hljs-string">'http://python123.io/ws/demo.html'</span>)demo = r.textsoup = BeautifulSoup(demo,<span class="hljs-string">'html.parser'</span>)soup</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment"># name : 对标签名称的检索字符串</span>soup.find_all(<span class="hljs-string">'a'</span>)soup.find_all([<span class="hljs-string">'a'</span>, <span class="hljs-string">'p'</span>])<span class="hljs-comment"># attrs: 对标签属性值的检索字符串，可标注属性检索</span>soup.find_all(<span class="hljs-string">"p"</span>,<span class="hljs-string">"course"</span>)</code></pre><pre class="highlight"><code class="python">soup.find_all(id=<span class="hljs-string">"link"</span>) <span class="hljs-comment"># 完全匹配才能匹配到</span><span class="hljs-comment">#  recursive: 是否对子孙全部检索，默认True</span>soup.find_all(<span class="hljs-string">'p'</span>,recursive=<span class="hljs-literal">False</span>)<span class="hljs-comment"># string: &lt;&gt;…&lt;/&gt;中字符串区域的检索字符串</span>soup.find_all(string = <span class="hljs-string">"Basic Python"</span>) <span class="hljs-comment"># 完全匹配才能匹配到</span></code></pre><h4 id="好大学排名爬虫给你"><a class="markdownIt-Anchor" href="#好大学排名爬虫给你"></a> 好大学排名爬虫给你</h4><ul><li>爬取url：<a href="http://www.zuihaodaxue.cn/zuihaodaxuepaiming2019.html" target="_blank" rel="noopener">http://www.zuihaodaxue.cn/zuihaodaxuepaiming2019.html</a></li><li>爬取思路：<ol><li>从网络上获取大学排名网页内容</li><li>提取网页内容中信息到合适的数据结构（二维数组）-排名，学校名称，总分</li><li>利用数据结构展示并输出结果</li></ol></li></ul><pre class="highlight"><code class="python"><span class="hljs-comment"># 导入库</span><span class="hljs-keyword">import</span> requests<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<span class="hljs-keyword">import</span> bs4</code></pre><p>自己和官方代码比起来就比较简陋了</p><pre class="highlight"><code class="python">r=requests.get(<span class="hljs-string">'http://www.zuihaodaxue.cn/zuihaodaxuepaiming2019.html'</span>)r.raise_for_status()r.encoding=r.apparent_encoding  <span class="hljs-comment">#自动获取编码，可以省好多事</span>demo=r.textdemo</code></pre><pre class="highlight"><code class="python">soup=BeautifulSoup(demo,<span class="hljs-string">'html.parser'</span>)print(<span class="hljs-string">'{0:^8}\t{1:^18}\t{2:^18}'</span>.format(<span class="hljs-string">"排名"</span>,<span class="hljs-string">"学校名称"</span>,<span class="hljs-string">"总分"</span>))<span class="hljs-keyword">for</span> tr <span class="hljs-keyword">in</span> trs:    rank=tr.find_all(<span class="hljs-string">'td'</span>)[<span class="hljs-number">0</span>].string     school_name=tr.find_all(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>].string    score=tr.find_all(<span class="hljs-string">'td'</span>)[<span class="hljs-number">4</span>].string    print(<span class="hljs-string">'{0:^8}\t{1:^18}\t{2:^18}'</span>.format(rank,school_name,score))</code></pre><h3 id="xpath"><a class="markdownIt-Anchor" href="#xpath"></a> Xpath</h3><h4 id="xpath-语法"><a class="markdownIt-Anchor" href="#xpath-语法"></a> Xpath 语法</h4><ul><li>XPath即为XML路径语言（XML Path Language），它是一种用来确定XML文档中某部分位置的语言。</li><li>在XPath中，有七种类型的节点：元素、属性、文本、命名空间、处理指令、注释以及文档（根）节点。</li><li>XML文档是被作为节点树来对待的。</li></ul><p>XPath使用路径表达式在XML文档中选取节点。节点是通过沿着路径选取的。下面列出了最常用的路径表达式：</p><ul><li>nodename 选取此节点的所有子节点。</li><li>/ 从根节点选取。</li><li>// 从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</li><li>. 选取当前节点。</li><li>… 选取当前节点的父节点。</li><li>@ 选取属性。</li><li>/text() 提取标签下面的文本内容<ul><li>如：</li><li>/标签名 逐层提取</li><li>/标签名 提取所有名为&lt;&gt;的标签</li><li>//标签名[@属性=“属性值”] 提取包含属性为属性值的标签</li><li>@属性名 代表取某个属性名的属性值</li></ul></li><li>详细学习：<a href="https://www.cnblogs.com/gaojun/archive/2012/08/11/2633908.html" target="_blank" rel="noopener">https://www.cnblogs.com/gaojun/archive/2012/08/11/2633908.html</a></li></ul><h4 id="使用lxml解析"><a class="markdownIt-Anchor" href="#使用lxml解析"></a> 使用lxml解析</h4><ul><li>导入库：from lxml import etree</li><li>lxml将html文本转成xml对象<ul><li>tree = etree.HTML(html)</li></ul></li><li>用户名称：tree.xpath(’//div[@class=“auth”]/a/text()’)</li><li>回复内容：tree.xpath(’//td[@class=“postbody”]’) 因为回复内容中有换行等标签，所以需要用string()来获取数据。<ul><li>string()的详细见链接：<a href="https://www.cnblogs.com/CYHISTW/p/12312570.html" target="_blank" rel="noopener">https://www.cnblogs.com/CYHISTW/p/12312570.html</a></li></ul></li><li>Xpath中text()，string()，data()的区别如下：<ul><li>text()仅仅返回所指元素的文本内容。</li><li>string()函数会得到所指元素的所有节点文本内容，这些文本讲会被拼接成一个字符串。</li><li>data()大多数时候，data()函数和string()函数通用，而且不建议经常使用data()函数，有数据表明，该函数会影响XPath的性能。</li></ul></li></ul><h4 id="丁香园评论爬虫"><a class="markdownIt-Anchor" href="#丁香园评论爬虫"></a> 丁香园评论爬虫</h4><p>chrome的开发工具里面是有copy Xpath这个选项的</p><pre class="highlight"><code class="python"><span class="hljs-comment"># 导入库</span><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<span class="hljs-keyword">import</span> requestsurl = <span class="hljs-string">"http://www.dxy.cn/bbs/thread/626626#626626"</span></code></pre><pre class="highlight"><code class="python">req = requests.get(url)html = req.text</code></pre><pre class="highlight"><code class="python">tree = etree.HTML(html) tree</code></pre><pre class="highlight"><code class="python">user = tree.xpath(<span class="hljs-string">'//div[@class="auth"]/a/text()'</span>)<span class="hljs-comment"># print(user)</span>content = tree.xpath(<span class="hljs-string">'//td[@class="postbody"]'</span>)</code></pre><pre class="highlight"><code class="python">results = []<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(user)):    <span class="hljs-comment"># print(user[i].strip()+":"+content[i].xpath('string(.)').strip())</span>    <span class="hljs-comment"># print("*"*80)</span>    <span class="hljs-comment"># 因为回复内容中有换行等标签，所以需要用string()来获取数据</span>    results.append(user[i].strip() + <span class="hljs-string">":  "</span> + content[i].xpath(<span class="hljs-string">'string(.)'</span>).strip())</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment"># 打印爬取的结果</span><span class="hljs-keyword">for</span> i,result <span class="hljs-keyword">in</span> zip(range(<span class="hljs-number">0</span>, len(user)),results):    print(<span class="hljs-string">"user"</span>+ str(i+<span class="hljs-number">1</span>) + <span class="hljs-string">"-"</span> + result)    print(<span class="hljs-string">"*"</span>*<span class="hljs-number">100</span>)</code></pre><p>比较让自己困惑的是text()和string(.)的用法，博客上介绍说text()返回的是匹配到的所有元素包含文字的列表，而string(.)返回的是合并后的结果。而且string(.)的用法要在获取上级元素后，单独对每个元素调用.xpath(‘string(.)’)。后来我才发现，如果文字中内嵌有其他标签，比如br等，就会将文字分割成单独的各个列表元素，和上一层及的元素并列产生问题。因此我们可以对同一层级的元素使用string(.),这样不管同级元素是否有下级元素，都会统一成一个元素。</p><p>收工~~~</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>正则表达式</tag>
      
      <tag>bs4</tag>
      
      <tag>Xpath</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-爬虫入门</title>
    <link href="/2020/04/21/01-%E7%88%AC%E8%99%AB/"/>
    <url>/2020/04/21/01-%E7%88%AC%E8%99%AB/</url>
    
    <content type="html"><![CDATA[<h3 id="http请求"><a class="markdownIt-Anchor" href="#http请求"></a> HTTP请求</h3><p>对于http请求，记录一下常用的几种：</p><ol><li>GET：向指定的资源发出“显示”请求。GET方法应该只用于读取数据 ，查询字符串（名称/值对）是在 GET 请求的 URL 中发送的 。</li><li>POST：向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求文本中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。  查询字符串（名称/值对）是在 POST 请求的 HTTP 消息主体中发送的</li><li>PUT：向指定资源位置上传输最新内容。</li><li>DELETE：请求服务器删除Request-URL所标识的资源。</li></ol><h3 id="requestsget"><a class="markdownIt-Anchor" href="#requestsget"></a> requests.get</h3><p>实现基本的requests应用，爬取python之禅</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requestsurl=<span class="hljs-string">'https://www.python.org/dev/peps/pep-0020/'</span>res=request.get(url)text=res.text</code></pre><p>此时返回的text是html原生文本，想要获取对应内容就需要进行匹配了。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python.txt'</span>,<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:    f.write(text[text.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:text.find(<span class="hljs-string">'&lt;/pre&gt;'</span>)<span class="hljs-number">-1</span>])print(text[text.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:text.find(<span class="hljs-string">'&lt;/pre'</span>)<span class="hljs-number">-1</span>])Beautiful <span class="hljs-keyword">is</span> better than ugly.Explicit <span class="hljs-keyword">is</span> better than implicit.Simple <span class="hljs-keyword">is</span> better than complex.Complex <span class="hljs-keyword">is</span> better than complicated.Flat <span class="hljs-keyword">is</span> better than nested.Sparse <span class="hljs-keyword">is</span> better than dense.Readability counts.Special cases aren<span class="hljs-string">'t special enough to break the rules.Although practicality beats purity.Errors should never pass silently.Unless explicitly silenced.In the face of ambiguity, refuse the temptation to guess.There should be one-- and preferably only one --obvious way to do it.Although that way may not be obvious at first unless you'</span>re Dutch.Now <span class="hljs-keyword">is</span> better than never.Although never <span class="hljs-keyword">is</span> often better than *right* now.If the implementation <span class="hljs-keyword">is</span> hard to explain, it<span class="hljs-string">'s a bad idea.If the implementation is easy to explain, it may be a good idea.Namespaces are one honking great idea -- let'</span>s do more of those!</code></pre><p>python自带的urllib也能实现上述功能</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> urlliburl = <span class="hljs-string">'https://www.python.org/dev/peps/pep-0020/'</span>res=urllib.request.urlopen(url).read().decode(<span class="hljs-string">'utf-8'</span>)print(res[res.find(<span class="hljs-string">'&lt;pre'</span>)+<span class="hljs-number">28</span>:res.find(<span class="hljs-string">'&lt;/pre'</span>)<span class="hljs-number">-1</span>])</code></pre><p>urllib明显要繁琐些。</p><h3 id="requestpost"><a class="markdownIt-Anchor" href="#requestpost"></a> request.post</h3><p>request.get只是从网站上爬取已有数据，当我们需要和网站进行数据交互时，就要用到post方法。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> requests<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">translate</span><span class="hljs-params">(word)</span>:</span>    url=<span class="hljs-string">"http://fy.iciba.com/ajax.php?a=fy"</span>    data={        <span class="hljs-string">'f'</span>:<span class="hljs-string">'auto'</span>,        <span class="hljs-string">'t'</span>:<span class="hljs-string">'atuo'</span>,        <span class="hljs-string">'w'</span>:word,    }        headers={<span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36'</span>}        response=requests.post(url,data=data,headers=headers)    json_data=response.json()    <span class="hljs-keyword">return</span> json_data<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(word)</span>:</span>    result=tranlate(word)[<span class="hljs-string">'content'</span>][<span class="hljs-string">'out'</span>]    print(result)    <span class="hljs-keyword">return</span> result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>    <span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python.txt'</span>) <span class="hljs-keyword">as</span> f:        zh=[run(word) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> f]            <span class="hljs-keyword">with</span> open(<span class="hljs-string">'zon_of_python_zh-CN.txt'</span>,<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> g:        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> zh:            g.write(i+<span class="hljs-string">'\n'</span>)<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">'__main__'</span>:    main()</code></pre><p>data内容和格式的确定需要从chrome的检查工具network中的Headers获取。</p><h3 id="爬取豆瓣电影top250"><a class="markdownIt-Anchor" href="#爬取豆瓣电影top250"></a> 爬取豆瓣电影top250</h3><ol><li>首先要找到我们要爬取的东西在网页的位置，借助检查工具，可以找到对用位置的代码：</li></ol><p><img src="https://s1.ax1x.com/2020/04/21/JGGbKs.png" srcset="/img/loading.gif" alt="JGGbKs.png" /></p><p>借助匹配规则就可以拿到想要的东西（ps：还不会匹配呀，应该是要根据html元素的层级关系来匹配）。借助检查工具中的<strong>Copy Xpath</strong>功能，可以找到电影名和图片超链接的位置。</p><p><img src="https://s1.ax1x.com/2020/04/21/JGt7xe.png" srcset="/img/loading.gif" alt="JGt7xe.png" /></p><p>获取电影名和图片超链接的Xpath公式为</p><pre class="highlight"><code class="python">//*[@id=<span class="hljs-string">"content"</span>]/div/div[<span class="hljs-number">1</span>]/ol/li[<span class="hljs-number">23</span>]/div/div[<span class="hljs-number">1</span>]/a/img/@alt//*[@id=<span class="hljs-string">"content"</span>]/div/div[<span class="hljs-number">1</span>]/ol/li[<span class="hljs-number">23</span>]/div/div[<span class="hljs-number">1</span>]/a/img/@src</code></pre><p>其中23是电影对应的当前页次序，范围是1-25，刚开始以为是电影的排名还出错了。</p><ol start="2"><li>电影分布在好几个页面，所以还要找出翻页的规律，借助检查工具点击页码，找到对应位置的代码：</li></ol><p><img src="https://s1.ax1x.com/2020/04/21/JGJtJS.png" srcset="/img/loading.gif" alt="JGJtJS.png" /></p><p>可以发现其中url对应的数字规律，0 25 50…</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree<span class="hljs-keyword">import</span> timedic={}headers={      <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36'</span>    }<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_name_imgpath</span><span class="hljs-params">(text)</span>:</span>    html = etree.HTML(text)    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">26</span>):        name = html.xpath(<span class="hljs-string">'//*[@id="content"]/div/div[1]/ol/li[{}]/div/div[1]/a/img/@alt'</span>.format(i))        img_path=html.xpath(<span class="hljs-string">'//*[@id="content"]/div/div[1]/ol/li[{}]/div/div[1]/a/img/@src'</span>.format(i))        print(name[<span class="hljs-number">0</span>],img_path[<span class="hljs-number">0</span>])        dic.update({name[<span class="hljs-number">0</span>]:img_path[<span class="hljs-number">0</span>]})print(<span class="hljs-string">'crawl start'</span>)<span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">226</span>,<span class="hljs-number">25</span>):    text=requests.get(<span class="hljs-string">'https://movie.douban.com/top250?start={}&amp;filter='</span>.format(page),headers=headers).text    get_name_imgpath(text)    time.sleep(<span class="hljs-number">1</span>)    print(<span class="hljs-string">'crawl finish'</span>)print(dic)</code></pre><p>程序运行成功</p><p><img src="https://s1.ax1x.com/2020/04/21/JGfZ24.png" srcset="/img/loading.gif" alt="JGfZ24.png" /></p><p>收工！！！</p>]]></content>
    
    
    <categories>
      
      <category>爬虫</category>
      
    </categories>
    
    
    <tags>
      
      <tag>爬虫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-二手车价格预测之模型融合</title>
    <link href="/2020/04/04/04-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88/"/>
    <url>/2020/04/04/04-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88/</url>
    
    <content type="html"><![CDATA[<p>虽然这是最后一次打卡的内容，但是自己离掌握这些内容还差得很远，还要继续努力呀！温故而知新。</p><h3 id="ensemble的方法"><a class="markdownIt-Anchor" href="#ensemble的方法"></a> ensemble的方法</h3><h4 id="简单加权融合"><a class="markdownIt-Anchor" href="#简单加权融合"></a> 简单加权融合</h4><ul><li><p>回归（分类概率）：算术平均融合（Arithmetic mean），几何平均融合（Geometric mean）；</p></li><li><p>分类：投票（Voting)</p></li><li><p>综合：排序融合(Rank averaging)，log融合</p></li></ul><h4 id="stackingblending"><a class="markdownIt-Anchor" href="#stackingblending"></a> stacking/blending</h4><ul><li>构建多层模型，并利用预测结果再拟合预测</li></ul><h4 id="boostingbagging"><a class="markdownIt-Anchor" href="#boostingbagging"></a> boosting/bagging</h4><ul><li>在xgboost，Adaboost，GBDT中使用，多树的提升方法</li></ul><h3 id="stacking-理论介绍"><a class="markdownIt-Anchor" href="#stacking-理论介绍"></a> Stacking 理论介绍</h3><p><img src="https://camo.githubusercontent.com/7c71414331606f6169511b07898f44ffa7852734/687474703a2f2f6a75707465722d6f73732e6f73732d636e2d68616e677a686f752e616c6979756e63732e636f6d2f7075626c69632f66696c65732f696d6167652f323332363534313034322f313538343434383739333233315f365479676a58776a4e622e6a7067" srcset="/img/loading.gif" alt="img" /></p><p>先训练几个学习器，在这些学习器预测数据的基础上再训练新的学习器。</p><p>将个体学习器结合在一起的时候使用的方法叫做结合策略。对于分类问题，我们可以使用投票法来选择输出最多的类。对于回归问题，我们可以将分类器输出的结果求平均值。</p><p>在stacking方法中，我们把个体学习器叫做初级学习器，用于结合的学习器叫做次级学习器或元学习器（meta-learner），次级学习器用于训练的数据叫做次级训练集。次级训练集是在训练集上用初级学习器得到的。</p><p>对于训练集和测试集分布不那么一致的情况，用初始模型训练的标签再利用真实标签进行再训练，毫无疑问会导致一定的模型过拟合训练集，这里我们一般有两种方法：次级模型尽量选择简单的线性模型</p><p>利用K折交叉验证。</p><h3 id="代码示例"><a class="markdownIt-Anchor" href="#代码示例"></a> 代码示例</h3><h4 id="简单加权平均"><a class="markdownIt-Anchor" href="#简单加权平均"></a> 简单加权平均</h4><pre class="highlight"><code class="python"><span class="hljs-comment">## 生成一些简单的样本数据，test_prei 代表第i个模型的预测值</span>test_pre1 = [<span class="hljs-number">1.2</span>, <span class="hljs-number">3.2</span>, <span class="hljs-number">2.1</span>, <span class="hljs-number">6.2</span>]test_pre2 = [<span class="hljs-number">0.9</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">5.9</span>]test_pre3 = [<span class="hljs-number">1.1</span>, <span class="hljs-number">2.9</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">6.0</span>]<span class="hljs-comment"># y_test_true 代表第模型的真实值</span>y_test_true = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>] </code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<span class="hljs-comment">## 定义结果的加权平均函数</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Weighted_method</span><span class="hljs-params">(test_pre1,test_pre2,test_pre3,w=[<span class="hljs-number">1</span>/<span class="hljs-number">3</span>,<span class="hljs-number">1</span>/<span class="hljs-number">3</span>,<span class="hljs-number">1</span>/<span class="hljs-number">3</span>])</span>:</span>    Weighted_result = w[<span class="hljs-number">0</span>]*pd.Series(test_pre1)+w[<span class="hljs-number">1</span>]*pd.Series(test_pre2)+w[<span class="hljs-number">2</span>]*pd.Series(test_pre3)    <span class="hljs-keyword">return</span> Weighted_result</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> metrics<span class="hljs-comment"># 各模型的预测结果计算MAE</span>print(<span class="hljs-string">'Pred1 MAE:'</span>,metrics.mean_absolute_error(y_test_true, test_pre1))print(<span class="hljs-string">'Pred2 MAE:'</span>,metrics.mean_absolute_error(y_test_true, test_pre2))print(<span class="hljs-string">'Pred3 MAE:'</span>,metrics.mean_absolute_error(y_test_true, test_pre3))</code></pre><pre class="highlight"><code class="python">w = [<span class="hljs-number">0.3</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.3</span>] <span class="hljs-comment"># 定义比重权值</span>Weighted_pre = Weighted_method(test_pre1,test_pre2,test_pre3,w)print(<span class="hljs-string">'Weighted_pre MAE:'</span>,metrics.mean_absolute_error(y_test_true, Weighted_pre))</code></pre><p>即使是这样对多个预测结果的简单加权，也可以给实验结果带来提升</p><pre class="highlight"><code class="python"><span class="hljs-comment">## 定义结果的加权平均函数</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Mean_method</span><span class="hljs-params">(test_pre1,test_pre2,test_pre3)</span>:</span>    Mean_result = pd.concat([pd.Series(test_pre1),pd.Series(test_pre2),pd.Series(test_pre3)],axis=<span class="hljs-number">1</span>).mean(axis=<span class="hljs-number">1</span>)    <span class="hljs-keyword">return</span> Mean_result</code></pre><pre class="highlight"><code class="python">Mean_pre = Mean_method(test_pre1,test_pre2,test_pre3)print(<span class="hljs-string">'Mean_pre MAE:'</span>,metrics.mean_absolute_error(y_test_true, Mean_pre))</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">## 定义结果的加权平均函数</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Median_method</span><span class="hljs-params">(test_pre1,test_pre2,test_pre3)</span>:</span>    Median_result = pd.concat([pd.Series(test_pre1),pd.Series(test_pre2),pd.Series(test_pre3)],axis=<span class="hljs-number">1</span>).median(axis=<span class="hljs-number">1</span>)    <span class="hljs-keyword">return</span> Median_result</code></pre><pre class="highlight"><code class="python">Median_pre = Median_method(test_pre1,test_pre2,test_pre3)print(<span class="hljs-string">'Median_pre MAE:'</span>,metrics.mean_absolute_error(y_test_true, Median_pre))</code></pre><h4 id="stacking融合回归"><a class="markdownIt-Anchor" href="#stacking融合回归"></a> stacking融合（回归）</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> linear_model<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Stacking_method</span><span class="hljs-params">(train_reg1,train_reg2,train_reg3,y_train_true,test_pre1,test_pre2,test_pre3,model_L2= linear_model.LinearRegression<span class="hljs-params">()</span>)</span>:</span>    model_L2.fit(pd.concat([pd.Series(train_reg1),pd.Series(train_reg2),pd.Series(train_reg3)],axis=<span class="hljs-number">1</span>).values,y_train_true)    Stacking_result = model_L2.predict(pd.concat([pd.Series(test_pre1),pd.Series(test_pre2),pd.Series(test_pre3)],axis=<span class="hljs-number">1</span>).values)    <span class="hljs-keyword">return</span> Stacking_result</code></pre><pre class="highlight"><code class="py"><span class="hljs-comment">## 生成一些简单的样本数据，test_prei 代表第i个模型的预测值</span>train_reg1 = [<span class="hljs-number">3.2</span>, <span class="hljs-number">8.2</span>, <span class="hljs-number">9.1</span>, <span class="hljs-number">5.2</span>]train_reg2 = [<span class="hljs-number">2.9</span>, <span class="hljs-number">8.1</span>, <span class="hljs-number">9.0</span>, <span class="hljs-number">4.9</span>]train_reg3 = [<span class="hljs-number">3.1</span>, <span class="hljs-number">7.9</span>, <span class="hljs-number">9.2</span>, <span class="hljs-number">5.0</span>]<span class="hljs-comment"># y_test_true 代表第模型的真实值</span>y_train_true = [<span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">5</span>] test_pre1 = [<span class="hljs-number">1.2</span>, <span class="hljs-number">3.2</span>, <span class="hljs-number">2.1</span>, <span class="hljs-number">6.2</span>]test_pre2 = [<span class="hljs-number">0.9</span>, <span class="hljs-number">3.1</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">5.9</span>]test_pre3 = [<span class="hljs-number">1.1</span>, <span class="hljs-number">2.9</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">6.0</span>]<span class="hljs-comment"># y_test_true 代表第模型的真实值</span>y_test_true = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>] </code></pre><pre class="highlight"><code class="python">model_L2= linear_model.LinearRegression()Stacking_pre = Stacking_method(train_reg1,train_reg2,train_reg3,y_train_true,                               test_pre1,test_pre2,test_pre3,model_L2)print(<span class="hljs-string">'Stacking_pre MAE:'</span>,metrics.mean_absolute_error(y_test_true, Stacking_pre))</code></pre><p>我们需要注意的一点是，对于第二层Stacking的模型不宜选取的过于复杂</p><h4 id="分类模型融合"><a class="markdownIt-Anchor" href="#分类模型融合"></a> 分类模型融合</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_blobs<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeClassifier<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> VotingClassifier<span class="hljs-keyword">from</span> xgboost <span class="hljs-keyword">import</span> XGBClassifier<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression<span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVC<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_moons<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score,roc_auc_score<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> StratifiedKFold</code></pre><h5 id="voting-投票机制"><a class="markdownIt-Anchor" href="#voting-投票机制"></a> Voting 投票机制</h5><p>分为软投票和硬投票两种</p><pre class="highlight"><code class="python"><span class="hljs-string">'''硬投票：对多个模型直接进行投票，不区分模型结果的相对重要度，最终投票数最多的类为最终被预测的类。'''</span>iris = datasets.load_iris()x=iris.datay=iris.targetx_train,x_test,y_train,y_test=train_test_split(x,y,test_size=<span class="hljs-number">0.3</span>)clf1 = XGBClassifier(learning_rate=<span class="hljs-number">0.1</span>, n_estimators=<span class="hljs-number">150</span>, max_depth=<span class="hljs-number">3</span>, min_child_weight=<span class="hljs-number">2</span>, subsample=<span class="hljs-number">0.7</span>,                     colsample_bytree=<span class="hljs-number">0.6</span>, objective=<span class="hljs-string">'binary:logistic'</span>)clf2 = RandomForestClassifier(n_estimators=<span class="hljs-number">50</span>, max_depth=<span class="hljs-number">1</span>, min_samples_split=<span class="hljs-number">4</span>,                              min_samples_leaf=<span class="hljs-number">63</span>,oob_score=<span class="hljs-literal">True</span>)clf3 = SVC(C=<span class="hljs-number">0.1</span>)<span class="hljs-comment"># 硬投票</span>eclf = VotingClassifier(estimators=[(<span class="hljs-string">'xgb'</span>, clf1), (<span class="hljs-string">'rf'</span>, clf2), (<span class="hljs-string">'svc'</span>, clf3)], voting=<span class="hljs-string">'hard'</span>)<span class="hljs-keyword">for</span> clf, label <span class="hljs-keyword">in</span> zip([clf1, clf2, clf3, eclf], [<span class="hljs-string">'XGBBoosting'</span>, <span class="hljs-string">'Random Forest'</span>, <span class="hljs-string">'SVM'</span>, <span class="hljs-string">'Ensemble'</span>]):    scores = cross_val_score(clf, x, y, cv=<span class="hljs-number">5</span>, scoring=<span class="hljs-string">'accuracy'</span>)    print(<span class="hljs-string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span> % (scores.mean(), scores.std(), label))Accuracy: <span class="hljs-number">0.97</span> (+/- <span class="hljs-number">0.02</span>) [XGBBoosting]Accuracy: <span class="hljs-number">0.33</span> (+/- <span class="hljs-number">0.00</span>) [Random Forest]Accuracy: <span class="hljs-number">0.95</span> (+/- <span class="hljs-number">0.03</span>) [SVM]Accuracy: <span class="hljs-number">0.94</span> (+/- <span class="hljs-number">0.04</span>) [Ensemble]</code></pre><pre class="highlight"><code class="python"><span class="hljs-string">'''软投票：和硬投票原理相同，增加了设置权重的功能，可以为不同模型设置不同权重，进而区别模型不同的重要度。'''</span>x=iris.datay=iris.targetx_train,x_test,y_train,y_test=train_test_split(x,y,test_size=<span class="hljs-number">0.3</span>)clf1 = XGBClassifier(learning_rate=<span class="hljs-number">0.1</span>, n_estimators=<span class="hljs-number">150</span>, max_depth=<span class="hljs-number">3</span>, min_child_weight=<span class="hljs-number">2</span>, subsample=<span class="hljs-number">0.8</span>,                     colsample_bytree=<span class="hljs-number">0.8</span>, objective=<span class="hljs-string">'binary:logistic'</span>)clf2 = RandomForestClassifier(n_estimators=<span class="hljs-number">50</span>, max_depth=<span class="hljs-number">1</span>, min_samples_split=<span class="hljs-number">4</span>,                              min_samples_leaf=<span class="hljs-number">63</span>,oob_score=<span class="hljs-literal">True</span>)clf3 = SVC(C=<span class="hljs-number">0.1</span>, probability=<span class="hljs-literal">True</span>)<span class="hljs-comment"># 软投票</span>eclf = VotingClassifier(estimators=[(<span class="hljs-string">'xgb'</span>, clf1), (<span class="hljs-string">'rf'</span>, clf2), (<span class="hljs-string">'svc'</span>, clf3)], voting=<span class="hljs-string">'soft'</span>, weights=[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])clf1.fit(x_train, y_train)<span class="hljs-keyword">for</span> clf, label <span class="hljs-keyword">in</span> zip([clf1, clf2, clf3, eclf], [<span class="hljs-string">'XGBBoosting'</span>, <span class="hljs-string">'Random Forest'</span>, <span class="hljs-string">'SVM'</span>, <span class="hljs-string">'Ensemble'</span>]):    scores = cross_val_score(clf, x, y, cv=<span class="hljs-number">5</span>, scoring=<span class="hljs-string">'accuracy'</span>)    print(<span class="hljs-string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span> % (scores.mean(), scores.std(), label))</code></pre><h5 id="分类的stacking-blending融合"><a class="markdownIt-Anchor" href="#分类的stacking-blending融合"></a> 分类的Stacking、Blending融合</h5><pre class="highlight"><code class="python"><span class="hljs-string">'''5-Fold Stacking'''</span><span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> ExtraTreesClassifier,GradientBoostingClassifier<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<span class="hljs-comment">#创建训练的数据集</span>data_0 = iris.datadata = data_0[:<span class="hljs-number">100</span>,:]target_0 = iris.targettarget = target_0[:<span class="hljs-number">100</span>]<span class="hljs-comment">#模型融合中使用到的各个单模型</span>clfs = [LogisticRegression(solver=<span class="hljs-string">'lbfgs'</span>),        RandomForestClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        ExtraTreesClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        ExtraTreesClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'entropy'</span>),        GradientBoostingClassifier(learning_rate=<span class="hljs-number">0.05</span>, subsample=<span class="hljs-number">0.5</span>, max_depth=<span class="hljs-number">6</span>, n_estimators=<span class="hljs-number">5</span>)] <span class="hljs-comment">#切分一部分数据作为测试集</span>X, X_predict, y, y_predict = train_test_split(data, target, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">2020</span>)dataset_blend_train = np.zeros((X.shape[<span class="hljs-number">0</span>], len(clfs)))dataset_blend_test = np.zeros((X_predict.shape[<span class="hljs-number">0</span>], len(clfs)))<span class="hljs-comment">#5折stacking</span>n_splits = <span class="hljs-number">5</span>skf = StratifiedKFold(n_splits)skf = skf.split(X, y)<span class="hljs-keyword">for</span> j, clf <span class="hljs-keyword">in</span> enumerate(clfs):    <span class="hljs-comment">#依次训练各个单模型</span>    dataset_blend_test_j = np.zeros((X_predict.shape[<span class="hljs-number">0</span>], <span class="hljs-number">5</span>))    <span class="hljs-keyword">for</span> i, (train, test) <span class="hljs-keyword">in</span> enumerate(skf):        <span class="hljs-comment">#5-Fold交叉训练，使用第i个部分作为预测，剩余的部分来训练模型，获得其预测的输出作为第i部分的新特征。</span>        X_train, y_train, X_test, y_test = X[train], y[train], X[test], y[test]        clf.fit(X_train, y_train)        y_submission = clf.predict_proba(X_test)[:, <span class="hljs-number">1</span>]        dataset_blend_train[test, j] = y_submission        dataset_blend_test_j[:, i] = clf.predict_proba(X_predict)[:, <span class="hljs-number">1</span>]    <span class="hljs-comment">#对于测试集，直接用这k个模型的预测值均值作为新的特征。</span>    dataset_blend_test[:, j] = dataset_blend_test_j.mean(<span class="hljs-number">1</span>)    print(<span class="hljs-string">"val auc Score: %f"</span> % roc_auc_score(y_predict, dataset_blend_test[:, j]))clf = LogisticRegression(solver=<span class="hljs-string">'lbfgs'</span>)clf.fit(dataset_blend_train, y)y_submission = clf.predict_proba(dataset_blend_test)[:, <span class="hljs-number">1</span>]print(<span class="hljs-string">"Val auc Score of Stacking: %f"</span> % (roc_auc_score(y_predict, y_submission)))</code></pre><p>Blending，其实和Stacking是一种类似的多层模型融合的形式</p><p>其主要思路是把原始的训练集先分成两部分，比如70%的数据作为新的训练集，剩下30%的数据作为测试集。</p><p>在第一层，我们在这70%的数据上训练多个模型，然后去预测那30%数据的label，同时也预测test集的label。</p><p>在第二层，我们就直接用这30%数据在第一层预测的结果做为新特征继续训练，然后用test集第一层预测的label做特征，用第二层训练的模型做进一步预测</p><p>其优点在于：</p><ul><li>1.比stacking简单（因为不用进行k次的交叉验证来获得stacker feature）</li><li>2.避开了一个信息泄露问题：generlizers和stacker使用了不一样的数据集</li></ul><p>缺点在于：</p><ul><li><p>1.使用了很少的数据（第二阶段的blender只使用training set10%的量）</p></li><li><p>2.blender可能会过拟合</p></li><li><p>3.stacking使用多次的交叉验证会比较稳健</p></li></ul><pre class="highlight"><code class="python"><span class="hljs-string">'''Blending'''</span> <span class="hljs-comment">#创建训练的数据集</span><span class="hljs-comment">#创建训练的数据集</span>data_0 = iris.datadata = data_0[:<span class="hljs-number">100</span>,:]target_0 = iris.targettarget = target_0[:<span class="hljs-number">100</span>] <span class="hljs-comment">#模型融合中使用到的各个单模型</span>clfs = [LogisticRegression(solver=<span class="hljs-string">'lbfgs'</span>),        RandomForestClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        RandomForestClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'entropy'</span>),        ExtraTreesClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        <span class="hljs-comment">#ExtraTreesClassifier(n_estimators=5, n_jobs=-1, criterion='entropy'),</span>        GradientBoostingClassifier(learning_rate=<span class="hljs-number">0.05</span>, subsample=<span class="hljs-number">0.5</span>, max_depth=<span class="hljs-number">6</span>, n_estimators=<span class="hljs-number">5</span>)] <span class="hljs-comment">#切分一部分数据作为测试集</span>X, X_predict, y, y_predict = train_test_split(data, target, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">2020</span>)<span class="hljs-comment">#切分训练数据集为d1,d2两部分</span>X_d1, X_d2, y_d1, y_d2 = train_test_split(X, y, test_size=<span class="hljs-number">0.5</span>, random_state=<span class="hljs-number">2020</span>)dataset_d1 = np.zeros((X_d2.shape[<span class="hljs-number">0</span>], len(clfs)))dataset_d2 = np.zeros((X_predict.shape[<span class="hljs-number">0</span>], len(clfs))) <span class="hljs-keyword">for</span> j, clf <span class="hljs-keyword">in</span> enumerate(clfs):    <span class="hljs-comment">#依次训练各个单模型</span>    clf.fit(X_d1, y_d1)    y_submission = clf.predict_proba(X_d2)[:, <span class="hljs-number">1</span>]    dataset_d1[:, j] = y_submission    <span class="hljs-comment">#对于测试集，直接用这k个模型的预测值作为新的特征。</span>    dataset_d2[:, j] = clf.predict_proba(X_predict)[:, <span class="hljs-number">1</span>]    print(<span class="hljs-string">"val auc Score: %f"</span> % roc_auc_score(y_predict, dataset_d2[:, j]))<span class="hljs-comment">#融合使用的模型</span>clf = GradientBoostingClassifier(learning_rate=<span class="hljs-number">0.02</span>, subsample=<span class="hljs-number">0.5</span>, max_depth=<span class="hljs-number">6</span>, n_estimators=<span class="hljs-number">30</span>)clf.fit(dataset_d1, y_d2)y_submission = clf.predict_proba(dataset_d2)[:, <span class="hljs-number">1</span>]print(<span class="hljs-string">"Val auc Score of Blending: %f"</span> % (roc_auc_score(y_predict, y_submission)))</code></pre><h5 id="分类的stacking融合利用mlxtend"><a class="markdownIt-Anchor" href="#分类的stacking融合利用mlxtend"></a> 分类的Stacking融合(利用mlxtend)</h5><pre class="highlight"><code class="python">!pip install mlxtend<span class="hljs-keyword">import</span> warningswarnings.filterwarnings(<span class="hljs-string">'ignore'</span>)<span class="hljs-keyword">import</span> itertools<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<span class="hljs-keyword">import</span> matplotlib.gridspec <span class="hljs-keyword">as</span> gridspec<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression<span class="hljs-keyword">from</span> sklearn.neighbors <span class="hljs-keyword">import</span> KNeighborsClassifier<span class="hljs-keyword">from</span> sklearn.naive_bayes <span class="hljs-keyword">import</span> GaussianNB <span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<span class="hljs-keyword">from</span> mlxtend.classifier <span class="hljs-keyword">import</span> StackingClassifier<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score<span class="hljs-keyword">from</span> mlxtend.plotting <span class="hljs-keyword">import</span> plot_learning_curves<span class="hljs-keyword">from</span> mlxtend.plotting <span class="hljs-keyword">import</span> plot_decision_regions<span class="hljs-comment"># 以python自带的鸢尾花数据集为例</span>iris = datasets.load_iris()X, y = iris.data[:, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>], iris.targetclf1 = KNeighborsClassifier(n_neighbors=<span class="hljs-number">1</span>)clf2 = RandomForestClassifier(random_state=<span class="hljs-number">1</span>)clf3 = GaussianNB()lr = LogisticRegression()sclf = StackingClassifier(classifiers=[clf1, clf2, clf3],                           meta_classifier=lr)label = [<span class="hljs-string">'KNN'</span>, <span class="hljs-string">'Random Forest'</span>, <span class="hljs-string">'Naive Bayes'</span>, <span class="hljs-string">'Stacking Classifier'</span>]clf_list = [clf1, clf2, clf3, sclf]fig = plt.figure(figsize=(<span class="hljs-number">10</span>,<span class="hljs-number">8</span>))gs = gridspec.GridSpec(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)grid = itertools.product([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],repeat=<span class="hljs-number">2</span>)clf_cv_mean = []clf_cv_std = []<span class="hljs-keyword">for</span> clf, label, grd <span class="hljs-keyword">in</span> zip(clf_list, label, grid):            scores = cross_val_score(clf, X, y, cv=<span class="hljs-number">3</span>, scoring=<span class="hljs-string">'accuracy'</span>)    print(<span class="hljs-string">"Accuracy: %.2f (+/- %.2f) [%s]"</span> %(scores.mean(), scores.std(), label))    clf_cv_mean.append(scores.mean())    clf_cv_std.append(scores.std())            clf.fit(X, y)    ax = plt.subplot(gs[grd[<span class="hljs-number">0</span>], grd[<span class="hljs-number">1</span>]])    fig = plot_decision_regions(X=X, y=y, clf=clf)    plt.title(label)plt.show()</code></pre><h4 id="其他方法"><a class="markdownIt-Anchor" href="#其他方法"></a> 其他方法</h4><p>将特征放进模型中预测，并将预测结果变换并作为新的特征加入原有特征中再经过模型预测结果 （Stacking变化）</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Ensemble_add_feature</span><span class="hljs-params">(train,test,target,clfs)</span>:</span>        <span class="hljs-comment"># n_flods = 5</span>    <span class="hljs-comment"># skf = list(StratifiedKFold(y, n_folds=n_flods))</span>    train_ = np.zeros((train.shape[<span class="hljs-number">0</span>],len(clfs*<span class="hljs-number">2</span>)))    test_ = np.zeros((test.shape[<span class="hljs-number">0</span>],len(clfs*<span class="hljs-number">2</span>)))    <span class="hljs-keyword">for</span> j,clf <span class="hljs-keyword">in</span> enumerate(clfs):        <span class="hljs-string">'''依次训练各个单模型'''</span>        <span class="hljs-comment"># print(j, clf)</span>        <span class="hljs-string">'''使用第1个部分作为预测，第2部分来训练模型，获得其预测的输出作为第2部分的新特征。'''</span>        <span class="hljs-comment"># X_train, y_train, X_test, y_test = X[train], y[train], X[test], y[test]</span>        clf.fit(train,target)        y_train = clf.predict(train)        y_test = clf.predict(test)        <span class="hljs-comment">## 新特征生成</span>        train_[:,j*<span class="hljs-number">2</span>] = y_train**<span class="hljs-number">2</span>        test_[:,j*<span class="hljs-number">2</span>] = y_test**<span class="hljs-number">2</span>        train_[:, j+<span class="hljs-number">1</span>] = np.exp(y_train)        test_[:, j+<span class="hljs-number">1</span>] = np.exp(y_test)        <span class="hljs-comment"># print("val auc Score: %f" % r2_score(y_predict, dataset_d2[:, j]))</span>        print(<span class="hljs-string">'Method '</span>,j)        train_ = pd.DataFrame(train_)    test_ = pd.DataFrame(test_)    <span class="hljs-keyword">return</span> train_,test_</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score, train_test_split<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegressionclf = LogisticRegression()data_0 = iris.datadata = data_0[:<span class="hljs-number">100</span>,:]target_0 = iris.targettarget = target_0[:<span class="hljs-number">100</span>]x_train,x_test,y_train,y_test=train_test_split(data,target,test_size=<span class="hljs-number">0.3</span>)x_train = pd.DataFrame(x_train) ; x_test = pd.DataFrame(x_test)<span class="hljs-comment">#模型融合中使用到的各个单模型</span>clfs = [LogisticRegression(),        RandomForestClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        ExtraTreesClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'gini'</span>),        ExtraTreesClassifier(n_estimators=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, criterion=<span class="hljs-string">'entropy'</span>),        GradientBoostingClassifier(learning_rate=<span class="hljs-number">0.05</span>, subsample=<span class="hljs-number">0.5</span>, max_depth=<span class="hljs-number">6</span>, n_estimators=<span class="hljs-number">5</span>)]New_train,New_test = Ensemble_add_feature(x_train,x_test,y_train,clfs)clf = LogisticRegression()<span class="hljs-comment"># clf = GradientBoostingClassifier(learning_rate=0.02, subsample=0.5, max_depth=6, n_estimators=30)</span>clf.fit(New_train, y_train)y_emb = clf.predict_proba(New_test)[:, <span class="hljs-number">1</span>]print(<span class="hljs-string">"Val auc Score of stacking: %f"</span> % (roc_auc_score(y_test, y_emb)))</code></pre><h3 id="本次赛题"><a class="markdownIt-Anchor" href="#本次赛题"></a> 本次赛题</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> warnings<span class="hljs-keyword">import</span> matplotlib<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> snswarnings.filterwarnings(<span class="hljs-string">'ignore'</span>)%matplotlib inline<span class="hljs-keyword">import</span> itertools<span class="hljs-keyword">import</span> matplotlib.gridspec <span class="hljs-keyword">as</span> gridspec<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> datasets<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression<span class="hljs-keyword">from</span> sklearn.neighbors <span class="hljs-keyword">import</span> KNeighborsClassifier<span class="hljs-keyword">from</span> sklearn.naive_bayes <span class="hljs-keyword">import</span> GaussianNB <span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<span class="hljs-comment"># from mlxtend.classifier import StackingClassifier</span><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score, train_test_split<span class="hljs-comment"># from mlxtend.plotting import plot_learning_curves</span><span class="hljs-comment"># from mlxtend.plotting import plot_decision_regions</span><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> StratifiedKFold<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> linear_model<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> preprocessing<span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVR<span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> PCA,FastICA,FactorAnalysis,SparsePCA<span class="hljs-keyword">import</span> lightgbm <span class="hljs-keyword">as</span> lgb<span class="hljs-keyword">import</span> xgboost <span class="hljs-keyword">as</span> xgb<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV,cross_val_score<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestRegressor,GradientBoostingRegressor<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> mean_squared_error, mean_absolute_error</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">## 数据读取</span>Train_data = pd.read_csv(<span class="hljs-string">'data/used_car_train_20200313.csv'</span>, sep=<span class="hljs-string">' '</span>)TestA_data = pd.read_csv(<span class="hljs-string">'data/used_car_testA_20200313.csv'</span>, sep=<span class="hljs-string">' '</span>)print(Train_data.shape)print(TestA_data.shape)</code></pre><pre class="highlight"><code class="python">numerical_cols = Train_data.select_dtypes(exclude = <span class="hljs-string">'object'</span>).columnsprint(numerical_cols)</code></pre><pre class="highlight"><code class="python">feature_cols = [col <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> numerical_cols <span class="hljs-keyword">if</span> col <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'SaleID'</span>,<span class="hljs-string">'name'</span>,<span class="hljs-string">'regDate'</span>,<span class="hljs-string">'price'</span>]]</code></pre><pre class="highlight"><code class="python">X_data = Train_data[feature_cols]Y_data = Train_data[<span class="hljs-string">'price'</span>]X_test  = TestA_data[feature_cols]print(<span class="hljs-string">'X train shape:'</span>,X_data.shape)print(<span class="hljs-string">'X test shape:'</span>,X_test.shape)</code></pre><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Sta_inf</span><span class="hljs-params">(data)</span>:</span>    print(<span class="hljs-string">'_min'</span>,np.min(data))    print(<span class="hljs-string">'_max:'</span>,np.max(data))    print(<span class="hljs-string">'_mean'</span>,np.mean(data))    print(<span class="hljs-string">'_ptp'</span>,np.ptp(data))    print(<span class="hljs-string">'_std'</span>,np.std(data))    print(<span class="hljs-string">'_var'</span>,np.var(data))</code></pre><pre class="highlight"><code class="python">print(<span class="hljs-string">'Sta of label:'</span>)Sta_inf(Y_data)</code></pre><pre class="highlight"><code class="python">X_data = X_data.fillna(<span class="hljs-number">-1</span>)X_test = X_test.fillna(<span class="hljs-number">-1</span>)</code></pre><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_lr</span><span class="hljs-params">(x_train,y_train)</span>:</span>    reg_model = linear_model.LinearRegression()    reg_model.fit(x_train,y_train)    <span class="hljs-keyword">return</span> reg_model<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_ridge</span><span class="hljs-params">(x_train,y_train)</span>:</span>    reg_model = linear_model.Ridge(alpha=<span class="hljs-number">0.8</span>)<span class="hljs-comment">#alphas=range(1,100,5)</span>    reg_model.fit(x_train,y_train)    <span class="hljs-keyword">return</span> reg_model<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_lasso</span><span class="hljs-params">(x_train,y_train)</span>:</span>    reg_model = linear_model.LassoCV()    reg_model.fit(x_train,y_train)    <span class="hljs-keyword">return</span> reg_model<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_gbdt</span><span class="hljs-params">(x_train,y_train)</span>:</span>    estimator =GradientBoostingRegressor(loss=<span class="hljs-string">'ls'</span>,subsample= <span class="hljs-number">0.85</span>,max_depth= <span class="hljs-number">5</span>,n_estimators = <span class="hljs-number">100</span>)    param_grid = {             <span class="hljs-string">'learning_rate'</span>: [<span class="hljs-number">0.05</span>,<span class="hljs-number">0.08</span>,<span class="hljs-number">0.1</span>,<span class="hljs-number">0.2</span>],            }    gbdt = GridSearchCV(estimator, param_grid,cv=<span class="hljs-number">3</span>)    gbdt.fit(x_train,y_train)    print(gbdt.best_params_)    <span class="hljs-comment"># print(gbdt.best_estimator_ )</span>    <span class="hljs-keyword">return</span> gbdt<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_xgb</span><span class="hljs-params">(x_train,y_train)</span>:</span>    model = xgb.XGBRegressor(n_estimators=<span class="hljs-number">120</span>, learning_rate=<span class="hljs-number">0.08</span>, gamma=<span class="hljs-number">0</span>, subsample=<span class="hljs-number">0.8</span>,\        colsample_bytree=<span class="hljs-number">0.9</span>, max_depth=<span class="hljs-number">5</span>) <span class="hljs-comment">#, objective ='reg:squarederror'</span>    model.fit(x_train, y_train)    <span class="hljs-keyword">return</span> model<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model_lgb</span><span class="hljs-params">(x_train,y_train)</span>:</span>    estimator = lgb.LGBMRegressor(num_leaves=<span class="hljs-number">63</span>,n_estimators = <span class="hljs-number">100</span>)    param_grid = {        <span class="hljs-string">'learning_rate'</span>: [<span class="hljs-number">0.01</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.1</span>],    }    gbm = GridSearchCV(estimator, param_grid)    gbm.fit(x_train, y_train)    <span class="hljs-keyword">return</span> gbm</code></pre><h4 id="xgboost五折交叉回归验证"><a class="markdownIt-Anchor" href="#xgboost五折交叉回归验证"></a> XGBoost五折交叉回归验证</h4><pre class="highlight"><code class="python"><span class="hljs-comment">## xgb</span>xgr = xgb.XGBRegressor(n_estimators=<span class="hljs-number">120</span>, learning_rate=<span class="hljs-number">0.1</span>, subsample=<span class="hljs-number">0.8</span>,\        colsample_bytree=<span class="hljs-number">0.9</span>, max_depth=<span class="hljs-number">7</span>) <span class="hljs-comment"># ,objective ='reg:squarederror'</span>scores_train = []scores = []<span class="hljs-comment">## 5折交叉验证方式</span>sk=StratifiedKFold(n_splits=<span class="hljs-number">5</span>,shuffle=<span class="hljs-literal">True</span>,random_state=<span class="hljs-number">0</span>)<span class="hljs-keyword">for</span> train_ind,val_ind <span class="hljs-keyword">in</span> sk.split(X_data,Y_data):        train_x=X_data.iloc[train_ind].values    train_y=Y_data.iloc[train_ind]    val_x=X_data.iloc[val_ind].values    val_y=Y_data.iloc[val_ind]        xgr.fit(train_x,train_y)    pred_train_xgb=xgr.predict(train_x)    pred_xgb=xgr.predict(val_x)        score_train = mean_absolute_error(train_y,pred_train_xgb)    scores_train.append(score_train)    score = mean_absolute_error(val_y,pred_xgb)    scores.append(score)print(<span class="hljs-string">'Train mae:'</span>,np.mean(score_train))print(<span class="hljs-string">'Val mae'</span>,np.mean(scores))</code></pre><h4 id="划分数据集并用多种方法训练和预测"><a class="markdownIt-Anchor" href="#划分数据集并用多种方法训练和预测"></a> 划分数据集，并用多种方法训练和预测</h4><pre class="highlight"><code class="python"><span class="hljs-comment">## Split data with val</span>x_train,x_val,y_train,y_val = train_test_split(X_data,Y_data,test_size=<span class="hljs-number">0.3</span>)<span class="hljs-comment">## Train and Predict</span>print(<span class="hljs-string">'Predict LR...'</span>)model_lr = build_model_lr(x_train,y_train)val_lr = model_lr.predict(x_val)subA_lr = model_lr.predict(X_test)print(<span class="hljs-string">'Predict Ridge...'</span>)model_ridge = build_model_ridge(x_train,y_train)val_ridge = model_ridge.predict(x_val)subA_ridge = model_ridge.predict(X_test)print(<span class="hljs-string">'Predict Lasso...'</span>)model_lasso = build_model_lasso(x_train,y_train)val_lasso = model_lasso.predict(x_val)subA_lasso = model_lasso.predict(X_test)print(<span class="hljs-string">'Predict GBDT...'</span>)model_gbdt = build_model_gbdt(x_train,y_train)val_gbdt = model_gbdt.predict(x_val)subA_gbdt = model_gbdt.predict(X_test)</code></pre><h3 id="一般比赛中效果最为显著的方法"><a class="markdownIt-Anchor" href="#一般比赛中效果最为显著的方法"></a> 一般比赛中效果最为显著的方法</h3><pre class="highlight"><code class="python">print(<span class="hljs-string">'predict XGB...'</span>)model_xgb = build_model_xgb(x_train,y_train)val_xgb = model_xgb.predict(x_val)subA_xgb = model_xgb.predict(X_test)print(<span class="hljs-string">'predict lgb...'</span>)model_lgb = build_model_lgb(x_train,y_train)val_lgb = model_lgb.predict(x_val)subA_lgb = model_lgb.predict(X_test)</code></pre><pre class="highlight"><code class="python">print(<span class="hljs-string">'Sta inf of lgb:'</span>)Sta_inf(subA_lgb)</code></pre><h4 id="加权融合"><a class="markdownIt-Anchor" href="#加权融合"></a> 加权融合</h4><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Weighted_method</span><span class="hljs-params">(test_pre1,test_pre2,test_pre3,w=[<span class="hljs-number">1</span>/<span class="hljs-number">3</span>,<span class="hljs-number">1</span>/<span class="hljs-number">3</span>,<span class="hljs-number">1</span>/<span class="hljs-number">3</span>])</span>:</span>    Weighted_result = w[<span class="hljs-number">0</span>]*pd.Series(test_pre1)+w[<span class="hljs-number">1</span>]*pd.Series(test_pre2)+w[<span class="hljs-number">2</span>]*pd.Series(test_pre3)    <span class="hljs-keyword">return</span> Weighted_result<span class="hljs-comment">## Init the Weight</span>w = [<span class="hljs-number">0.3</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.3</span>]<span class="hljs-comment">## 测试验证集准确度</span>val_pre = Weighted_method(val_lgb,val_xgb,val_gbdt,w)MAE_Weighted = mean_absolute_error(y_val,val_pre)print(<span class="hljs-string">'MAE of Weighted of val:'</span>,MAE_Weighted)<span class="hljs-comment">## 预测数据部分</span>subA = Weighted_method(subA_lgb,subA_xgb,subA_gbdt,w)print(<span class="hljs-string">'Sta inf:'</span>)Sta_inf(subA)<span class="hljs-comment">## 生成提交文件</span>sub = pd.DataFrame()sub[<span class="hljs-string">'SaleID'</span>] = X_test.indexsub[<span class="hljs-string">'price'</span>] = subAsub.to_csv(<span class="hljs-string">'./sub_Weighted.csv'</span>,index=<span class="hljs-literal">False</span>)</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">## 与简单的LR（线性回归）进行对比</span>val_lr_pred = model_lr.predict(x_val)MAE_lr = mean_absolute_error(y_val,val_lr_pred)print(<span class="hljs-string">'MAE of lr:'</span>,MAE_lr)</code></pre><h4 id="stacking融合"><a class="markdownIt-Anchor" href="#stacking融合"></a> Stacking融合</h4><pre class="highlight"><code class="python"><span class="hljs-comment">## 第一层</span>train_lgb_pred = model_lgb.predict(x_train)train_xgb_pred = model_xgb.predict(x_train)train_gbdt_pred = model_gbdt.predict(x_train)Strak_X_train = pd.DataFrame()Strak_X_train[<span class="hljs-string">'Method_1'</span>] = train_lgb_predStrak_X_train[<span class="hljs-string">'Method_2'</span>] = train_xgb_predStrak_X_train[<span class="hljs-string">'Method_3'</span>] = train_gbdt_predStrak_X_val = pd.DataFrame()Strak_X_val[<span class="hljs-string">'Method_1'</span>] = val_lgbStrak_X_val[<span class="hljs-string">'Method_2'</span>] = val_xgbStrak_X_val[<span class="hljs-string">'Method_3'</span>] = val_gbdtStrak_X_test = pd.DataFrame()Strak_X_test[<span class="hljs-string">'Method_1'</span>] = subA_lgbStrak_X_test[<span class="hljs-string">'Method_2'</span>] = subA_xgbStrak_X_test[<span class="hljs-string">'Method_3'</span>] = subA_gbdt</code></pre><pre class="highlight"><code class="python"><span class="hljs-comment">## level2-method </span>model_lr_Stacking = build_model_lr(Strak_X_train,y_train)<span class="hljs-comment">## 训练集</span>train_pre_Stacking = model_lr_Stacking.predict(Strak_X_train)print(<span class="hljs-string">'MAE of Stacking-LR:'</span>,mean_absolute_error(y_train,train_pre_Stacking))<span class="hljs-comment">## 验证集</span>val_pre_Stacking = model_lr_Stacking.predict(Strak_X_val)print(<span class="hljs-string">'MAE of Stacking-LR:'</span>,mean_absolute_error(y_val,val_pre_Stacking))<span class="hljs-comment">## 预测集</span>print(<span class="hljs-string">'Predict Stacking-LR...'</span>)subA_Stacking = model_lr_Stacking.predict(Strak_X_test)</code></pre><pre class="highlight"><code class="python">subA_Stacking[subA_Stacking&lt;<span class="hljs-number">10</span>]=<span class="hljs-number">10</span>  <span class="hljs-comment">## 去除过小的预测值</span>sub = pd.DataFrame()sub[<span class="hljs-string">'SaleID'</span>] = X_test.indexsub[<span class="hljs-string">'price'</span>] = subA_Stackingsub.to_csv(<span class="hljs-string">'./sub_Stacking.csv'</span>,index=<span class="hljs-literal">False</span>)</code></pre><pre class="highlight"><code class="python">print(<span class="hljs-string">'Sta inf:'</span>)Sta_inf(subA_Stacking)</code></pre><h3 id="经验总结"><a class="markdownIt-Anchor" href="#经验总结"></a> 经验总结</h3><ul><li><strong>结果层面的融合</strong>，这种是最常见的融合方法，其可行的融合方法也有很多，比如根据结果的得分进行加权融合，还可以做Log，exp处理等。在做结果融合的时候，有一个很重要的条件是模型结果的得分要比较近似，然后结果的差异要比较大，这样的结果融合往往有比较好的效果提升。</li><li><strong>特征层面的融合</strong>，这个层面其实感觉不叫融合，准确说可以叫分割，很多时候如果我们用同种模型训练，可以把特征进行切分给不同的模型，然后在后面进行模型或者结果融合有时也能产生比较好的效果。</li><li><strong>模型层面的融合</strong>，模型层面的融合可能就涉及模型的堆叠和设计，比如加Staking层，部分模型的结果作为特征输入等，这些就需要多实验和思考了，基于模型层面的融合最好不同模型类型要有一定的差异，用同种模型不同的参数的收益一般是比较小的。</li></ul>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
      <category>比赛</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-二手车价格预测之建模调参</title>
    <link href="/2020/04/01/03-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E5%BB%BA%E6%A8%A1%E8%B0%83%E5%8F%82/"/>
    <url>/2020/04/01/03-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E5%BB%BA%E6%A8%A1%E8%B0%83%E5%8F%82/</url>
    
    <content type="html"><![CDATA[<p>今天要总结的是建模调参部分，可谓重中之重，DataWhale官方的参考代码十分详细，够自己消化好一阵子了。</p><h3 id="数据处理"><a class="markdownIt-Anchor" href="#数据处理"></a> 数据处理</h3><p>作者向我们分享了一种减少内存空间占用的方法，其思想是对于每个Series将数据类型转化为合适的精度，对于非数值型数据转化为<code>category</code>类型数据。</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reduce_mem_usage</span><span class="hljs-params">(df)</span>:</span>    <span class="hljs-string">""" iterate through all the columns of a dataframe and modify the data type        to reduce memory usage.            """</span>    start_mem = df.memory_usage().sum()     print(<span class="hljs-string">'Memory usage of dataframe is {:.2f} MB'</span>.format(start_mem))        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> df.columns:        col_type = df[col].dtype                <span class="hljs-keyword">if</span> col_type != object:            c_min = df[col].min()            c_max = df[col].max()            <span class="hljs-keyword">if</span> str(col_type)[:<span class="hljs-number">3</span>] == <span class="hljs-string">'int'</span>:                <span class="hljs-keyword">if</span> c_min &gt; np.iinfo(np.int8).min <span class="hljs-keyword">and</span> c_max &lt; np.iinfo(np.int8).max:                    df[col] = df[col].astype(np.int8)                <span class="hljs-keyword">elif</span> c_min &gt; np.iinfo(np.int16).min <span class="hljs-keyword">and</span> c_max &lt; np.iinfo(np.int16).max:                    df[col] = df[col].astype(np.int16)                <span class="hljs-keyword">elif</span> c_min &gt; np.iinfo(np.int32).min <span class="hljs-keyword">and</span> c_max &lt; np.iinfo(np.int32).max:                    df[col] = df[col].astype(np.int32)                <span class="hljs-keyword">elif</span> c_min &gt; np.iinfo(np.int64).min <span class="hljs-keyword">and</span> c_max &lt; np.iinfo(np.int64).max:                    df[col] = df[col].astype(np.int64)              <span class="hljs-keyword">else</span>:                <span class="hljs-keyword">if</span> c_min &gt; np.finfo(np.float16).min <span class="hljs-keyword">and</span> c_max &lt; np.finfo(np.float16).max:                    df[col] = df[col].astype(np.float16)                <span class="hljs-keyword">elif</span> c_min &gt; np.finfo(np.float32).min <span class="hljs-keyword">and</span> c_max &lt; np.finfo(np.float32).max:                    df[col] = df[col].astype(np.float32)                <span class="hljs-keyword">else</span>:                    df[col] = df[col].astype(np.float64)        <span class="hljs-keyword">else</span>:            df[col] = df[col].astype(<span class="hljs-string">'category'</span>)    end_mem = df.memory_usage().sum()     print(<span class="hljs-string">'Memory usage after optimization is: {:.2f} MB'</span>.format(end_mem))    print(<span class="hljs-string">'Decreased by {:.1f}%'</span>.format(<span class="hljs-number">100</span> * (start_mem - end_mem) / start_mem))    <span class="hljs-keyword">return</span> df</code></pre><p><a href="https://imgchr.com/i/G8ULnS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8ULnS.png" srcset="/img/loading.gif" alt="G8ULnS.png" /></a></p><p>可以看出，放弃不必要的精度确实能节省不少内存空间。</p><h3 id="简单建模与分析"><a class="markdownIt-Anchor" href="#简单建模与分析"></a> 简单建模与分析</h3><p>对于数值数据的预测，首先采用了最简单的线性回归模型。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegressionmodel = LinearRegression(normalize=<span class="hljs-literal">True</span>)model = model.fit(train_X, train_y)sorted(dict(zip(continuous_feature_names, model.coef_)).items(), key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)</code></pre><p>值得一提的是，我们可以根据线性模型对应的权重来判断属性的重要程度，权重越大，属性与预测结果越相关。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> pltsubsample_index=np.random.randint(low=<span class="hljs-number">0</span>,high=len(train_y),size=<span class="hljs-number">50</span>)plt.scatter(train_X[<span class="hljs-string">'v_9'</span>][subsample_index],train_y[subsample_index],color=<span class="hljs-string">'black'</span>)plt.scatter(train_X[<span class="hljs-string">'v_9'</span>][subsample_index],model.predict(train_X.loc[subsample_index]),color=<span class="hljs-string">'blue'</span>)plt.xlabel(<span class="hljs-string">'v_9'</span>)plt.ylabel(<span class="hljs-string">'price'</span>)plt.legend([<span class="hljs-string">'True Price'</span>,<span class="hljs-string">'Predicted Price'</span>],loc=<span class="hljs-string">'upper right'</span>)print(<span class="hljs-string">'The predicted price is obvious different from true price'</span>)plt.show()</code></pre><p>但是我们选取权重最大的属性对数据进行预测后发现和真实数据差别偏大，那么很可能是模型除了问题</p><p><a href="https://imgchr.com/i/G8di8I" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8di8I.png" srcset="/img/loading.gif" alt="G8di8I.png" /></a></p><p>对我们要预测的数据作图</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> snsprint(<span class="hljs-string">'It is clear to see the price shows a exponential distribution'</span>)plt.figure(figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">5</span>))plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)sns.distplot(train_y)plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)sns.distplot(train_y[train_y&lt;np.quantile(train_y,<span class="hljs-number">0.9</span>)])</code></pre><p><a href="https://imgchr.com/i/G8dmVg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8dmVg.md.png" srcset="/img/loading.gif" alt="G8dmVg.md.png" /></a></p><p>数据呈长尾分布，我们对其进行log变换</p><pre class="highlight"><code class="python">train_y_ln = np.log(train_y + <span class="hljs-number">1</span>)<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> snsprint(<span class="hljs-string">'The transformed price seems like normal distribution'</span>)plt.figure(figsize=(<span class="hljs-number">15</span>,<span class="hljs-number">5</span>))plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)sns.distplot(train_y_ln)plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)sns.distplot(train_y_ln[train_y_ln &lt; np.quantile(train_y_ln, <span class="hljs-number">0.9</span>)])</code></pre><p><a href="https://imgchr.com/i/G8d1x0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8d1x0.md.png" srcset="/img/loading.gif" alt="G8d1x0.md.png" /></a></p><p>长尾现象明显缓解，再作预测，选取最相关的权重。</p><pre class="highlight"><code class="python">plt.scatter(train_X[<span class="hljs-string">'v_9'</span>][subsample_index],train_y[subsample_index],color=<span class="hljs-string">'black'</span>)plt.scatter(train_X[<span class="hljs-string">'v_9'</span>][subsample_index],np.exp(model.predict(train_X.loc[subsample_index])),color=<span class="hljs-string">'blue'</span>)plt.xlabel(<span class="hljs-string">'v_9'</span>)plt.ylabel(<span class="hljs-string">'price'</span>)plt.legend([<span class="hljs-string">'True Price'</span>,<span class="hljs-string">'Predicted Price'</span>],loc=<span class="hljs-string">'upper right'</span>)print(<span class="hljs-string">'The predicted price seems normal after np.log(transforming'</span>)plt.show()</code></pre><p><a href="https://imgchr.com/i/G8dJqU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8dJqU.png" srcset="/img/loading.gif" alt="G8dJqU.png" /></a></p><p>这时拟合效果要好得多。</p><h3 id="交叉验证"><a class="markdownIt-Anchor" href="#交叉验证"></a> 交叉验证</h3><p>交叉验证将数据分成若干份，每次取一份作验证集，其余的作训练集，这样可以将模型所有数据都机型训练，并且对模型泛化结果进行检验。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> mean_absolute_error,  make_scorer<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_transfer</span><span class="hljs-params">(func)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span><span class="hljs-params">(y, yhat)</span>:</span>        result = func(np.log(y), np.nan_to_num(np.log(yhat)))        <span class="hljs-keyword">return</span> result    <span class="hljs-keyword">return</span> wrapperscores = cross_val_score(model, X=train_X, y=train_y, verbose=<span class="hljs-number">1</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(log_transfer(mean_absolute_error)))print(<span class="hljs-string">'AVG:'</span>, np.mean(scores))scores = cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">1</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error))print(<span class="hljs-string">'AVG:'</span>, np.mean(scores))scores = pd.DataFrame(scores.reshape(<span class="hljs-number">1</span>,<span class="hljs-number">-1</span>))scores.columns = [<span class="hljs-string">'cv'</span> + str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)]scores.index = [<span class="hljs-string">'MAE'</span>]scores</code></pre><p>z在这里就捕将数据输出一一列出了。</p><p>但是使用交叉验证时也要考虑到数据的真实情况，比如数据与时间相关时，那么把后时间靠后的数据作为训练集，时间靠前的作为验证集，颠倒了顺序，不合逻辑。在实际建模时，要注意考虑这一点。</p><h3 id="绘制学习率验证曲线"><a class="markdownIt-Anchor" href="#绘制学习率验证曲线"></a> 绘制学习率验证曲线</h3><p>可以使我们清楚的看出训练数据和验证数据得分（损失）的下降情况。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> learning_curve,validation_curve<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curve</span><span class="hljs-params">(estimator, title, X, y, ylim=None, cv=None,n_jobs=<span class="hljs-number">1</span>, train_size=np.linspace<span class="hljs-params">(<span class="hljs-number">.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">5</span> )</span>)</span>:</span>      plt.figure()      plt.title(title)      <span class="hljs-keyword">if</span> ylim <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:          plt.ylim(*ylim)      plt.xlabel(<span class="hljs-string">'Training example'</span>)      plt.ylabel(<span class="hljs-string">'score'</span>)      train_sizes, train_scores, test_scores = learning_curve(estimator, X, y, cv=cv, n_jobs=n_jobs, train_sizes=train_size, scoring = make_scorer(mean_absolute_error))      train_scores_mean = np.mean(train_scores, axis=<span class="hljs-number">1</span>)      train_scores_std = np.std(train_scores, axis=<span class="hljs-number">1</span>)      test_scores_mean = np.mean(test_scores, axis=<span class="hljs-number">1</span>)      test_scores_std = np.std(test_scores, axis=<span class="hljs-number">1</span>)      plt.grid()<span class="hljs-comment">#区域  </span>    plt.fill_between(train_sizes, train_scores_mean - train_scores_std,                       train_scores_mean + train_scores_std, alpha=<span class="hljs-number">0.1</span>,                       color=<span class="hljs-string">"r"</span>)      plt.fill_between(train_sizes, test_scores_mean - test_scores_std,                       test_scores_mean + test_scores_std, alpha=<span class="hljs-number">0.1</span>,                       color=<span class="hljs-string">"g"</span>)      plt.plot(train_sizes, train_scores_mean, <span class="hljs-string">'o-'</span>, color=<span class="hljs-string">'r'</span>,               label=<span class="hljs-string">"Training score"</span>)      plt.plot(train_sizes, test_scores_mean,<span class="hljs-string">'o-'</span>,color=<span class="hljs-string">"g"</span>,               label=<span class="hljs-string">"Cross-validation score"</span>)      plt.legend(loc=<span class="hljs-string">"best"</span>)      <span class="hljs-keyword">return</span> plt  plot_learning_curve(LinearRegression(),<span class="hljs-string">'linear_model'</span>,train_X[:<span class="hljs-number">1000</span>],train_y_ln[:<span class="hljs-number">1000</span>],ylim=(<span class="hljs-number">0.0</span>,<span class="hljs-number">0.5</span>),cv=<span class="hljs-number">5</span>,n_jobs=<span class="hljs-number">1</span>)</code></pre><p><a href="https://imgchr.com/i/G8wvAe" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8wvAe.png" srcset="/img/loading.gif" alt="G8wvAe.png" /></a></p><h3 id="多种模型对比"><a class="markdownIt-Anchor" href="#多种模型对比"></a> 多种模型对比</h3><p>在交叉验证的基础上，使用多个模型</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegression<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> Ridge<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> Lassomodels = [LinearRegression(),          Ridge(),          Lasso()]result = dict()<span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> models:    model_name = str(model).split(<span class="hljs-string">'('</span>)[<span class="hljs-number">0</span>]    scores = cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error))    result[model_name] = scores    print(model_name + <span class="hljs-string">' is finished'</span>)</code></pre><p><a href="https://imgchr.com/i/G80ag1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G80ag1.png" srcset="/img/loading.gif" alt="G80ag1.png" /></a></p><p>还可以通过带正则化的线性回归模型进行特征筛选。</p><pre class="highlight"><code class="python">model = Ridge().fit(train_X, train_y_ln)print(<span class="hljs-string">'intercept:'</span>+ str(model.intercept_))sns.barplot(abs(model.coef_), continuous_feature_names)</code></pre><p><a href="https://imgchr.com/i/G805b8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G805b8.png" srcset="/img/loading.gif" alt="G805b8.png" /></a></p><pre class="highlight"><code class="python">model = Lasso().fit(train_X, train_y_ln)print(<span class="hljs-string">'intercept:'</span>+ str(model.intercept_))sns.barplot(abs(model.coef_), continuous_feature_names)</code></pre><p><a href="https://imgchr.com/i/G80bCj" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G80bCj.png" srcset="/img/loading.gif" alt="G80bCj.png" /></a></p><h3 id="非线性模型"><a class="markdownIt-Anchor" href="#非线性模型"></a> 非线性模型</h3><p>前面说了那么多线性回归的模型，下面介绍非线性模型</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegression<span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVC<span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeRegressor<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestRegressor<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> GradientBoostingRegressor<span class="hljs-keyword">from</span> sklearn.neural_network <span class="hljs-keyword">import</span> MLPRegressor<span class="hljs-keyword">from</span> xgboost.sklearn <span class="hljs-keyword">import</span> XGBRegressor<span class="hljs-keyword">from</span> lightgbm.sklearn <span class="hljs-keyword">import</span> LGBMRegressormodels = [LinearRegression(),          DecisionTreeRegressor(),          RandomForestRegressor(),          GradientBoostingRegressor(),          MLPRegressor(solver=<span class="hljs-string">'lbfgs'</span>, max_iter=<span class="hljs-number">100</span>),           XGBRegressor(n_estimators = <span class="hljs-number">100</span>, objective=<span class="hljs-string">'reg:squarederror'</span>),           LGBMRegressor(n_estimators = <span class="hljs-number">100</span>)]result = dict()<span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> models:    model_name = str(model).split(<span class="hljs-string">'('</span>)[<span class="hljs-number">0</span>]    scores = cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error))    result[model_name] = scores    print(model_name + <span class="hljs-string">' is finished'</span>)    result = pd.DataFrame(result)result.index = [<span class="hljs-string">'cv'</span> + str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)]result</code></pre><p><a href="https://imgchr.com/i/G8BMPH" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/01/G8BMPH.md.png" srcset="/img/loading.gif" alt="G8BMPH.md.png" /></a></p><p>可以看出随机森林还是顶的。</p><h3 id="模型调参"><a class="markdownIt-Anchor" href="#模型调参"></a> 模型调参</h3><h4 id="贪心调参"><a class="markdownIt-Anchor" href="#贪心调参"></a> 贪心调参</h4><pre class="highlight"><code class="python"><span class="hljs-comment">## LGB的参数集合：</span>objective = [<span class="hljs-string">'regression'</span>, <span class="hljs-string">'regression_l1'</span>, <span class="hljs-string">'mape'</span>, <span class="hljs-string">'huber'</span>, <span class="hljs-string">'fair'</span>]num_leaves = [<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">20</span>,<span class="hljs-number">40</span>, <span class="hljs-number">55</span>]max_depth = [<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">20</span>,<span class="hljs-number">40</span>, <span class="hljs-number">55</span>]bagging_fraction = []feature_fraction = []drop_rate = []best_obj = dict()<span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> objective:    model = LGBMRegressor(objective=obj)    score = np.mean(cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error)))    best_obj[obj] = score    best_leaves = dict()<span class="hljs-keyword">for</span> leaves <span class="hljs-keyword">in</span> num_leaves:    model = LGBMRegressor(objective=min(best_obj.items(), key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>], num_leaves=leaves)    score = np.mean(cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error)))    best_leaves[leaves] = score    best_depth = dict()<span class="hljs-keyword">for</span> depth <span class="hljs-keyword">in</span> max_depth:    model = LGBMRegressor(objective=min(best_obj.items(), key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>],                          num_leaves=min(best_leaves.items(), key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>],                          max_depth=depth)    score = np.mean(cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error)))    best_depth[depth] = score    sns.lineplot(x=[<span class="hljs-string">'0_initial'</span>,<span class="hljs-string">'1_turning_obj'</span>,<span class="hljs-string">'2_turning_leaves'</span>,<span class="hljs-string">'3_turning_depth'</span>], y=[<span class="hljs-number">0.143</span> ,min(best_obj.values()), min(best_leaves.values()), min(best_depth.values())])</code></pre><h4 id="网格调参"><a class="markdownIt-Anchor" href="#网格调参"></a> 网格调参</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCVparameters = {<span class="hljs-string">'objective'</span>: objective , <span class="hljs-string">'num_leaves'</span>: num_leaves, <span class="hljs-string">'max_depth'</span>: max_depth}model = LGBMRegressor()clf = GridSearchCV(model, parameters, cv=<span class="hljs-number">5</span>)clf = clf.fit(train_X, train_y)model = LGBMRegressor(objective=<span class="hljs-string">'regression'</span>,                          num_leaves=<span class="hljs-number">55</span>,                          max_depth=<span class="hljs-number">15</span>)np.mean(cross_val_score(model, X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error)))</code></pre><p>网格调参比较好理解，我们事先输入我们认为合理的参数，对所有参数的组合进行实验，找出得分最高的参数组合。</p><h4 id="贝叶斯调参"><a class="markdownIt-Anchor" href="#贝叶斯调参"></a> 贝叶斯调参</h4><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> bayes_opt <span class="hljs-keyword">import</span> BayesianOptimization<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rf_cv</span><span class="hljs-params">(num_leaves, max_depth, subsample, min_child_samples)</span>:</span>    val = cross_val_score(        LGBMRegressor(objective = <span class="hljs-string">'regression_l1'</span>,            num_leaves=int(num_leaves),            max_depth=int(max_depth),            subsample = subsample,            min_child_samples = int(min_child_samples)        ),        X=train_X, y=train_y_ln, verbose=<span class="hljs-number">0</span>, cv = <span class="hljs-number">5</span>, scoring=make_scorer(mean_absolute_error)    ).mean()    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> - valrf_bo = BayesianOptimization(    rf_cv,    {    <span class="hljs-string">'num_leaves'</span>: (<span class="hljs-number">2</span>, <span class="hljs-number">100</span>),    <span class="hljs-string">'max_depth'</span>: (<span class="hljs-number">2</span>, <span class="hljs-number">100</span>),    <span class="hljs-string">'subsample'</span>: (<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>),    <span class="hljs-string">'min_child_samples'</span> : (<span class="hljs-number">2</span>, <span class="hljs-number">100</span>)    })</code></pre><p>对于贝叶斯调参和贪心调参，自己确实不够了解，还需要再专门学习一下。</p>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
      <tag>比赛</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02-二手车价格预测之特征工程</title>
    <link href="/2020/03/28/02-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"/>
    <url>/2020/03/28/02-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8B%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>今天要做的笔记是特征工程，感觉这次官方给的代码不是特别全。最近在忙作业和kaggle的比赛，后面自己有时间会再完善一下。自己将按照特征工程的常见任务进行介绍。</p><h3 id="异常处理"><a class="markdownIt-Anchor" href="#异常处理"></a> 异常处理</h3><p>数据收集的过程中可能会产生脏数据，导致产生离群值，数据分布明显不合理，这时候我们要对数据进行异常处理。常见的异常处理方法有：</p><h4 id="通过箱型图删除异常值"><a class="markdownIt-Anchor" href="#通过箱型图删除异常值"></a> 通过箱型图删除异常值</h4><p>官方提供了相关代码</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">outliers_proc</span><span class="hljs-params">(data,col_name,scale=<span class="hljs-number">3</span>)</span>:</span>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">box_plot_outliers</span><span class="hljs-params">(data_ser,box_scale)</span>:</span>    iqr=box_scale*(data_ser.quantile(<span class="hljs-number">0.75</span>)-data_ser.quantile(<span class="hljs-number">0.25</span>))    val_low=data_ser.quantile(<span class="hljs-number">0.25</span>)-iqr    val_up=data_ser.quantile(<span class="hljs-number">0.75</span>)+iqr    rule_low=(data_ser&lt;val_low)    rule_up=(data_ser&gt;val_up)    <span class="hljs-keyword">return</span> (rule_low,rule_up),(val_low,val_up)  data_n=data.copy()  data_series=data_n[col_name]  rule,value=box_plot_outliers(data_series,box_scale=scale)  index=np.arange(data_series.shape[<span class="hljs-number">0</span>])[rule[<span class="hljs-number">0</span>]|rule[<span class="hljs-number">1</span>]]  print(<span class="hljs-string">'Delete number is :{}'</span>.format(len(index)))  data_n=data_n.drop(index)  data_n.reset_index(drop=<span class="hljs-literal">True</span>,inplace=<span class="hljs-literal">True</span>)  print(<span class="hljs-string">'Now column number is :{}'</span>.format(data_n.shape[<span class="hljs-number">0</span>]))  index_low=np.arange(data_series.shape[<span class="hljs-number">0</span>])[rule[<span class="hljs-number">0</span>]]  outliers=data_series.iloc[index_low]  print(<span class="hljs-string">'Description of data less than the lower bound is :'</span>)  print(pd.Series(outliers).describe())  index_up=np.arange(data_series.shape[<span class="hljs-number">0</span>])[rule[<span class="hljs-number">1</span>]]  outliers=data_series.iloc[index_up]  print(<span class="hljs-string">'Description of data larger than the upper bound is:'</span>)  print(pd.Series(outliers).describe())  fig,ax=plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,figsize=(<span class="hljs-number">10</span>,<span class="hljs-number">7</span>))  sns.boxplot(y=data[col_name],data=data,palette=<span class="hljs-string">'Set1'</span>,ax=ax[<span class="hljs-number">0</span>])  sns.boxplot(y=data_n[col_name],data=data_n,palette=<span class="hljs-string">'Set1'</span>,ax=ax[<span class="hljs-number">1</span>])  <span class="hljs-keyword">return</span> data_n</code></pre><img src="https://s1.ax1x.com/2020/03/28/GA39YT.png" srcset="/img/loading.gif" alt="GA39YT.png" style="zoom: 80%;" /><p>可以看出异常值得到了有效剔除，不过这段代码不是太懂，有时间还要再研究一下。</p><h4 id="box-cox-转换处理有偏分布"><a class="markdownIt-Anchor" href="#box-cox-转换处理有偏分布"></a> BOX-COX 转换（处理有偏分布）</h4><p><a href="https://zhuanlan.zhihu.com/p/40125782" target="_blank" rel="noopener">待完善</a> ，我们希望数据尽量符合正态分布，除了这种方法，常见的还有对数据取log、倒数等。</p><h4 id="长尾截断"><a class="markdownIt-Anchor" href="#长尾截断"></a> 长尾截断</h4><p>对此自己持怀疑态度，网上也没找到相关代码。如果数据的特征少时，截断一部分数据还能接受，如果符合长尾的特则很多再进行长尾阶段似乎显得不合适。</p><h3 id="特征归一化标准化"><a class="markdownIt-Anchor" href="#特征归一化标准化"></a> 特征归一化/标准化</h3><p>sklearn有专门的数据归一化和标注化的包，当然自己写也不难</p><h4 id="归一化"><a class="markdownIt-Anchor" href="#归一化"></a> 归一化</h4><pre class="highlight"><code class="pyth">def max_min(x):  return (x-np.min(x))/(np.max(x)-np.min(x))</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> MinMaxScalerscaler = MinMaxScaler()x = scaler.fit_transform(x)</code></pre><h4 id="标准化"><a class="markdownIt-Anchor" href="#标准化"></a> 标准化</h4><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">standard</span><span class="hljs-params">(x)</span>:</span>  <span class="hljs-keyword">return</span> (x-np.mean(x))/(np.var(x))</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScalerscaler = StandardScaler()x = scaler.fit_transform(x)</code></pre><h4 id="幂率分布"><a class="markdownIt-Anchor" href="#幂率分布"></a> 幂率分布</h4><p>这种情况我还没遇到过，在此记录下</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mi>x</mi></mrow><mrow><mn>1</mn><mo>+</mo><mi>m</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>a</mi><mi>n</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">log(\frac{1+x}{1+median})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2484389999999999em;vertical-align:-0.403331em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></p><h3 id="数据分桶"><a class="markdownIt-Anchor" href="#数据分桶"></a> 数据分桶</h3><p>通俗理解下，就是将数据分段。举个例子年龄段的分桶</p><h4 id="等频分桶"><a class="markdownIt-Anchor" href="#等频分桶"></a> 等频分桶</h4><p>待完善</p><h4 id="等距分桶"><a class="markdownIt-Anchor" href="#等距分桶"></a> 等距分桶</h4><pre class="highlight"><code class="python">bin=[i*<span class="hljs-number">10</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">31</span>)]data[<span class="hljs-string">'power_bin'</span>]=pd.cut(data[<span class="hljs-string">'power'</span>],bin,labels=<span class="hljs-literal">False</span>)data[[<span class="hljs-string">'power_bin'</span>,<span class="hljs-string">'power'</span>]].head()</code></pre><h4 id="best-ks分桶"><a class="markdownIt-Anchor" href="#best-ks分桶"></a> Best-KS分桶</h4><p>待完善</p><h4 id="卡方分桶"><a class="markdownIt-Anchor" href="#卡方分桶"></a> 卡方分桶</h4><p>待完善</p><h3 id="缺失值处理"><a class="markdownIt-Anchor" href="#缺失值处理"></a> 缺失值处理</h3><p>对于树模型，模型本身已经有了对于缺失值的处理机制，这时候我们可以不对数据进行处理。</p><p>其他的常见方法是对缺失值进行填充，常见的有平均数、中位数、众数等等。</p><p>分箱，对含有缺失值的数据进行分箱，缺失的数据单独为一类，但是如果还想利用原来未缺失的数据值，分箱并未对缺失值数据进行填充。</p><h3 id="特征构造"><a class="markdownIt-Anchor" href="#特征构造"></a> 特征构造</h3><h4 id="构造统计量"><a class="markdownIt-Anchor" href="#构造统计量"></a> 构造统计量</h4><p>如各个类别的数据求均值、方差、极值、中位数等等</p><pre class="highlight"><code class="python">train_gb=train.groupby(<span class="hljs-string">'brand'</span>)all_info={}<span class="hljs-keyword">for</span> kind,kind_data <span class="hljs-keyword">in</span> train_gb:  info={}  kind_data=kind_data[kind_data[<span class="hljs-string">'price'</span>]&gt;<span class="hljs-number">0</span>]  info[<span class="hljs-string">'brand_amount'</span>]=len(kind_data)  info[<span class="hljs-string">'brand_price_max'</span>]=kind_data.price.max()  info[<span class="hljs-string">'brand_price_median'</span>]=kind_data.price.median()  info[<span class="hljs-string">'brand_price_min'</span>]=kind_data.price.min()  info[<span class="hljs-string">'brand_price_sum'</span>]=kind_data.price.sum()  info[<span class="hljs-string">'brand_price_std'</span>]=kind_data.price.std()  info[<span class="hljs-string">'brand_price_average'</span>]=round(kind_data.price.sum()/(len(kind_data)+<span class="hljs-number">1</span>),<span class="hljs-number">2</span>)  all_info[kind]=infobrand_fe=pd.DataFrame(all_info).T.reset_index().rename(columns={<span class="hljs-string">'index'</span>:<span class="hljs-string">'brand'</span>})data=data.merge(brand_fe,how=<span class="hljs-string">'left'</span>,on=<span class="hljs-string">'brand'</span>)</code></pre><h4 id="时间特征"><a class="markdownIt-Anchor" href="#时间特征"></a> 时间特征</h4><p>求相对时间、节假日等，在本项目中，汽车的使用时间很明显就会对销售价格产生影响。</p><pre class="highlight"><code class="python">ata[<span class="hljs-string">'used_time'</span>]=(pd.to_datetime(data[<span class="hljs-string">'creatDate'</span>],format=<span class="hljs-string">'%Y%m%d'</span>,errors=<span class="hljs-string">'coerce'</span>)-            pd.to_datetime(data[<span class="hljs-string">'regDate'</span>],format=<span class="hljs-string">'%Y%m%d'</span>,errors=<span class="hljs-string">'coerce'</span>)).dt.days</code></pre><h4 id="地理特征"><a class="markdownIt-Anchor" href="#地理特征"></a> 地理特征</h4><p>前提是你得知道数据中所包含的地理信息，</p><pre class="highlight"><code class="python">data[<span class="hljs-string">'city'</span>]=data[<span class="hljs-string">'regionCode'</span>].apply(<span class="hljs-keyword">lambda</span> x:str(x))[:<span class="hljs-number">-3</span>]</code></pre><p>除了以上的特征构造方式外，还有特征组合、对数据的非线性变换（log、根值、平方）等等。私以为构造可解释的特征组合还比较有说服力，胡乱组合的特征可能就有点碰运气了。</p><h3 id="特征筛选"><a class="markdownIt-Anchor" href="#特征筛选"></a> 特征筛选</h3><h4 id="过滤式"><a class="markdownIt-Anchor" href="#过滤式"></a> 过滤式</h4><p>通过相关系数选择发、互信息法、卡方检验、Relief、方差选择法选择特征，相关系数法比较好理解，越相关的特征当然更值得选择。</p><pre class="highlight"><code class="python">data_numeric=data[[<span class="hljs-string">'power'</span>,<span class="hljs-string">'kilometer'</span>,<span class="hljs-string">'brand_amount'</span>,<span class="hljs-string">'brand_price_average'</span>,<span class="hljs-string">'brand_price_max'</span>,<span class="hljs-string">'brand_price_median'</span>]]correlation=data_numeric.corr()f,ax=plt.subplots(figsize=(<span class="hljs-number">7</span>,<span class="hljs-number">7</span>))plt.title(<span class="hljs-string">'Correlation of Numeric Features with Price'</span>,y=<span class="hljs-number">1</span>,size=<span class="hljs-number">16</span>)sns.heatmap(correlation,square=<span class="hljs-literal">True</span>,vmax=<span class="hljs-number">0.8</span>)</code></pre><p>u1s1,热力图可以直接看出哪些特征比较相关，不过这个图似乎少了price这个变量</p><p>[<img src="https://s1.ax1x.com/2020/03/28/GAaTkd.png" srcset="/img/loading.gif" alt="GAaTkd.png" style="zoom:80%;" /></p><h4 id="包裹式"><a class="markdownIt-Anchor" href="#包裹式"></a> 包裹式</h4><p>把学习器的性能作为特征子集的评价准则，类似于auto-ml？或者是logistic回归的变量系数，系数越大越相关。利用包帮我们自助寻找特征</p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> mlxtend.feature_selection <span class="hljs-keyword">import</span> SequentialFeatureSelector <span class="hljs-keyword">as</span> SFS<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegressionsfs=SFS(LinearRegression(),        k_features=<span class="hljs-number">10</span>,        forward=<span class="hljs-literal">True</span>,        floating=<span class="hljs-literal">False</span>,        scoring=<span class="hljs-string">'r2'</span>,        cv=<span class="hljs-number">0</span>)x=data.drop([<span class="hljs-string">'price'</span>],axis=<span class="hljs-number">1</span>)x=x.fillna(<span class="hljs-number">0</span>)y=y.fillna(<span class="hljs-number">0</span>)y=data[<span class="hljs-string">'price'</span>]sfs.fit(x,y)sfs.k_feature_names_</code></pre><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> mlxtend.plotting <span class="hljs-keyword">import</span> plot_sequential_feature_selection <span class="hljs-keyword">as</span> plot_sfs<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> pltfig1=plot_sfs(sfs.get_metric_dict(),kind=<span class="hljs-string">'std_dev'</span>)plt.grid()plt.show()</code></pre><h4 id="嵌入式"><a class="markdownIt-Anchor" href="#嵌入式"></a> 嵌入式</h4><p>结合过滤式和包裹式，在训练过程进行特征选择。其实就是把数据输入算法中，让算法自己取选择特征呗。</p><h3 id="降维"><a class="markdownIt-Anchor" href="#降维"></a> 降维</h3><p>降维自己还是有点了解的，对于高维度数据可以降到低维度。在数据可视化也常用到。常用的降维算法有PCA、t-SNE、LDA、LSA等等。</p><p>这次的内容好多啊，感觉给的笔记也不是很全，还需要自己再多做总结。</p>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
      <category>特征工程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01-二手车价格销售价格预测之EDA</title>
    <link href="/2020/03/24/01-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%94%80%E5%94%AE%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8BEDA/"/>
    <url>/2020/03/24/01-%E4%BA%8C%E6%89%8B%E8%BD%A6%E4%BB%B7%E6%A0%BC%E9%94%80%E5%94%AE%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%E4%B9%8BEDA/</url>
    
    <content type="html"><![CDATA[<h3 id="写在前面"><a class="markdownIt-Anchor" href="#写在前面"></a> 写在前面</h3><p>这次参加了DataWhale组织的二手车销售价值预测组队学习，开始第一部分的学习——数据分析EDA。主要从数据分析流程和软件包工具两方面来介绍自己的收获。</p><h3 id="数据分析流程"><a class="markdownIt-Anchor" href="#数据分析流程"></a> 数据分析流程</h3><p>总结了一下，EDA主要做的工作就是发现数据缺失值和查看数据分布情况以及预测目标与其他因变量的相关性分析。</p><h4 id="缺失值分析"><a class="markdownIt-Anchor" href="#缺失值分析"></a> 缺失值分析</h4><p>对于表格数据，使用DataFrame的<code>info()</code>函数就可以直观的看到数据的缺失情况，但是这个只针对数值型（numeric）数据，缺失数据会以null值的形式呈现，直接调用DataFrame的<code>isnull()</code>函数配合<code>sum()</code>就可以对缺失值数据进行统计。比较坑的是object类型数据，有些缺失值数据并不会用null值表示，像下面这种：</p><p><img src="https://s1.ax1x.com/2020/03/24/8LKOZ8.png" srcset="/img/loading.gif" alt="8LKOZ8.png" /></p><p>“-”明显代表缺失值数据，但被字符串代替了。如何发现这种缺失情况，需要我们对相应的数据调用<code>value_counts()</code>函数，或者更直观点观察看一部分数据看有无异常情况。比如类别数据中，有的类别只出现了一次，和其他类别压根不是一个数量级，那么很有可能是异常值，可以考虑将其删去。</p><p><img src="https://s1.ax1x.com/2020/03/24/8LYuqA.png" srcset="/img/loading.gif" alt="8LYuqA.png" /></p><h4 id="数据分布"><a class="markdownIt-Anchor" href="#数据分布"></a> 数据分布</h4><p>首先是预测值的数据分布情况，其次是其他数据（或者说是自变量）的分布情况。对于数值型数据我们可以用正太分布、对数正态分布进行拟合，其他分布自己还不太了解。对于类别特征，我们要查看各种类别对应的数量，可以用柱状图来可视化。也可以查看不同类别的数据对应的目标预测值（price）的分布情况，可以用来分析的图表有箱型图、小提琴图。箱型图可以帮助了解数据的特征范围，也可用来查看离群点。小提琴图在箱型图的基础上显示了目标数据值的分布情况。</p><p><img src="https://datavizcatalogue.com/ZH/%E6%96%B9%E6%B3%95/images/anatomy/SVG/%E5%B0%8F%E6%8F%90%E7%90%B4%E5%9B%BE.svg" srcset="/img/loading.gif" alt="violin" /></p><p><img src="https://niyanchun.com/usr/uploads/2018/07/1539567941.png" srcset="/img/loading.gif" alt="箱型图" /></p><h4 id="相关性分析"><a class="markdownIt-Anchor" href="#相关性分析"></a> 相关性分析</h4><p>主要是预测值和自变量之间的相关性分析，还有各个自变量之间的相关性分析。常用散点图来绘制，看数据之间是不是有相关性关系。如果预测值和某个自变量有很强的线性关系，那么毫无疑问这个变量对我们的预测是十分有用的。如果有两个自变量它们之间具有很明显的线性关系，那么我们可以只保留其中一个。相关性分析中常用到的图表有热力图、散点图等等。</p><h3 id="软件工具技能包"><a class="markdownIt-Anchor" href="#软件工具技能包"></a> 软件工具技能包</h3><p>以前只知道用pandas读数据，matplotlib绘图，这次学到了一些新知识，在此记录。</p><h4 id="missingno"><a class="markdownIt-Anchor" href="#missingno"></a> missingno</h4><p>见名知意，这个包是用来处理缺失值的。</p><pre class="highlight"><code class="python">missingno.matrix(dataframe)</code></pre><p><img src="https://s1.ax1x.com/2020/03/24/8LtwOH.png" srcset="/img/loading.gif" alt="8LtwOH.png" /></p><pre class="highlight"><code class="python">missingno.bar(dataframe)</code></pre><p><img src="https://s1.ax1x.com/2020/03/24/8LtW6g.png" srcset="/img/loading.gif" alt="8LtW6g.png" /></p><p>可以直观的让我们看出哪些数据有缺失值</p><h4 id="pandas"><a class="markdownIt-Anchor" href="#pandas"></a> pandas</h4><pre class="highlight"><code class="python">DataFrame.skew()DataFrame.kurt()</code></pre><p>查看数值型数据的偏度和峰度</p><pre class="highlight"><code class="python">DataFrame.corr() </code></pre><p>计算数据的相关性</p><pre class="highlight"><code class="python">Series.astype(<span class="hljs-string">'category'</span>)Series.cat.add_category(list)</code></pre><p>astype将某个Seiries转成category型数据</p><p>add_category为category型数据添加新的类别</p><pre class="highlight"><code class="python">pd.melt(dataframe,id_vars,value_vars,var_name,value_name)</code></pre><p>将列名转为列数据，id_vars是保留的列，value_vars是要转换的列，var_name、value_name对应保留和转换后的列名，盗用一张图表示</p><p><img src="https://img-blog.csdn.net/20180927155514513?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21pbmdrb3Vrb3U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" srcset="/img/loading.gif" alt="melt" /></p><h4 id="seaborn"><a class="markdownIt-Anchor" href="#seaborn"></a> seaborn</h4><p>有中文的<a href="https://seaborn.apachecn.org/" target="_blank" rel="noopener">文档</a>，查阅起来十分方便</p><p>以前绘图使用的都是matplotlib，今天见识到了seaborn的强大，并且绘制出来的图也十分好看</p><pre class="highlight"><code class="python">seaborn.distplot(a, bins=<span class="hljs-literal">None</span>, hist=<span class="hljs-literal">True</span>, kde=<span class="hljs-literal">True</span>, rug=<span class="hljs-literal">False</span>, fit=<span class="hljs-literal">None</span>, hist_kws=<span class="hljs-literal">None</span>, kde_kws=<span class="hljs-literal">None</span>, rug_kws=<span class="hljs-literal">None</span>, fit_kws=<span class="hljs-literal">None</span>, color=<span class="hljs-literal">None</span>, vertical=<span class="hljs-literal">False</span>, norm_hist=<span class="hljs-literal">False</span>, axlabel=<span class="hljs-literal">None</span>, label=<span class="hljs-literal">None</span>, ax=<span class="hljs-literal">None</span>)</code></pre><p>灵活绘制单变量观测值分布图 ,fit可以配合scipy使用，查看数据是否符合某种数学分布</p><pre class="highlight"><code class="python">seaborn.heatmap(data, vmin=<span class="hljs-literal">None</span>, vmax=<span class="hljs-literal">None</span>, cmap=<span class="hljs-literal">None</span>, center=<span class="hljs-literal">None</span>, robust=<span class="hljs-literal">False</span>, annot=<span class="hljs-literal">None</span>, fmt=<span class="hljs-string">'.2g'</span>, annot_kws=<span class="hljs-literal">None</span>, linewidths=<span class="hljs-number">0</span>, linecolor=<span class="hljs-string">'white'</span>, cbar=<span class="hljs-literal">True</span>, cbar_kws=<span class="hljs-literal">None</span>, cbar_ax=<span class="hljs-literal">None</span>, square=<span class="hljs-literal">False</span>, xticklabels=<span class="hljs-string">'auto'</span>, yticklabels=<span class="hljs-string">'auto'</span>, mask=<span class="hljs-literal">None</span>, ax=<span class="hljs-literal">None</span>, **kwargs)</code></pre><p>可以将pandas处理的corr数据放进去，绘制出热力图，选择不同的主题就很舒服</p><p><img src="https://seaborn.apachecn.org/docs/img/e18cb02ed3ad1b91b540951f2912539b.jpg" srcset="/img/loading.gif" alt="cmap" /></p><pre class="highlight"><code class="python">seaborn.pairplot(data, hue=<span class="hljs-literal">None</span>, hue_order=<span class="hljs-literal">None</span>, palette=<span class="hljs-literal">None</span>, vars=<span class="hljs-literal">None</span>, x_vars=<span class="hljs-literal">None</span>, y_vars=<span class="hljs-literal">None</span>, kind=<span class="hljs-string">'scatter'</span>, diag_kind=<span class="hljs-string">'auto'</span>, markers=<span class="hljs-literal">None</span>, height=<span class="hljs-number">2.5</span>, aspect=<span class="hljs-number">1</span>, dropna=<span class="hljs-literal">True</span>, plot_kws=<span class="hljs-literal">None</span>, diag_kws=<span class="hljs-literal">None</span>, grid_kws=<span class="hljs-literal">None</span>, size=<span class="hljs-literal">None</span>)</code></pre><p>diag_kind选择对角线图的类型，可选 {‘auto’, ‘hist’, ‘kde’} 三种类型</p><pre class="highlight"><code class="python">seaborn.regplot(x, y, data=<span class="hljs-literal">None</span>, x_estimator=<span class="hljs-literal">None</span>, x_bins=<span class="hljs-literal">None</span>, x_ci=<span class="hljs-string">'ci'</span>, scatter=<span class="hljs-literal">True</span>, fit_reg=<span class="hljs-literal">True</span>, ci=<span class="hljs-number">95</span>, n_boot=<span class="hljs-number">1000</span>, units=<span class="hljs-literal">None</span>, order=<span class="hljs-number">1</span>, logistic=<span class="hljs-literal">False</span>, lowess=<span class="hljs-literal">False</span>, robust=<span class="hljs-literal">False</span>, logx=<span class="hljs-literal">False</span>, x_partial=<span class="hljs-literal">None</span>, y_partial=<span class="hljs-literal">None</span>, truncate=<span class="hljs-literal">False</span>, dropna=<span class="hljs-literal">True</span>, x_jitter=<span class="hljs-literal">None</span>, y_jitter=<span class="hljs-literal">None</span>, label=<span class="hljs-literal">None</span>, color=<span class="hljs-literal">None</span>, marker=<span class="hljs-string">'o'</span>, scatter_kws=<span class="hljs-literal">None</span>, line_kws=<span class="hljs-literal">None</span>, ax=<span class="hljs-literal">None</span>)</code></pre><p>注意和之前的不同，由于是两个变量之间的回归，所以x,y值得是变量名，data才是DataFrame数据</p><pre class="highlight"><code class="python">seaborn.boxplot(x=<span class="hljs-literal">None</span>, y=<span class="hljs-literal">None</span>, hue=<span class="hljs-literal">None</span>, data=<span class="hljs-literal">None</span>, order=<span class="hljs-literal">None</span>, hue_order=<span class="hljs-literal">None</span>, orient=<span class="hljs-literal">None</span>, color=<span class="hljs-literal">None</span>, palette=<span class="hljs-literal">None</span>, saturation=<span class="hljs-number">0.75</span>, width=<span class="hljs-number">0.8</span>, dodge=<span class="hljs-literal">True</span>, fliersize=<span class="hljs-number">5</span>, linewidth=<span class="hljs-literal">None</span>, whis=<span class="hljs-number">1.5</span>, notch=<span class="hljs-literal">False</span>, ax=<span class="hljs-literal">None</span>, **kwargs)</code></pre><p>同样x、y是字符串，data是数据</p><pre class="highlight"><code class="python">seaborn.violinplot(x=<span class="hljs-literal">None</span>, y=<span class="hljs-literal">None</span>, hue=<span class="hljs-literal">None</span>, data=<span class="hljs-literal">None</span>, order=<span class="hljs-literal">None</span>, hue_order=<span class="hljs-literal">None</span>, bw=<span class="hljs-string">'scott'</span>, cut=<span class="hljs-number">2</span>, scale=<span class="hljs-string">'area'</span>, scale_hue=<span class="hljs-literal">True</span>, gridsize=<span class="hljs-number">100</span>, width=<span class="hljs-number">0.8</span>, inner=<span class="hljs-string">'box'</span>, split=<span class="hljs-literal">False</span>, dodge=<span class="hljs-literal">True</span>, orient=<span class="hljs-literal">None</span>, linewidth=<span class="hljs-literal">None</span>, color=<span class="hljs-literal">None</span>, palette=<span class="hljs-literal">None</span>, saturation=<span class="hljs-number">0.75</span>, ax=<span class="hljs-literal">None</span>, **kwargs)</code></pre><p>小提琴图的功能与箱型图类似。 它显示了一个（或多个）分类变量多个属性上的定量数据的分布，从而可以比较这些分布。与箱形图不同，其中所有绘图单元都与实际数据点对应，小提琴图描述了基础数据分布的核密度估计。</p><pre class="highlight"><code class="python">seaborn.FacetGrid(data, row=<span class="hljs-literal">None</span>, col=<span class="hljs-literal">None</span>, hue=<span class="hljs-literal">None</span>, col_wrap=<span class="hljs-literal">None</span>, sharex=<span class="hljs-literal">True</span>, sharey=<span class="hljs-literal">True</span>, height=<span class="hljs-number">3</span>, aspect=<span class="hljs-number">1</span>, palette=<span class="hljs-literal">None</span>, row_order=<span class="hljs-literal">None</span>, col_order=<span class="hljs-literal">None</span>, hue_order=<span class="hljs-literal">None</span>, hue_kws=<span class="hljs-literal">None</span>, dropna=<span class="hljs-literal">True</span>, legend_out=<span class="hljs-literal">True</span>, despine=<span class="hljs-literal">True</span>, margin_titles=<span class="hljs-literal">False</span>, xlim=<span class="hljs-literal">None</span>, ylim=<span class="hljs-literal">None</span>, subplot_kws=<span class="hljs-literal">None</span>, gridspec_kws=<span class="hljs-literal">None</span>, size=<span class="hljs-literal">None</span>)</code></pre><p>来了难点了，以前的只要代数据就可以，这个网格稍微复杂点</p><p>col_wrap 指定网络的列数，col指定列维度，row指定行维度，hue指定第三个维度。在指定维度上，会绘制对应类别的数据。</p><p>之后可以调用FacetGrid对象的map方法。像下面的小栗子</p><pre class="highlight"><code class="python">g = sns.FacetGrid(tips, col=<span class="hljs-string">"time"</span>)g.map(plt.hist, <span class="hljs-string">"tip"</span>);</code></pre><p><img src="https://seaborn.apachecn.org/docs/img/5e335e837566d00501c0389d96625993.jpg" srcset="/img/loading.gif" alt="map" /></p><p>col对应的维度是time，而time有Lunch和Dinner两类数据，就会分别在两列绘制对应的数句。map方法传入要绘制的图类型函数plt.hist,并传递参数名称。</p><pre class="highlight"><code class="python">g = sns.FacetGrid(tips, col=<span class="hljs-string">"sex"</span>, hue=<span class="hljs-string">"smoker"</span>)g.map(plt.scatter, <span class="hljs-string">"total_bill"</span>, <span class="hljs-string">"tip"</span>, alpha=<span class="hljs-number">.7</span>)g.add_legend();</code></pre><p>这是传入第三维度的例子</p><p><img src="https://seaborn.apachecn.org/docs/img/96cf02373c746bde1b58beb44b2f25c8.jpg" srcset="/img/loading.gif" alt="hue" /></p><p>好啦，这次就都这里了，快到deadline了，上传下我的博客。</p>]]></content>
    
    
    <categories>
      
      <category>数据分析</category>
      
      <category>Regression</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据分析</tag>
      
      <tag>EDA</tag>
      
      <tag>回归</tag>
      
      <tag>比赛</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04-spelling-correction</title>
    <link href="/2020/02/16/04-spelling-correction/"/>
    <url>/2020/02/16/04-spelling-correction/</url>
    
    <content type="html"><![CDATA[<p>今天要介绍的是拼写检查，主要基于语言模型。</p><h2 id="spelling-tasks"><a class="markdownIt-Anchor" href="#spelling-tasks"></a> Spelling Tasks</h2><p>拼写检查任务主要包括两个方面，一方面是拼写错误侦测，另一方面是拼写错误修正。</p><p>拼写错误分为两种：</p><p>1.Non-word Errors：比如漏写导致的错误，graffe-&gt;giraffe。这类错误产生的词不存在。可以通过词典来进行侦测。找出与这些词相近的词，有两种方法，最小编辑路径法，信道法（Highest noisy channel probability）。</p><p>2.Real-word Errors：一种是打印错误，如 three-&gt;there顺序颠倒。另一种是认知错误，如piece-&gt;peace,too-&gt;two，发音相同导致的错误。这类错误产生的词是真实存在的，要先找到与这些词发音拼写相近的词形成候选集，在通过信道模型和分类器选择最好的候选词。</p><h2 id="the-nosiy-channel-model-of-spelling"><a class="markdownIt-Anchor" href="#the-nosiy-channel-model-of-spelling"></a> The Nosiy Channel Model of Spelling</h2><p>The intuition of Noisy Model is that the words we see may be wrong words were produced through Noisy Channel。我们观察到的拼写错误的词，可以建立一个概率模型找到正确的词。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mover accent="true"><mi>w</mi><mo>^</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mrow><mi>w</mi><mo>∈</mo><mi>V</mi></mrow></munder><mi>P</mi><mo stretchy="false">(</mo><mi>w</mi><mi mathvariant="normal">∣</mi><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mrow><mi>w</mi><mo>∈</mo><mi>V</mi></mrow></munder><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mrow><mi>w</mi><mo>∈</mo><mi>V</mi></mrow></munder><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{w} &amp;=\underset{w \in V}{\operatorname{argmax}} P(w | x) \\&amp;=\underset{w \in V}{\operatorname{argmax}} \frac{P(x | w) P(w)}{P(x)} \\&amp;=\underset{w \in V}{\operatorname{argmax}} P(x | w) P(w)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.905422999999999em;vertical-align:-3.2027115em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.7027114999999995em;"><span style="top:-6.2897115em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span></span></span><span style="top:-3.5965705em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"></span></span><span style="top:-1.4904295000000003em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.2027115em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.7027114999999995em;"><span style="top:-6.2897115em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.161229em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.966141em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord">∣</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span><span style="top:-3.5965705em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.161229em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.966141em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.4904295000000003em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.161229em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.966141em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.2027115em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>V是词表</p><h3 id="non-word-spellig-error-example"><a class="markdownIt-Anchor" href="#non-word-spellig-error-example"></a> Non-word spellig error example</h3><p>比如acress这个词我们要找到他的拼写正确的词</p><p>首先要产生候选集，候选集的产生又两种，一种是基于拼写上的相近，另一种是基于发音上的相近。</p><p>最小编辑距离又有四种类型：插入，删除，替换，相邻位置词的替换。插入删除 编辑距离为1，替换编辑距离为2</p><p><a href="https://imgchr.com/i/3pEYTg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/02/16/3pEYTg.md.png" srcset="/img/loading.gif" alt="3pEYTg.md.png" /></a></p><p>大部分拼写错误的编辑距离都在1以内，几乎所有拼写错误都包含在编辑距离2.</p><p>会用到两种模型，一种是Language Model，另一种是Channel Model Probability，即正确的词产生某种拼写错误的概率。</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">P(x | w)=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span> probability of the edit<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>是正确词 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>是拼写错误的词</p><p>deletion/insertion/substitution/transposition)</p><p>拼写错误的四种情况可以产生对应的混淆矩阵</p><p>del[x,y]:  count(xy typed as x)</p><p>ins[x,y]:  count(x typed as xy)</p><p>sub[x,y]:  count(x typed as y)</p><p>trans[x,y]: count(xy typed as yx)</p><p>基于语料进行统计，比如有多少次xy被拼成了x啊，x被拼成了xy</p><p><img src="https://s2.ax1x.com/2020/02/16/3pVtu6.png" srcset="/img/loading.gif" alt="3pVtu6.png" /></p><p>基于上图的混淆矩阵我们就可以计算对应错误的概率</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.15999999999999992em" columnalign="center left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi mathvariant="normal">del</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">]</mo></mrow></mrow><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">]</mo></mrow></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext> if deletion </mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi mathvariant="normal">ins</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>i</mi></msub><mo fence="true">]</mo></mrow></mrow><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">]</mo></mrow></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext> if insertion </mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi mathvariant="normal">sub</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">]</mo></mrow></mrow><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">]</mo></mrow></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext> if substitution </mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi mathvariant="normal">trans</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo fence="true">]</mo></mrow></mrow><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><msub><mi>w</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo fence="true">]</mo></mrow></mrow></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext> if transposition </mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">P(x | w)=\left\{\begin{array}{cl}{\frac{\operatorname{del}\left[w_{i-1}, w_{i}\right]}{\operatorname{count}\left[w_{i-1}, w_{i}\right]},} &amp; {\text { if deletion }} \\{\frac{\operatorname{ins}\left[w_{i-1}, x_{i}\right]}{\operatorname{count}\left[w_{i-1}\right]},} &amp; {\text { if insertion }} \\{\frac{\operatorname{sub}\left[x_{i}, w_{i}\right]}{\operatorname{count}\left[w_{i}\right]},} &amp; {\text { if substitution }} \\{\frac{\operatorname{trans}\left[w_{i}, w_{i+1}\right]}{\operatorname{count}\left[w_{i}, w_{i+1}\right]},} &amp; {\text { if transposition }}\end{array}\right.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:6.120000000000001em;vertical-align:-2.810000000000001em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2500199999999997em;"><span style="top:-1.2999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.2999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.5999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.8999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.1999899999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.60001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.90001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.20001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.500019999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3099999999999996em;"><span style="top:-5.309999999999999em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">d</span><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight">l</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span style="top:-3.779999999999999em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">i</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">s</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span style="top:-2.2499999999999982em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">s</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">b</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span style="top:-0.7199999999999989em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">t</span><span class="mord mathrm mtight">r</span><span class="mord mathrm mtight">a</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">s</span></span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">[</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">]</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.810000000000001em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3099999999999996em;"><span style="top:-5.309999999999999em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> if deletion </span></span></span></span></span><span style="top:-3.779999999999999em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> if insertion </span></span></span></span></span><span style="top:-2.2499999999999982em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> if substitution </span></span></span></span></span><span style="top:-0.7199999999999989em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> if transposition </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.810000000000001em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>这些概率可以用来对应候选集各个单词的概率，错误词对应的可能的真实词的概率</p><p><img src="https://s2.ax1x.com/2020/02/16/3pZ1Z8.png" srcset="/img/loading.gif" alt="3pZ1Z8.png" /></p><p>再加上language model</p><p><img src="https://s2.ax1x.com/2020/02/16/3pZyi4.png" srcset="/img/loading.gif" alt="3pZyi4.png" /></p><p>我们就可以找到最大概率的词，当然啦这只是基于当前词unigram</p><p>再看bigram</p><p>“a stellar and versatile <strong>acress</strong> whose combination of sass and glamour…”</p><p>•P(actress|versatile)=.000021</p><p>P(whose|actress) = .0010</p><p>•P(across|versatile) =.000021</p><p>P(whose|across) = .000006</p><p>基于bigram计算出对应前后两个词组成序列的概率</p><p>•P(“versatile actress whose”) = .000021*.0010 = 210 x10-10</p><p>•P(“versatile across whose”) = .000021*.000006 = 1 x10-10</p><p>再乘上对应的编辑距离概率，就能得出候选集各个词的概率</p><h3 id="real-word-spelling-errors"><a class="markdownIt-Anchor" href="#real-word-spelling-errors"></a> Real-word spelling errors</h3><p>就是这个词在字典中是存在的，但是并不是我们要的那个词。</p><p>•The design <strong>an</strong> construction of the system…</p><p>•Can they <strong>lave</strong> him my messages?</p><p>第一步也是产生候选集，for each word in sentence</p><p>因为这些词是真实存在与字典中的，所以词自身也是在候选集里，其他的还包括单一编辑距离词，发音相近的词等。</p><p>真实存在词拼写检查流程比较明显的特点就是它是基于整个句子，对每个词都产生候选集，将所有词进行组合，选择概率最大的那个序列路径的词</p><p>•Given a sentence w1,w2,w3,…,wn</p><p>•Generate a set of candidates for each word wi</p><p>•Candidate(w1) = {w1, w’1 , w’’1 , w’’’1 ,…}</p><p>•Candidate(w2) = {w2, w’2 , w’’2 , w’’’2 ,…}</p><p>•Candidate(wn) = {wn, w’n , w’’n , w’’’n ,…}</p><p>•Choose the sequence W that maximizes P(W)</p><p>下面这张图应该就比较好理解了</p><p><img src="https://s2.ax1x.com/2020/02/16/3pmh5D.png" srcset="/img/loading.gif" alt="3pmh5D.png" /></p><p>很明显，two of the应该是计算后概率最大的路径。</p><p>也可以简化计算，每次只替换路径中的一个词，一般来说拼写错误只会拼错一个吧。</p><p>和non-word error相比,real-word error多了一个概率计算，no error $$\mathrm{P}(\mathrm{w} | \mathrm{w})$$<br />那么这个词本身就是正确的概率是多少呢？需要根据具体应用而定。假设你要做的应用，十个词就有一个是错误的，那么就是0.90，20个词里面有1个是错误的就是0.95.</p><p>看一下，现面的例子</p><p><img src="https://s2.ax1x.com/2020/02/16/3puNkT.png" srcset="/img/loading.gif" alt="3puNkT.png" /></p><p>在unigram模型中，thew很有可能就是the拼错的，如果假设语料的拼写错误概率是0.9的情况下</p><h2 id="state-of-the-art-systems"><a class="markdownIt-Anchor" href="#state-of-the-art-systems"></a> State-of-the-art Systems</h2><p>不再简单的把先验概率乘上channel model产生的错误概率，将独立性假设转为概率不相同</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi>w</mi><mo>^</mo></mover><mo>=</mo><munder><mo><mi mathvariant="normal">argmax</mi><mo>⁡</mo></mo><mrow><mi>w</mi><mo>∈</mo><mi>V</mi></mrow></munder><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mi mathvariant="normal">∣</mi><mi>w</mi><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><mi>w</mi><msup><mo stretchy="false">)</mo><mi>λ</mi></msup></mrow><annotation encoding="application/x-tex">\hat{w}=\underset{w \in V}{\operatorname{argmax}} P(x | w) P(w)^{\lambda}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.865249em;vertical-align:-0.966141em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.161229em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mop"><span class="mord mathrm">a</span><span class="mord mathrm">r</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">m</span><span class="mord mathrm">a</span><span class="mord mathrm">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.966141em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">λ</span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>针对non-word error，产生了上面的公式，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">λ</span></span></span></span>可以通过development  test set 中学习出来。</p><h3 id="phonetic-error-model"><a class="markdownIt-Anchor" href="#phonetic-error-model"></a> Phonetic error model</h3><p>简单的来说就是加上发音来修正拼写错误，原来的拼写错误都是基于字母的拼写错误，现在把发音因素也考虑到拼写错误。比如下面的规则：</p><p>•“Drop duplicate adjacent letters, except for C.”</p><p>•“If the word begins with ‘KN’, ‘GN’, ‘PN’, ‘AE’, ‘WR’, drop the first letter.”</p><p>“Drop ‘B’ if after ‘M’ and if it is at the end of the</p><p>去掉这些字母后，根据发音来进行spelling correction？？？</p><p>接着找到和拼写错误词发音相差1-2的最小编辑错误候选词</p><p>计算概率时对不同的编辑错误候选给与不同的权重。</p><h3 id="improvement-to-channel-model"><a class="markdownIt-Anchor" href="#improvement-to-channel-model"></a> Improvement to channel model</h3><p>更丰富的编辑距离，不仅仅是删除插入替换等</p><p>•ent–&gt;ant</p><p>•ph–&gt;f</p><p>•le–&gt;al</p><p>将发音错误考虑到channel里面</p><h3 id="channel-model"><a class="markdownIt-Anchor" href="#channel-model"></a> channel model</h3><p>除了基于语料统计出插入删除替换产生的channel model，还可以考虑其他因素</p><p>•The source letter</p><p>•The target letter</p><p>•Surrounding letters</p><p>•The position in the word</p><p>•Nearby keys on the keyboard</p><p>•Homology on the keyboard</p><p>•Pronunciations</p><p>•Likely morpheme transformations</p><h3 id="classifier-based-methods-for-real-word-spelling-correction"><a class="markdownIt-Anchor" href="#classifier-based-methods-for-real-word-spelling-correction"></a> classifier-based methods for real-word spelling correction</h3><p>除了基于language model 、channel model的生成式模型，我们还可以利用特征输入分类器来进行拼写错误检查。</p><p>比如下面的例子</p><p>whether/weather</p><p>判断这个拼写错误到底是哪一个，我们考虑下面这些特征：<br />附近10个词内是否有cloudy，有的话那么很可能就是weather天气</p><p>后面 是不是接的 to VERB，是的话那么很有可能就是whether 是否</p><p>后面接的是不是 or not，是的话很有可能就是or not 是否</p>]]></content>
    
    
    <categories>
      
      <category>nlp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nlp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03-language-modeling</title>
    <link href="/2020/02/14/03-language-modeling/"/>
    <url>/2020/02/14/03-language-modeling/</url>
    
    <content type="html"><![CDATA[<p>今天要学习的是语言模型，好多东西呀！</p><h2 id="概念"><a class="markdownIt-Anchor" href="#概念"></a> 概念</h2><p>老师介绍了一大堆，我的理解语言模型就是对语言的合理性进行建模。这种建模可以是一个完整的句子的可能性，也可以是一句话基于之前的词预测出下一个词的可能性。数学公式表达如下：</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">P</mi><mo stretchy="false">(</mo><mi mathvariant="normal">W</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">P</mi><mrow><mo fence="true">(</mo><msub><mi mathvariant="normal">w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">W</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">W</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">W</mi><mn>4</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">W</mi><mn>5</mn></msub><mo>…</mo><msub><mi mathvariant="normal">W</mi><mi mathvariant="normal">n</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{P}(\mathrm{W})=\mathrm{P}\left(\mathrm{w}_{1}, \mathrm{W}_{2}, \mathrm{W}_{3}, \mathrm{W}_{4}, \mathrm{W}_{5} \dots \mathrm{W}_{\mathrm{n}}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">w</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span>  一个句子出现的概率</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">P</mi><mrow><mo fence="true">(</mo><msub><mi mathvariant="normal">w</mi><mi mathvariant="normal">n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi mathvariant="normal">w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">W</mi><mn>2</mn></msub><mo>…</mo><msub><mi mathvariant="normal">W</mi><mrow><mi mathvariant="normal">n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{P}\left(\mathrm{w}_{\mathrm{n}} | \mathrm{w}_{1}, \mathrm{W}_{2} \dots \mathrm{W}_{\mathrm{n}-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">w</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">w</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">n</span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span>基于之前词预测下一词</p><h2 id="语言模型的计算"><a class="markdownIt-Anchor" href="#语言模型的计算"></a> 语言模型的计算</h2><p>那么语言模型该如何计算呢？我们可以通过链式法则来计算一句话所有单词的联合概率</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><munder><mo>∏</mo><mi>i</mi></munder><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(w_{1} w_{2} \cdots w_{n}\right)=\prod_{i} P\left(w_{i} | w_{1} w_{2} \cdots w_{i-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>举个例子</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">P</mi><mrow><mo fence="true">(</mo><msup><mrow></mrow><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">s</mi></mrow><msup><mtext> water is so transparent&quot; </mtext><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup><mo fence="true">)</mo></mrow><mo>=</mo></mrow><annotation encoding="application/x-tex">\mathrm{P}\left(^{\prime \prime} \mathrm{its} \text { water is so transparent&quot; }^{\prime \prime}\right)=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">i</span><span class="mord mathrm">t</span><span class="mord mathrm">s</span></span><span class="mord"><span class="mord text"><span class="mord"> water is so transparent&quot; </span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.836232em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mspace width="1em"/><mi mathvariant="normal">P</mi><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">s</mi></mrow><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">P</mi><mo stretchy="false">(</mo><mtext> water </mtext><mi mathvariant="normal">∣</mi><mtext> its </mtext><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">P</mi><mo stretchy="false">(</mo><mtext> is lits water </mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\quad \mathrm{P}(\mathrm{its}) \times \mathrm{P}(\text { water } | \text { its }) \times \mathrm{P}(\text { is lits water })</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">i</span><span class="mord mathrm">t</span><span class="mord mathrm">s</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord text"><span class="mord"> water </span></span><span class="mord">∣</span><span class="mord text"><span class="mord"> its </span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord text"><span class="mord"> is lits water </span></span><span class="mclose">)</span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mspace width="1em"/><mo>×</mo><mi mathvariant="normal">P</mi><mo stretchy="false">(</mo><mtext> so lits water is </mtext><mo stretchy="false">)</mo><mo>×</mo></mrow><annotation encoding="application/x-tex">\quad \times \mathrm{P}(\text { so lits water is }) \times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord">×</span><span class="mord"><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord text"><span class="mord"> so lits water is </span></span><span class="mclose">)</span><span class="mord">×</span></span></span></span>P(transparent) its water is so<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span></span></span></span></p><p>这样一来，每个字都是依赖于之前所有的字，通过链式法则从第一个字一直传递到最后一个字，形成完整的一句话的概率。</p><p>但是随着句子长度增长，条件概率的计算变得不现实</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext> the </mtext><mi mathvariant="normal">∣</mi><mtext> its water is so transparent that </mtext><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mi>t</mi><mi>s</mi><mi>w</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>t</mi><mi>t</mi><mi>h</mi><mi>e</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>C</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mi>t</mi><mi>s</mi><mi>w</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(\text { the } | \text { its water is so transparent that })= Count (its water is so transparent that the) /Count (its water is so transparent that)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord"> the </span></span><span class="mord">∣</span><span class="mord text"><span class="mord"> its water is so transparent that </span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span></span></p><p>我们通过对序列计数来计算条件概率，当句子过长时，句子序列数量增长，有些句子序列我们根本就没见过，会导致分母部分概率为0，导致无法计算。由此引入了马尔科夫假设，即一个事务的状态只与之前的状态有关。</p><p>整个序列的概率可以用如下公式估计</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow><mo>≈</mo><mo>∏</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi></mrow></msub><mo>⋯</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(w_{1} w_{2} \cdots w_{n}\right) \approx \prod P\left(w_{i} | w_{i-k} \cdots w_{i-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∏</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>单个单词的条件概率估计</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>≈</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi></mrow></msub><mo>⋯</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(w_{i} | w_{1} w_{2} \cdots w_{i-1}\right) \approx P\left(w_{i} | w_{i-k} \cdots w_{i-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>当当前词的概率只与当前词有关，则是Unigram Model</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow><mo>≈</mo><munder><mo>∏</mo><mi>i</mi></munder><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(w_{1} w_{2} \cdots w_{n}\right) \approx \prod_{i} P\left(w_{i}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>当当前词概率与前一个词有关时，则是Bigram Model</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mn>1</mn></msub><msub><mi>w</mi><mn>2</mn></msub><mo>⋯</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>≈</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(w_{i} | w_{1} w_{2} \cdots w_{i-1}\right) \approx P\left(w_{i} | w_{i-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>由此可以继续推出3-gram、4-gram Model等n-gram model模型。</p><p>n-gram模型基于条件独立假设，忽略了语言之间的依赖性，但我们仍使用它。</p><h3 id="预测n-gram-概率"><a class="markdownIt-Anchor" href="#预测n-gram-概率"></a> 预测N-gram 概率</h3><p>举个bigram例子</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">P\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)}{c\left(w_{i-1}\right)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>在实际应用中，我们会加上句子的开始&lt;s&gt;和&lt;/s&gt;结尾符。</p><pre class="highlight"><code class="py">&lt;s&gt; I am Sam &lt;/s&gt;&lt;s&gt; Sam I am &lt;/s&gt;&lt;s&gt; I do <span class="hljs-keyword">not</span> like green eggs <span class="hljs-keyword">and</span> ham &lt;/s&gt;</code></pre><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.15999999999999992em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mi mathvariant="normal">I</mi><mi mathvariant="normal">∣</mi><mo>&lt;</mo><mi mathvariant="normal">s</mi><mo>&gt;</mo><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mo>=</mo><mi mathvariant="normal">.</mi><mn>67</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext> Sam </mtext><mi mathvariant="normal">∣</mi><mo>&lt;</mo><mi mathvariant="normal">s</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo>=</mo><mi mathvariant="normal">.</mi><mn>33</mn><mspace width="1em"/><mi>P</mi><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi></mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">I</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mo>=</mo><mi mathvariant="normal">.</mi><mn>67</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mo>&lt;</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">s</mi><mo>&gt;</mo><mi mathvariant="normal">∣</mi><mtext> Sam </mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.5</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext> Sam </mtext><mi mathvariant="normal">∣</mi><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mi mathvariant="normal">.</mi><mn>5</mn><mspace width="1em"/><mi>P</mi><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">o</mi></mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">I</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo>=</mo><mi mathvariant="normal">.</mi><mn>33</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{ll}{P(\mathrm{I} |&lt;\mathrm{s}&gt;)=\frac{2}{3}=.67} &amp; {P(\text { Sam } |&lt;\mathrm{s})=\frac{1}{3}=.33 \quad P(\mathrm{am} | \mathrm{I})=\frac{2}{3}=.67} \\{P(&lt;/ \mathrm{s}&gt;| \text { Sam })=\frac{1}{2}=0.5} &amp; {P(\text { Sam } | \mathrm{am})=\frac{1}{2}=.5 \quad P(\mathrm{do} | \mathrm{I})=\frac{1}{3}=.33}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.410216em;vertical-align:-0.9551080000000003em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4551079999999998em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">I</span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathrm">s</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">.</span><span class="mord">6</span><span class="mord">7</span></span></span></span><span style="top:-2.404892em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">/</span><span class="mord"><span class="mord mathrm">s</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">∣</span><span class="mord text"><span class="mord"> Sam </span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9551080000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4551079999999998em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord"> Sam </span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathrm">s</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">.</span><span class="mord">3</span><span class="mord">3</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">a</span><span class="mord mathrm">m</span></span><span class="mord">∣</span><span class="mord"><span class="mord mathrm">I</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">.</span><span class="mord">6</span><span class="mord">7</span></span></span></span><span style="top:-2.404892em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord"> Sam </span></span><span class="mord">∣</span><span class="mord"><span class="mord mathrm">a</span><span class="mord mathrm">m</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:1em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">d</span><span class="mord mathrm">o</span></span><span class="mord">∣</span><span class="mord"><span class="mord mathrm">I</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">.</span><span class="mord">3</span><span class="mord">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9551080000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><p>基于语料我们可以形成对应bigram表</p><p><img src="https://s2.ax1x.com/2020/02/14/1jzkut.png" srcset="/img/loading.gif" alt="1jzkut.png" /></p><p>这种概率计算出来的概率会很小，可能会带来underflow问题，由此引出log函数将连乘转化为累加</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>×</mo><msub><mi>p</mi><mn>2</mn></msub><mo>×</mo><msub><mi>p</mi><mn>3</mn></msub><mo>×</mo><msub><mi>p</mi><mn>4</mn></msub><mo fence="true">)</mo></mrow><mo>=</mo><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mn>2</mn></msub><mo>+</mo><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mn>3</mn></msub><mo>+</mo><mi>log</mi><mo>⁡</mo><msub><mi>p</mi><mn>4</mn></msub></mrow><annotation encoding="application/x-tex">\log \left(p_{1} \times p_{2} \times p_{3} \times p_{4}\right)=\log p_{1}+\log p_{2}+\log p_{3}+\log p_{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="评价语言模型-perplexity"><a class="markdownIt-Anchor" href="#评价语言模型-perplexity"></a> 评价语言模型 perplexity</h2><p>除了可以根据任务评价语言模型外，最直接的语言模型评价方法就是perplexity</p><p>一个好的语言模型应该能给真实的句子更高的概率，我们可以据此来评价语言模型。将模型在测试集上的概率的倒数n次幂后作为perplexity，bigrams公式如下</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">PP</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo><mo>=</mo><mroot><mrow><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><mn>1</mn><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mfrac></mrow><mi>N</mi></mroot></mrow><annotation encoding="application/x-tex">\operatorname{PP}(W)=\sqrt[N]{\prod_{i=1}^{N} \frac{1}{P\left(w_{i} | w_{i-1}\right)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">P</span><span class="mord mathrm">P</span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.3337550000000005em;vertical-align:-1.277669em;"></span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8087152000000003em;"><span style="top:-2.9670502em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0560860000000005em;"><span class="svg-align" style="top:-5.293754999999999em;"><span class="pstrut" style="height:5.293755em;"></span><span class="mord" style="padding-left:1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-4.0160860000000005em;"><span class="pstrut" style="height:5.293755em;"></span><span class="hide-tail" style="min-width:0.742em;height:3.373755em;"><svg width='400em' height='3.373755em' viewBox='0 0 400000 3373' preserveAspectRatio='xMinYMin slice'><path d='M702 80H400000v40H742v3239l-4 4-4 4c-.667.7-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span></span></span></span></span></p><p>困惑度越低代表模型越好</p><h2 id="smoothing-平滑"><a class="markdownIt-Anchor" href="#smoothing-平滑"></a> Smoothing 平滑</h2><p>当训练集和测试集很相似的时候，n-grams模型可以取得很好效果。但是现实中，训练集和测试集常有差别，导致在测试集中出现许多在训练集中没见过的东西。没见过的东西概率是0，那么测试集中原本是正确的句子可能被预测为错误，而且概率为0，导致无法计算困惑度。</p><h3 id="劫富济贫"><a class="markdownIt-Anchor" href="#劫富济贫"></a> 劫富济贫</h3><p>将一些概率较高的gram分配给一些未出现过的gram</p><p><img src="https://s2.ax1x.com/2020/02/14/1vFolD.png" srcset="/img/loading.gif" alt="1vFolD.png" /></p><h3 id="add-one-estimation"><a class="markdownIt-Anchor" href="#add-one-estimation"></a> Add-one estimation</h3><p>对所有词都加一，那么分母就要机上词表大小V</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mtext>Add-1</mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>V</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">P_{\text {Add-1}}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)+1}{c\left(w_{i-1}\right)+V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Add-1</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><img src="https://s2.ax1x.com/2020/02/14/1vks4P.png" srcset="/img/loading.gif" alt="1vks4P.png" /></p><p>Add-one方法显得十分粗糙，所以并没有用在N-grams中，但在文本分类和0的数目不是很多的任务中会用到。</p><p>也可以不加1，加k，由此引出下列模型</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>P</mi><mrow><mtext>Add </mtext><mo>−</mo><mi>k</mi></mrow></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>k</mi></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>k</mi><mi>V</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>P</mi><mtext>Add-k</mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mi>V</mi></mfrac><mo fence="true">)</mo></mrow></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;P_{\text {Add }-k}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)+k}{c\left(w_{i-1}\right)+k V}\\&amp;P_{\text {Add-k}}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)+m\left(\frac{1}{V}\right)}{c\left(w_{i-1}\right)+m}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.48901em;vertical-align:-2.494505em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.994505em;"><span style="top:-5.157515em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"></span></span><span style="top:-2.331505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.494505em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.994505em;"><span style="top:-5.157515em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Add </span></span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.331505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Add-k</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59001em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7400100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.494505em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>保证分子加上的和和分母加上的相等即可，也可加上当前词的概率</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>P</mi><mtext>Add-k</mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mi>V</mi></mfrac><mo fence="true">)</mo></mrow></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>P</mi><mtext>UnigramPrior </mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>m</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}&amp;P_{\text {Add-k}}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)+m\left(\frac{1}{V}\right)}{c\left(w_{i-1}\right)+m}\\&amp;P_{\text {UnigramPrior }}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)+m P\left(w_{i}\right)}{c\left(w_{i-1}\right)+m}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.48901em;vertical-align:-2.494505em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.994505em;"><span style="top:-4.994505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"></span></span><span style="top:-2.331505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.494505em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.994505em;"><span style="top:-4.994505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Add-k</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59001em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7400100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.331505em;"><span class="pstrut" style="height:3.59001em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">UnigramPrior </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.494505em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h2 id="模型的融合"><a class="markdownIt-Anchor" href="#模型的融合"></a> 模型的融合</h2><h3 id="backoff-回退"><a class="markdownIt-Anchor" href="#backoff-回退"></a> Backoff 回退</h3><p>试一试那种语言模型好，谁好用谁。例如计算trigram时，预料中没有这个trigram，就用bigram来代替，bigram没有就用unigram代替。</p><h3 id="interpolation-插值"><a class="markdownIt-Anchor" href="#interpolation-插值"></a> Interpolation 插值</h3><p>将 unigram，bigram，trigram混用，通常会表现的更好。</p><p>简单的interpolation</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>P</mi><mo>^</mo></mover><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>λ</mi><mn>1</mn></msub><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msub><mi>λ</mi><mn>2</mn></msub><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msub><mi>λ</mi><mn>3</mn></msub><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{P}\left(w_{n} | w_{n-1} w_{n-2}\right)=&amp; \lambda_{1} P\left(w_{n} | w_{n-1} w_{n-2}\right) \\&amp;+\lambda_{2} P\left(w_{n} | w_{n-1}\right) \\&amp;+\lambda_{3} P\left(w_{n}\right)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.606769999999999em;vertical-align:-2.0533849999999996em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.553385em;"><span style="top:-4.606615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span><span style="top:-3.106615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.6066150000000006em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0533849999999996em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.553385em;"><span style="top:-4.606615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.106615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-1.6066150000000006em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0533849999999996em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>λ</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{i} \lambda_{i}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p><p>基于上文的interpolation</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>P</mi><mo>^</mo></mover><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><msub><mi>λ</mi><mn>1</mn></msub><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msub><mi>λ</mi><mn>2</mn></msub><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msub><mi>λ</mi><mn>3</mn></msub><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\hat{P}\left(w_{n} | w_{n-2} w_{n-1}\right)=&amp; \lambda_{1}\left(w_{n-2}^{n-1}\right) P\left(w_{n} | w_{n-2} w_{n-1}\right) \\&amp;+\lambda_{2}\left(w_{n-2}^{n-1}\right) P\left(w_{n} | w_{n-1}\right) \\&amp;+\lambda_{3}\left(w_{n-2}^{n-1}\right) P\left(w_{n}\right)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.654986em;vertical-align:-2.077493em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.577493em;"><span style="top:-4.630723em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.16666em;">^</span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span><span style="top:-3.106615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.582507em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.077493em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.577493em;"><span style="top:-4.630723em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.443561em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31477em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.106615em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.443561em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31477em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-1.582507em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.443561em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31477em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.077493em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>我们要找到能使概率最大的lambda</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>…</mo><msub><mi>w</mi><mi>n</mi></msub><mi mathvariant="normal">∣</mi><mi>M</mi><mrow><mo fence="true">(</mo><msub><mi>λ</mi><mn>1</mn></msub><mo>…</mo><msub><mi>λ</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mi>log</mi><mo>⁡</mo><msub><mi>P</mi><mrow><mi>M</mi><mrow><mo fence="true">(</mo><msub><mi>λ</mi><mn>1</mn></msub><mo>…</mo><msub><mi>λ</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow></mrow></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log P\left(w_{1} \ldots w_{n} | M\left(\lambda_{1} \ldots \lambda_{k}\right)\right)=\sum_{i} \log P_{M\left(\lambda_{1} \ldots \lambda_{k}\right)}\left(w_{i} | w_{i-1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mtight"><span class="mord mathdefault mtight">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="minner mtight">…</span><span class="mord mtight"><span class="mord mathdefault mtight">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>对于大规模的n-gram模型，如果某个词序列个数为0，导致n-gram为0，则可以降低n-gram阶数，计算之前的n-gram概率。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.15999999999999992em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>i</mi></msubsup><mo fence="true">)</mo></mrow></mrow><mrow><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext> if </mtext><mi mathvariant="normal">count</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>i</mi></msubsup><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0.4</mn><mi>S</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mi>k</mi><mo>+</mo><mn>2</mn></mrow><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext> otherwise </mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">S\left(w_{i} | w_{i-k+1}^{i-1}\right)=\left\{\begin{array}{cc}{\frac{\operatorname{count}\left(w_{i-k+1}^{i}\right)}{\operatorname{count}\left(w_{i-k+1}^{i-1}\right)}} &amp; {\text { if } \operatorname{count}\left(w_{i-k+1}^{i}\right)&gt;0} \\{0.4 S\left(w_{i} | w_{i-k+2}^{i-1}\right)} &amp; {\text { otherwise }}\end{array}\right.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.224674em;vertical-align:-0.35001em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-2.408561em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3497699999999999em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.49999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.30002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9223975em;"><span style="top:-3.9223975em;"><span class="pstrut" style="height:3.31em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.31em;"><span style="top:-2.4924999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">(</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8754071428571427em;"><span style="top:-2.152771428571429em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.9043214285714285em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.40674999999999994em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">)</span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6125em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">c</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">t</span></span><span class="minner mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">(</span></span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9020857142857144em;"><span style="top:-2.214em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34552142857142853em;"><span></span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.07500000000000001em;"><span class="mtight">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.81em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span style="top:-2.2476024999999997em;"><span class="pstrut" style="height:3.31em;"></span><span class="mord"><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864795em;"><span style="top:-2.398692em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35963899999999993em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4223975000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.9223975em;"><span style="top:-3.9223975em;"><span class="pstrut" style="height:3.31em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> if </span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathrm">c</span><span class="mord mathrm">o</span><span class="mord mathrm">u</span><span class="mord mathrm">n</span><span class="mord mathrm">t</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4168920000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34143899999999994em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span style="top:-2.2476024999999997em;"><span class="pstrut" style="height:3.31em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord"> otherwise </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4223975000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h2 id="高级平滑"><a class="markdownIt-Anchor" href="#高级平滑"></a> 高级平滑</h2><h3 id="absolute-discounting-interpolation"><a class="markdownIt-Anchor" href="#absolute-discounting-interpolation"></a> Absolute Discounting Interpolation</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mtext>AbsoluteDiscounting </mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>−</mo><mi>d</mi></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>u</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow></mfrac><mo>+</mo><mi>λ</mi><mrow><mo fence="true">(</mo><msub><mover><mo><mi>w</mi></mo><mi>d</mi></mover><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mi>P</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P_{\text {AbsoluteDiscounting }}\left(w_{i} | w_{i-1}\right)=\frac{c\left(w_{i-1}, w_{i}\right)-d}{c\left(u_{i}\right)}+\lambda\left(\stackrel{d}{w}_{i-1}\right) P(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">AbsoluteDiscounting </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mrel"><span class="mrel"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2513880000000002em;"><span style="top:-3.03472em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.66528em;margin-left:0.02691em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span></span></p><p>将我们频率出现较高的词减去一部分，分给较低的一部分。d通常取0.75或者比较小的数</p><h3 id="kneser-ney-smotting"><a class="markdownIt-Anchor" href="#kneser-ney-smotting"></a> Kneser-Ney Smotting</h3><p>I used to eat Chinese food with ______ instead of knife and fork.</p><p>当我们在一句话中预测未知词，我们除了要考虑词的unigram，还要考虑这个词的bigram，它是否适合和别的词组成词，即一种连续性。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mtext>CONTTNUATION </mtext></msub><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mo fence="true">∣</mo><mrow><mo fence="true">{</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>:</mo><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>w</mi><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mo fence="true">}</mo></mrow><mo fence="true">∣</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mrow><mo fence="true">{</mo><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>:</mo><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mo fence="true">}</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">P_{\text {CONTTNUATION }}(w)=\frac{\left|\left\{w_{i-1}: c\left(w_{i-1}, w\right)&gt;0\right\}\right|}{|\left\{\left(w_{j-1}, w_{j}\right): c\left(w_{j-1}, w_{j}\right)&gt;0\right\}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CONTTNUATION </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.399108em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;">}</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;">}</span></span><span class="mclose delimcenter" style="top:0em;">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>上面时w这个词在语料中产生的bigram数量，下面是语料中所有词的bigram数量</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mtext>CONTTNUATON </mtext></msub><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mo fence="true">∣</mo><mrow><mo fence="true">{</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>:</mo><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>w</mi><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mo fence="true">}</mo></mrow><mo fence="true">∣</mo></mrow><mrow><munder><mo>∑</mo><msup><mi>w</mi><mo mathvariant="normal">′</mo></msup></munder><mrow><mo fence="true">∣</mo><mrow><mo fence="true">{</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><mo mathvariant="normal">′</mo></msubsup><mo>:</mo><mi>c</mi><mrow><mo fence="true">(</mo><msubsup><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><mo mathvariant="normal">′</mo></msubsup><mo separator="true">,</mo><msup><mi>w</mi><mo mathvariant="normal">′</mo></msup><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mo fence="true">}</mo></mrow><mo fence="true">∣</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">P_{\text {CONTTNUATON }}(w)=\frac{\left|\left\{w_{i-1}: c\left(w_{i-1}, w\right)&gt;0\right\}\right|}{\sum_{w^{\prime}}\left|\left\{w_{i-1}^{\prime}: c\left(w_{i-1}^{\prime}, w^{\prime}\right)&gt;0\right\}\right|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CONTTNUATON </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.529em;vertical-align:-1.102em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.24801em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.17826999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.86199em;"><span style="top:-2.2559899999999997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.86199em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000999999999993em;"><span></span></span></span></span></span></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">{</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3351949999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.733692em;"><span style="top:-2.4231360000000004em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3351949999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">}</span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.86199em;"><span style="top:-2.2559899999999997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.86199em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35000999999999993em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;">}</span></span><span class="mclose delimcenter" style="top:0em;">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.102em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>将<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mtext>CONTINUATION </mtext></msub><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P_{\text {CONTINUATION }}(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CONTINUATION </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>引入之前定义的abosolute discounting</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>K</mi><mi>N</mi></mrow></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>−</mo><mi>d</mi><mo separator="true">,</mo><mn>0</mn><mo fence="true">)</mo></mrow></mrow><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mfrac><mo>+</mo><mi>λ</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><msub><mi>P</mi><mtext>CONTINUATION</mtext></msub><mrow><mo fence="true">(</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{K N}\left(w_{i} | w_{i-1}\right)=\frac{\max \left(c\left(w_{i-1}, w_{i}\right)-d, 0\right)}{c\left(w_{i-1}\right)}+\lambda\left(w_{i-1}\right) P_{\text {CONTINUATION}}\left(w_{i}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">CONTINUATION</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p><p>max是为了使分子都大于0</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mi>d</mi><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow></mrow></mfrac><mrow><mo fence="true">∣</mo><mrow><mo fence="true">{</mo><mi>w</mi><mo>:</mo><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>w</mi><mo fence="true">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mo fence="true">}</mo></mrow><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda\left(w_{i-1}\right)=\frac{d}{c\left(w_{i-1}\right)}\left|\left\{w: c\left(w_{i-1}, w\right)&gt;0\right\}\right|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">λ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.30744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">∣</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mclose delimcenter" style="top:0em;">}</span></span><span class="mclose delimcenter" style="top:0em;">∣</span></span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">λ</span></span></span></span>取值，只有当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mrow><mo fence="true">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">c\left(w_{i-1}, w_{i}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span>&gt;0时才会减去d，这里又乘上减去d的次数。</p><p>平滑算法太复杂啦，今天先到这儿，我还要再理解理解。</p>]]></content>
    
    
    <categories>
      
      <category>nlp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nlp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02 basic text processing</title>
    <link href="/2020/02/12/02-basic-text-processing/"/>
    <url>/2020/02/12/02-basic-text-processing/</url>
    
    <content type="html"><![CDATA[<p>今天学习正则表达式的使用，后面还有一个小作业要做，开始啦！</p><h1 id="正则表达式"><a class="markdownIt-Anchor" href="#正则表达式"></a> 正则表达式</h1><h2 id="disjunctions-析取"><a class="markdownIt-Anchor" href="#disjunctions-析取"></a> Disjunctions 析取</h2><p>我也不知道中文该怎么说，暂定析取吧。disjunction用 <strong>[]</strong> 表示，表示选取括号中表示的一个字符。下面举个例子</p><table><thead><tr><th>Pattern</th><th>Matches</th></tr></thead><tbody><tr><td>[wW]oodchunk</td><td>Woodchunk,woodchunk</td></tr><tr><td>[123456789]</td><td>any digit(由于匹配是贪心的，所以只要是数字都会匹配)</td></tr></tbody></table><p>像数字每次都要把十个阿拉伯数字都写出来太麻烦了，所以有了range用法</p><table><thead><tr><th>Pattern</th><th>Matches</th></tr></thead><tbody><tr><td>[A-Z]</td><td>An uppeer case letter</td></tr><tr><td>[a-z]</td><td>A lowwer case letter</td></tr><tr><td>[0-9]</td><td>A single digit</td></tr></tbody></table><h2 id="negation-in-disjunction-析取取反"><a class="markdownIt-Anchor" href="#negation-in-disjunction-析取取反"></a> Negation in Disjunction 析取取反</h2><p>翻译忽略， <strong>^</strong> carat就是取反的意思，在disjunction中经常会用到</p><p><strong>^</strong> 只有在析取 <strong>[]</strong> 中作为第一个字符才表示取反，也就是说**^** 与 <strong>[]</strong> 常常连用</p><table><thead><tr><th>Pattern</th><th>Matcher</th><th>Examples</th></tr></thead><tbody><tr><td>[^A-Z]</td><td>Not an upper case letter</td><td>H<strong>ello</strong> W<strong>orld</strong></td></tr><tr><td>[^Ss]</td><td>Neither <strong>S</strong> nor <strong>s</strong></td><td>S<strong>ay</strong></td></tr><tr><td>[<sup>e</sup>]</td><td>Neither e nor ^</td><td>^e<strong>ergg</strong></td></tr><tr><td>a^b</td><td>The pattern a carat b,as a signal tobe matched</td><td><strong>a^b</strong></td></tr></tbody></table><h2 id="more-disjunction-取或"><a class="markdownIt-Anchor" href="#more-disjunction-取或"></a> More Disjunction 取或</h2><p>用 **|**来表示，表示取或的意思，或者理解成linux的管道？在前面的基础上继续进行运算。</p><table><thead><tr><th>Pattern</th><th>Matches</th></tr></thead><tbody><tr><td>hello|world</td><td>匹配hello或者world</td></tr><tr><td>a|b|c</td><td>等同于[abc]</td></tr><tr><td>[Hh]ello|[Ww]orld</td><td>匹配大小写开头的hello或者world</td></tr></tbody></table><p>值得注意的是 <strong>|</strong> 判断的是符号之前或之后的连续字符是否匹配，而不是只看前面若干个字符匹配情况。</p><h2 id=""><a class="markdownIt-Anchor" href="#"></a> ？ * +.</h2><table><thead><tr><th>Patter</th><th>Matches</th><th>Instances</th></tr></thead><tbody><tr><td>colou?r</td><td>optional previous char,?号前面的字符可有可无</td><td>color colour</td></tr><tr><td>oo*h!</td><td>0 or more of previous char,0次或者更多次</td><td>oh!,ooh!,oooh!</td></tr><tr><td>o+h!</td><td>1 or more of previous char,1次或者更多次</td><td>oh!,ooh!</td></tr><tr><td>baa+</td><td></td><td>baa,baaa</td></tr><tr><td>beg.n</td><td>1 char,单个字符，可以是任意字符</td><td>beggn，beg1n，beg2n</td></tr></tbody></table><h2 id="anchors-锚"><a class="markdownIt-Anchor" href="#anchors-锚"></a> Anchors ^$ 锚</h2><p>说白了，就是表明位置。<strong>^</strong> 后的字符表示该字符在序列开始处，<strong>$</strong> 前的字符表示该字符在结尾处。</p><table><thead><tr><th>Pattern</th><th>Matches</th></tr></thead><tbody><tr><td>^[A-Z]</td><td><strong>P</strong>alo Alto 只匹配前面的一个大写P</td></tr><tr><td>^[^A-Za-z]</td><td>**1    “**Hello”  实验证明只能匹配一个字符并不能匹配引号，ppt上有误</td></tr><tr><td>\.$</td><td>The end. 以.结尾</td></tr><tr><td>.$</td><td>匹配结尾的任意一个字符 The end**？**  The end**！**</td></tr></tbody></table><h2 id="-2"><a class="markdownIt-Anchor" href="#-2"></a> </h2><h1 id="文本序列化"><a class="markdownIt-Anchor" href="#文本序列化"></a> 文本序列化</h1><h2 id="text-normalization-文本规范化"><a class="markdownIt-Anchor" href="#text-normalization-文本规范化"></a> Text Normalization 文本规范化</h2><p>引出几个概念</p><p><strong>lemma</strong> 词根：cat 和 cats的词根是相同的</p><p><strong>wordform</strong> 词形：cat 和 cats的词形式不同的</p><p>对于词的类型和数目也有讲究，比如一句简单的英语</p><p>they lay back on the San Fancisco grass and looked at the stars and their</p><p>关于词的数目，San Fancisco是算一个词还是两个词呢</p><p>关于词的类型，they和their算不算同一类词呢？</p><p>都是问题</p><p>我们通产用N表示token的数目，用V表示词典词的大小，也就是词类型数目</p><p>不同的语言在token的过程中会遇到不同的问题，这里就不一一例举了。</p><p>课程中还专门介绍了中文分词方法，最大正向匹配法。最大正向匹配法的思想很简单，就是拿词典中最长的词去遍历语句，匹配成功则分词，不成功则换长度更短的词继续匹配，直至匹配结束。</p><p>下面介绍集中常见的文本规范化方法。</p><h2 id="word-normalization"><a class="markdownIt-Anchor" href="#word-normalization"></a> Word Normalization</h2><h3 id="case-folding"><a class="markdownIt-Anchor" href="#case-folding"></a> Case folding</h3><p>大小写转换，文本处理中我们通常会将大写转化为小写，但是这也会带来一些问题。例如机器翻译中，大写US和小写us完全不是一个意思。但是在信息检索中，我们习惯小写，如果出现了大写也会同时检索小写的结果。</p><h3 id="lemmatization"><a class="markdownIt-Anchor" href="#lemmatization"></a> Lemmatization</h3><p>词性还原，根据词典找到词初始的词形式，比如单复数，所有格，时态的还原</p><p>am，are，is --&gt; be</p><h3 id="morphology"><a class="markdownIt-Anchor" href="#morphology"></a> Morphology</h3><p>形态还原，将词分为词干和词缀，在信息检索中就常会用到Stemming。保留词的词干用来检索，</p><p>例如compressed和compression都能通过它们的词干compress检索到。</p><p>英语中会有专门的规则用来获取词的词干，比如下面这条。</p><p>（*v*)ing  去掉ing后的词干，词干中含有元音</p><p>walking  --&gt;walk a是元音</p><p>sing  --&gt;sing  s不是元音，所以词干不是s</p><p>秀一波正则表达式，.*[aoeiu].*ing$，就是上面我们说的匹配所有类似于walking这样的词</p><h2 id="sentence-segmentation-and-decision-trees"><a class="markdownIt-Anchor" href="#sentence-segmentation-and-decision-trees"></a> Sentence Segmentation and Decision Trees</h2><p>句子的划分有时候也是一个问题。英语中的句号.有时会被当作其他用途，并不是真正表示一句话结束，例如%0.2中的.就不是表示句子结束,所以我们要建立一个分类器来判断哪里是句子的开始哪里句子结束了.</p><p>例如决策树来判断句子是否结束.</p><p><img src="https://s2.ax1x.com/2020/02/12/1bw3v9.png" srcset="/img/loading.gif" alt="1bw3v9.png" /></p><p>我们需要手工选取许多特征输入决策树让决策树判断</p>]]></content>
    
    
    <categories>
      
      <category>nlp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nlp</tag>
      
      <tag>正则表达式</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01 introduction to nlp</title>
    <link href="/2020/02/12/01-introduction-to-nlp/"/>
    <url>/2020/02/12/01-introduction-to-nlp/</url>
    
    <content type="html"><![CDATA[<h2 id="写在前面"><a class="markdownIt-Anchor" href="#写在前面"></a> 写在前面</h2><p>研究生读了半年了，越来越迷茫了，没有认认真真做好一件事。今天，立帖为证，我一定要将这门课认真修完，勤做笔记，完成作业。话不多说，开始吧！附上<a href="https://www.bilibili.com/video/av35805262" target="_blank" rel="noopener">课程链接</a>。</p><h2 id="nlp的应用领域"><a class="markdownIt-Anchor" href="#nlp的应用领域"></a> nlp的应用领域</h2><ol><li><p>Question Answering 问答</p></li><li><p>Information Extraction 信息抽取</p></li><li><p>Sentiment Analysis 情感分析</p></li><li><p>机器翻译</p></li></ol><p>自然语言在垃圾邮件侦测、词性标注、命名实体识别上已经取得了较好的表现，在情感分类、指代消解、句法分析、机器翻译、信息抽取也有所进步，尤其是现在的神经机器翻译，比之前的统计机器翻译取得了长足的进步，不过这门课开设时间已经比较早了，那时候深度学习还没有大规模应用到nlp中。但在问答、摘要、对话系统、改述（Paraphrase）等方面表现还有待提高。</p><h2 id="歧义让nlp变得更加困难"><a class="markdownIt-Anchor" href="#歧义让nlp变得更加困难"></a> 歧义让nlp变得更加困难</h2><p>举个例子，这是纽约时报的一条新闻头条</p><p>Fed raises interest rates</p><p>既可以理解为Fed这个人将利率interest rates 提高了，也可以理解为Fed这个人对rates这个东西起了兴趣raise interest。</p><p>当给出更多信息时，可以帮助我们消除这种模糊性。</p><p>Fed raises interest rates 0.5%</p><p>这时候我们就知道了新闻真实想表达的意思是利率提高了%0.5，而不是Fed来了兴趣.</p><h2 id="其他的困难"><a class="markdownIt-Anchor" href="#其他的困难"></a> 其他的困难</h2><ol><li>非标准英语 比如推特上的用语可能就很不规范</li><li>切分问题 一个词不同的切分会带来不同的问题</li><li>俚语 类似于我们的成语,不能通过字面意思来判断他的意思</li><li>新词 类似于给力这种新词汇</li><li>外部知识 知识的不确定性</li><li>实体名 有些词可能是专有名词,不能按字面意思理解</li></ol><h2 id="写在后面"><a class="markdownIt-Anchor" href="#写在后面"></a> 写在后面</h2><p>第一篇差不多就到这儿了,完事开头难,加油写下去哦!</p>]]></content>
    
    
    <categories>
      
      <category>nlp</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nlp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用torchtext处理中文文本</title>
    <link href="/2020/01/08/%E4%BD%BF%E7%94%A8torchtext%E5%A4%84%E7%90%86%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC/"/>
    <url>/2020/01/08/%E4%BD%BF%E7%94%A8torchtext%E5%A4%84%E7%90%86%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p>torchtext是pytorch中专门用来处理文本的包，使用torchtext可以灵活的帮我们生成batch和词向量。网上介绍的大多是基于英文的版本，自己在中文文本上进行了尝试，将之前的英文文本分类改成中文文本分类。下面开始介绍。</p><h2 id="数据格式"><a class="markdownIt-Anchor" href="#数据格式"></a> 数据格式</h2><table><thead><tr><th>text</th><th>label</th></tr></thead><tbody><tr><td>又要写博客了，好开心啊</td><td>0</td></tr><tr><td>程序出bug了，唉</td><td>1</td></tr></tbody></table><p>数据格式可以是csv、tsv、json文件，自己比较喜欢处理csv、tsv文件两者是一样的，json文件还没怎么接触。数据的内容如上所示，包括文本列和标签列，一般会分为train、dev、test三个集合。本文用到train.tsv、dev.tsv、test.tsv。</p><h2 id="field"><a class="markdownIt-Anchor" href="#field"></a> Field</h2><p>我也不知道这个该叫啥，针对我们要处理的不同数据分别创建Field对象。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> torchtext.data <span class="hljs-keyword">as</span> data<span class="hljs-keyword">import</span> jieba<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tokenizer</span><span class="hljs-params">(x)</span>:</span>    <span class="hljs-keyword">return</span> list(jieba.cut(x))text_field=data.Field(tokenize=tokenizer,fix_length=<span class="hljs-number">60</span>)label_field=data.LabelField(dtype=torch.long)</code></pre><p>针对我们需要处理的text列和label列，我们创建了两个Field对象，分别用来处理对应列。因为我们需要对text进行分词，所以需要指定分词器，我这里用的结巴。分词器的返回结果需要是关于词语的列表，可以根据自己的需求指定。fix_length指定单个序列的长度，torchtext会自动帮我们进行padding和裁剪操作。label列是分类的类别列，torchtext相应提供了LabelField，需要指定数据类型。看别人的代码，使用Field也能用，自己还没实验过。</p><p>Field中还有其他参数</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_bigrams</span><span class="hljs-params">(x)</span>:</span>    n_grams = set(zip(*[x[i:] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>)]))    <span class="hljs-keyword">for</span> n_gram <span class="hljs-keyword">in</span> n_grams:        x.append(<span class="hljs-string">' '</span>.join(n_gram))    <span class="hljs-keyword">return</span> xtext_field=data.Field(tokenize=tokenizer,fix_length=<span class="hljs-number">60</span>,include_lengths=<span class="hljs-literal">True</span>,                     preprocessing=generate_bigrams)</code></pre><p>include_lengths,返回的minibatch中包含padded后的text和序列长度，序列长度对于我们处理变长序列有用。这样操作后，在后面的每个batch中，batch.text返回的就是一个（text，text_length）的元组。</p><p>preprocessing,添加预处理函数，tokenize后的结果返回的是列表类型数据，将这个列表数据再通过preprocessing指定的函数进行处理。</p><h2 id="tabulardataset"><a class="markdownIt-Anchor" href="#tabulardataset"></a> TabularDataset</h2><p>针对我们需要处理的表格数据，torch提供了TabularDataset帮助我们按行进行划分，按照表格对应列的顺序指定Field对象构成元组<code>fields=[('text', text_field)，('label', label_field), ]</code> ,label和text是别名，可以任意，我们后面可以通过这个别名获取batch的数据。除此之外还要指定数据的路径，格式，以及是否跳过表头等超参数。</p><pre class="highlight"><code class="">train,dev,test=data.TabularDataset.splits(path,train='trian.tsv',validation='dev.tsv',test='test.tsv',skip_header=True,fields=[('label',label_field),('text',text_field)],format='tsv')</code></pre><p>生成的数据格式如下</p><p><a href="https://imgchr.com/i/l2IfgO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/01/08/l2IfgO.md.png" srcset="/img/loading.gif" alt="l2IfgO.md.png" /></a></p><h2 id="构建映射和导入词向量"><a class="markdownIt-Anchor" href="#构建映射和导入词向量"></a> 构建映射和导入词向量</h2><p>前面将数据按行进行划分了，但是并没有建立词和索引的对应关系，也没有建立索引和词向量的对应关系，下一步就是建立词和索引和向量的关系</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> torchtext.vocab <span class="hljs-keyword">as</span> vocabvectors=vocab.Vectors(<span class="hljs-string">'embedding_path'</span>,<span class="hljs-string">'cachepath'</span>)text_field.build_vocab(train,dev,test,vectors,unk_init=torch.Tensor.normal_)label_field.build_vocab(train,dev,test)</code></pre><p>torchtext.vocab提供了一个缓存词向量的方法，在第一次读取词向量时将词向量缓存到指定目录，下次再读取词向量时直接从缓存目录中读取，这样就不用每次加载词向量了，加快了读取速度。未知词和padding词词语和索引对应关系为：{<unk>:0,<pad>:1}。其索引可以通过如下 方式获取：</p><pre class="highlight"><code class="python">PAD_IDX=text_field.vocab.stoi[text_field.pad_token]UNK_IDX=text_field.vocab.stoi[text_field.unk_token]</code></pre><p>未知词和padding词通常对我们的任务没有帮助，但<code>unk_init=torch.Tensor.normal_</code>却正太分布初始化了，获取了这两个词的索引可以帮助我们在后面的embedding层将其词向量重置为0</p><p>建立text中词和索引、词向量的映射关系时，需要输入要处理的数据、词向量，指定未识别词的初始化方式。</p><p>建立label中类别和索引的关系就比较简单了，输入之前生成的数据就好了。看一眼生成的词表和词向量</p><p><a href="https://imgchr.com/i/l2TJf0" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/01/08/l2TJf0.md.png" srcset="/img/loading.gif" alt="l2TJf0.md.png" /></a></p><h2 id="生成batch"><a class="markdownIt-Anchor" href="#生成batch"></a> 生成batch</h2><p>前面我们已经将每行数据进行了分词，建立了词表、索引等对应关系，接下来就是生成batch啦</p><pre class="highlight"><code class="python">train_iter,dev_iter,test_iter=data.BucketIterator.splits((train,dev,test),batch_sizes=(<span class="hljs-number">64</span>,len(dev),len(test)),    sort_key=<span class="hljs-keyword">lambda</span> x:len(x.text),sort_within_batch,repeat=<span class="hljs-literal">False</span>,    shuffle=<span class="hljs-literal">True</span>,device=device)</code></pre><p>首先指定要处理的数据（train，dev，test），接着指定各个数据对应要生成 的batch的batch_size大小，注意这里是多个数据集的batch_size,参数是batch_sizes=（64，len（dev),len(test)）,可以看到这里对dev和test我们的batchsize大小就是他们所有数据，所以这些数据只会生成一个batch。通常对训练集和验证集的数据要按数据长度进行排序，我们要指定排序的键sort_key，这里使用了匿名函数，text就是我们之前指定的别名。还包括其他一些参数，不一一介绍。至此我们就生成了text和label的batch集合，两者是合在一起的，我们可以通过batch的别名获得各自值。sort_within_batch,在一个batch内对数据进行排序。</p><h2 id="embedding"><a class="markdownIt-Anchor" href="#embedding"></a> embedding</h2><p>如何获得词表对应的embedding呢？</p><pre class="highlight"><code class="python">pretrained_embeddings=text_field.vocab.vectors</code></pre><p>可以和torch的embedding模块结合使用</p><pre class="highlight"><code class="python">embedding = nn.Embedding.from_pretrained(pretrained_embeddings, freeze=<span class="hljs-literal">False</span>)embedded=embedding(batch.text)</code></pre><p>embedding的输入需要是之前处理过的batch数据，torchtext会自动帮我们处理好对应关系。</p><p>那么我们如何处理边长序列呢？通常为了数据的通用性，我们对较短的数据会进行padding，让所有序列具有相同的长度。当使用RNN等网络时，经过padding的数据产生的hidden state、outputs对于我们并无帮助，我们主需要真是序列长产生的hidden state和outputs即可。torchtext提供了pack_padded_sequence和pad_packed_sequence两个方法，对embedded的结果进行处理加入序列长度。</p><pre class="highlight"><code class="python">embedded=self.embedding(text) <span class="hljs-comment">#添加了padding的embedding结果</span>packed_embedded=nn.utils.pack_padded_embedding(embedded,text_lengths)packed_output,(hidden,cell)=self.rnn(packed_output) <span class="hljs-comment">#没有padding的输出</span>output,output_lengths=nn.utils.rnn.pad_packed_sequence(packed_output) <span class="hljs-comment">#返回输出，和没有padding的句子长度</span></code></pre><p>对于unk和pad词我们可以将其词向量初始化为0向量</p><pre class="highlight"><code class="python">model.embedding.weight.data[UNK_IDX]=torch.zeros(EMBEDDING_DIM)model.embedding.weight.data[PAD_IDX]=torch.zeros(EMBEDDING_DIM)</code></pre><p>其实在调用field.build_coab时会自动将pad和unk初始化为0</p><p>还可以换种方式指定embedding</p><pre class="highlight"><code class="python">embedding=nn.Embedding(vocab_size,embedding_dim,pad_idx=pad_idx)</code></pre><p>先指定好embedding的形状，再在模型搭建好后指定embedding</p><pre class="highlight"><code class="">embedding=model.embedding.weight.data.copy_(pretrained_embeddings)</code></pre><p>收工~</p>]]></content>
    
    
    
    <tags>
      
      <tag>torchtext</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TextCNN</title>
    <link href="/2020/01/07/TextCNN/"/>
    <url>/2020/01/07/TextCNN/</url>
    
    <content type="html"><![CDATA[<p>学了点pytorch，最近在知乎刷到了一个repo主要是介绍文本分类的，感觉还不错，打算用来入门，自己将会比较细致的实现代码，分析代码的结构。天下大事必做于易，天下大事必做于细。寒假来了，自己基础较差，只能多花点时间了。</p><h2 id="基础网络"><a class="markdownIt-Anchor" href="#基础网络"></a> 基础网络</h2><p>作者自己没有直接调用torch的api，而是在其基础上进行实现。一些模块继承自<code>nn.Module</code>层，并且实现了初始化和前向计算。嘿呀，等我熟练了，我也要自己做一个工具箱。不多说上代码</p><h3 id="conv1d"><a class="markdownIt-Anchor" href="#conv1d"></a> Conv1d</h3><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> torch.nn.Functional <span class="hljs-keyword">as</span> F<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Conv1d</span><span class="hljs-params">(nn.Module)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,in_channels,out_channels,filter_sizes)</span>:</span>        super(Conv1d,self).__init__()        self.convs=nn.ModuleList([            nn.Conv1d(in_channels,out_channels,kernel_size=fs)            <span class="hljs-keyword">for</span> fs <span class="hljs-keyword">in</span> filter_sizes        ])        self.init_params()            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_params</span><span class="hljs-params">(self)</span>:</span>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.convs:            nn.init.xavier_uniform_(m.weight.data)            nn.init.constant_(m.bias.data,<span class="hljs-number">0.1</span>)                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self,x)</span>:</span>        <span class="hljs-keyword">return</span> [F.relu(conv(x))<span class="hljs-keyword">for</span> conv <span class="hljs-keyword">in</span> self.convs]</code></pre><p>让我们来细细品味这段代码，继承自 <code>nn.Module</code> 这不用说了，表明这个模块可以和torch自带的模块混用。<code>__init__</code>函数的参数有讲究，除了必传的<code>self</code>外，还传入了一些指定卷积层形状的参数，例如通道数：<code>in_channels、out_channels</code>,还有卷积核集合。这里传入的是卷积核集合，而不是单单一个卷积核需要注意。接下来是继承自父类的初始化，<code>super()</code>第一个参数一般为函数名，第二个是self,后面再接<code>__init__()</code>。在<code>__init__()</code>函数中放置要用到的模块或参数等，不涉及到具体的操作，在初始化层调用了后面定义的参数 初始化函数。</p><p>第二部分是初始化层，<code>init_params()</code>。初始化层比较好理解，初始化<code>init</code>层的参数就好。前面要初始化的只有<code>ModuleList</code>中的卷积层，卷积的函数改天专门总结一下。卷积层参数分为weight和bias两部分,bias部分初始化为0。</p><p>第三部分是前向传播，<code>forward()</code>。参数有输入x，由于有多个卷积核，将多个卷积核的卷积结果放到列表中。再调用<code>F.relu()</code>activation。不得不说<code>torch.nn.Functional</code> 超好用。</p><h2 id="linear"><a class="markdownIt-Anchor" href="#linear"></a> Linear</h2><p>Linear层和Conv1d结构上差不多，不过Linear层的初始化参数将卷积层的channel换成了feature，并且少了卷积核。代码如下：</p><pre class="highlight"><code class="python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Linear</span><span class="hljs-params">(nn.Module)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,in_features,out_features)</span>:</span>        super(Linear,self).__init__()        self.linear=nn.Linear(in_features=in_features,out_features=out_features)        self.init_params()            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_parmas</span><span class="hljs-params">(self)</span>:</span>        nn.init.kaiming_normal_(self.linear.weight)        nn.init.constant_(self,linear.bias,<span class="hljs-number">0</span>)            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self,x)</span>:</span>        x=self.linear(x)        <span class="hljs-keyword">return</span> x</code></pre><h2 id="textcnn"><a class="markdownIt-Anchor" href="#textcnn"></a> TextCNN</h2><p>到了最最关键的环节了，TextCNN层:</p><pre class="highlight"><code class="python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextCNN</span><span class="hljs-params">(nn.Module)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,embedding_dim,n_filters,filter_sizes,output_dim,dropout,                 pretrained_embeddings)</span>:</span>        super(TextCNN,self).__init__()        <span class="hljs-comment">#导入预训练的embedding frezee指定权重是否更新</span>        self.embedding=nn.Embedding.from_pretrained(pretrained_embeddings,freeze=<span class="hljs-literal">False</span>)        <span class="hljs-comment">#卷积核参数 embedding维数，卷积核个数，卷积核大小</span>        self.convs=Cov1d(embedding_dim,n_filters,filter_sizes)        <span class="hljs-comment">#前向运算 输入维度 预测输出</span>        self.fc=Linear(len(filter_sizes)*fliters,output_dim)        self.dropout=nn.Dropout(dropout)            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self,x)</span>:</span>        <span class="hljs-comment">#text:[sent_len,batch_size] 两个参数分别是行数列数</span>        text,_=x        <span class="hljs-comment">#维度换位 [batch_size,sent_len]</span>        text=text.permute(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)        <span class="hljs-comment"># [batch_size,sent_len,embedding_len]</span>        embedded=self.embedding(text)        <span class="hljs-comment">#[batch_size,emb_dim,sent_len]</span>        embedded=embedded.permute(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)        conved=self.convs(embedded)        <span class="hljs-comment">##[batch_size,n_filters,sent_len-filter_sizes[n]+1]</span>        pooled=[F.max_pool1d(conv,conv.shape[<span class="hljs-number">2</span>])               <span class="hljs-keyword">for</span> conv <span class="hljs-keyword">in</span> conved]        cat=self.dropout(torch.cat(pooled,dim=<span class="hljs-number">1</span>))        cat=cat.reshae((cat.shape[<span class="hljs-number">0</span>],<span class="hljs-number">-1</span>))        <span class="hljs-keyword">return</span> self.fc(cat)</code></pre><p>TextCNN层中的张量维度变换比较复杂，我是一下子反应不过来的，后面自己会debug彻底弄清楚每一步是怎么卷积的，维度怎么变换的。</p><h2 id="argparse"><a class="markdownIt-Anchor" href="#argparse"></a> argparse</h2><p>代码还有一个比较值得借鉴的点就是使用了argparse模块对各种参数进行管理，不是一个个手动去定义变量，更加清晰。</p><pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> argparse<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_args</span><span class="hljs-params">(data_dir, cache_dir, embedding_folder, model_dir, log_dir)</span>:</span>    parser = argparse.ArgumentParser(description=<span class="hljs-string">'SST'</span>)    <span class="hljs-comment"># data_util</span>    parser.add_argument(<span class="hljs-string">'--model_name'</span>, default=<span class="hljs-string">'TextCNN'</span>, type=str, help=<span class="hljs-string">'参数所属模型名'</span>)    parser.add_argument(<span class="hljs-string">'--seed'</span>, default=<span class="hljs-number">47</span>, type=int, help=<span class="hljs-string">'随机种子'</span>)    parser.add_argument(<span class="hljs-string">'--data_path'</span>, default=data_dir, type=str, help=<span class="hljs-string">'SST2数据集位置'</span>)    parser.add_argument(<span class="hljs-string">'--cache_path'</span>, default=cache_dir, type=str, help=<span class="hljs-string">'数据集地址'</span>)    parser.add_argument(<span class="hljs-string">'--sequence_length'</span>, default=<span class="hljs-number">60</span>, type=int, help=<span class="hljs-string">'句子长度'</span>)    <span class="hljs-comment"># 输出文件名</span>    parser.add_argument(<span class="hljs-string">'--model_dir'</span>, default=model_dir + <span class="hljs-string">'TextCNN/'</span>, type=str, help=<span class="hljs-string">'输出模型地址'</span>)    parser.add_argument(<span class="hljs-string">'--log_dir'</span>, default=log_dir + <span class="hljs-string">'TextCNN/'</span>, type=str, help=<span class="hljs-string">'日志文件地址'</span>)    parser.add_argument(<span class="hljs-string">'--do_train'</span>, action=<span class="hljs-string">'store_true'</span>, help=<span class="hljs-string">'Whether to run training'</span>)    parser.add_argument(<span class="hljs-string">'--print_step'</span>, default=<span class="hljs-number">100</span>, type=int, help=<span class="hljs-string">'多少步存储一次模型'</span>)    <span class="hljs-comment"># 优化参数</span>    parser.add_argument(<span class="hljs-string">'--batch_size'</span>, default=<span class="hljs-number">64</span>, type=int)    parser.add_argument(<span class="hljs-string">'--epoch_num'</span>, default=<span class="hljs-number">5</span>, type=int)    parser.add_argument(<span class="hljs-string">'--dropout'</span>, default=<span class="hljs-number">0.4</span>, type=float)    <span class="hljs-comment"># 模型参数</span>    parser.add_argument(<span class="hljs-string">'--output_dim'</span>, default=<span class="hljs-number">2</span>, type=int)    <span class="hljs-comment"># TextCNN参数</span>    parser.add_argument(<span class="hljs-string">'--filter_num'</span>, default=<span class="hljs-number">200</span>, type=int, help=<span class="hljs-string">'filter数量'</span>)    parser.add_argument(<span class="hljs-string">'--filter_sizes'</span>, default=<span class="hljs-string">'1 2 3 4 5'</span>, type=str, help=<span class="hljs-string">'filter的size'</span>)    <span class="hljs-comment"># word embdding</span>    parser.add_argument(<span class="hljs-string">'--glove_word_file'</span>, default=embedding_folder + <span class="hljs-string">'glove.6B.50d.txt'</span>,                        type=str, help=<span class="hljs-string">'path of embedding file'</span>)    parser.add_argument(<span class="hljs-string">'--glove_words_size'</span>, default=int(<span class="hljs-number">2.2e6</span>), type=int, help=<span class="hljs-string">'Corpus size for Glove'</span>)    parser.add_argument(<span class="hljs-string">'--glove_word_dim'</span>, default=<span class="hljs-number">50</span>, type=int, help=<span class="hljs-string">'word embedding size(default:300)'</span>)    config = parser.parse_args([])    <span class="hljs-keyword">return</span> config</code></pre><p>注意的一点就是parse_args()在notebook中需要加入[]作为参数，否则会报错。</p><h2 id="device"><a class="markdownIt-Anchor" href="#device"></a> device</h2><p>指定设备device，这个很容易理解</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_device</span><span class="hljs-params">()</span>:</span>    device=torch.device(<span class="hljs-string">'cuda:0'</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">'cpu'</span>)    n_gpu=torch.cuda.device_count()    <span class="hljs-keyword">if</span> torch.cuda.is_available():        print(<span class="hljs-string">'device is cuda,# cuda is:'</span>,n_gpu)    <span class="hljs-keyword">else</span>:        print(<span class="hljs-string">'device is cpu,not recommend'</span>)    <span class="hljs-keyword">return</span> device,n_gpu</code></pre><p>统计gpu数代码：<code>torch.cuda.device_count()</code></p><p>指定device代码：<code>torch.device('cuda:0')</code></p><h2 id="加载数据集"><a class="markdownIt-Anchor" href="#加载数据集"></a> 加载数据集</h2><p>对api还不太熟悉，这里也比较复杂。</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_sst2</span><span class="hljs-params">(path,text_field,label_field,batch_size,device,embedding_file,cache_dir)</span>:</span>    train,dev,test=data.TabularDataset.splits(    path=path,train=<span class="hljs-string">'train.tsv'</span>,validationj=<span class="hljs-string">'dev.tsv'</span>,        test=<span class="hljs-string">'test.tsv'</span>,format=<span class="hljs-string">'tsv'</span>,skip_header=<span class="hljs-literal">True</span>,        fields=[(<span class="hljs-string">'text'</span>,text_field),(<span class="hljs-string">'label'</span>,label_field)]    )    print(<span class="hljs-string">'the size of train:{},dev:{},test:{}'</span>.format(        len(train.examples), len(dev.examples), len(test.examples)    ))    <span class="hljs-comment">#将词向量放到缓存目录中，下次直接从换从目录中加载</span>    vectors=vocab.Vectors(embedding_file,cache_dir)        <span class="hljs-comment">#使用之前构建的词向量映射文本序列，将子序列转化为数字序列</span>    text_field.build_vocab(    train,dev,test,max_size=<span class="hljs-number">25000</span>,        vectors=vectors,unk_init=torch.Tensor.normal_    )    label_field.build_vocab(train,dev,test)        train_iter,dev_iter,test_iter=data.BucketIterator.splits(    (train,dev,test),batch_sizes=(batch_size,len(dev),len(test)),        sort_key=<span class="hljs-keyword">lambda</span> x:len(x.text),sort_within_batch=<span class="hljs-literal">True</span>,repeat=<span class="hljs-literal">False</span>,        shuffle=<span class="hljs-literal">True</span>,device=device    )    <span class="hljs-keyword">return</span> train_iter,dev_iter,test_iter</code></pre><p>得总结一下套路，看起来懵懵的</p><h2 id="训练"><a class="markdownIt-Anchor" href="#训练"></a> 训练</h2><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train</span><span class="hljs-params">(epoch_num,model,train_dataloader,dev_dataloader,optimizer,criterion,          label_list,out_model_file,log_dir,print_step,data_type=<span class="hljs-string">'word'</span>)</span>:</span>    <span class="hljs-comment">#首先转为训练模式</span>    model.train()    writer=SummaryWriter(log_dir=log_dir+time.strftime(<span class="hljs-string">'%H%M%S'</span>,time.gmtime()))    global_step=<span class="hljs-number">0</span>    best_dev_loss=float(<span class="hljs-string">'inf'</span>)        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(int(epoch_num)):        print(<span class="hljs-string">f'--------------Epoch:<span class="hljs-subst">{epoch+<span class="hljs-number">1</span>:<span class="hljs-number">02</span>}</span>--------------'</span>)                epoch_loss=<span class="hljs-number">0</span>        train_step=<span class="hljs-number">0</span>                all_preds=np.array([],dtype=int)        all_labels=np.array([],dtype=int)                <span class="hljs-keyword">for</span> step,batch <span class="hljs-keyword">in</span> enumerate(tqdm(train_dataloader,desc=<span class="hljs-string">'Iteration'</span>)):            <span class="hljs-comment">#首先梯度归零</span>            optimzier.zero_grad()            logits=model(batch.text)                        <span class="hljs-comment">#计算损失</span>            loss=criterion(logits.view(<span class="hljs-number">-1</span>,len(label_list)),batch.label)            labels=batch.label.detach().cpu().numpy()            preds=np.argmax(logits.detach().cpu().numpy(),axis=<span class="hljs-number">1</span>)                        <span class="hljs-comment">#计算梯度</span>            loss.backward()            optimizer.step()            global_step+=<span class="hljs-number">1</span>                        epoch_loss+=loss.item()            train_steps+=<span class="hljs-number">1</span>                        all_preds=np.append(all_preds,preds)            all_labels=np.append(all_labels,labels)                        <span class="hljs-comment">#打印</span>            <span class="hljs-keyword">if</span> global_step%print_step==<span class="hljs-number">0</span>:                train_loss=epoch_loss/train_steps                train_acc,train_report=classification_metric(                    all_preds,all_labels,label_list)                dev_loss,dev_acc,dev_report=evaluate(                    model,dev_dataloader,criterion,label_list,data_type                )                c=global_step/print_step                writer.add_scalar(<span class="hljs-string">'loss/train'</span>,train_loss,c)                writer.add_scalar(<span class="hljs-string">'loss/dev'</span>,dev_loss,c)                writer.add_scalar(<span class="hljs-string">'acc/train'</span>,train_acc,c)                writer.add_scalar(<span class="hljs-string">'acc/dev'</span>,dev_acc,c)                <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> label_list:                    writer.add_scalar(label+<span class="hljs-string">':'</span>+<span class="hljs-string">'f1/train'</span>,                                train_report[label][<span class="hljs-string">'f1-score'</span>],c)                    writer.add_scalar(label+<span class="hljs-string">':'</span>+<span class="hljs-string">'f1/dev'</span>,                                dev_report[label][<span class="hljs-string">'f1-score'</span>],c)                print_list=[<span class="hljs-string">'macro avg'</span>,<span class="hljs-string">'weighted avg'</span>]                <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> print_list:                    writer.add_scalar(label+<span class="hljs-string">':'</span>+<span class="hljs-string">'f1/train'</span>,                                train_report[label][<span class="hljs-string">'f1-score'</span>],c)                    writer.add_scalar(label+<span class="hljs-string">':'</span>+<span class="hljs-string">'f1/dev'</span>,                                dev_report[label][<span class="hljs-string">'f1-score'</span>],c)                <span class="hljs-keyword">if</span> dev_loss&lt;best_dev_loss:                    best_dev_loss=dev_loss                    torch.save(model.state_dict(),out_model_file)                model.train()    writer.close()</code></pre><p>训练函数有几个点总结，传入参数有：迭代次数、model、训练集、验证集，optimzer、损失函数、打印的epoch数，等等。</p><h2 id="evaluate"><a class="markdownIt-Anchor" href="#evaluate"></a> evaluate</h2><p>用于在训练过程中对训练结果进行测试</p><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">evaluate</span><span class="hljs-params">(model,iterator,criterion,label_list,data_type=<span class="hljs-string">'word'</span>)</span>:</span>    model.eval()    epoch_loss=<span class="hljs-number">0</span>    all_preds=np.array([],dtype=int)    all_labels=np.array([],dtype=int)    <span class="hljs-keyword">with</span> torch.no_grad():        <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> iterator:            <span class="hljs-keyword">if</span> data_type==<span class="hljs-string">'word'</span>:                <span class="hljs-keyword">with</span> torch.no_grad():                    logits=model(batch.text)            <span class="hljs-keyword">elif</span> data_type==<span class="hljs-string">'highway'</span>:                <span class="hljs-keyword">with</span> torch.no_grad():                    logits=model(batch.text_word,batch.text_char)            loss=criterion(logits.view(<span class="hljs-number">-1</span>,len(label_list)),batch.label)            labels=batch.label.detach().cpu().numpy()            preds=np.argmax(logits.detach().cpu().numpy(),axis=<span class="hljs-number">1</span>)            all_preds=np.append(all_preds,preds)            all_labels=np.append(all_labels,labels)            epoch_loss+=loss.item()    acc,report=classification_metric(all_preds,all_labels,label_list)    <span class="hljs-keyword">return</span> epoch_loss/len(iterator),acc,report</code></pre><p>测试过程中记得要切换到eval模式，并且关闭梯度追踪<code>with torch.no_grad()</code>。</p><h2 id="main函数"><a class="markdownIt-Anchor" href="#main函数"></a> main函数</h2><pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(config)</span>:</span>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(config.model_dir):        os.makedirs(config.model_dir)    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(config.log_dir):        os.makedirs(config.log_dir)    print(<span class="hljs-string">'\t \t \t the model name is {}'</span>.format(config.model_name))    device, n_gpu = get_device()    <span class="hljs-comment"># 指定torch 随机种子</span>    torch.manual_seed(config.seed)    <span class="hljs-comment"># 指定numpy 随机种子</span>    np.random.seed(config.seed)    torch.manual_seed(config.seed)    <span class="hljs-keyword">if</span> n_gpu &gt; <span class="hljs-number">0</span>:        <span class="hljs-comment"># 指定cuda随机种子</span>        torch.cuda.manual_seed_all(config.seed)        <span class="hljs-comment"># CuDNN的卷积操作就是每次一样,实验可重复</span>        torch.backends.cudnn.deterministic = <span class="hljs-literal">True</span>    <span class="hljs-comment"># sst2 数据准备</span>    text_field = data.Field(tokenize=<span class="hljs-string">'toktok'</span>, lower=<span class="hljs-literal">True</span>, include_lengths=<span class="hljs-literal">True</span>, fix_length=config.sequence_length)    label_field = data.LabelField(dtype=torch.long)    train_iterator, dev_iterator, test_iterator = load_sst2(config.data_path, text_field, label_field,                                                            config.batch_size,                                                            device, config.glove_word_file, config.cache_path)    <span class="hljs-comment"># 词向量准备 获取词向量按index顺序排序</span>    pretrained_embeddings = text_field.vocab.vectors    model_file = config.model_dir + <span class="hljs-string">'model1.pt'</span>    <span class="hljs-comment"># 模型准备 卷积核大小</span>    filter_sizes = [int(val) <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> config.filter_sizes.split()]    model = TextCNN(config.glove_word_dim, config.filter_num, filter_sizes,                    config.output_dim, config.dropout, pretrained_embeddings)    optimizer = torch.optim.Adam(model.parameters())    criterion = nn.CrossEntropyLoss()    model = model.to(device)    criterion = criterion.to(device)    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> config.do_train:        train(config.epoch_num, model, train_iterator, dev_iterator, optimizer, criterion,              [<span class="hljs-string">'0'</span>, <span class="hljs-string">'1'</span>], model_file, config.log_dir,config.print_step, <span class="hljs-string">'word'</span>)    model.load_state_dict(torch.load(model_file))    test_loss, test_acc, test_report = evaluate(model, test_iterator, criterion, [<span class="hljs-string">'0'</span>, <span class="hljs-string">'1'</span>], <span class="hljs-string">'word'</span>)    print(<span class="hljs-string">'-----------Test----------'</span>)    print(<span class="hljs-string">'\t Loss:{}|Acc:{}|Macro avg F1{}|Weighted avg F1{}'</span>.format(        test_loss, test_acc, test_report[<span class="hljs-string">'macro avg'</span>][<span class="hljs-string">'f1-score'</span>], test_report[<span class="hljs-string">'weighted avg'</span>][<span class="hljs-string">'f1-score'</span>]    ))</code></pre><p>太多啦，懒得再记录鸟~下面分析一下卷积的过程吧。</p><h2 id="卷积的过程"><a class="markdownIt-Anchor" href="#卷积的过程"></a> 卷积的过程</h2><p>代码中用了5个卷积核，卷积核的大小分别是[1,2,3,4,5]。一维卷积层的输入是词向量的拼接，本代码中使用的词向量是50维，每个样本有60个词，因此卷积的输入是50x60的矩阵<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>。一维卷积核的输入通道数就是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span>的宽50，输出通道数是卷积核的个数200，则卷积核[1,2,3,4,5]对应的输出分别为[200*x60,200x59,200x58,200x57,200x56]。再分别对行进行最大池化，得到的输出为5个[200x1]的向量，将这5个向量拼接起来成[1000x1]的向量，输入前馈神经网络[1000x2]，即可进行二分类。老实说，一维卷积的过程自己没太看懂。代码中将卷积核的个数作为一维卷积的输出通道数，embedding维度作为卷积的输入通道数。一直以来看到的都是二维卷积，一维卷积有点懵，下面画个草图理解下吧。</p><p><a href="https://imgchr.com/i/l2WFPS" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/01/08/l2WFPS.md.jpg" srcset="/img/loading.gif" alt="l2WFPS.md.jpg" /></a></p>]]></content>
    
    
    
    <tags>
      
      <tag>CNN</tag>
      
      <tag>文本分类</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>colab使用</title>
    <link href="/2020/01/07/colab%E4%BD%BF%E7%94%A8/"/>
    <url>/2020/01/07/colab%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>最近学习pytorch的使用，自己的电脑没有显卡，一些实验做不了，想起之前本科老师安利的colab，感谢谷歌提供的免费资源。</p><h2 id="访问谷歌"><a class="markdownIt-Anchor" href="#访问谷歌"></a> 访问谷歌</h2><p>colab基于谷歌云盘，既然是谷歌的服务，难免就要翻墙了。自己用的<a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="noopener">shadowsocks</a>，一年100块左右，大部分时间都挺稳定的。开启小飞机，你就可以看到外面的世界啦！</p><h2 id="云盘挂载"><a class="markdownIt-Anchor" href="#云盘挂载"></a> 云盘挂载</h2><p>关于colab的基础使用这里就不介绍了，可以自行百度。在使用colab的过程中，经常需要挂载云盘文件，参考了许多人的方法后，介绍一个无坑版。首先，在colab左侧的代码提示部分选择挂载colab会自动生成云盘挂载代码，如下所示：</p><p><a href="https://imgchr.com/i/l6wSsJ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/01/07/l6wSsJ.md.png" srcset="/img/loading.gif" alt="l6wSsJ.md.png" /></a></p><pre class="highlight"><code class="python"><span class="hljs-keyword">from</span> google.colab <span class="hljs-keyword">import</span> drivedrive.mount(<span class="hljs-string">'/gdrive'</span>)</code></pre><p>运行第一个单元格的代码，第二个是打开相关文件的代码忽略。运行后会给出一个超链接，点击进去验证得到验证码输入即可挂载成功，这时候我们挂载的位置是在<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">/</mi><mi>g</mi><mi>d</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">/gdrive</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span></span></span></span> 目录下。那么如何切换到我们想要的目录呢？再次打开左侧的代码提示部分，进入文件栏，点击 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.10556em;vertical-align:0em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span> 进入上层目录，进入<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">/</mi><mi>g</mi><mi>d</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">/gdrive</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span></span></span></span>目录，可以看到我们云盘下的目录文件，右击复制文件路径。</p><p><img src="https://s2.ax1x.com/2020/01/07/l6BdP0.png" srcset="/img/loading.gif" alt="l6BdP0.png" /></p><p>再通过魔法函数<span class="katex"><span class="katex-mathml"><math><semantics><mrow></mrow><annotation encoding="application/x-tex">%cd 路径</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span>就<code>%cd filepath</code> 就可以切换到指定的路径，此时colab的工作路径就是你指定的路径，你就可以像在本地一样操作colab的文件。操作非当前文件夹下的文件，指定好文件的路径即可。</p><pre class="highlight"><code class="python">%cd /gdrive/My Drive/Colab Notebooks/测试用的</code></pre><h2 id="无限容量"><a class="markdownIt-Anchor" href="#无限容量"></a> 无限容量</h2><p>colab默认的存储容量是15G，可能放几个大文件就占满了，升级的话又不支持支付宝，而且一年也要100多块。贫穷使我想起了歪门邪道。在淘宝上提供了colab扩容服务，20块就够了，其原理是将你加入一些学校的共享盘群组，你可以在上面无限制上传文件。可能会存在一些安全问题，但平时跑跑程序是完全没问题的。加入贡献盘后，我们可以看到自己的gdrive文件夹下多了一个Shared drives。我们可以在上面进行和原硬盘相同的操作，并且无线空间。厉害啦👍</p><p><img src="https://s2.ax1x.com/2020/01/07/l6rPXD.png" srcset="/img/loading.gif" alt="l6rPXD.png" /></p><h2 id="纪念自己的第一篇博客"><a class="markdownIt-Anchor" href="#纪念自己的第一篇博客"></a> 纪念自己的第一篇博客</h2><p>既然开了这个博客就要好好写哦，记录自己的学习、生活，努力成为更好的人啊！</p><p>加油</p><p>冲</p>]]></content>
    
    
    
    <tags>
      
      <tag>colab Google Drive</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
